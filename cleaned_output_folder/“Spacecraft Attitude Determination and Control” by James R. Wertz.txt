Space Technology Library F . Landis Markley John L. Crassidis Fundamentals of Spacecraft Attitude Determination and ControlFundamentals of Spacecraft Attitude Determination and ControlSPACE TECHNOLOGY LIBRARY Published jointly by Microcosm Press and Springer The Space Technology Library Editorial Board Managing Editor: James R. Wertz (Microcosm, Inc., El Segundo, CA) Editorial Board: Roland Doré (Professor and Director International Space Univer- sity, Strasbourg)Tom Logsdon (Senior member of Technical Staff, Space Divi- sion, Rockwell International) F. Landis Markley (NASA, Goddard Space Flight Center) Robert G. Melton (Professor of Aerospace Engineering, Penn- sylvania State University) Keiken Ninomiya (Professor, Institute of Space & Astronautical Science) Jehangir J. Pocha (Letchworth, Herts.) Rex W. Ridenoure (CEO and Co-founder at Ecliptic Enterprises Corporation) Gael Squibb (Jet Propulsion Laboratory, California Institute of Technology)Martin Sweeting (Professor of Satellite Engineering, University of Surrey) David A. Vallado (Senior Research Astrodynamicist, CSSI/AGI) Richard Van Allen (Vice President and Director, Space Systems Division, Microcosm, Inc.) For further volumes: http://www.springer.com/series/6575F. Landis Markley • John L. Crassidis Fundamentals of Spacecraft Attitude Determinationand Control 123F. Landis Markley Attitude Control Systems Engineering Branch NASA Goddard Space Flight CenterGreenbelt, MD, USAJohn L. Crassidis Mechanical and Aerospace EngineeringUniversity at BuffaloState University of New YorkAmherst, NY , USA ISBN 978-1-4939-0801-1 ISBN 978-1-4939-0802-8 (eBook) DOI 10.1007/978-1-4939-0802-8Springer New York Heidelberg Dordrecht London Library of Congress Control Number: 2014937452 © Springer Science+Business Media New York 2014 This work is subject to copyright. All rights are reserved by the Publisher, whether the whole or part ofthe material is concerned, speciﬁcally the rights of translation, reprinting, reuse of illustrations, recitation,broadcasting, reproduction on microﬁlms or in any other physical way, and transmission or information storage and retrieval, electronic adaptation, computer software, or by similar or dissimilar methodology now known or hereafter developed. Exempted from this legal reservation are brief excerpts in connectionwith reviews or scholarly analysis or material supplied speciﬁcally for the purpose of being entered and executed on a computer system, for exclusive use by the purchaser of the work. Duplication of this publication or parts thereof is permitted only under the provisions of the Copyright Law of thePublisher’s location, in its current version, and permission for use must always be obtained from Springer.Permissions for use may be obtained through RightsLink at the Copyright Clearance Center. Violations are liable to prosecution under the respective Copyright Law. The use of general descriptive names, registered names, trademarks, service marks, etc. in this publicationdoes not imply, even in the absence of a speciﬁc statement, that such names are exempt from the relevantprotective laws and regulations and therefore free for general use. While the advice and information in this book are believed to be true and accurate at the date of publication, neither the authors nor the editors nor the publisher can accept any legal responsibility forany errors or omissions that may be made. The publisher makes no warranty, express or implied, withrespect to the material contained herein. Springer grants the United States government royalty-free permission to reproduce all or part of this work and to authorize others to do so for United States government purposes. Printed on acid-free paper Springer is part of Springer Science+Business Media ( www.springer.com )To Gail, Michelle, and Isaac. To Pam and Lucas, and in memory of Lucas G.J. Crassidis.Preface This text provides the fundamental concepts and mathematical basis for spacecraft attitude determination and control. It is intended to serve as both a textbookfor undergraduate and graduate students and a reference guide for practicing professionals. A primary motivation of this text is to develop the theory of attitude determination from ﬁrst principles to practical algorithms, because very few of theexisting texts on spacecraft control treat spacecraft attitude determination in depth. We emphasize speciﬁc applications; so the reader can understand how the derived theory is applied to actual orbiting spacecraft. We also highlight some simpliﬁedanalytical expressions that can serve as ﬁrst cut analyses for more detailed studies and are especially important in the initial design phase of a spacecraft attitude determination and control system. For example, Sect. 6.3shows a simple single- axis analysis that is widely used by spacecraft engineers to design actual attitude estimation hardware and software conﬁgurations and to predict their performance. Analyses of this type can also help to determine whether anomalous behaviorencountered by an orbiting spacecraft is due to a hardware problem, a control system design error, or a programming error, and to ﬁnd a path to resolving the anomaly. In writing this book the authors hope to make a signiﬁcant contributiontoward expediting the process most newcomers must go through in assimilating and applying attitude determination and control theory. Chapter 1provides an introduction to the concepts presented in the text. It serves to motivate the reader by giving a historical review of the subject matter, including discussions of several actual missions that cover a broad spectrum of attitude determination and control designs. It also provides examples of how an inadequatetheoretical analysis can cause a failure to meet mission objectives or, even worse, loss of a mission. Some examples of creative strategies to recover from potential mission failures are also presented. Chapter 2begins with a review of linear algebra and moves on to the basic ideas of spacecraft attitude studies: reference frames, transformations between reference frames, and alternative representations of these transformations. Chapter 3provides detailed derivations of attitude kinematics and dynamics, including a treatment of the torques acting on spacecraft. Chapter 4 provides the mathematical models behind the most common types of spacecraft viiviii Preface sensors and actuators. Actual hardware speciﬁcations of these sensors and actuators are not given because the rapid development of this technology would quickly render them obsolete. Chapter 5is a detailed treatment of attitude determination methods that do not depend on a retained memory of past observations. The most famous method in this category, the solution of Wahba’s problem, is introduced, accompanied by several algorithms for solving it and a rigorous statistical analysis of its estimation errors. Chapter 6covers attitude determination methods that mitigate the effects of sensor errors by incorporating dynamic models into a ﬁltering process to retain a memory of past observations. Here the focus is on Kalman ﬁltering, including both calibration and mission mode ﬁlters. Chapter 7shows the fundamentals of attitude control, including some recent theoretical advancements on the effects of noise on the control system design. This book is the product of many years of experience possessed by the authors working on actual spacecraft attitude determination and control designs for numer- ous missions. Several actual mission examples are presented throughout the text to help the reader bridge the gap between theory and practice. For example, Sect. 5.8 presents an attitude determination algorithm that is employed onboard the Tropical Rainfall Measuring Mission (TRMM) as of this writing. Most of the mission examples in this text provide representative examples of typical mission mode designs. However, the authors wish to also show how the theory presented in the text can be applied to nonstandard mission modes derived from unique requirements. Section 7.7presents the speciﬁc example of the range of mission modes actually used in the attitude determination and control system of the Solar, Anomalous, and Magnetospheric Particle Explorer (SAMPEX), each mode responding to its own unique challenges. Section 6.4.5 presents experimental magnetometer calibration results from the Transition Region and Coronal Explorer (TRACE) to give the reader a taste of how algorithm designs perform with real data. All of the examples are based on a “ground up” approach, i.e., starting with the fundamentals and leading towards an actual onboard algorithm. As stated previously, this text can be used for an undergraduate course in spacecraft dynamics and controls. The second author has taught a senior level course in this area for many years, which is split into two parts: (1) orbital dynamics and (2) attitude kinematics and dynamics. Chapter 10provides the material that is used for the orbital dynamics portion of the course. Chapters 2and3provide the necessary material for the attitude kinematics and dynamics portion of the course.Chapter 8gives a list of quaternion identities, many of which have not appeared in open literature. Chapter 9presents the explicit equations for the attitude matrices and kinematic equations for all 12 Euler angle representations of the attitude. Chapter 10gives an overview of orbital dynamics to provide the background required to understand several topics in th e text, such as the local-vertical/local- horizontal frame in Sect. 2.6.4 . Chapter 11provides a summary of environment models, which is crucial to understanding their effect on spacecraft translational and rotational motion. Chapter 12reviews the theoretical basis of general control and estimation in enough detail to refresh the reader’s memory of the concepts that underlie the applications in the text.Preface ix Material for a graduate level course can include a brief review of orbital dynamics from Chapter 10followed by the environmental models shown in Chapter 11. Chapters 5and 6can provide the bulk of a graduate course covering attitude determination and estimation. Chapter 7can also be used in the graduate course to provide an introduction to attitude control. The authors believe that the entire book can serve as a reference or refresher for practitioners, which provides the primary motivation for including Chap. 4in the text. To encourage student learning we have incorporated both analytical and computer-based problems at the end of each chapter. This promotes working problems from ﬁrst principles. General computer software and coded scripts have deliberately not been included with this text. Instead, a website with computer programs for all the examples shown in the text can be accessed by the reader subject, we feel that they may hinder rigorous theoretical studies that are required to properly comprehend the material. Therefore, we strongly encourage students to program their own computer routines, using the codes provided from the website for veriﬁcation purposes only. We are indebted to numerous colleagues and students for contributions to various aspects of this work. In particular, we wish to express our gratitude to Mark Psiaki and especially to John Junkins for encouraging us to write this book. Many students have provided excellent insights and recommendations to enhance the pedagogical value, as well as developing new problems that are used as exercises. Although there are far too many students to name individually here, our sincere appreciation goes out to them. We do wish to acknowledge the signiﬁcant contributions on the subject matter to the following individuals: Christopher Nebelecky for providing the section on the disturbing forces in Sect. 10.3, Agamemnon Crassidis for providing inputs on the sliding mode control in Sect. 12.2.3 , John Downing for suggesting the dodecahedral wheel conﬁguration in Sect. 4.8.3 , and Sam Placanica for providing Fig.4.16. Our heartfelt thanks to the following individuals for proofreading the text: Michael Andrle, J. Russell Carpenter, Yang Cheng, Joanna Hinks, Alice Liu, Adonis Pimienta-Peñalver, Steve Queen, Matthias Schmid, and Matthew Whittaker. We also wish to thank the following individuals for their many discussions and insights throughout the development of this book: K. Terry Alfriend, Roberto Alonso, Penina Axelrad, Itzhack Bar-Itzhack, Frank Bauer, J. Russell Carpenter, Yang Cheng, Daniel Choukroun, Neil Dennehy, Adam Fosbury, Michael Grifﬁn, Christopher Hall, Joanna Hinks, Henry Hoffman, Kathleen Howell, Johnny Hurtado, Moriba Jah, Jer-Nan Juang, N. Jeremy Kasdin, Ken Lebsock, E. Glenn Lightsey, Richard Linares, Michael Lisano, Alice Liu, Manoranjan Majji, D. Joseph Mook, Daniele Mortari, Jim O’Donnell, Yaakov Oshman, Mark Pittelkau, Steve Queen, Reid Reynolds, Hanspeter Schaub, Conrad Schiff, Malcolm Shuster, Tarun Singh, Puneet Singla, Eric Stoneking, Sergei Tanygin, Julie Thienel, Panagiotis Tsiotras, James Turner, S. Rao Vadali, James Wertz, Bong Wie, and Renato Zanetti. Also, many thanks are due to several people at Springer, including our editor Maury Solomon, our assistant editor Nora Rawn, and Harry (J.J.) Blom. Finally, our deepest and most sincere appreciation must be expressed to our families for their patience and(see Appendix). Although computer routines can provide some insights into thex Preface understanding throughout the years while we prepared this text. This text was produced using L ATEX2"(thanks Yaakov and HP!). Any corrections are welcome via email to Landis.Markley@nasa.gov orjohnc@buffalo.edu . Greenbelt, MD, USA F. Landis Markley Amherst, NY , USA John L. CrassidisContents 1 Introduction ................................................................. 1 References .................................................................... 15 2 Matrices, Vectors, Frames, Transforms .................................. 17 2.1 Matrices ............................................................... 17 2.2 Vectors ................................................................ 21 2.3 Jacobian, Gradient, and Hessian ..................................... 22 2.4 Orthonormal Bases, Change of Basis ............................... 24 2.5 Vectors in Three Dimensions ........................................ 28 2.6 Some Useful Reference Frames ..................................... 31 2.6.1 Spacecraft Body Frame ..................................... 31 2.6.2 Inertial Reference Frames .................................. 31 2.6.3 Earth-Centered/Earth-Fixed Frame ........................ 32 2.6.4 Local-Vertical/Local-Horizontal Frame ................... 36 2.7 Quaternions ........................................................... 37 2.8 Rotations and Euler’s Theorem ...................................... 40 2.9 Attitude Representations ............................................. 41 2.9.1 Euler Axis/Angle Representation .......................... 41 2.9.2 Rotation Vector Representation ............................ 44 2.9.3 Quaternion Representation ................................. 45 2.9.4 Rodrigues Parameter Representation ...................... 48 2.9.5 Modiﬁed Rodrigues Parameters ........................... 50 2.9.6 Euler Angles ................................................ 52 2.10 Attitude Error Representations ...................................... 59 References .................................................................... 64 3 Attitude Kinematics and Dynamics ....................................... 67 3.1 Attitude Kinematics .................................................. 68 3.1.1 Attitude Matrix ............................................. 68 3.1.2 Vector Addition of Angular Velocity ...................... 69 3.1.3 Vector Kinematics .......................................... 70 xixii Contents 3.2 Kinematics of Attitude Parameterizations .......................... 71 3.2.1 Quaternion Kinematics ..................................... 71 3.2.2 Rodrigues Parameter Kinematics .......................... 72 3.2.3 Modiﬁed Rodrigues Parameter Kinematics ............... 72 3.2.4 Rotation Vector Kinematics ................................ 72 3.2.5 Euler Angle Kinematics .................................... 73 3.2.6 Attitude Error Kinematics .................................. 76 3.3 Attitude Dynamics ................................................... 77 3.3.1 Angular Momentum and Kinetic Energy .................. 77 3.3.2 Rigid Body Dynamics ...................................... 80 3.3.3 Rigid Body Motion ......................................... 84 3.3.4 Torque-Free Motion of a Rigid Body ...................... 90 3.3.5 Internal Torques ............................................ 99 3.3.6 External Torques ............................................ 103 3.3.7 Angular Momentum for Health Monitoring ............... 111 3.3.8 Dynamics of Earth-Pointing Spacecraft ................... 112 References .................................................................... 121 4 Sensors and Actuators ..................................................... 123 4.1 Redundancy ........................................................... 123 4.2 Star Trackers .......................................................... 125 4.2.1 Overview .................................................... 125 4.2.2 Modes of Operation ........................................ 126 4.2.3 Field of View, Resolution, Update Rate ................... 127 4.2.4 Star Catalogs ................................................ 129 4.2.5 Proper Motion, Parallax, and Aberration .................. 130 4.3 Sun Sensors ........................................................... 133 4.4 Horizon Sensors ...................................................... 135 4.5 Magnetometers ....................................................... 135 4.6 Global Positioning System ........................................... 136 4.6.1 GPS Satellites ............................................... 138 4.7 Gyroscopes ........................................................... 140 4.7.1 Gyro Measurement Model ................................. 143 4.8 Reaction Wheels ...................................................... 147 4.8.1 Reaction Wheel Characteristics ............................ 148 4.8.2 Reaction Wheel Disturbances .............................. 148 4.8.3 Redundant Wheel Conﬁgurations .......................... 152 4.9 Control Moment Gyros .............................................. 166 4.10 Magnetic Torquers ................................................... 168 4.11 Thrusters .............................................................. 169 4.12 Nutation Dampers .................................................... 170 References .................................................................... 178 5 Static Attitude Determination Methods .................................. 183 5.1 The TRIAD Algorithm ............................................... 184 5.2 Wahba’s Problem ..................................................... 186Contents xiii 5.3 Quaternion Solutions of Wahba’s Problem ......................... 187 5.3.1 Davenport’s qMethod ...................................... 187 5.3.2 Quaternion Estimator (QUEST) ........................... 189 5.3.3 Another View of QUEST ................................... 191 5.3.4 Method of Sequential Rotations ........................... 192 5.3.5 Estimator of the Optimal Quaternion (ESOQ) ............ 194 5.3.6 Second Estimator of the Optimal Quaternion (ESOQ2) .. 195 5.4 Matrix Solutions of Wahba’s Problem .............................. 196 5.4.1 Singular Value Decomposition (SVD) Method ........... 196 5.4.2 Fast Optimal Attitude Matrix (FOAM) .................... 198 5.4.3 Wahba’s Problem with Two Observations ................. 199 5.5 Error Analysis of Wahba’s Problem ................................. 201 5.5.1 Attitude Error Vector ....................................... 201 5.5.2 Covariance Analysis of Wahba’s Problem ................. 204 5.5.3 Covariance with Two Observations ........................ 207 5.6 MLE for Attitude Determination .................................... 208 5.6.1 Fisher Information Matrix for Attitude Determination ... 212 5.7 Induced Attitude Errors from Orbit Errors .......................... 216 5.8 TRMM Attitude Determination ..................................... 218 5.9 GPS Attitude Determination ......................................... 223 References .................................................................... 231 6 Filtering for Attitude Estimation and Calibration ...................... 235 6.1 Attitude Representations for Kalman Filtering ..................... 236 6.1.1 Three-Component Representations ........................ 236 6.1.2 Additive Quaternion Representation ....................... 237 6.1.3 Multiplicative Quaternion Representation ................. 239 6.2 Attitude Estimation ................................................... 240 6.2.1 Kalman Filter Formulation ................................. 240 6.2.2 Gyro Calibration Kalman Smoother ....................... 246 6.2.3 Filtering and the QUEST Measurement Model ........... 254 6.2.4 Mission Mode Kalman Filter .............................. 257 6.2.5 Murrell’s Version ........................................... 260 6.3 Farrenkopf’s Steady-State Analysis ................................. 263 6.4 Magnetometer Calibration ........................................... 269 6.4.1 Measurement Model ........................................ 270 6.4.2 Centered Solution ........................................... 272 6.4.3 The TWOSTEP Algorithm ................................. 274 6.4.4 Extended Kalman Filter Approach ........................ 276 6.4.5 TRACE Spacecraft Results ................................ 277 References .................................................................... 283 7 Attitude Control ............................................................ 287 7.1 Introduction ........................................................... 287 7.2 Attitude Control: Regulation Case .................................. 289xiv Contents 7.3 Attitude Control: Tracking Case ..................................... 294 7.3.1 Alternative Formulation .................................... 301 7.4 Attitude Thruster Control ............................................ 303 7.5 Magnetic Torque Attitude Control .................................. 307 7.5.1 Detumbling ................................................. 308 7.5.2 Momentum Dumping ....................................... 311 7.6 Effects of Noise ...................................................... 312 7.7 SAMPEX Control Design ........................................... 318 7.7.1 Attitude Determination ..................................... 321 7.7.2 Magnetic Torque Control Law ............................. 324 7.7.3 Science Modes .............................................. 324 7.7.4 Reaction Wheel Control Law .............................. 332 7.7.5 Simulations ................................................. 333 References .................................................................... 341 8 Quaternion Identities ....................................................... 345 8.1 Cross Product Identities .............................................. 345 8.2 Basic Quaternion Identities .......................................... 346 8.3 The Matrices /EOT.q/,/TAB.q/,˝.!/ , and/NUL.!/ ........................ 349 8.4 Identities Involving the Attitude Matrix ............................. 350 8.5 Error Quaternions .................................................... 354 8.6 Quaternion Kinematics ............................................... 355 References .................................................................... 359 9 Euler Angles ................................................................. 361 10 Orbital Dynamics ........................................................... 365 10.1 Geometry of Ellipses ................................................. 365 10.2 Keplerian Motion ..................................................... 370 10.2.1 Classical Orbital Elements ................................. 374 10.2.2 Kepler’s Equation ........................................... 376 10.2.3 Orbit Propagation ........................................... 379 10.3 Disturbing Forces .................................................... 382 10.3.1 Non-Spherical Gravity ..................................... 382 10.3.2 Third-Body Forces .......................................... 388 10.3.3 Atmospheric Drag .......................................... 389 10.3.4 Solar Radiation Pressure ................................... 390 10.4 Perturbation Methods ................................................ 392 10.4.1 Variation of Parameters ..................................... 392 10.4.2 Two Line Elements ......................................... 393 10.4.3 A Useful Approximation, Secular J2Effects Only ....... 395 10.4.4 Sun-Synchronous Orbits ................................... 397 10.5 Lagrange Points ...................................................... 398 References .................................................................... 402Contents xv 11 Environment Models ....................................................... 403 11.1 Magnetic Field Models ............................................... 403 11.1.1 Dipole Model ............................................... 404 11.2 Atmospheric Density ................................................. 406 11.2.1 Exponentially Decaying Model Atmosphere .............. 406 11.2.2 Harris-Priester Model Atmosphere ........................ 407 11.2.3 Jacchia and GOST Model Atmospheres ................... 408 11.2.4 Jacchia-Bowman 2008 (JB2008) Model Atmosphere .... 409 11.3 Sun Position, Radiation Pressure, and Eclipse Conditions ......... 420 11.4 Orbital Ephemerides of the Sun, Moon, and Planets ............... 422 References .................................................................... 423 12 Review of Control and Estimation Theory .............................. 425 12.1 System Modeling ..................................................... 425 12.1.1 Inverted Pendulum Modeling .............................. 425 12.1.2 State and Observation Models ............................. 428 12.1.3 Discrete-Time Systems ..................................... 434 12.2 Control Theory ....................................................... 437 12.2.1 Basic Linear Control Design ............................... 437 12.2.2 Stability of Nonlinear Dynamic Systems .................. 442 12.2.3 Sliding-Mode Control ...................................... 444 12.3 Estimation Theory .................................................... 448 12.3.1 Static-Based and Filter-Based Estimation ................. 449 12.3.2 Batch Least Squares Estimation ........................... 451 12.3.3 Sequential Least Squares Estimation ...................... 453 12.3.4 Maximum Likelihood Estimation .......................... 454 12.3.5 Nonlinear Least Squares ................................... 456 12.3.6 Advantages and Disadvantages ............................ 462 12.3.7 State Estimation Techniques ............................... 462 12.3.8 Linear Covariance Analysis ................................ 470 12.3.9 Separation Theorem ........................................ 470 References .................................................................... 473 Appendix: Computer Software ................................................. 475 Index ............................................................................... 477Chapter 1 Introduction Spacecraft attitude determination and control covers the entire range of techniques for determining the orientation of a spacecraft and then controlling it so that thespacecraft points in some desired direction. The attitude estimation and attitude control problems are coupled, but they can be considered separately to some extent. The separation theorem for linear systems shown in Sect. 12.3.9 tells us that the control system can be designed without considering the estimator and vice versa. Speciﬁcally, the feedback gains in the control system can be chosen assuming that the system’s state is perfectly known. No general separation theorem exists fornonlinear systems, including spacecraft attitude control systems, but the pointing requirements for most space missions have been satisﬁed by designing the attitude determination and control systems separately. It is sometimes useful to distinguish between attitude determination and attitude estimation, although this distinction is often blurred. Attitude determination in this strict sense refers to memoryless approaches that determine the attitude point-by-point in time, quite often without taking the statistical properties of the attitude measurements into account. Attitude estimation, on the other hand, refers to approaches with memory, i.e. those that use a dynamic model of the spacecraft’smotion in a ﬁlter that retains information from a series of measurements taken over time. Malcolm Shuster made the incisive observation that attitude estimation is the youngest of the four quadrants of astronautics shown in Table 1.1, which is adapted from his work [ 33]. The table shows the attitude estimation quadrant to be actually empty before the launch of Sputnik, the ﬁrst artiﬁcial satellite, in1957. As Shuster pointed out,“There were, apparently no eighteenth- or nineteenth- century contributors to attitude estimation of even modest calibre,” because “there was simply no great problem in Attitude Estimation waiting to be solved.” The ﬁeldof attitude estimation actually remained in a very underdeveloped state even into the F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _1, © Springer Science+Business Media New York 201412 1 Introduction Table 1.1 Founders of astronauticsDynamics Estimation Orbit Newton (1642–1727) Kepler (1571–1630 Lagrange (1736–1813) Lagrange (1736–1813)Hamilton (1805–1865) Gauss (1777–1855) Einstein (1874–1955) Attitude Euler (1707–1783) (gone ﬁshin’) Cayley (1821–1895) late 1970s, although hundreds of spacecraft missions existed by that time, starting with Sputnik and including the Apollo missions from the late 1960s to the early 1970s. A natural question is: “With all these missions why didn’t attitude estimation become important until the late 1970s?” The answer does not necessarily lie in the absence of mathematical developments, as one might expect. Harold Blackhad developed the algebraic method for the point-by-point determination of a spacecraft’s attitude from a set of two vector observations in 1964 [ 4,24]. Shuster later renamed this algorithm TRIAD [ 35], the name stemming from an IBM Federal Systems Division internal report called “Tri-Axial Attitude Determination System.” One year after Black’s breakthrough, Grace Wahba published her famous attitude determination problem involving any number of vector observations [ 40]; but the ﬁrst solutions of this problem never found practical application [ 13]. The ﬁrst practical algorithm was Paul Davenport’s celebrated qmethod, which solved for the quaternion parameterizing the attitude [ 24]. Unfortunately, this algorithm required performing an eigenvalue/eigenvector decomposition of a 4/STX4matrix. It was used to support NASA’s High Energy Astronomy Observatories (HEAO 1–3) [ 10], but was not practical for most missions on even the mainframe computers of the1970s [ 34]. Shuster developed his QUaternion ESTimator (QUEST), which did not require an eigenvalue/eigenvector decomposition, to meet the greater throughput demands of the Magsat mission, launched in late 1979 [ 35]. Many other practical solutions to Wahba’s problem have been developed since that time, but QUEST was the ﬁrst algorithm suited to onboard computer processors and is still the most widely employed [ 27]. James Farrell published the ﬁrst known paper using a Kalman ﬁlter for attitude estimation in 1970 [ 12], but a constant-gain ﬁlter had been proposed earlier [ 21], and Kalman ﬁlters for attitude estimation had appeared previously in contractorreports [ 11] and conference reports [ 30,39]. Kalman ﬁlters were employed during the late 1970s and early 1980s to both ﬁlter noisy measurements and estimate for the attitude and gyro biases. The spacecraft dynamics and measurement modelsare nonlinear, though, so the ﬁlter is actually a quasi-linear extended Kalman ﬁlter (EKF, see Sect. 12.3.7.2 ), which does not possess the guaranteed convergence that the linear Kalman ﬁlter has. The EKF provides higher accuracy attitude estimatesthan point-by-point methods, but it is more expensive computationally, and the threat of divergence made attitude control engineers initially slow to adopt it. Farrell used the Euler angle attitude parameterization [ 12], but implementations using1 Introduction 3 the quaternion parameterization had gained prominence by the mid 1970s [ 29]. A survey paper on quaternion-based attitude EKFs appeared in 1982, bringing more attention to that approach [ 23]. However, a conventional Kalman ﬁlter using the quaternion parameterization results in a covariance matrix that is nearly singular.1 This could cause problems, especially with single-precision computers, but theywere overcome by using a local unconstrained three-dimensional parameterizationfor the attitude error and the quaternion for the global parameterization of the attitude. Reference [ 42] provides an excellent summary of the state of the art in 1978, but most of the attitude estimation processing described in this reference was performed by large mainframe computers on the ground. Algorithms for performing attitude determination and estimation existed well before that time, but space-hardened computer processors with the power required to execute them onboard spacecraft were not available. This raises the question: “How did spacecraft control their attitude without having attitude estimates?” Some early spacecraft, suchas Sputnik and the Echo 1 and 2 satellites (mylar balloons 30 and 40 m in diameter), were spheres with no pointing requirements at all. Other spacecraft used passive stabilization methods: spacecraft spin or a momentum wheel providing aconstant angular momentum bias and/or gravity-gradient stabilization (see Chap. 3). Infrequent control torques to be applied by active mechanisms were computed on the ground and telemetered to the spacecraft. Other spacecraft with active controlsystems derived their control commands directly from sensor data, using simple analog circuitry. Most modern-day spacecraft missions have speciﬁc pointing requirements, otherwise known as pointing modes . Some examples include Earth pointing, inertial pointing, and Sun pointing. Communications and broadcast satellites are a special case of Earth-pointing spacecraft. They are typically placed in geostationary orbitsalong the equator, with an orbital period equal to the Earth’s rotational period (i.e. one sidereal day), so they appear from the ground to be stationary in the sky. Their angular momentum vectors are perpendicular to the equator and theirattitude rotation rates are also the same as the Earth’s rate, keeping their antennas constantly pointed at the Earth. This explains why a satellite TV dish can be pointed to a ﬁxed location for reception purposes. An example of an inertially pointingspacecraft is the Hubble Space Telescope (HST), which can point its main mirror to a ﬁxed location in the sky for several hours to collect enough faint light to provide a good image. An example of a Sun pointing spacecraft is the Solar &Heliospheric Observatory (SOHO) which is used to study the Sun from its deep core to the outer corona and the solar wind. Sometimes the pointing mode changes during the spacecraft mission. This may be due to changing requirements or failure 1Reference [ 23] states that the covariance matrix is exactly singular, but this would only result from a linear constraint, while the quaternion norm constraint is quadratic. Itzhack Bar-Itzhackand Jeremy Kasdin pointed this out to the authors in personal discussions.4 1 Introduction ACSStabilization Requirements Cost System Budgets Desired AccuracyDisturbance TorquesDesign ConstraintsPayload Vehicle Design Fig. 1.1 Factors affecting ACS selection of some hardware component. The Solar, Anomalous and Magnetospheric Particle Explorer (SAMPEX) discussed in Sect. 7.7provides an example of changing pointing algorithms to meet changing pointing requirements. A spacecraft’s overall pointing error is a function of both the attitude determina- tion/estimation errors and control errors, because the control system takes its inputsfrom the attitude determination/estimation system. As an example consider the non- realistic case where the control errors are exactly zero. If the attitude determination errors are 2 ı, then the overall pointing errors are also 2ıeven though the control is perfect. Therefore, when considering the overall pointing design requirements both the control errors and attitude determination/estimation errors must be taken into account. Pointing requirements can include requirements for both holding a desiredorientation and for maneuvering the spacecraft from one orientation to another. The desired orientation may be a static resting point or a time varying trajectory. The trajectory itself may be predeﬁned speciﬁcally, such as pointing towards a particularlocation on the ground from low-Earth orbit (LEO), or not speciﬁcally deﬁned, such as a general spin that scans the universe. The Wilkinson Microwave Anisotropy Probe (WMAP) spacecraft spent 9 years performing a repetitive “spirograph” scanof the celestial sphere, as described in Sect. 7.3. Reference [ 36] provides an excellent overview of the factors that affect an attitude control system (ACS) conﬁguration, as shown in Fig. 1.1. Some of these factors are obvious, such as the payload, cost and desired accuracy, but others take much longer to quantify. More often than not the stabilization requirements may involve multiple pointing modes of the spacecraft. For example, the mission mode is the primary mode to complete the mission objectives. In addition to this mode asafehold mode is usually required to cope with an anomaly. An example of this mode is a Sun pointing mode that holds the solar arrays to face the Sunand removes power from all non-critical subsystems, minimizing power demands1 Introduction 5 Fig. 1.2 LADEE modular common spacecraft bus architecture until the anomaly is resolved. The spacecraft’s inertia properties and the expected disturbance torques must be accounted for during the ACS design process. The conﬁguration of the vehicle may impose design constraints on the ACS in the form of system budgets for weight, power and volume. This leads to various deﬁnitions for the conﬁguration. For example, a CubeSat has a volume of exactly one liter and has a mass of no more than 1.33 kg. Current designs focus on commercial off-the-shelf (COTS) technology, which is a federal acquisition regulation term deﬁning a non-developmental item of supply that is both commercial and sold in substantial quantities in the commercial marketplace. The Lunar Atmosphere and Dust Environment Explorer (LADEE) satellite uses a modular common spacecraft bus architecture along with COTS components, as shown in Fig. 1.2, in order to signiﬁcantly reduce costs. These types of designs will certainly be prevalent for many future missions. Although reducing costs is important, it is equally important that a proper ACS achieves its stated objective throughout the lifetime of the mission. This begins with a complete understanding of the theory behind an ACS. Most often the particular mission objectives drive the requirements. Engineers are usually given the objectives and then they must develop a proper ACS that meets these objectives, keeping all the factors shown in Fig. 1.1in mind. But sometimes engineers are able to drive the objectives. An example of this is an experience that this book’s authors had for the contingency mode for the Tropical Rainfall Measuring Mission (TRMM) spacecraft. The scientists asked the authors “Roughly what attitude accuracy do you think can be achieved with three-axis magnetometer and Sun sensors?” After a simple analysis we responded that 0.7ıshould be doable. The very next day the ofﬁcial requirement from the scientists for the contingency mode was stated to be 0.7ı! The authors and other engineers then performed a detailed analysis to prove that this requirement could be met [ 6]. Other times one system is more important than another system. This is the case for the Wilkinson Microwave Anisotropy Probe (WMAP) spacecraft [ 25], which is used to make fundamental cosmological measurements. The ACS objectives are to provide a complete scan of the universe6 1 Introduction twice a year. The scientists were more interested in the attitude knowledge than WMAP’s actual orientation. Therefore, the control system did not need to be as accurate as the attitude estimation system, which involved a star tracker and gyros.This allowed for a less sophisticated control design than would be required for a ﬁne pointing spacecraft. It is important to note that other requirements may be imposed on the overall pointing mode. For example, nearly every spacecraft uses solar arrays for power generation, and the arrays must be pointed towards the Sun well enough to provide sufﬁcient power. This may require that the desired pointing mode beslightly modiﬁed during mission operations. Other spacecraft require calibration maneuvers to determine sensor biases and other calibration parameters. These attitude maneuvers typically require that the spacecraft be capable of controllingall three of its axes, which is often broadly termed three-axis stabilization . The history of attitude determination/estimation has been well documented, but the history of attitude control is less known. This is in part due to the fact that thisﬁeld of study was classiﬁed Secret in the early days of spacecraft mission designs. Robert Roberson [ 32] claims that its birth year is 1952, with the ﬁrst publicly published works by him and Vladimir Beletskii, who was in the USSR, appearingin the mid 1950s. Early designs were based on linearized equations of motion to study the behavior of the control system. Active control relies on only a handful of available actuators: (1) momentum exchange devices such as reaction wheels,(2) thrusters and (3) magnetic torquers. As early as 1961 magnetic torquers had been proposed both for momentum dumping and active pointing control. According to Roberson, the ﬁrst Orbiting Solar Observatory (OSO 1) was the ﬁrst knowncontrolled spacecraft. This used a dual-spin design, with a rotating wheel to provide gyroscopic stability, and a saildriven electrically against the wheel’s rotation to point at the Sun. Although modern-day actuators have not changed from their initialpurpose, technology has advanced greatly since the early days to provide much greater efﬁciency and tighter pointing performance. For example, in order to take images of distant, faint objects, HST must point extremely stably and accurately.The telescope is able to lock onto a target without deviating more than 7/1000th of an arcsecond, or the width of a human hair seen at a distance of about 1.5 km. Fine guidance sensors looking through HST’s main optics are used to provide the attitudeknowledge while reaction wheels provide the necessary control. These reaction wheels must be very accurately balanced and isolated so that vibration is as small as possible; otherwise a jitter effect would ensue causing image blurring. Spacecraft attitude control methods fall into two broad classes: passive control and active control. Passive control methods use the natural spacecraft dynamics to satisfy their pointing requirements. The simplest of these is spin stabilization,which depends on the fact that the direction of a rigid spinning body’s angular momentum is relatively immune to disturbances (see Sect. 3.3.3 ). The Pioneer series of spacecraft provides a good example of early spinners. Pioneer 10 and 11 eachcarried a sensor called the Imaging Photopolarimeter (IPP), as shown in Fig. 1.3, which measured the strength of sunlight scattered from the clouds of Jupiter [ 31]. It then converted this information into digital format of different shades of red1 Introduction 7 Spin axis of spacecraft 10 degLook angle (can be varied 151 deg)Direction of scan data beamScan limit 14 deg JupiterWidth of scan data beam 0.5 by 0.5 milliradian Closest telescope position to spin axis Fig. 1.3 Pioneer imaging photopolarimeter and blue that made up each image of Jupiter. The telescope axis was swept about the spacecraft spin axis through 360ıin the look angle as the spacecraft rotated at its nominal spin rate. It could also be positioned in discrete 0.5 mrad steps of cone angle over a range from 29ıfrom the earthward direction (limited by the spacecraft antenna structure) to 170ıfrom earthward. This allowed two-dimensional mapping of the celestial sphere in any one of three distinct operational modes. The total angle coverage per spin rotation depended on the spacecraft data transmissionrate; during encounter it was limited to 70 ıand 14ı(28ıat low sample rate) for photopolarimetry and imaging, respectively. Any swath of the 360ırotation could be covered by selecting the starting angle. In the faint light mode the entire roll wascovered. As shown by the example of Pioneer, one advantage of spinning spacecraft is that the spin can be used by ACS and payload sensors to scan targets. A disadvantage, ofcourse, is that a spinning platform is very inconvenient for sensors or antennas that need to point at ﬁxed targets. Dual-spin spacecraft have both a spinning component and a despun platform that is not rotating. The dual-spin conﬁguration has mainly been used for communications or broadcast satellites, where the despun platform contains an antenna pointed at a receiving station on the Earth, but it was also used8 1 Introduction for OSO 1 and for the Galileo interplanetary spacecraft, which was launched toward Jupiter in October 1989. Dual-spin spacecraft are intermediate between passive and active control, because the pointing of the spin axis is largely passive, but the angleof rotation of the despun platform about the spin axis is controlled actively by the motor driving the relative rotation of the two components. Amomentum-bias attitude control system is conceptually similar to a dual-spin system, but the angular momentum bias is provided by a spinning wheel or wheels internal to the main spacecraft body, which is not spinning. Many Earth- pointing spacecraft have used this conﬁguration, with the momentum bias along thespacecraft pitch axis, which is perpendicular to the orbital plane. Spacecraft pitch motion is controlled by the wheel torque and the motion about the other two axes can be controlled by magnetic torques or propulsive torques. Another common variationis to have two wheels slightly misaligned from the pitch axis so that torquing them in the same direction provides pitch control and commanding them in opposite directions provides a torque perpendicular to the pitch axis. Gravity-gradient torques provide another passive method to keep one axis of an Earth-orbiting spacecraft pointed toward the Earth, as was ﬁrst demonstrated on the Transit Research and Attitude Control (TRAAC) spacecraft, launched in1962 [ 45]. Since this provides no control about the Earth-pointing axis, it is usually combined with some other form of control, a pitch momentum bias in the case of the Geostationary Experimental Ocean Satellite (GEOS) [ 42] or magnetic torquing in the case of the Ørsted satellite [ 44]. As pointing requirements have become more demanding and spacecraft computers have become more capable, spacecraft ACS designs have largelymoved to three-axis stabilization. Most actively-controlled spacecraft use thrusters, reaction wheels or, less frequently, control moment gyros (CMGs) as their primary controllers. Thrusters by their nature use expendable propellants, limiting the lifeof a mission. Reaction wheels or CMGs, on the other hand, require only electrical power that can be supplied by solar arrays. They also are well suited for repointing and absorbing periodic disturbance torques, which cause no long-term change intheir stored angular momentum. Secular disturbances, on the other hand, lead to momentum buildup in the wheels, which must be unloaded (or “dumped”) using external torques provided by attitude thrusters or magnetic torquers. Magnetictorquers are preferable because they do not use expendables and are less disruptive to the spacecraft’s primary function, but they are generally only employed in LEO. The Geostationary Operational Environmental Satellites (GOES), which supply the weather pictures seen on televised weather programs, provide an excellent example of the evolution of attitude control system designs. The ﬁrst three of these satellites, GOES 1–3, 2were spin-stabilized. Weather images were obtained by a Visible Infrared Spin Scan Radiometer (VISSR) which used the satellite spin to scan in the East-West direction, and a mirror stepped once per spin period to 2NASA satellites are given letter designations before launch and numerical designations after they attain orbit, so the ﬁrst three GOES satellites were also known as GOES A-C.1 Introduction 9 Trim TabImager and SounderSolar Sail Solar ArrayFig. 1.4 Geostationary operational environmentalsatellite I–M scan North to South. GOES 4–7 were dual-spin satellites, with high-gain antennas on the despun platform to increase the speed of data transmission to the Earth. One drawback of these designs was that the VISSR spent only a very small fraction of its spin period actually scanning the Earth. In order to increase thetime spent actually gathering weather imagery, the GOES 8–12 satellites, depicted in Fig. 1.4, were designed as momentum-biased three-axis controlled spacecraft, with the scan provided by the science instruments [ 37]. These were the imager, which senses infrared and visible energy from the Earth’s surface and atmosphere, and the sounder, which provides data for vertical atmospheric temperature and moisture proﬁles, surface and cloud top temperature, and ozone distribution. Themain disturbance at geosynchronous altitudes is the torque caused by solar radiation pressure on solar arrays, so geosynchronous spacecraft usually have two solar arrays on opposite sides to balance the torque. The imager and sounder need a coldﬁeld of view for their radiators, so GOES could not have balanced solar arrays. A small solar sail on an extended boom was provided to balance the solar torque, but the combination of imperfect symmetry, center of mass shifts, and changingsurface optical properties resulted in a seasonally-varying net torque. The resulting accumulated momentum was unloaded by thrusters or by magnetic torquing, the latter with mixed success at geosynchronous altitude. A trim tab at the end of the10 1 Introduction solar array was adjusted daily by ground command to minimize the need for active momentum dumping [ 17]. Each spacecraft had a set of gyros, the Digital Integration Rate Assembly (DIRA), but it was not used for the mission mode ACS because thegyros had an operational lifetime of only 2,000 h. The pointing requirement for this series of GOES satellites was 12 /c157rad relative to an Earth referenced system, which translates to roughly 4 km knowledge onthe ground. It is important to note that this was the tightest pointing requirement ever for a spacecraft that did not use data from its main instruments to aid the ACS, as HST and other ﬁne-pointing spacecraft do. The original ACS designersbelieved that this requirement could be met using a horizon sensor only and by making corrections through ground processing of the data [ 20]. Unfortunately, the requirements were not met on orbit with this approach, so a NASA team investigatedACS modiﬁcations needed to improve the performance of the next generation of GOES spacecraft [ 8,26]. The present authors concluded that the desired level of performance required star trackers and gyros capable of providing continuousdata in a stellar-inertial ACS, which had been used for Earth-pointing spacecraft in near-Earth orbit at least since Landsat 4 in 1982, but never to our knowledge for a geostationary satellite. However, star trackers provide an attitude relative toan inertial frame, and converting the attitude to an Earth reference frame requires knowledge of the spacecraft orbit, 3so orbit errors will contribute to pointing errors. This is the reason why Earth-pointing spacecraft have historically used horizonsensors as pointing references. Fortunately, it is not difﬁcult to reduce orbit errors to the point where they do not signiﬁcantly degrade pointing performance, so the stellar-inertial design could meet the pointing requirements. Reference [ 26] had been presented at the 1991 AIAA Guidance, Navigation, and Control Conference, and it was well known to the spacecraft manufacturers interested in building the next generation of GOES spacecraft. Thus it is nosurprise that later GOES satellites starting with GOES 13 have used many of the improvements suggested in that paper, including a stellar-inertial ACS mode [ 38]. Increased cooling demands of the imager and sounder precluded the use of a solarsail on these spacecraft, so they must perform daily momentum dumps, but the improved performance of the ACS allows them to continue imaging during the dumps and to meet all their performance requirements [ 15]. The design of the TRMM ACS involved a similar decision between an Earth- referenced concept and a stellar-inertial concept. TRMM was developed at Goddard Space Flight Center concurrently with the Rossi X-Ray Timing Explorer (RXTE),and an effort was made to use common hardware and software wherever feasible. RXTE was an astronomical mission, and its stringent pointing stability requirement of 30 arcsec led it to incorporate a stellar-inertial ACS [ 3]. The TRMM engineers decided not to use a stellar-inertial system, because their much less stringent attitude knowledge requirement of 0.18 ıper axis could be met by using pitch and roll measurements from an Earth Sensor Assembly (ESA), and obtaining yaw 3This is discussed in Sects. 2.6.4 and5.7.1 Introduction 11 knowledge from gyros updated twice each orbit by Sun sensor measurements. Although this decision was controversial, it was supported by the ﬁrst author of this book on the principle that an Earth-pointing mission should use an Earth-referencedACS. It appeared to be an unfortunate decision in early 1994, after development of the TRMM ACS was well underway, when ACS engineers became aware of a progressive degradation of similar ESAs on the Defense Meteorological SatelliteProgram (DMSP) spacecraft. They considered adding a star tracker to TRMM to protect against this possibility, but avoided the severe monetary and schedule penalties that this would entail by developing a contingency mode using gyros andmagnetometers, based on results that had been obtained in ground-based attitude determination of the Upper Atmosphere Research Satellite (UARS) using ﬂight gyro and magnetometer data [ 18]. Implementation of TRMM’s contingency mode required an onboard ﬁlter to reduce the effects of sensor noise and magnetic ﬁeld modeling errors. The common hardware procurement with RXTE spacecraft provided gyros that were much moreaccurate than required by the ESA-based TRMM ACS but provided the dynamic memory needed by the ﬁlter. It was not clear that the onboard processor could handle the computational load of a full Kalman ﬁlter in addition to the existingACS software, so the authors of this book conducted a study to develop algorithms that could provide near-optimal attitude estimates with a lower computational load [6]. Our investigation showed that one eigenvalue of the covariance matrix of attitude errors was much larger than the other two, and its eigenvector was within 2.5 ıof the Sun vector. This reﬂects the fact that the more accurate Sun sensor cannot reduce the attitude error along the Sun line, which must be estimated usingthe less-accurate magnetometer. A simpliﬁed expression for the covariance using this analysis provided several alternate algorithms that obtained nearly the same accuracy as the Kalman ﬁlter at a fraction of the computational load [ 6]. It was determined, however, that the already-validated RXTE Kalman ﬁlter, modiﬁed to use magnetometer and Sun sensor data in place of star tracker data, would ﬁt in the TRMM computer, so this alternative was chosen. In August of2001 TRMM’s orbit altitude was raised from 350 to 402 km to save propellant used to compensate for atmospheric drag. The ESA had performed well at the lower altitudes for which it was designed, but it ceased providing valid data above 380 km,and the contingency mode Kalman ﬁlter was enabled. It has since provided attitude accuracies of approximately 0:2 ı, about the same as the ESA had provided and much better than the allotted attitude knowledge accuracy for the contingency modeof 0.7 ıper axis [ 1]. In addition to difﬁculties in meeting requirements, as on GOES 8–12, it is not uncommon to experience an outright failure. Some of these are not recoverable,but ingenious workarounds can often be found. The Lewis spacecraft provides an example of an unrecoverable failure. The Lewis design engineers adopted a Sun- pointing ACS safehold mode that had been designed for the Total Ozone MappingSpectrometer-Earth Probe (TOMS-EP) spacecraft. Unfortunately, the spacecraft axis that the Lewis safehold mode pointed at the Sun was an unstable axis of intermediate inertia (see Sect. 3.3.3 ), unlike the stable Sun-pointing axis on12 1 Introduction TOMS-EP. This instability should have revealed itself in simulations performed during the design phase, but the simulations assumed perfectly aligned and balanced thrusters. When Lewis entered safehold mode on orbit, a small thruster imbalancecaused the spacecraft to spin up around the unstable intermediate axis. This rotation could not be sensed by the Sun sensors, and the spin momentum started to transfer into the controlled principal axis causing the thrusters to ﬁre excessively in anattempt to maintain control. But the ACS processor was programmed to shut down the control system if excessive ﬁrings occurred. The spin momentum then was transferred to the principal axis, which rotated the spacecraft 90 ı, causing the solar arrays to be pointed nearly edge-on to the Sun, resulting in a fatal loss of power from which Lewis could not recover. The Solar Maximum Mission (SMM) provides an example of a recovery from a potentially fatal malfunction. Launched in February 1970, SMM was the ﬁrst of the Multimission Modular Spacecraft (MMS) with independent modules designed to be replaceable on orbit [ 9,16]. SMM’s Modular Attitude Control System (MACS) functioned ﬂawlessly for the ﬁrst nine months after launch, but then fuse failures permanently disabled three of its four reaction wheels, which were the primary ACS actuators. With only one wheel operational, the experiment axis would drift awayfrom the Sun and severe thermal and power problems would develop. Engineers at Goddard Space Flight Center developed an algorithm to spin-stabilize SMM, which was uplinked to the onboard computer less than six weeks after the loss of the ﬁrstwheel [ 19]. A successful spinup was achieved, leaving the spacecraft rotating at about 1 deg/s and pointing near the Sun in a thermal- and power-safe state. Three of the seven observatory experiments continued to operate while spinning to returnsolar constant measurements as well as data on gamma ray and x-ray emissions from the Sun. SMM remained in the spin-stabilized mode until it was captured in 1984 by Space Shuttle Challenger and its MACS module was replaced in the ﬁrst repair of an orbiting spacecraft. Another rescue from a potentially fatal malfunction was performed on the International Ultraviolet Explorer (IUE), which was launched in January 1978 intoa geosynchronous, but not geostationary, orbit. Because of its high altitude, IUE could not be serviced on orbit. It was equipped with six gyros, of which three were needed for the ACS. Three of the gyros had failed by July 1982, so a replacementtwo-gyro control algorithm was developed in 1982–1983 to permit continued use of the observatory in the anticipated loss of a fourth gyro [ 14]. This algorithm was ready for operation by Spring 1983, well before the fourth gyro failed onAugust 17, 1985. IUE continued science operations until it was decommissioned for non-ACS reasons in September 1996, 18 years and 9 months after launch, although it was built to last for 3 years with a goal of 5 years. A single-gyro controlalgorithm for IUE was developed and fully tested on orbit, but it was never needed. Their rescues of SMM, IUE, and several other spacecraft earned the engineers in Henry Hoffman’s Guidance and Control Branch at Goddard Space Flight Center theappellation “Satellite Saviors” [ 22].1 Introduction 13 HST, deployed by Space Shuttle Discovery in April 1990, is the only telescope designed to be serviced on orbit by astronauts. Like IUE, HST was launched with six primary high-accuracy single-degree-of-freedom gyros for redundancy. In fact,the gyros are of the same basic design as IUE’s, but they were improved to avoid the IUE’s failure mode. Unfortunately, they experienced a different failure mode. If four of the six primary gyros were lost, vehicle health and safety could still bemaintained by using a set of backup lower-accuracy gyros until the primary gyros could be brought on line, after replacement if necessary. The backup gyros have a limited operational life, however, so they should not be relied on for long-termcontrol. Therefore, when two of HST’s primary gyros failed during the ﬁrst year of HST operation, it was felt prudent to develop a zero-gyro sunpoint (ZGSP) safehold mode [ 28]. Development of this safehold mode algorithm, which uses magnetometer and coarse Sun sensor data, went from concept to ﬂight code in three months, with uplink to HST on January 20, 1992, and it maintained HST in a power and thermally safe state for 38 consecutive days between the failure of a fourth gyroin November 1999 and a December servicing mission to replace all six gyros. Our ﬁnal example of an ACS design using minimal hardware is provided by the Solar Radiation and Climate Experiment (SORCE) spacecraft [ 2]. The SORCE engineers developed a gyroless ACS design out of necessity after much of the ACS ﬂight software had already been coded, when problems arose with their gyro procurement and no alternate gyros could be procured quickly that met spacecraftinterface and resource requirements. Facing a very tight schedule, the ACS team designed and implemented a simple science mode that took advantage of the availability of two star trackers and a ﬁne Sun sensor to derive accurate rates,and a safehold mode deriving rates from magnetometer and coarse Sun sensor measurements. The key system feature enabling the simplicity of these modes was that the science instrument was designed to point at the Sun and therefore couldnot be damaged by Sun exposure. Reference [ 5] provides an overview of gyroless pointing modes on several scientiﬁc spacecraft, including SORCE. A sound theoretical foundation is the ﬁrst and foremost step to achieve a good ACS design. The Lewis issue could have been easily avoided by a simple analysis that would have showed that the safehold mode had a spin about its intermediate axis. Understanding how orbit errors couple with attitude errors in the GOES startracker design is another example of using theory to aid in the ACS analysis. The TRMM contingency ﬁlter, described above, also provides an illustrative case. A classic example is the roll/yaw coupling effect used to control communicationssatellites (see Sect. 3.3.8 ), which typically employ a horizon sensor for the ACS. A horizon sensor can provide only roll and pitch information, leaving the yaw rotation angle about the nadir vector unknown and the attitude not fully observable.However, roll/yaw coupling causes an error in yaw to become an error in roll a quarter orbit later, so yaw is controllable even though it is not observable. The yaw pointing accuracy is typically about an order of magnitude worse than roll and pitch,but this is of no concern for most communications satellites because their antennas are still pointed toward the Earth to meet their requirements.14 1 Introduction Since the ﬁrst publications on attitude control this area has been extremely active, producing a vast stream of theoretically-based publications that continues to this day. It is impossible to even begin to scratch the surface of the extensivedevelopments in this area. Rather, we shall highlight some key aspects of the results shown in classic publications. The attitude control problem can be essentially broken down into two parts: (1) attitude regulation and (2) attitude tracking.Regulation drives the attitude toward a ﬁxed orientation and keeps it there. Note that this is exactly the same as an inertial pointing mode. Tracking involves continuously re-orientating the attitude to follow some predeﬁned attitude motion proﬁle. Thisfalls under the category of three-axis stabilization. Control techniques fall under both open-loop and closed-loop approaches, as is further discussed in Sect. 7.1. As with estimation the parameterization of choice for control purposes is the quaternion. Bong Wie and Peter Barba produced one of the earliest works using this parameterization for the regularization problem in 1985 [ 43]. This work derives simple feedback laws that are essentially equivalent to classical proportional-derivative controllers and shows them to be stable through a Lyapunov analysis. Note that Wie and Barba did not prove asymptotic stability, but fortunately their control laws do lead to an asymptotically stable closed-loop system as shown inSect. 7.2. The extension of this work to the tracking case is derived by John Wen and Kenneth Kreutz-Delgado [ 41]. Control theory has continued to evolve since the time of these classic papers, including robust control approaches, control methods thattake into account actuation constraints, controllers that can work when an actuator fails (such as the two-wheel control problem), as well as many others that can be found in the open literature. Many of the techniques described in this text have been extensively employed for many years, but the ﬁeld continues to grow. Advances in attitude estimation include a number of nonlinear ﬁltering algorithms developed since the survey paper of 1982[23], many of which are critically reviewed in a more recent survey paper [ 7]. The most important theoretical tool that has signiﬁcantly advanced the mathematics underlying attitude control is the use of Lyapunov-based methods to designcontrollers that guarantee stability for general nonlinear systems. 4Although the potential advantages of the new control and estimation algorithms are undeniable, it is wise to apply the old adage “If it ain’t broke don’t ﬁx it” to the simple buteffective control laws and the standard extended Kalman ﬁlter, which have proved their worth on a multitude of spacecraft missions. Ultimately, enhanced conﬁdence in the new approaches, coupled with the more stringent pointing requirements offuture missions, will bring about more widespread use of these approaches, or of others as yet undiscovered, for spacecraft attitude determination and control. 4A review of Lyapunov stability is presented in Sect. 12.2.2 .References 15 References Andrews, S.F., Bilanow, S.: Recent ﬂight results of the TRMM Kalman ﬁlter. In: AIAA Guidance, Navigation and Control Conference. Monterey (2002). AIAA 2002-5047 Baird, G.C., Groszkiewicz, J.E.: Gyroless attitude control for the SORCE spacecraft. In: Chapel, J.D., Culp, R.D. (eds.) Guidance and Control 2004, Advances in the AstronauticalSciences, vol. 118, pp. 593–605. Univelt, San Diego (2004). AAS 04-076 Bauer, F.H., Femiano, M.D., Mosier, G.E.: Attitude control system conceptual design for the X-Ray Timing Explorer. In: AIAA Guidance, Navigation and Control Conference. HiltonHead (1992). AIAA 92-4334-CP Black, H.D.: A passive system for determining the attitude of a satellite. AIAA J. 2(7), 1350–1351 (1964) Bruno, D., Class, B.F., Rovner, D., Baird, G., Groszkiewicz, J., Lebsock, K., Kruk, J.: A comparison of gyroless implementations on scientiﬁc spacecraft. In: AIAA Guidance,Navigation and Control Conference. Chicago (2009). AIAA 2009-5942 Crassidis, J.L., Andrews, S.F., Markley, F.L., Ha, K.: Contingency designs for attitude deter- mination of TRMM. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium,pp. 419–433. NASA-Goddard Space Flight Center, Greenbelt (1995) Crassidis, J.L., Markley, F.L., Cheng, Y .: Survey of nonlinear attitude estimation methods. J. Guid. Contr. Dynam. 30(1), 12–28 (2007) Crassidis, J.L., Markley, F.L., Kyle, A.M., Kull, K.: Attitude determination improvements for GOES. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium, pp. 151–165. NASA-Goddard Space Flight Center, Greenbelt (1996) Falkenhayn Jr., E.: Multimission Modular Spacecraft (MMS). In: Proceedings of the AIAA Programs and Technologies Conference. Houston (1988). AIAA 88-3513 Fallon III, L., Harrop, I.H., Sturch, C.R.: Ground attitude determination and gyro calibration procedures for the HEAO missions. In: 17th Aerospace Sciences Meeting, AIAA 79-0397.New Orleans (1979) Farrell, J.L.: Attitude determination by Kalman ﬁltering. Contractor Report NASA-CR-598, NASA Goddard Space Flight Center, Washington, DC (1964) Farrell, J.L.: Attitude determination by Kalman ﬁltering. Automatica 6, 419–430 (1970) Farrell, J.L., Stuelpnagel, J.C.: A least-squares estimate of satellite attitude. SIAM Rev. 7(3), 384–386 (1966) Femiano, M.D.: Inﬂight redesign of the IUE attitude control system. In: 2nd Aerospace Main- tenance Conference. San Antonio (1986). AIAA 86-1193 Gibbs, B.P., Uetrecht, D.S., Carr, J.L., Sayal, C.: Analysis of GOES-13 orbit and attitude determination. In: SpaceOps Conference. Heidelberg (2008). AIAA 2008-3222 Guha, A.K.: Solar Maximum Mission–a system overview. In: Proceedings of the AIAA 19th Aerospace Sciences Meeting. St. Louis (1981). AIAA 81-0200 Harvie III, E., Rowe, J., Tsui, Y .K.J.: Performance analysis of the GOES trim tab solar pressure torque angular momentum control. In: Proceedings of SPIE, GOES-8 and Beyond, vol. 2812.Denver (1996) Hashmall, J.A., Liu, A.K., Rokni, M.: Accurate spacecraft attitudes from magnetometer data. In: CNES Spacecraft Dynamics (Colloque 95), pp. 169–179. Cépaduès-Éditions, Toulouse(1995) Hoffman, H.C., Donohue, J.H., Flatley, T.W.: SMM attitude control recovery. In: Proceedings of the AIAA Guidance and Control Conference. Albuquerque (1981). AIAA 81-1760 Kamel, A.A., Bhat, M.K.P., Gamble, D., Scholtz, J.H.: GOES I–M image motion compensation system. In: 1992 AIAA Aerospace Design Conference. Irvine (1992). AIAA 92-1107 Kau, S., Kumar, K.S.P., Granley, G.B.: Attitude determination via nonlinear ﬁltering. IEEE Trans. Aero. Electron. Syst. AES-5 (6), 906–911 (1969) Kuznik, F.: Satellite saviors. Air Space Smithsonian 6(3), 66–70 (1991)16 1 Introduction Lefferts, E.J., Markley, F.L., Shuster, M.D.: Kalman ﬁltering for spacecraft attitude estimation. J. Guid. Contr. Dynam. 5(5), 417–429 (1982) Lerner, G.M.: Three-axis attitude determination. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and Control, chap. 12. Kluwer Academic, Dordrecht (1978) Markley, F.L., Andrews, S.F., O’Donnell Jr., J.R., Ward, D.K.: Attitude control system of the Wilkinson Microwave Anisotropy Probe. J. Guid. Contr. Dynam. 28(3), 385–397 (2005) Markley, F.L., Bauer, F.H., Deily, J.J., Femiano, M.D.: Attitude control system conceptual design for Geostationary Operational Environmental Satellite spacecraft series. J. Guid. Contr.Dynam. 18(2), 247–255 (1995) Markley, F.L., Mortari, D.: Quaternion attitude estimation using vector observations. J. Astronaut. Sci. 48(2/3), 359–380 (2000) Markley, F.L., Nelson, J.D.: Zero-gyro safemode controller for the Hubble Space Telescope. J. Guid. Contr. Dynam. 17(4), 815–822 (1994) Murrell, J.W.: Precision attitude determination for multimission spacecraft. In: Proceedings of the AIAA Guidance, Navigation, and Control Conference, pp. 70–87. Palo Alto (1978) Pauling, D.C., Jackson, D.B., Brown, C.D.: SPARS algorithms and simulation results. In: Proceedings of the Symposium on Spacecraft Attitude Estimation, vol. 1, pp. 293–317.Aerospace Corporation, El Segundo (1969) Pellicori, S.F., Russell, E.E., Watts, L.A.: Pioneer imaging photopolarimeter optical system. Appl. Optic 12(6), 1246–1258 (1973) Roberson, R.E.: Two decades of spacecraft attitude control. J. Guid. Contr. 2(1), 3–8 (1979) Shuster, M.D.: In my estimation. J. Astronaut. Sci. 54(3 & 4), 273–297 (2006) Shuster, M.D.: The quest for better attitudes. J. Astronaut. Sci. 54(3/4), 657–683 (2006) Shuster, M.D., Oh, S.D.: Attitude determination from vector observations. J. Guid. Contr. 4(1), 70–77 (1981) Siahpush, A., Gleave, J.: A brief survey of attitude control systems for small satellites using momentum concepts. In: Proceedings of the 2nd AIAA/USU Conference on Small Satellites.Logan (1988). SSC88-IV-24 Space Systems Loral: GOES I–M data book (1996). http://goes.gsfc.nasa.gov/text/goes. databook.html (accessed Jan. 27, 2014) The Boeing Company: GOES N data book (2005). http://goes.gsfc.nasa.gov/text/goes. databooknop.html (accessed Jan. 27, 2014) Toda, N.F., Heiss, J.L., Schlee, F.H.: SPARS: The system, algorithms, and test results. In: Proceedings of the Symposium on Spacecraft Attitude Estimation, vol. 1, pp. 361–370.Aerospace Corporation, El Segundo (1969) Wahba, G.: A least-squares estimate of satellite attitude. SIAM Rev. 7(3), 409 (1965) Wen, J.T.Y ., Kreutz-Delgado, K.: The attitude control problem. IEEE Trans. Automat. Contr. 36(10), 1148–1162 (2002) Wertz, J.R. (ed.): Spacecraft Attitude Determination and Control. Kluwer Academic, Dor- drecht (1978) Wie, B., Barba, P.M.: Quaternion feedback for spacecraft large angle maneuvers. J. Guid. Contr. Dynam. 8(3), 360–365 (1985) Wi ´sniewski, R., Blanke, M.: Fully magnetic attitude control for spacecraft subject to gravity gradient. Automatica 35(7), 1201–1214 (1999) Worth, H.E., Warren, M.: Transit to Tomorrow: Fifty Years of Space Research at the Johns Hopkins University Applied Physics Laboratory. The Johns Hopkins University AppliedPhysics Laboratory, Laurel (2009)Chapter 2 Matrices, Vectors, Frames, Transforms This chapter begins with an overview of matrices and vectors, which are used extensively in attitude analysis. We assume that the reader has some familiaritywith this material, so the account is not completely self-contained. The principal objective of this section is to deﬁne our notation and conventions. We next discuss a special category of four-component vectors, which we refer to as quaternions although they differ conceptionally from the quaternions introduced by W. R. Hamilton in 1844. They perform the same function as Hamilton’s quaternions in applications, however, and have proved to be extremely useful inattitude analysis. We then move on to a discussion of rotations in three-dimensional space and the most common parameter sets that have been used to specify these rotations: theEuler axis and angle, the rotation vector, the quaternion, the Rodrigues parameters, the modiﬁed Rodrigues parameters, and the Euler angles. The last section in this chapter addresses the representation of attitude errors. A more extensive treatment ofthe material in this section, including historical references, can be found in Shuster’s comprehensive review article [ 17]. 2.1 Matrices Anm/STXnmatrixAis an array with mrows andncolumns of scalars : AD2 6664a 11a12/SOH/SOH/SOHa1n a21a22/SOH/SOH/SOHa2n :::::::::::: a m1am2/SOH/SOH/SOHamn3 7775(2.1) F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _2, © Springer Science+Business Media New York 20141718 2 Matrices, Vectors, Frames, Transforms We will assume that the scalar matrix elements are real numbers. The results in this chapter can be generalized to matrices with complex elements, but we will rarely need to deal with complex matrices. If mDn, then the matrix Aissquare . We denote an m/STXnmatrix with all components equal to zero by 0m/STXn, or sometimes simply by0if confusion is unlikely to result. Acolumn vector , or sometimes simply a vector, is an n/STX1matrix xD2 6664x1 x2 ::: xn3 7775(2.2) We denote an n-component vector with all components equal to zero by 0n,o r sometimes simply by 0if confusion is unlikely. Matrices can be added, subtracted, or multiplied. For addition and subtraction, all matrices must have the same number of rows and columns. The elements of CDA˙B (2.3) are given bycijDaij˙bij. Matrix addition and subtraction are both commutative, A˙BDB˙A, and associative, .A˙B/˙CDA˙.B˙C/. The multiplication of two matrices AandB: CDAB (2.4) is valid only when the number of columns of Ais equal to the number of rows of B (i.e.AandBmust be conformable ). The resulting matrix Cwill have rows equal to the number of rows of Aand columns equal to the number of columns of B. Thus, ifAhas dimension m/STXnandBhas dimension n/STXp, thenCwill have dimension m/STXp. The elements of Care given by cijDnX kD1aikbkj (2.5) for alliD1;2;:::;m andjD1;2;:::;p . Matrix multiplication is associative, A.BC/D.AB/C , and distributive, A.BCC/DABCAC, but not commutative in general, AB¤BA. In those cases for which ABDBA,t h e matricesAandBare said to commute . The transpose of a matrix, denoted AT, has rows that are the columns of Aand columns that are the rows of A. The transpose of the matrix deﬁned by Eq. ( 2.1), for example, is2.1 Matrices 19 ATD2 6664a 11a21/SOH/SOH/SOHam1 a12a22/SOH/SOH/SOHam2 :::::::::::: a1na2n/SOH/SOH/SOHamn3 7775(2.6) The transpose of a column vector is a row vector . The transpose operator has the following properties: .˛A/TD˛AT;where˛is a scalar (2.7a) .ACB/TDATCBT(2.7b) .AB/TDBTAT(2.7c) IfADAT, thenAis asymmetric matrix, ifAD/NULAT, thenAis askew symmetric matrix. Adiagonal matrix is a square matrix with nonzero elements only on the main diagonal and all other elements equal to zero. An n/STXndiagonal matrix can be formed from an n-component row or column vector by diag.x/Ddiag.xT/Ddiag.Œx1x2/SOH/SOH/SOHxn/c141//DC12 6664x 10/SOH/SOH/SOH0 0x2/SOH/SOH/SOH0 :::::::::::: 00/SOH/SOH/SOHxn3 7775(2.8) An important special case of a diagonal matrix is the identity matrix: I/DC1diag.Œ11/SOH/SOH/SOH1/c141/ (2.9) It has the property that IADAandBIDBif the matrices are conformable. We sometimes denote the n/STXnidentity matrix by I nif supplying the subscript helps to remove ambiguity. Anupper triangular matrix is a matrix in which all the entries below the main diagonal are zero, i.e. aijD0fori<j .Alower triangular matrix has all zeros above the main diagonal, i.e. aijD0fori>j . Two useful scalar quantities can be deﬁned for square matrices, the trace and thedeterminant . The trace of an n/STXnmatrix is simply the sum of the diagonal elements: trADnX iD1aii (2.10)20 2 Matrices, Vectors, Frames, Transforms Some useful identities involving the matrix trace are given by tr.˛A/D˛trA (2.11a) tr.ACB/DtrACtrB (2.11b) tr.ABC/Dtr.BCA/Dtr.CAB/ (2.11c) tr.AB/Dtr.BA/ (2.11d) tr.xyT/DxTy (2.11e) tr.AyxT/DxTAy (2.11f) Equation ( 2.11d )–(2.11f ) are special cases of Eq. ( 2.11c ), which shows the cyclic invariance of the trace. The operation yxTis known as the outer product (note that yxT¤xyTin general). The determinant of an n/STXnmatrix can be computed using an expansion about any rowior any column j: detADnX kD1./NUL1/iCkaikmikDnX kD1./NUL1/kCjakjmkj (2.12) wheremijis the minor , which is the determinant of the .n/NUL1//STX.n/NUL1/ matrix resulting from deleting row iand columnjofA. Some useful determinant identities are detID1 (2.13a) detATDdetA (2.13b) det.AB/DdetAdetB (2.13c) det.˛A/D˛ndetA (2.13d) The elements of the adjoint matrix adjAare deﬁned in terms of the minors: ŒadjA/c141ijD./NUL1/iCjmji (2.14) Note the reversed order of the subscripts on the left and right side of this equation. It can be shown that [ 21] A.adjA/D.adjA/AD.detA/I (2.15) Thus we see that a nonsingular matrix, which is a square matrix with a nonzero determinant, has an inverse A/NUL1DadjA detA(2.16)2.2 Vectors 21 that satisﬁes the identities A/NUL1ADAA/NUL1DI (2.17a) .AT//NUL1D.A/NUL1/T/DC1A/NULT(2.17b) IfAandBaren/STXnmatrices, then the matrix product AB is nonsingular if and only ifAandBare nonsingular. If these conditions are met, then .AB//NUL1DB/NUL1A/NUL1(2.18) 2.2 Vectors Thedot product ,inner product ,o rscalar product of two vectors of equal dimension, n/STX1, is given by x/SOHy/DC1xTyDyTxDnX iD1xiyi (2.19) If the dot product is zero, then the vectors are said to be orthogonal . A measure of the length of a vector is given by its Euclidean norm , which is the square root of the inner product of the vector with itself: kxk/DC1px/SOHxD"nX iD1x2 i#1=2 (2.20) It is easily seen that k˛xkDj˛jkxk. The norm obeys the inequality kxk/NAK0 (2.21) with equality only for xD0. A vector with norm equal to unity is said to be a unit vector . Any nonzero vector can be made into a unit vector by dividing it by its norm: xunit/DC1x kxk(2.22) This is referred to as normalizing the vector x. Figure 2.1a shows two vectors, xandy, and the orthogonal projection of a vector yonto a vector x. The orthogonal projection of yonto x¤0is given by22 2 Matrices, Vectors, Frames, Transforms y pxy−p Orthogonal Projectiony xy−x θ Angle between Two Vectorsab Fig. 2.1 Depiction of an orthogonal projection ( a) and of the angle between two vectors ( b) pDx/SOHy kxk2x (2.23) This projection yields .y/NULp//SOHxD0.F r o mE q s .( 2.21) and ( 2.23) we see that 0/DC4k.y/NULp/k2Dkyk2/NUL.x/SOHy/2 kxk2(2.24) This yields the Cauchy-Schwarz inequality : jx/SOHyj/DC4k xkkyk (2.25) The Cauchy-Schwarz inequality implies the triangle inequality kxCyk/DC4k xkCk yk (2.26) and it allows us to deﬁne the angle /DC2between the vectors xandyby cos/DC2Dx/SOHy kxkkyk(2.27) This angle is illustrated in Fig. 2.1b, as is the vector difference y/NULx. 2.3 Jacobian, Gradient, and Hessian In this section we will introduce notation for partial derivatives with respect to components of a vector x.I f y.x/is anm-component vector function of an n-component vector x, we deﬁne the Jacobian matrix as them/STXnmatrix2.3 Jacobian, Gradient, and Hessian 23 @y.x/ @x/DC12 6666666666666664@y 1 @x1@y1 @x2/SOH/SOH/SOH@y1 @xn @y2 @x1@y2 @x2/SOH/SOH/SOH@y2 @xn :::::::::::: @y m @x1@ym @x2/SOH/SOH/SOH@ym @xn3 7777777777777775(2.28) In particular, if we have a scalar f.x/in place of the vector function y.x/,t h i s reduces to the m/STX1row vector @f.x/ @x/DC1/DC4@f @x1@f @x2:::@f @xn/NAK (2.29) The transpose of this, a 1/STXmcolumn vector, is known as the gradient off.x/: rxf.x//DC1/DC4@f.x/ @x/NAKT /DC1@f.x/ @xT(2.30) The Hessian is then/STXnsymmetric matrix of second-order partial derivatives off.x/: @2f.x/ @x@xT/DC12 6666666666666664@ 2f @x1@x1@2f @x1@x2/SOH/SOH/SOH@2f @x1@xn @2f @x2@x1@2f @x2@x2/SOH/SOH/SOH@2f @x2@xn :::::::::::: @ 2f @xn@x1@2f @xn@x2/SOH/SOH/SOH@2f @xn@xn3 7777777777777775(2.31) Some use the term Hessian to refer to the determinant of the Hessian matrix. The Laplacian is the trace of the Hessian matrix: r 2 xf.x//DC1nX iD1@2f @x2 iDtr/DC2@2f.x/ @x@xT/DC3 (2.32)24 2 Matrices, Vectors, Frames, Transforms 2.4 Orthonormal Bases, Change of Basis Anorthonormal set of vectors is a set with inner products obeying xi/SOHxjDıij (2.33) where the Kronecker delta ıijis deﬁned as ıijD( 0ifi¤j 1ifiDj(2.34) If the number of vectors in the set is equal to the dimension of the vectors, then the set is said to constitute an orthonormal basis . We will generally denote basis vectors (and some other unit vectors) by the letter e. The orthonormal basis e1D2 66641 0 ::: 03 7775;e 2D2 66640 1 ::: 03 7775;:::; e nD2 66640 0 ::: 13 7775(2.35) is called the natural basis . Any vector xcan be written as a linear superposition of basis vectors; using the natural basis gives xD2 6664x 1 x2 ::: xn3 7775DnX jD1xjej (2.36) An orthonormal set of basis vectors deﬁnes a reference frame . Let us refer to the frame deﬁned by e1;e2;:::; enas frameF; and consider another frame F0deﬁned by the orthonormal basis: e0 1;e0 2;:::; e0 n. We can express the vector xin either basis xDnX jD1xjejDnX kD1x0 ke0k(2.37) Taking the dot product of this equation with ejore0 kgives xjDej/SOHxDnX kD1.ej/SOHe0 k/x0 k (2.38a) x0 kDe0 k/SOHxDnX jD1.e0 k/SOHej/xj (2.38b)2.4 Orthonormal Bases, Change of Basis 25 Substituting the ﬁrst equality of Eq. ( 2.38a ) into the ﬁrst equality of Eq. ( 2.37)g i v e s xDnX jD1ej.eT jx/D0 @nX jD1ejeT j1 Ax (2.39) It follows that the identity matrix can be expressed in terms of any orthonormal basis by InDnX iD1eieT i (2.40) When considering transformations among different reference frames, it is very useful (almost indispensable, in fact) to regard xas an abstract vector having an existence in n-dimensional space independent of any particular reference frame, and having representations xFin reference frame FandxF0in frameF0. Subscripts will be provided when it is important to indicate the reference frame explicitly or to carefully distinguish between abstract vectors and their representations, but subscripts will often be omitted when confusion is unlikely to arise. Arraying thecomponents of xin the reference frames FandF 0as column vectors gives the representations xFD2 6664x 1 x2 ::: xn3 7775D2 6664e 1/SOHx e2/SOHx ::: en/SOHx3 7775and x F0D2 6664x0 1 x0 2::: x0 n3 7775D2 6664e 0 1/SOHx e0 2/SOHx ::: e0 n/SOHx3 7775(2.41) Equation ( 2.38) can be used to express the relations between x FandxF0as matrix products: xFDDFF0xF0 (2.42a) xF0DDF0FxF (2.42b) where DFF0D2 6664e 1/SOHe0 1e1/SOHe0 2/SOH/SOH/SOH e1/SOHe0 n e2/SOHe0 1e2/SOHe0 2/SOH/SOH/SOH e2/SOHe0 n:::::::::::: e n/SOHe0 1en/SOHe0 2/SOH/SOH/SOH en/SOHe0 n3 7775(2.43a) D F0FD2 6664e0 1/SOHe1e0 1/SOHe2/SOH/SOH/SOH e0 1/SOHen e0 2/SOHe1e0 2/SOHe2/SOH/SOH/SOH e0 2/SOHen :::::::::::: e 0 n/SOHe1e0 n/SOHe2/SOH/SOH/SOH e0 n/SOHen3 7775(2.43b)26 2 Matrices, Vectors, Frames, Transforms The matrices DFF0andDF0Fare known as direction cosine matrices (DCMs) because their elements are the cosines of the angles between the basis vectors in the two reference frames. These transformation equations hold for any two orthonormalbases. We see immediately that D F0FDDT FF0 (2.44) which means that the matrix transforming vector representations from frame Fto frameF0is the transpose of the matrix transforming from F0toF. Another way of stating the content of Eq. ( 2.43) is that the columns of DFF0are the representations in frameFof the basis vectors of frame F0andvice versa : DFF0D/STX e0 1Fe02F/SOH/SOH/SOHe0 nF/ETX (2.45a) DF0FD/STX e1F0e2F0/SOH/SOH/SOHenF0/ETX (2.45b) We emphasize that the transformations considered here are transformations of the representations of a ﬁxed abstract vector resulting from a change in the reference frame. This is the passive interpretation of a transformation, also known as the alias sense (from the Latin word for “otherwise,” in the sense of “otherwise known as”) [ 17]. The alternative active interpretation (also known as the alibi sense from the Latin word for “elsewhere”) considers the representation in a ﬁxed reference frame of an abstract vector that is rotated from xtox0. The difference between these two interpretations is illustrated in Fig. 2.2a–c. Figure 2.2a shows the components x1andx2of the vector xin frameF. Figure 2.2b shows the components x0 1and x0 2ofxin the rotated frame F0, illustrating the alias sense. Figure 2.2cs h o w st h e componentsx0 1andx0 2of a rotated vector x0in the unrotated frame F, illustrating the alibi sense. In this example, the values of x0 1andx0 2are the same in the alias and alibi interpretations, but the signiﬁcance of these quantities is completely different in thetwo cases. They are the components of an unrotated vector in a rotated reference frame in the alias interpretation, while they are the components of a rotated vector in an unrotated reference frame in the alibi interpretation. When necessary, we canuse a more precise notation to distinguish these two different interpretations, as in Eq. ( 2.45); but we can usually avoid this complication because this book will rarely, if ever, employ the active interpretation of transformations. In the exampleillustrated in Fig. 2.2b,c, it can be seen that the magnitude of the rotation is the same in the two interpretations but the sense of the rotation is opposite. It is important to remember this important difference in the sense of rotation in the twointerpretations; it results in some unexpected minus signs, and overlooking them has led to actual errors in ﬂight software. 1 1One example is an incorrect sign for the velocity aberration correction for star tracker measure- ments on the WMAP spacecraft, which fortunately was easily corrected.2.4 Orthonormal Bases, Change of Basis 27 ab c Fig. 2.2 Alias and Alibi interpretations of a transformation. ( a) Components. ( b) Alias. ( c) Alibi Now consider that we have three reference frames, denoted F,G, andH, and that we transform a vector representation from frame Fto frameGand then from frameGto frameH. This is effected by the successive transformations xHDDHGxGDDHG.DGFxF/D.DHGDGF/xF (2.46) We could have transformed directly from FtoHbyxHDDHFxF. These transformations must be equivalent for any vector xF, so it must be true that DHFDDHGDGF (2.47) This says that successive transformations are accomplished by simple matrix multiplication of DCMs, which may appear to be an obvious result. It is not inconceivable, though, that the method for implementing successive transformations could have been more complex. Transforming from frame Fto frameGand back to frame Fis effected by the matrixDFF, which must be the identity matrix. But from Eqs. ( 2.44) and ( 2.47)t h i s means that IDDFGDGFDDFGDT FGDDT GFDGF (2.48) Matrices like DCMs for which IDDDTDDTDare called orthogonal matrices, or sometimes orthonormal matrices. The transpose of an orthogonal matrix is equal to its inverse; its columns constitute a set of orthonormal vectors, as do its rows.In fact, the columns and rows of a DCM are just the representations in one reference frame of the basis vectors in the other reference frame. Equation ( 2.7c) can be used to show that the product of two orthogonal matrices is orthogonal; i.e. if AandB are orthogonal, then .AB/.AB/ TDABBTATDAATDI (2.49) This means that the set of n/STXnorthogonal matrices form a group , which requires, among other things, that the product of two elements of the group is also an element.28 2 Matrices, Vectors, Frames, Transforms The group of n/STXnorthogonal matrices is called the orthogonal group O.n/. Because 1DdetIDdet.DTD/D.detD/2, the determinant of an orthogonal matrix must be equal to˙1. It follows that the set of n/STXnproper orthogonal matrices, which are those whose determinant is C1, also form a group, called the special orthogonal group SO.n/. The orthogonal matrices with determinant /NUL1do not form a group, because the product of two matrices with determinant /NUL1has determinantC1. An important result follows from Eq. ( 2.48), namely that xG/SOHyGD.DGFxF/TDGFyFDxT FDT GFDGFyFDxF/SOHyF (2.50) This says that the value of the inner product of two vectors is independent of the reference frame in which they are represented, or equivalently that reference frametransformations preserve both lengths of vectors and angles between them. Inserting a matrix between two vectors leads to the relation x T FMFyFDxT FDT GFDGFMFDT GFDGFyFDxT GMGyG (2.51) where MG/DC1DGFMFDT GF (2.52) This deﬁnes how matrices must transform under reference frame transformations for Eq. ( 2.51) to hold. 2.5 Vectors in Three Dimensions The case of three dimensions is especially interesting because we and our vehicles live in three-dimensional space.2In three dimensions, the abstract vectors generally represent physical quantities that have both a magnitude and a direction, like displacements or velocities. We can deﬁne a vector product orcross product for three-component vectors in terms of their components by x/STXyD2 4x2y3/NULx3y2 x3y1/NULx1y3 x1y2/NULx2y13 5D/NULy/STXx (2.53) It is easily seen that the cross product x/STXyis perpendicular to both xandy.T h e cross product can also be obtained using matrix multiplication: 2This is true in classical physics. Various contemporary physical theories indicate that we live in a space having anywhere from two to eleven dimensions.2.5 Vectors in Three Dimensions 29 x/STXyDŒx/STX/c141y (2.54) whereŒx/STX/c141is the cross product matrix , deﬁned by Œx/STX/c141/DC12 40/NULx3x2 x30/NULx1 /NULx2x103 5 (2.55) Note thatŒx/STX/c141is a skew symmetric matrix.3 The cross product and the cross product matrix obey the following relations: x/SOH.y/STXz/D.x/STXy//SOHz (2.56a) Œx/STX/c141Œy/STX/c141D/NUL.x/SOHy/ICyxT(2.56b) Œx/STX/c141Œy/STX/c141/NULŒy/STX/c141Œx/STX/c141DyxT/NULxyTDŒ.x/STXy//STX/c141 (2.56c) adjŒx/STX/c141DxxT(2.56d) It follows from Eq. ( 2.56b ) that kx/STXyk2D.Œx/STX/c141y/T.Œx/STX/c141y/D/NULyTŒx/STX/c1412yDkxk2kyk2/NUL.x/SOHy/2(2.57) With Eq. ( 2.27), this means that kx/STXykDk xkkyksin/DC2 (2.58) It is often convenient to express a 3/STX3matrix in terms of its columns: M/DC1/STX abc/ETX (2.59) With this notation, the determinant is detMDa/SOH.b/STXc/Db/SOH.c/STXa/Dc/SOH.a/STXb/ (2.60) and the adjoint is adjM/DC1adj/NUL/STX abc/ETX/SOH D2 4.b/STXc/T .c/STXa/T .a/STXb/T3 5 (2.61) We can also derive the useful identity 3A vector product of two vectors can be deﬁned only in three dimensions because an n/STXnskew- symmetric matrix has exactly nindependent parameters only for nD3.30 2 Matrices, Vectors, Frames, Transforms MTŒx/STX/c141MD2 4a/SOH.x/STXa/a/SOH.x/STXb/a/SOH.x/STXc/ b/SOH.x/STXa/b/SOH.x/STXb/b/SOH.x/STXc/ c/SOH.x/STXa/c/SOH.x/STXb/c/SOH.x/STXc/3 5 D2 40/NUL.a/STXb//SOHx.c/STXa//SOHx .a/STXb//SOHx0/NUL.b/STXc//SOHx /NUL.c/STXa//SOHx.b/STXc//SOHx03 5DŒf.adjM/xg/STX/c141 (2.62) SettingMDAT, whereAis a proper orthogonal 3/STX3matrix, gives adj MDA and AŒx/STX/c141ATDŒ.Ax//STX/c141;forA2SO(3) (2.63) This special case is much more useful than the general case. In the speciﬁc case of a reference frame transformation, we have AGFŒxF/STX/c141AT GFDŒ.AGFxF//STX/c141DŒxG/STX/c141 (2.64) which can be viewed as a special case of Eq. ( 2.52). This equation can be used to show that xG/STXyGDŒ.AGFxF//STX/c141AGFyFDAGF.xF/STXyF/ (2.65) The signiﬁcance of this is that the cross product of two vectors transforms exactly like any other vector under a reference frame rotation, which is what we want. The discussion so far has been purely algebraic; it has said nothing about the right hand rule . Discussing this rule requires an intuitive picture of vectors in three- dimensional space. First note that the deﬁnition of the cross product means that the natural basis vectors deﬁned by Eq. ( 2.35) satisfy the relation e3De1/STXe2.N o w consider the possible orientation of these three basis vectors in physical space. Theorientation of e 1ande2is arbitrary, except that they must be orthogonal; but this leaves us only two choices for e3, which must be perpendicular to both e1ande2. We choose the orientation of e3to satisfy the right hand rule, i.e: we place e1ande2 tail-to-tail, ﬂatten the right hand, extending it in the direction of e1, curl the ﬁngers toward e2through the shortest angle, and choose e3to point along the direction indicated by the thumb. This deﬁnes a right-handed reference frame, and all crossproducts will obey the right hand rule if we restrict ourselves to right handed reference frames. To see this explicitly, consider two arbitrary vectors xandy. There is a reference frame in which x FDkxk2 41 003 5;y FDkyk2 4cos/DC2 sin/DC2 03 5H) xF/STXyFDkxkkyk2 40 0 sin/DC23 5(2.66)2.6 Some Useful Reference Frames 31 where/DC2is the angle between xandy. This cross product obeys the right-hand rule, and Eq. ( 2.65) guarantees that the right hand rule will then hold in any reference frame. Note that if Ahad been an improper orthogonal matrix with determinant /NUL1, an undesirable minus sign would have appeared between the two sides of Eq. ( 2.63). Seen from this point of view, the problem with improper orthogonal matrices is that they would change a right-handed reference frame into a left-handed one; theywould turn the reference frame inside out. 2.6 Some Useful Reference Frames Several reference frames in three dimensions are of special interest for attitudeanalysis. We will discuss the most important of these in this section. In general, a reference frame is speciﬁed by the location of its origin and the orientation of its coordinate axes, with the orientation being much more important for attitudeanalysis. 2.6.1 Spacecraft Body Frame A spacecraft body frame is deﬁned by an origin at a speciﬁed point in the spacecraft body and three Cartesian axes. A body frame is used to align the various components during spacecraft assembly. Components will generally shift due to the large forcesexperienced during launch, though, and can also move while on orbit due to thermal deformations. Every effort is made to limit these motions, but they cannot always be neglected. Whether they are negligible or not depends on the pointing accuracyrequired of the spacecraft. As an additional complication, some components of the spacecraft, such as solar arrays or gimbaled instruments, are moved quite deliberately. Therefore, it is quite common to deﬁne the body coordinate systemoperationally as the orientation of some sufﬁciently rigid navigation base , which is a subsystem of the spacecraft including the most critical attitude sensors and payload instruments. The navigation base often takes the form of a specially constructedoptical bench , with its attached sensors and payload components. The purpose of attitude estimation and attitude control is to ascertain and to control the orientation of the navigation base relative to some external reference frame. 2.6.2 Inertial Reference Frames An inertial reference frame is a frame in which Newton’s laws of motion are valid.It is a well known fact of classical mechanics that any frame moving at constant velocity and without rotation with respect to an inertial frame is also inertial [ 5].32 2 Matrices, Vectors, Frames, Transforms The existence of these dynamically preferred frames raises the interesting question of whether there is something with respect to which all inertial frames are non- rotating and unaccelerated. Weinberg concludes in [ 25, p. 474] that “ ...i n e r t i a l frames are any reference frames that move at constant velocity, and without rotation, relative to frames in which the universe appears spherically symmetric.” This characterization is consistent with Mach’s Principle , the hypothesis that inertial frames are somehow determined by the mass of everything in the universe. Celestial reference frames with their axes ﬁxed relative to distant “ﬁxed” stars are the best realizations of inertial frames. The standard as of this writing is theInternational Celestial Reference System (ICRF) with its axes ﬁxed with respect to the positions of several hundred distant extragalactic sources of radio waves, determined by very long baseline interferometry [ 8,11]. The zaxis of this frame is aligned with the Earth’s North pole, and the xaxis with the vernal equinox ,t h e intersection of the Earth’s equatorial plane with the plane of the Earth’s orbit around the Sun, in the direction of the Sun’s position relative to the Earth on the ﬁrst day ofspring. Unfortunately, neither the polar axis nor the ecliptic plane is inertially ﬁxed, so the ICRF axes are deﬁned to be the mean orientations of the pole and the vernal equinox (the positions with short-period motions removed by dynamic models) atsome ﬁxed epoch time. The origin of the ICRF is at the center-of-mass of the solar system. An approximate inertial frame, known as the Geocentric Inertial Frame (GCI) has its origin at the center of mass of the Earth. This frame has a linear acceleration because of the Earth’s circular orbit about the Sun, but this is unimportant for attitude analysis. The axes of a “mean of epoch” GCI frame are aligned with themean North pole and mean vernal equinox at some epoch. The GCI frame is denoted by the triadfi 1;i2;i3g, as shown in Fig. 2.3. 2.6.3 Earth-Centered/Earth-Fixed Frame The Earth-Centered/Earth-Fixed (ECEF) Frame is denoted by f/SI1;/SI2;/SI3gas shown in Fig. 2.3. This frame is similar to the GCI frame with /SI3Di3; however, the /SI1axis points in the direction of the Earth’s prime meridian, and the /SI2axis completes the right-handed system. Unlike the GCI frame, the ECEF frame rotates with the Earth. The rotation angle is known as the Greenwich Mean Sidereal Time (GMST) angleand is denoted by /DC2 GMST in Fig. 2.3. The transformation of a position vector rfrom its GCI representation rIto its ECEF representation rEfollows rED2 4x y z3 5DAEIrID2 4cos/DC2GMST sin/DC2GMST0 /NULsin/DC2GMST cos/DC2GMST0 00 13 5rI (2.67)2.6 Some Useful Reference Frames 33 Prime Meridian PlaneEquatorial Plane23,i 1Spacecraft r 1i 2iInertial Reference DirectionGMST3 Fig. 2.3 Deﬁnitions of various reference frames Determining the GMST angle requires the Julian date, JD. For a given year Y (between 1901 and 2099), month M, dayD, hourh, minutem, and second s,t h e Julian date is calculated by [ 24] JD.Y;M;D;h;m;s/ D1;721;013:5C367Y/NULINT/SUB7 4/DC4 YCINT/DC2MC9 12/DC3/NAK/ESC CINT/DC2275M 9/DC3 CDC60hCmCs=60/ETX 1440 (2.68) where INT denotes the integer part and 60* denotes using 61 s for days with a leap second. We need to compute T0, the number of Julian centuries elapsed from the epoch J2000.0 to zero hours of the date in question: T0DJD.Y;M;D;0;0;0/ /NUL2;451;545 36;525(2.69) The GCI coordinate system is ﬁxed relative to the stars, not the Sun, so the GMST angle is the mean sidereal time at zero longitude. A sidereal day is the length of time that passes between successive crossings of a given projected meridian by agiven ﬁxed star in the sky. It is approximately 3 min and 56 s shorter than a solar34 2 Matrices, Vectors, Frames, Transforms Rpole R NhZenith HorizonrFig. 2.4 Geocentric and geodetic latitude dayof 86,400 s, which is the length of time that elapses between the Sun reaching its highest point in the sky two consecutive times [ 1]. Therefore/DC2GMST in units of seconds is calculated by /DC2GMSTD24;110:54841C8;640;184:812866T 0C0:093104T2 0 /NUL6:2/STX10/NUL6T3 0C1:002737909350795.3600h C60mCs/ (2.70) This quantity is next reduced to a range from 0 to 86,400 s by adding/subtracting multiples of 86,400. Then /DC2GMST in degrees is obtained by dividing by 240, because 1sD1/240ı. The ECEF position vector can be speciﬁed by its magnitude r/DC1krEkDk rIk, longitude/RS, and geocentric latitude /NAK0. An alternative description in terms of geodetic latitude, /NAK, is often employed. The Earth’s geoid can be approximated by an ellipsoid of revolution about its minor axis, the Earth’s rotation axis, as shown in Fig. 2.4[11]. The geocentric latitude /NAK0Dsin/NUL1.z=r/is the angle between the equatorial plane and the radius vector from the center of the Earth. The geodeticlatitude/NAKis the angle between the equatorial plane and the normal to the reference ellipsoid. The ﬂattening of the ellipsoid is given by fDR ˚/NULRpole R˚(2.71) whereR˚is the equatorial radius of the Earth and Rpoleis the distance from the center of the Earth to a pole. The eccentricity of the reference ellipsoid is given by eDp 1/NUL.1/NULf/2Dp f.2/NULf/ (2.72) Many reference ellipsoid models exist, but for all of them the difference between the equatorial and polar radii is less than 22 km, so that f/EM1=298:257 is a valid approximation. A common ellipsoid model is given by the World Geodetic System1984 model (WGS-84), with semimajor axis R ˚/DC1aD6;378;137:0 m and semiminor axis Rpole/DC1bD6;356;752:3142 m. The eccentricity of this ellipsoid is given byeD0:0818 .2.6 Some Useful Reference Frames 35 To determine the ECEF position vector from the geodetic coordinates, latitude /NAK, longitude/RS, and heighth, we ﬁrst compute the distance between the zaxis and the normal to the ellipsoid, ﬁnding [ 3] NDR˚p 1/NULe2sin2/NAK(2.73) Then the ECEF position coordinates are given by xD.NCh/cos/NAKcos/RS (2.74a) yD.NCh/cos/NAKsin/RS (2.74b) zDŒN.1/NULe2/Ch/c141sin/NAK (2.74c) This gives the following relationship between geocentric and geodetic latitudes tan/NAKDNCh N.1/NULe2/Chtan/NAK0(2.75) which has the ﬁrst order approximation in the ﬂattening f /NAKD/NAK0CfR˚ R˚Chsin.2/NAK0/ (2.76) The difference between geodetic and geocentric latitudes amounts to 12 arcmin at most [ 11]. The conversion from ECEF to geodetic coordinates is not straightforward, but a closed-form solution is given in [ 20]. Given,x,yandzin ECEF coordinates, the solution is given by e2D1/NULb2=a2;/SI2Da2=b2/NUL1; /SUBDp x2Cy2 (2.77a) pDjzj=/SI2;sD/SUB2=.e2/SI2/; qDp2/NULb2Cs (2.77b) uDp=pq; vDb2u2=q; PD27vs=q; QD.p PC1Cp P/2=3 (2.77c) tD.1CQC1=Q/=6; cDp u2/NUL1C2t; wD.c/NULu/=2 (2.77d) dDsign.z/pqh wC.p t2Cv/NULuw/NULt=2/NUL1=4/1=2i (2.77e) NDap 1C/SI2d2=b2;/NAKDsin/NUL1Œ./SI2C1/.d=N//c141 (2.77f) hD/SUBcos/NAKCzsin/NAK/NULa2=N; /RSDatan2.y;x/ (2.77g)36 2 Matrices, Vectors, Frames, Transforms Direction of MotionGeocentric Radius Vector of Spacecraft Orbital Plane b a Fig. 2.5 Local-vertical/local-horizontal frame. ( a) Frame deﬁnition. ( b) Flight path angle where atan2.y;x/ is the standard function giving the argument of the complex numberxCiy. It should be noted that longitude here is assumed to range between /NUL180ı(West) toC180ı(East). 2.6.4 Local-Vertical/Local-Horizontal Frame It is often convenient, especially for Earth-pointing spacecraft, to deﬁne a reference frame referenced to the spacecraft’s orbit, which we will identify by the subscript O. The most common case is the Local-Vertical/Local-Horizontal (LVLH) orbit frame shown in Fig. 2.5a. It has its zaxiso3pointing along the nadir vector, directly toward the center of the Earth from the spacecraft,4and itsyaxis o2pointing along the negative orbit normal, in the direction opposite to the spacecraft’s orbital angular velocity. The xaxis o1completes the right-handed triad. The representations of these vectors in an inertial frame Iare o3ID/NULrI=krIk/DC1/NULg3rI (2.78a) o2ID/NUL.rI/STXvI/=krI/STXvIk/DC1/NULg2.rI/STXvI/ (2.78b) o1IDo2I/STXo3IDg2g3.rI/STXvI//STXrIDg2g3ŒkrIk2vI/NUL.rI/SOHvI/rI/c141(2.78c) where rIandvIDPrIare the spacecraft position and velocity in the Iframe. Note that thexaxis is in the direction of the velocity for a circular orbit. The rotation matrix from the Oframe to theIframe can be expressed by Eq. ( 2.45)a s AIOD/STX o1Io2Io3I/ETX (2.79) 4This is the geocentric nadir vector. Some spacecraft use the geodetic nadir vector, which is normal to the surface of the reference ellipsoid, but we will not consider this complication.2.7 Quaternions 37 The angle between the velocity vector and the local horizontal .o1I/NULo2I/plane is called the ﬂight-path angle , denoted by /CRin Fig. 2.5b. The speciﬁc angular momentum is given by hIDrI/STXvI, as discussed in Chap. 10.F r o mE q . ( 2.58) we haveh/DC1khjkDrvsin', wherer/DC1krIkandv/DC1kvIk. Since/CRC'D90ı, then the ﬂight path angle can be computed using cos/CRDh rv(2.80) T h es i g no f/CRis the same as the sign of rI/SOHvI. Notice that o1Iis in the direction of the spacecraft velocity and the ﬂight path angle is always zero for a circular orbit, because rI/SOHvID0in this case. 2.7 Quaternions We consider a quaternion to be a four-component vector with some additional operations deﬁned on it. A quaternion qhas a three-vector part q1W3and a scalar partq4 qD/DC4q1W3 q4/NAK where q1W3D2 4q1 q2 q33 5 (2.81) The most important added quaternion operations are two different products of a pair of quaternionsNqandq Nq˝qD/DC4q4Nq1W3CNq4q1W3/NULNq1W3/STXq1W3 Nq4q4/NULNq1W3/SOHq1W3/NAK (2.82a) NqˇqD/DC4q4Nq1W3CNq4q1W3CNq1W3/STXq1W3 Nq4q4/NULNq1W3/SOHq1W3/NAK (2.82b) Notice that these deﬁnitions differ only in the sign of the cross product in the vector part, from which it follows that5 Nq˝qDqˇNq (2.83) Our quaternions are conceptually different from those introduced by Hamilton in 1844, before the introduction of vector notation. Hamilton deﬁned a quaternion as qDq0Ciq1Cjq2Ckq3, a hypercomplex extension of a complex number zD xCiy, withi,j, andkobeying the relations i2Dj2Dk2D/NUL1,ijD/NULjiDk, 5The notation Nq˝qwas introduced in [ 7], and the notation Nqˇqis a modiﬁcation of notation introduced in [ 13].38 2 Matrices, Vectors, Frames, Transforms jkD/NULkjDi, andkiD/NULikDj. Hamilton’s product Nqqcorresponds to our productNqˇq, but the productNq˝qhas proven to be more useful in attitude analysis. Some authors’ notations differ from ours in labeling the scalar part of a quaternionq 0and putting it at the top of the column vector. Care must be taken to thoroughly understand the conventions embodied in any quaternion equation that one chooses to reference. Quaternion multiplication is associative, q˝.Nq˝NNq/D.q˝Nq/˝NNqand distributive, q˝.NqCNNq/Dq˝NqCq˝NNq, but not commutative in general, q˝Nq¤Nq˝q. This parallels the situation for matrix multiplication. In those cases for which q˝NqDNq˝q, the quaternions qandNqare said to commute. Analogous equations hold for the product Nqˇq. Quaternion products can be represented by matrix multiplication, very much like the cross product: q˝NqDŒq˝/c141NqDNqˇq (2.84a) qˇNqDŒqˇ/c141NqDNq˝q (2.84b) where Œq˝/c141/DC1/DC4q4I3/NULŒq1W3/STX/c141q1W3 /NULqT 1W3q4/NAK D/STX /TAB.q/q/ETX (2.85) and Œqˇ/c141/DC1/DC4q4I3CŒq1W3/STX/c141q1W3 /NULqT 1W3q4/NAK D/STX /EOT.q/q/ETX (2.86) with/TAB.q/and/EOT.q/being the4/STX3matrices /TAB.q//DC1/DC4q4I3/NULŒq1W3/STX/c141 /NULqT 1W3/NAK D2 664q4q3/NULq2 /NULq3q4q1 q2/NULq1q4 /NULq1/NULq2/NULq33 775(2.87) /EOT.q//DC1/DC4q4I3CŒq1W3/STX/c141 /NULqT 1W3/NAK D2 664q4/NULq3q2 q3q4/NULq1 /NULq2q1q4 /NULq1/NULq2/NULq33 775(2.88) It is easy to show that /TABT.q//TAB.q/D/EOTT.q//EOT.q/Dkqk2I3 (2.89a) /TAB.q//TABT.q/D/EOT.q//EOTT.q/Dkqk2I4/NULqqT(2.89b) /TABT.q/qD/EOTT.q/qD03 (2.89c) from which it follows that kqk/NUL1Œq˝/c141andkqk/NUL1Œqˇ/c141are orthogonal matrices.2.7 Quaternions 39 We deﬁne the identity quaternion Iq/DC1/DC403 1/NAK (2.90) which obeys Iq˝qDq˝IqDIqˇqDqˇIqDq, as required of the identity. We also deﬁne the conjugate q/ETXof a quaternion, obtained by changing the sign of the three-vector part: q/ETXD/DC4q1W3 q4/NAK/ETX /DC1/DC4/NULq1W3 q4/NAK (2.91) The product of a quaternion with its conjugate is equal to the square of its norm times the identity quaternion q˝q/ETXDq/ETX˝qDqˇq/ETXDq/ETXˇqDkqk2Iq (2.92) The conjugate of the product of two quaternions Nqandqis the product of the conjugates in the opposite order .p˝q//ETXDq/ETX˝p/ETX. This relation, Eq. ( 2.92), and the associativity of quaternion multiplication can be used to show that kp˝qkDk pˇqkDk pkkqk (2.93) It is not difﬁcult to see that Œq/ETX˝/c141DŒq˝/c141TandŒq/ETXˇ/c141DŒqˇ/c141T(2.94) The inverse of any quaternion having nonzero norm is deﬁned by q/NUL1/DC1q/ETX=kqk2(2.95) so that q˝q/NUL1Dq/NUL1˝qDqˇq/NUL1Dq/NUL1ˇqDIq, as required by the deﬁnition of an inverse. The inverse of the product of two quaternions is the productof the inverses in the opposite order .p˝q/ /NUL1Dq/NUL1˝p/NUL1. We will overload the quaternion product notation to allow us to multiply a three- component vector xand a quaternion, using the deﬁnitions x˝q/DC1/DC4x 0/NAK ˝qDŒx˝/c141qand q˝x/DC1q˝/DC4x 0/NAK (2.96) with analogous deﬁnitions for xˇq,Œxˇ/c141, and qˇx. Note that the matrices Œx˝/c141D/DC4/NULŒx/STX/c141x /NULxT0/NAK /DC1˝.x/and (2.97a) Œxˇ/c141D/DC4Œx/STX/c141x /NULxT0/NAK /DC1/NUL.x/ (2.97b)40 2 Matrices, Vectors, Frames, Transforms are skew-symmetric. The relation x˝qDqˇxD/STX /EOT.q/q/ETX/DC4x 0/NAK D/EOT.q/x (2.98) is often very useful. 2.8 Rotations and Euler’s Theorem The discipline of spacecraft attitude determination is basically the study of methods for estimating the proper orthogonal matrix that transforms vectors from a reference frame ﬁxed in space to a frame ﬁxed in the spacecraft body. Thus it is the study of proper orthogonal 3/STX3matrices, or matrices in the group SO(3). We will refer to these as rotation matrices or attitude matrices and denote them by the letter A. Euler’s Theorem6states one of the most important properties of attitude matrices, namely that any rotation is a rotation about a ﬁxed axis. Recall that the transforma- tion of a vector representation xFfrom reference frame Fto reference frame Gby the attitude matrix AGFis given by AGFxFDxG (2.99) Euler’s Theorem asserts the existence of a vector ealong the direction of the rotation axis that has the same representation in frame Gas in frameF. This means that we can substitute xFDxGDein Eq. ( 2.99) and state Euler’s theorem algebraically as AeDe (2.100) This is a special case of an eigenvalue/eigenvector relationship. An eigenvector of a general square matrix Mis a nonzero vector xfor which multiplication by Mhas the same effect as multiplication by a scalar, i.e. MxD/NAKx (2.101) where the scalar /NAKis the eigenvalue corresponding to the eigenvector x. The solution forxis only determined up to a scale factor in general, so eigenvectors are almost invariably given as unit vectors. In order for Eq. ( 2.101 ) to have a nonzero solution forx, the matrix./NAKI/NULM/must be singular.7Therefore, from Eq. ( 2.16)w eh a v e det./NAKI/NULM/D/NAKnC˛1/NAKn/NUL1C/SOH/SOH/SOHC˛n/NUL1/NAKC˛nD0 (2.102) 6Leonhard Euler (1707–1783) laid the foundations for the analysis of rotations, and his ﬁngerprints are all over the subject. Thus, attaching his name to anything serves poorly for distinguishing itfrom other results also bearing his name. 7Otherwise, we would have xD./NAKI/NULM//NUL10D0.2.9 Attitude Representations 41 x,Aee xeexFig. 2.6 Euler axis/angle rotation This polynomial equation of degree nis known as the characteristic equation ofM. The eigenvalues are the nroots of the characteristic equation, counting multiple roots by their multiplicity. In the language of eigenvalues and eigenvectors, Euler’s theorem says that one of the eigenvalues of an attitude matrix has the value /NAKD1. The characteristic equation of a 3/STX3matrixMis easily found by explicit computation of the determinant to take the form /NAK3/NUL/NAK2trMC/NAKtr.adjM//NULdetMD0 (2.103) For the special case of a proper orthogonal 3/STX3matrix, we ﬁnd the characteristic equation to be 0D/NAK3/NUL/NAK2trAC/NAKtrA/NUL1D./NAK/NUL1/Œ/NAK2C/NAK.1/NULtrA/C1/c141 (2.104) This clearly has a root /NAKD1, which proves Euler’s theorem with the rotation axis e being the eigenvector corresponding to this eigenvalue. 2.9 Attitude Representations 2.9.1 Euler Axis/Angle Representation We have seen that every proper orthogonal 3/STX3matrix has a rotation axis speciﬁed by a unit vector e. The only other parameter needed to completely specify the matrix is the angle of rotation #about this axis. This axis and angle are known as the Euler axis andEuler angle of the rotation. We will now show how to parameterize the attitude matrix in terms of these parameters. Figure 2.6depicts the rotation of an arbitrary vector xthrough an angle #about an axis e. This ﬁgure is actually more illustrative of an active (alibi) rotation of the42 2 Matrices, Vectors, Frames, Transforms vector, but we want to represent the transformation as a passive (alias) rotation of the reference frame [ 5]. We make the connection between these two interpretations by referring to Fig. 2.2b,c, which show that we can move from one interpretation to the other by simply changing the direction of the rotation. The mapping of the vector xinto the rotated reference frame is denoted as A.e;#/x, as indicated in the ﬁgure. We express xas the sum of vectors parallel and perpendicular to the rotation axis xDxkCx? (2.105) where xk/DC1.x/SOHe/eD/NUL eeT/SOH xand x?/DC1x/NUL.x/SOHe/eD.I3/NULeeT/x (2.106) The rotation leaves xkalone, but rotates x?out of the plane deﬁned by eandx.T h e cross product e/STXxis perpendicular to that plane and has magnitude ke/STXxkDk x?k by Eq. ( 2.57), so the result of the norm-preserving rotation by angle #is A.e;#/xDxkC.cos#/x?/NUL.sin#/e/STXx (2.107) The sign of the last term is chosen to agree with the sense of the rotation shown in Fig.2.2b, which is regarded as a rotation in the positive sense about e3De1/STXe2, the outward normal from the plane of the ﬁgure. Because xis an arbitrary vector, Eq. ( 2.107 ) means, inserting the deﬁnitions of xkandx?, that A.e;#/D.cos#/I3/NULsin#Œe/STX/c141C.1/NULcos#/eeT(2.108) This is the Euler axis/angle parameterization of an attitude matrix. We can also express this, using Eq. ( 2.56b )a s A.e;#/DI3/NULsin#Œe/STX/c141C.1/NULcos#/Œe/STX/c1412(2.109) The attitude matrix is expressed in explicit component form as A.e;#/D2 4cC.1/NULc/e2 1.1/NULc/e1e2Cse3.1/NULc/e1e3/NULse2 .1/NULc/e2e1/NULse3cC.1/NULc/e2 2.1/NULc/e2e3Cse1 .1/NULc/e3e1Cse2.1/NULc/e3e2/NULse1cC.1/NULc/e2 33 5 (2.110) where we have written c/DC1cos#ands/DC1sin#for conciseness. The attitude matrix appears to depend on four parameters, but there are only three independentparameters owing to the constraint kekD1. The nine-component attitude matrix has only three independent parameters because of the orthogonality constraint AA TDI. This matrix constraint is equivalent to six scalar constraints rather than nine because the product AATis symmetric.2.9 Attitude Representations 43 Equations ( 2.108 )–(2.110 ) show that the attitude matrix is a periodic function of the rotation angle over an unlimited range with period 2/EM. Some useful identities satisﬁed by the Euler axis/angle representation are A.e;#/DA./NULe;/NUL#/ (2.111a) A/NUL1.e;#/DAT.e;#/DA./NULe;#/DA.e;/NUL#/ (2.111b) A.e;/EM/DA./NULe;/EM/D2eeT/NULI3 (2.111c) We now turn to the question of ﬁnding the rotation axis and angle corresponding to a given attitude matrix. Noting from Eq. ( 2.108 ) that trA.e;#/D1C2cos# (2.112) we see that the rotation angle is given by #Dcos/NUL1/DC2trA.e;#//NUL1 2/DC3 (2.113) If cos#D1the attitude matrix is A.e;#/DI3, and the rotation axis is clearly undeﬁned. If/NUL1<cos#<1 , the axis of rotation is given by eD1 2sin#2 4A23.e;#//NULA32.e;#/ A31.e;#//NULA13.e;#/ A12.e;#//NULA21.e;#/3 5 (2.114) If cos#D/NUL1the axis of rotation can be found by normalizing any nonzero column of A.e;#/CI3D2eeT(2.115) because all the columns of this matrix are parallel to e. The overall sign of the rotation axis vector is undetermined in this case, but Eq. ( 2.111c ) shows that this sign makes no difference. The other two eigenvalues of the attitude matrix are the other two roots of Eq. (2.104 ). Inserting the value of tr A.e;#/into this equation gives 0D/NAK2/NUL2/NAKcos#C1D/NAK2/NUL/NAK/NUL ei#Ce/NULi#/SOH C1D/NUL /NAK/NULei#/SOH/NUL /NAK/NULe/NULi#/SOH (2.116) These two eigenvalues form a complex conjugate pair on the unit circle in the complex plane, and the corresponding eigenvectors are complex as well. This result can be generalized to proper orthogonal matrices of higher dimensionality. A matrix in SO(2nC1) has one eigenvalue equal to C1andnconjugate pairs on the unit circle in the complex plane. A matrix in SO( 2n) has only the nconjugate pairs44 2 Matrices, Vectors, Frames, Transforms on the unit circle. Thus Euler’s theorem holds in any space of odd dimensionality, but not in a space with an even number of dimensions. If we regard Fig. 2.2ba s a rotation in two-dimensional space rather than a projection onto the plane of arotation in a higher-dimensional space, for example, it is easy to see that there is no invariant vector in the plane. This does not preclude the possibility of a pair of complex conjugate eigenvectors accidentally having the common value C1. Cross-product and trigonometric identities can be used to ﬁnd the unsurprising result of successive rotations about the same axis, A.e;#/A. e;'/DA.e;'/A. e;#/DA.e;#C'/ (2.117) but this is more easily derived using the quaternion representation of rotations. The composition of rotations about non-parallel axes does not have a simple form in the angle/axis representation. Another useful result holds for two attitude matrices A 0 andA.e;#/.F r o mE q .( 2.108 )w eh a v e A0A.e;#/AT 0D.cos#/I3/NUL.sin#/A0Œe/STX/c141AT 0C.1/NULcos#/A0eeTAT 0(2.118) This can be written, using Eqs. ( 2.7c) and ( 2.63), as A0A.e;#/AT 0DA.A0e;#/ (2.119) which shows that A0AAT 0is a rotation by the same angle as A, but about a rotated axis. 2.9.2 Rotation Vector Representation It is convenient for analysis, but not for computations, to combine the Euler axis and angle into the three-component rotation vector #/DC1#e (2.120) To express the attitude matrix in terms of the rotation vector, we insert the Taylor series expansions of the sine and cosine into Eq. ( 2.109 ), giving8 A.e;#/DI3/NULŒe/STX/c1411X iD0./NUL1/i#2iC1 .2iC1/Š/NULŒe/STX/c14121X iD1./NUL1/i#2i .2n/Š(2.121) Equation ( 2.56b ) can be used to show that Œe/STX/c1413D/NULŒe/STX/c141,s ow eh a v e A.e;#/DI3C1X iD0Œ./NUL#e//STX/c1412iC1 .2iC1/ŠC1X iD1Œ./NUL#e//STX/c1412i .2n/ŠD1X nD0Œ./NUL#e//STX/c141n nŠ(2.122) 8Note that these power series expansions assume that we measure angles in radians.2.9 Attitude Representations 45 A function of a square matrix is deﬁned by its Taylor series, so this expression for the attitude matrix in terms of the rotation vector can ﬁnally be written as A.e;#/Dexp./NULŒ#/STX/c141/ (2.123) where exp is the matrix exponential. This is the ﬁrst three-parameter representation of rotations that we have encoun- tered. It is a very useful representation for the analysis of small rotations; but it is not useful for large rotations, mainly because it obscures the periodicity of the attitude matrix as a function of #. In particular, it is not at all obvious in this representation that a rotation by an angle #D2/EMis equivalent to the identity transformation. Equation ( 2.113 ) shows that we can restrict the rotation angle to the range0/DC4#/DC4/EM, which avoids this problem and gives a 1:1 mapping of rotations with#</EM to rotation vectors. The rotation vectors ﬁll a ball of radius /EM, with the two vectors at the ends of a diameter of the ball representing the same attitude according to Eq. ( 2.111c ). This causes the difﬁculty that the rotation vector parameterization of a smoothly-varying attitude can jump discontinuously from one side of the ball to the other. This discontinuity can be avoided by giving up the 1:1 mapping by allowing rotation angles greater than /EM, but this causes other difﬁculties. It is an unavoidable fact that the rotation group has no global three-component parameterization without singular points [ 22]. The expense of computing the matrix exponential also renders the rotation vector parameterizationimpractical for numerical computations. 2.9.3 Quaternion Representation Substituting sin #D2sin.#=2/ cos.#=2/ and cos#Dcos2.#=2//NULsin2.#=2/ into Eq. (2.108 ) and deﬁning the quaternion q.e;#/D/DC4esin.#=2/ cos.#=2//NAK (2.124) gives the quaternion representation of the attitude matrix A.q/D/NUL q2 4/NULkq1W3k2/SOH I3/NUL2q4Œq1W3/STX/c141C2q1W3qT 1W3 D2 4q2 1/NULq2 2/NULq2 3Cq2 42.q1q2Cq3q4/2 . q 1q3/NULq2q4/ 2.q2q1/NULq3q4//NULq2 1Cq2 2/NULq2 3Cq2 42.q2q3Cq1q4/ 2.q3q1Cq2q4/2 . q 3q2/NULq1q4//NULq2 1/NULq2 2Cq2 3Cq2 43 5 (2.125) We are abusing the notation by using both A.q/andA.e;#/to denote the attitude matrix, and we will abuse it further when we deﬁne other representations. The meaning of the argument of A./SOH/will always be clear in context, however.46 2 Matrices, Vectors, Frames, Transforms The four parameters of the quaternion representation were ﬁrst considered by Euler, but their full signiﬁcance was revealed by Rodrigues.9For this reason, they are often referred to as the Euler symmetric parameters or the Euler-Rodrigues parameters. The beauty of the quaternion representation is that it expresses the attitude matrix as a homogenous quadratic function of the elements of the quater- nion, requiring no trigonometric or other transcendental function evaluations.Quaternions are more efﬁcient for specifying rotations than the attitude matrix itself, having only four components instead of nine, and obeying only one constraint, the norm constraint, instead of the six constraints imposed on the attitude matrix byorthogonality. Quaternions used to parameterize rotations are unit quaternions , i.e. quaternions with unit norm, as deﬁned by Eq. ( 2.124 ). A unit quaternion always has an inverse, which is identical with its conjugate. Also, the discussion in Sect. 2.7says that the matricesŒq˝/c141andŒqˇ/c141for a unit quaternion are orthogonal. We will now derive a useful expression for Œq˝/c141in terms of the rotation vector. Because it is a linear function of q,w eh a v e Œq.e;#/˝/c141Dcos.#=2/Œ I q˝/c141Csin.#=2/Œ e˝/c141Dcos.#=2/I4Csin.#=2/Œ e˝/c141 (2.126) Now expand the sine and cosine in Taylor series and use Œe˝/c1412D/NULI4, to get Œq.e;#/˝/c141D1X iD0Œ.#e=2/˝/c1412i .2n/ŠC1X iD0Œ.#e=2/˝/c1412iC1 .2iC1/ŠDexpŒ.#=2/˝/c141(2.127) This result and its derivation are very similar to Eq. ( 2.123 ). We now want to show how a rotation of a three-component vector xcan be implemented by quaternion multiplication. This is accomplished by the quaternion product q˝x˝q/ETXDŒq/ETXˇ/c141.q˝x/DŒqˇ/c141TŒq˝/c141/DC4x 0/NAK D/DC4/EOTT.q//TAB.q/x 0/NAK (2.128) where we have used several relations from Sect. 2.7. Explicit multiplication and comparison with Eq. ( 2.125 )g i v e s /EOTT.q//TAB.q/DA.q/ (2.129) 9Olinde Rodrigues (1795–1851) obtained a doctorate in mathematics in 1815, with a thesis con- taining his well-known formula for the Legendre polynomials. He published nothing mathematicalfor the next 21 years, devoting himself to banking, the development of the French railways, utopiansocialism, writing several pamphlets on banking, and editing an anthology of workers’ poetry. Thenhe published eight papers between 1838 and 1845, including his 1840 paper [ 14] greatly advancing the state of the art in attitude analysis.2.9 Attitude Representations 47 so that q˝x˝q/ETXD/DC4A.q/x 0/NAK (2.130) This can be used to derive the rule for performing successive transformations using quaternions. Applying a transformation by a second quaternion Nqgives Nq˝/NUL q˝x˝q/ETX/SOH ˝Nq/ETXDNq˝ŒA.q/x/c141˝Nq/ETXD/DC4A.Nq/A.q/x 0/NAK (2.131) This transformation can also be written as .Nq˝q/˝x˝.Nq˝q//ETXD/DC4A.Nq˝q/x 0/NAK (2.132) Because this relation must hold for any x, we have proved that A.Nq˝q/DA.Nq/A.q/ (2.133) Thus the quaternion representation of successive transformations is just the product of the quaternions of the constituent transformations, in the same way that the attitude matrix of the combined transformation is the product of the individual attitude matrices. A simple bilinear composition rule of this type holds only forthe attitude matrix and quaternion representations, which is one of the reasons for the popularity of quaternions. With our ˝quaternion product deﬁnition, the order of quaternion multiplication is identical to the order of matrix multiplication. The orderwould have been reversed if we had used the classical ˇdeﬁnition of quaternion multiplication. The quaternion equivalent of Eq. ( 2.117 ) for successive rotations about the same axis follows from straightforward quaternion multiplication: q.e;#/˝q.e;'/Dq.e;'/˝q.e;#/Dq.e;#C'/ (2.134) Unit quaternions reside on the three-dimensional unit sphere S 3embedded in four-dimensional quaternion space. Equation ( 2.124 ) shows that a rotation by 720ı, but not a rotation by 360ı, is equivalent to the identity transformation in quaternion space, because q.e;#C4/EM/Dq.e;#/butq.e;#C2/EM/D/NULq.e;#/. The attitude matrixA.q/is a homogenous quadratic function of the elements of the quaternion, though, so qand/NULqgive the same attitude matrix. This 2:1 mapping of quaternions to rotations is a minor annoyance that cannot be removed without introducing discontinuities like those that plague all three-parameter attitude representations. Because the quaternions qand/NULqare on opposite hemispheres of S3, we could get a 1:1 mapping of quaternions to rotations by restricting the quaternions to one hemisphere, which is usually taken to be the hemisphere with q4/NAK0. This gives rise to the same problem as restricting the rotation vector to #/DC4/EM, namely that a48 2 Matrices, Vectors, Frames, Transforms smoothly varying quaternion can jump discontinuously from one side to the other of the equator bounding the hemisphere. Restricting the representation to positive q4effectively gives a three-parameter representation with q4/DC1p 1/NULkq1W3k2,s o it is not surprising that it leads to the same problems as other three-parameter representations. We ﬁnally turn to the problem of extracting a quaternion from an attitude matrix [10]. We construct four four-component vectors from the components of A: 2 6641C2A11/NULtrA A12CA21 A13CA31 A23/NULA323 775D4q1q;2 664A21CA12 1C2A22/NULtrA A23CA32 A31/NULA133 775D4q2q 2 664A31CA13 A32CA23 1C2A33/NULtrA A12/NULA213 775D4q3q;2 664A23/NULA32 A31/NULA13 A12/NULA21 1CtrA3 775D4q4q (2.135) The quaternion can be found by normalizing any one of these four vectors. Numerical errors are minimized by choosing the vector with the greatest norm, which is the vector with the largest value of jqijon the right side. This can be found by the following procedure. Find the largest of tr AandAiiforiD1;2;3 . If trAis the largest of these, then jq4jis the largest of the jqij, otherwise the largest value ofjqijis the one with the same index as the largest Aii. The overall sign of the normalized vector is not determined, reﬂecting the twofold ambiguity of the quaternion representation. 2.9.4 Rodrigues Parameter Representation The three Rodrigues parameters made their appearance in Rodrigues’ classic 1840 paper [ 14]. They were later represented as the “vector semitangent of version” by J. Willard Gibbs, who invented modern vector notation. For this reason, the vector of Rodrigues parameters is often called the Gibbs vector and denoted by g.T h e ya r e related to the quaternion by gDq1W3 q4(2.136) which has the inverse qD˙1p 1Ckgk2/DC4g 1/NAK (2.137)2.9 Attitude Representations 49 0 q4 g q qq1:3Iqb a q4 q qq1:3ps pIq Fig. 2.7 Relationship of the Rodrigues parameters ( a) and the modiﬁed Rodrigues parameters (b) to the quaternion Using Eq. ( 2.124 ) to express the quaternion in terms of the Euler axis and angle gives g.e;#/Detan.#=2/ (2.138) which explains Gibbs’ peculiar terminology. The mapping from quaternions to Rodrigues parameters is illustrated in Fig. 2.7a. The plane of the ﬁgure is the plane containing the origin, q, and the identity quaternion Iq. The circle is the cross-section of the quaternion sphere S3, so it has unit radius. The vertical axis is the q4axis, and the horizontal axis represents the three-dimensional q1W3hyperplane. The horizontal line passing through Iqrepresents the three-dimensional Gibbs vector hyperplane, which is tangent to S3at the point qDIq. The Gibbs vector gis the projection of the quaternion from the origin onto the Gibbs vector hyperplane. It is clear from the ﬁgure or from Eq. ( 2.136 ) that q and/NULqmap to the same Gibbs vector, so the Rodrigues parameters provide a 1:1 mapping of rotations. The price paid for this is that the Gibbs vector is inﬁnite fora180 ırotation. Thus this parameterization is not recommended as a global attitude representation, but it provides an excellent representation of small rotations. Substituting Eq. ( 2.137 ) into Eq. ( 2.125 ) gives the Rodrigues parameter represen- tation of the attitude matrix A.g/D.1/NULkgk2/I3/NUL2Œg/STX/c141C2ggT 1Ckgk2DI3C2Œg/STX/c1412/NULŒg/STX/c141 1Ckgk2 D1 1Ckgk22 41Cg2 1/NULg2 2/NULg2 32.g1g2Cg3/2 . g 1g3/NULg2/ 2.g2g1/NULg3/1/NULg2 1Cg2 2/NULg2 32.g2g3Cg1/ 2.g3g1Cg2/2 . g 3g2/NULg1/1/NULg2 1/NULg2 2Cg2 33 5 (2.139)50 2 Matrices, Vectors, Frames, Transforms This is similar to the quaternion representation in requiring no transcendental function evaluations. However, it is a rational function of the Rodrigues parameters rather than a simple polynomial function. The relationship between the Rodrigues parameters and the attitude matrix can also be expressed as a Cayley transform . The equations A.g/D.I3/NULŒg/STX/c141/.I3CŒg/STX/c141//NUL1D.I3CŒg/STX/c141//NUL1.I3/NULŒg/STX/c141/ (2.140) can be veriﬁed by multiplying Eq. ( 2.139 )b yI3CŒg/STX/c141. Because the matrices .I3/NULŒg/STX/c141/and.I3CŒg/STX/c141//NUL1commute, the order of multiplication is irrelevant and the Cayley transform can be written as A.g/DI3/NULŒg/STX/c141 I3CŒg/STX/c141(2.141) This is not a useful form for computation, owing to the required matrix inversion; but it can be generalized to higher dimensions. Any n/STXnproper orthogonal matrix Mcan be expressed in terms of an n/STXnskew-symmetric matrix Sby DDIn/NULS InCS(2.142) A skew-symmetric n/STXnmatrix hasn.n/NUL1/=2 free parameters, the correct number to parameterize an orthogonal n/STXnmatrix that must obey n.nC1/=2 constraints on itsn2elements. The rule for computing the Gibbs vector representing a composite of two rotations is easily derived from Eqs. ( 2.82), (2.136 ), and ( 2.137 ). The Gibbs vector corresponding to the quaternion product NNqDNq˝qis NNgDNgCg/NULNg/STXg 1/NULNg/SOHg(2.143) This is not a bilinear function of the constituent Gibbs vectors, so it cannot be represented as a matrix product like quaternion composition. Extracting the Rodrigues parameters from the attitude matrix is similar to extracting the quaternion using one of the four-component vectors of Eq. ( 2.135 ). Instead of normalizing one of those vectors, though, the Rodrigues parameters are found by dividing the ﬁrst three components of the vector by the fourth component. 2.9.5 Modiﬁed Rodrigues Parameters The modiﬁed Rodrigues parameters (MRPs) are the newest of the commonly-employed attitude representations. They were invented by T. F. Wiener in 1962 [26], rediscovered by Marandi and Modi in 1987 [ 9], and have been championed by Junkins and Schaub [ 16]. They are related to the quaternion by pDq 1W3 1Cq4(2.144)2.9 Attitude Representations 51 which has the inverse qD1 1Ckpk2/DC42p 1/NULkpk2/NAK (2.145) Using Eq. ( 2.124 ) to express the quaternion in terms of the Euler axis and angle gives p.e;#/Detan.#=4/ (2.146) It it easy to see that p.e;#C2/EM/D/NULecot.#=4/D/NULp.e;#/ kp.e;#/k2(2.147) but that p.e;#C4/EM/Dp.e;#/. Thus the MRP representation is 2:1 just like the quaternion representation. Theshadow set of MRPs pS/DC1/NULp kpk2(2.148) represents the same attitude as p, in the same way that qand/NULqrepresent the same attitude. These two MRP vectors are illustrated in Fig. 2.7b, which shows them as stereographic projections from the point qD/NULIqonto the MRP hyperplane, which is coincident with the q1W3hyperplane. It is clear from the ﬁgure or from Eq. ( 2.148 ) thatkpSk/NAK1ifkpk/DC41. Thus, in following the variation of an attitude represented by MRPs, one can always keep the magnitude of the MRP vector from exceeding unity by switching to the shadow MRP when needed. The logic required for thisis regarded by many practitioners to be less burdensome than carrying the fourth component of a quaternion and enforcing the quaternion norm constraint, leading them to prefer MRPs for numerical simulation of attitude motion. It is good practiceto allow the MRP norm to exceed unity by some amount to avoid “chattering” between the MRP and its shadow in case the norm remains close to unity for an extended period. The MRP representation of the attitude matrix can be found by substituting Eq. (2.145 ) into Eq. ( 2.125 ). It is easier to note that A.e;#/DA 2.e;#=2/ from Eq. (2.117 ), so the MRP representation can be obtained by squaring the Gibbs vector representation for a half-angle rotation: A.p/D/DC2I3/NULŒp/STX/c141 I3CŒp/STX/c141/DC32 D/DC2 I3C2Œp/STX/c1412/NULŒp/STX/c141 1Ckpk2/DC32 DI3C8Œp/STX/c1412/NUL4/NUL 1/NULkpk2/SOH Œp/STX/c141 .1Ckpk2/2(2.149)52 2 Matrices, Vectors, Frames, Transforms The rule for computing the MRPs representing a composite of two rotations can be derived using Eqs. ( 2.82), (2.144 ). and ( 2.145 ). The MRP vector corresponding to the quaternion product NNqDNq˝qis NNpD/NUL 1/NULkpk2/SOHNpC/NUL 1/NULkNpk2/SOH p/NUL2Np/STXp 1Ckpk2kNpk2/NUL2Np/SOHp(2.150) This involves more computation than the composition of Gibbs vectors, but not an unreasonable burden. The most convenient way to extract the MRPs from the attitude matrix is to ﬁrst extract the quaternion and then compute the MRPs by Eq. ( 2.144 ). Junkins and Schaub have developed a family of attitude representations inter- mediate between the Rodrigues parameters and the MRPs by choosing a projectionpoint in quaternion space intermediate between the point qD0in Fig. 2.7a and the point qD/NUL I qin Fig. 2.7b[15]. Tsiotras, Junkins, and Schaub have investigated higher-order Cayley transforms A.v/D/DC2I3/NULŒv/STX/c141 I3CŒv/STX/c141/DC3n (2.151) forn>2 [23]. Neither of these generalizations has found wide application, however. 2.9.6 Euler Angles AnEuler angle representation expresses a rotation from an initial frame Ito a ﬁnal frameFas the product of three rotations: a rotation ﬁrst from Ito an intermediate frameH, then to a second intermediate frame G, and ﬁnally to frame F. The frame indices are generally omitted to simplify the notation, but including them clariﬁes the form of the overall transformation AFI.e/RS;e/DC2;e I/RS;/DC2; //DC1AFG.e ; /AGH.e/DC2;/DC2/AHI.e/RS;/RS/ (2.152) The rotation axis vectors of the constituent rotations are constant column vectors, and their subscripts do not label frames explicitly. The column vector e is a representation of a rotation axis in frames FandG,e/DC2is a representation in framesGandH, and e/RSis a representation in frames HandI. The rotation angles/RS,/DC2, and are the variables used to specify the rotation. The possibility of employing Euler axis sequences with a wide choice of rotation axes was discovered by Davenport [ 2,18], generalizing the classical applications of Euler angles that use a more restricted set of rotation axes. We will establish general results for Euler axis sequences using Davenport’s general formulation, and then the classical axis sequences will follow as special cases.2.9 Attitude Representations 53 We want to be able to represent any attitude matrix by this Euler angle sequence. In particular, we must be able to represent the attitude matrix that transforms e/RSinto e , which is to say e DA.e/RS;e/DC2;e I/RS;/DC2; / e/RSDA.e ; /A. e/DC2;/DC2/A. e/RS;/RS/e/RS (2.153) Multiplying on the left by AT.e ; / and noting that AT.e ; /e De and A.e/RS;/RS/e/RSDe/RS, we see that there must be an angle /DC20for which e DA.e/DC2;/DC20/e/RS (2.154) A little thought (or algebra) shows that this requires e /SOHe/DC2De/RS/SOHe/DC2.W em u s ta l s o be able to represent the attitude matrix that transforms e/RSinto/NULe , which means that there must be an angle /DC21for which/NULe DA.e/DC2;/DC21/e/RS. It follows from this that/NULe /SOHe/DC2De/RS/SOHe/DC2. These conditions can be satisﬁed simultaneously only if the rotation axis e/DC2is perpendicular to both e/RSande , so that e /SOHe/DC2De/RS/SOHe/DC2D0 (2.155) This relation leads to a more complete description of the orientation of the physical rotation axis vectors. Axis e/RSis ﬁxed in the initial reference frame, e is ﬁxed in the ﬁnal reference frame, and e/DC2is perpendicular to both e/RSande . We have shown that Eq. ( 2.155 ) is a necessary condition for Eq. ( 2.152 )t o represent a general attitude. We will now show that it is a sufﬁcient condition. Notethat the angle /DC2 0is not a variable, but is deﬁned by the choice of rotation axes. Then using Eqs. ( 2.111b ), (2.117 ) and ( 2.119 )g i v e s A.e/RS;e/DC2;e I/RS;/DC2; /DA/NUL A.e/DC2;/DC20/e/RS; /SOH A.e/DC2;/DC2/A. e/RS;/RS/ DA.e/DC2;/DC20/A.e/RS; /A. e/DC2;/DC20/A.e/RS;/RS/ DA.e/DC2;/DC20/A.e/RS;e/DC2;e/RSI/RS;/DC20; / (2.156) where/DC20/DC1/DC2/NUL/DC20.A sA.e/RS;e/DC2;e I/RS;/DC2; / covers all of SO(3), the product AT.e/DC2;/DC20/A.e/RS;e/DC2;e I/RS;/DC2; / also covers SO(3), so we only need to show that A.e/RS;e/DC2;e/RSI/RS;/DC20; / can represent any attitude, or equivalently to show that this rotation can transform the orthonormal basis e/RS,e/DC2,e/RS/STXe/DC2into any other orthonormal basis. It is sufﬁcient to show that e0 /RS/DC1A.e/RS;e/DC2;e/RSI/RS;/DC20; /e/RS can be any unit vector and e0 /DC2/DC1A.e/RS;e/DC2;e/RSI/RS;/DC20; /e/DC2can be any unit vector perpendicular to e0 /RS, because Eq. ( 2.65) then implies that e/RS/STXe/DC2will transform into e0 /RS/STXe0 /DC2, completing the orthonormal triad. Now e0 /RSDA.e/RS; /A. e/DC2;/DC20/A.e/RS;/RS/e/RSDA.e/RS; /A. e/DC2;/DC20/e/RS Dcos/DC20e/RSCsin/DC20sin e/DC2Csin/DC20cos .e/RS/STXe/DC2/ (2.157)54 2 Matrices, Vectors, Frames, Transforms and we can ﬁnd values of /DC20and to make this equal any desired unit vector. Furthermore, because A.e/RS;/RS/e/DC2Dcos/RSe/DC2/NULsin/RS.e/RS/STXe/DC2/,w eh a v e e0 /DC2Dcos/RSA. e/RS; /A. e/DC2;/DC20/e/DC2/NULsin/RSA. e/RS; /A. e/DC2;/DC20/.e/RS/STXe/DC2/ (2.158) Rotations preserve orthogonality, so this superposition can represent any unit vector in the plane perpendicular to e0 /RS, completing the proof that any Euler angle sequence obeying Eq. ( 2.155 ) is sufﬁcient to represent any attitude matrix. An Euler angle parameterization has a twofold ambiguity in addition to the usual 2/EMambiguity in specifying any angle. To see this ambiguity, insert the product A.e/RS;/NUL/EM/A. e/RS;/EM/before and after A.e/DC2;/DC20/in the second line of Eq. ( 2.156 ) and use some axis/angle representation identities to get A.e/RS;e/DC2;e I/RS;/DC2; /DA.e/DC2;/DC20/A.e/RS; /NUL/EM/A/NUL A.e/RS;/EM/e/DC2;/DC2/NUL/DC20/SOH A.e/RS;/RSC/EM/ DA.e/DC2;/DC20/A.e/RS; /NUL/EM/A./NULe/DC2;/DC2/NUL/DC20/A.e/RS;/RSC/EM/ DA.e/DC2;/DC20/A.e/RS; /NUL/EM/A. e/DC2;/NUL/DC20/A.e/DC2;2/DC20/NUL/DC2/A. e/RS;/RSC/EM/ DA.e/RS;e/DC2;e I/RSC/EM;2/DC20/NUL/DC2; /NUL/EM/ (2.159) The rotation axes of the classical Euler angle representation are selected from the set e1D2 41 003 5;e 2D2 40 103 5;e 3D2 40 013 5 (2.160) and a more compact notation is used for these representations A ijk./RS;/DC2; /DA.ek; /A. ej;/DC2/A. ei;/RS/ (2.161) The possible choice of axes is constrained by the requirements i¤jandj¤k,a s required by Eq. ( 2.155 ). This leaves us with six symmetric sets of Euler parameters, withi/NULj/NULkequal to: 1/NUL2/NUL1,1/NUL3/NUL1,2/NUL3/NUL2,2/NUL1/NUL2,3/NUL1/NUL3, and3/NUL2/NUL3 and six asymmetric sets: 1/NUL2/NUL3,1/NUL3/NUL2,2/NUL3/NUL1,2/NUL1/NUL3,3/NUL1/NUL2, and3/NUL2/NUL1 The explicit forms of the attitude matrices for all 12 sets are collected in Chap. 9. As a speciﬁc example of the symmetric sequences, we consider the 3/NUL1/NUL3 sequence, which is often used for analytical treatments of rigid body motion and for representing the attitude of spinning spacecraft: A313./RS;/DC2; /DA.e3; /A. e1;/DC2/A. e3;/RS/2.9 Attitude Representations 55 D2 4c s 0 /NULs c 0 00 13 52 4100 0c/DC2s/DC2 0/NULs/DC2c/DC23 52 4c/RS s/RS0 /NULs/RSc/RS0 00 13 5 D2 4c c/RS/NULs c/DC2s/RS c s/RSCs c/DC2c/RS s s/DC2 /NULs c/RS/NULc c/DC2s/RS/NULs s/RSCc c/DC2c/RSc s/DC2 s/DC2s/RS/NULs/DC2c/RS c/DC23 5(2.162) We have written c /DC1cos ,s /DC1sin , and analogous equations for /DC2and/RS. The symmetric Euler angle sets all have /DC20D0, so the angle ambiguity relation is A313./RS;/DC2; /DA313./RSC/EM;/NUL/DC2; /NUL/EM/ (2.163) The asymmetric sets are often called the Tait-Bryan angles, although this terminology has been called into question [ 4]. The three angles in an asymmetric Euler angle sequence are often referred to as roll,pitch , and yaw. This terminology originally described the motions of ships and then was carried over into aircraft and spacecraft. Roll is a rotation about the vehicle body axis that is closest to thevehicle’s usual direction of motion, and hence would be perceived as a screwing motion. The roll axis is conventionally assigned index 1. Yaw is a rotation about the vehicle body axis that is usually closest to the direction of local gravity, and hencewould be often be perceived as a motion that points the vehicle left or right. The yaw axis is conventionally assigned index 3. Pitch is a rotation about the remaining vehicle body axis, and hence would often be perceived as a motion that points thevehicle up or down. The pitch axis is conventionally assigned index 2. Note that this associates the terms roll, pitch, and yaw with the vehicle axes, while Eq. ( 2.161 ) assigns the variables /RS,/DC2, and based on the order of rotations in the sequence rather than on the axis indices. Thus there is no deﬁnite association between thevariables/RS,/DC2, and and the axis labels 1, 2, and 3 or the names roll, pitch and yaw. A different convention is followed by many authors who denote roll by /RS, pitch by/DC2, and yaw by . As always, the reader consulting any source should be careful to understand the conventions that it follows. The3/NUL2/NUL1sequence, which is often used to describe the attitude of an Earth- pointing spacecraft, is a speciﬁc example of an asymmetric sequence. A 321./RS;/DC2; /DA.e1; /A. e2;/DC2/A. e3;/RS/ D2 410 0 0c s 0/NULs c 3 52 4c/DC20/NULs/DC2 010 s/DC20 c/DC23 52 4c/RS s/RS0 /NULs/RSc/RS0 00 13 5 D2 4c/DC2c/RS c/DC2s/RS/NULs/DC2 /NULc s/RSCs s/DC2c/RS c c/RSCs s/DC2s/RS s c/DC2 s s/RSCc s/DC2c/RS/NULs c/RSCc s/DC2s/RSc c/DC23 5(2.164)56 2 Matrices, Vectors, Frames, Transforms Equation ( 2.154 ) shows that the angle /DC20for this sequence is equal to /NUL/EM=2,s ot h e angle ambiguity relation is A321./RS;/DC2; /DA321./RSC/EM;/EM/NUL/DC2; /NUL/EM/ (2.165) In fact, all the Tait-Bryan angle axis sets have /DC20D˙/EM=2 so they all obey Eq. (2.165 ), taking into account the 2/EMambiguity in the deﬁnition of /DC2.T h e Tait-Bryan representations have useful small-angle approximations, as will be shown in Sect. 2.10, but the small angle limits of the symmetric Euler angles are not as useful. Separate procedures for the different axis sequences are generally used to ﬁnd the Euler angles representing a given attitude matrix. We will consider the 3/NUL1/NUL3 and3/NUL2/NUL1sequences as speciﬁc examples, and will follow these examples with a general algorithm. For the symmetric 3/NUL1/NUL3sequence, the angle /DC2is computed from the 33 element ofA313: /DC2Dcos/NUL1.ŒA313/c14133/ (2.166) UnlessŒA313/c14133has magnitude unity, two distinct values of /DC2have the same cosine, corresponding to the two possible signs for sin /DC2and to the twofold ambiguity shown in Eq. ( 2.163 ). We are free to select either of these values, but we can avoid the twofold ambiguity by computing /DC2as the principal value of the inverse cosine, which restricts its range to 0/DC4/DC2/DC4/EMand gives sin /DC2/NAK0.I fs i n/DC2¤0,t h e other two Euler angles can be determined, modulo 2/EM,b y /RSDatan2./ESCŒA313/c14131;/NUL/ESCŒA313/c14132/ (2.167a) Datan2./ESCŒA313/c14113;/ESC Œ A313/c14123/ (2.167b) where/ESCD˙1is the sign of sin /DC2and atan2.y;x/ is the standard function giving the argument of the complex number xCiy. It is obvious that /RSand cannot be determined from Eqs. ( 2.167 )i f/DC2is equal t o0o r/EM, since these values give sin /DC2D0. The usual twofold ambiguity is absent in these cases, but the attitude matrix takes the form A313./RS;./EM/BEL/EM/=2; /D2 4cos./RS˙ / sin./RS˙ /0 /BELsin./RS˙ /˙cos./RS˙ /0 00 ˙13 5 (2.168) It can be seen that only the sum or difference /RS˙ is determined, and not the angles individually. This is known as gimbal lock , for reasons that will become apparent when we discuss the kinematics of rotations. Gimbal lock is caused bycollinearity of the physical rotation axis vectors of the ﬁrst and third rotations in the sequence. Note that the column vector representations of the rotation axes are always parallel for the symmetric Euler angle sequences, but that does not cause2.9 Attitude Representations 57 gimbal lock. Gimbal lock occurs for all the symmetric Euler angle sequences when sin/DC2D0. We could employ a special algorithm for the sin /DC2D0case, but it is preferable to develop a general algorithm for all values of /DC2, because we could encounter a loss of precision for small but nonzero values of sin /DC2. To this end, we note that ŒA313/c14111˙ŒA313/c14122D.1˙c/DC2/cos./RS˙ / (2.169a) ŒA313/c14112/BELŒA313/c14121D.1˙c/DC2/sin./RS˙ / (2.169b) and that.1˙c/DC2/is positive if cos /DC2¤/BEL1. Therefore, we ﬁnd either /RSor , but not both, from Eq. ( 2.167 ). If sin/DC2D0we can set one of these angles to any convenient value. Then we ﬁnd the other angle from their sum or difference by /RSC Datan2.ŒA313/c14112/NULŒA313/c14121;ŒA313/c14111CŒA313/c14122/ifŒA313/c14133/NAK0 (2.170a) /RS/NUL Datan2.ŒA313/c14112CŒA313/c14121;ŒA313/c14111/NULŒA313/c14122/ifŒA313/c14133<0 (2.170b) Extraction of the asymmetric Euler angles proceeds in a similar manner. For the 3/NUL2/NUL1sequence, the angle /DC2is computed from the 13 element of A321: /DC2Dsin/NUL1./NULŒA321/c14113/ (2.171) UnlessŒA321/c14113has magnitude unity, two distinct values of /DC2have the same sine, corresponding to the two possible signs for cos /DC2and to the twofold ambiguity shown in Eq. ( 2.165 ). We are free to select either value, but can avoid the ambiguity by computing /DC2as the principal value of the inverse sine, restricting its range to j/DC2j/DC4/EM=2 and giving cos /DC2/NAK0. If cos/DC2¤0, the other two angles can be determined by /RSDatan2/NUL /ESC0ŒA321/c14112;/ESC0ŒA321/c14111/SOH (2.172a) Datan2/NUL /ESC0ŒA321/c14123;/ESC0ŒA321/c14133/SOH (2.172b) where/ESC0D˙1is the sign of cos /DC2. Gimbal lock for the asymmetric Euler, or Tait-Bryan, sequences occurs when cos/DC2D0, i.e. when/DC2D/BEL/EM=2. Then the usual twofold ambiguity is absent, and the attitude matrix for the 3/NUL2/NUL1example has the form A321./RS;/BEL/EM=2; /D2 400 ˙1 /NULsin./RS˙ / cos./RS˙ /0 /BELcos./RS˙ //BELsin./RS˙ /03 5 (2.173)58 2 Matrices, Vectors, Frames, Transforms Only the sum or difference /RS˙ is determined, just as for the symmetric Euler axis sequence, again due to collinearity of the physical rotation axis vectors of the ﬁrst and third rotations. The column vector representations of the rotation axesare always perpendicular for the asymmetric sequences, but that does not prevent gimbal lock from occurring. In parallel with the 3/NUL1/NUL3case, we deal with gimbal lock by ﬁnding either /RSor from Eq. ( 2.172 ) and then the other from their sum or difference by /RSC Datan2./NULŒA 321/c14132/NULŒA321/c14121;ŒA321/c14122/NULŒA321/c14131/ifŒA321/c14113/NAK0 (2.174a) /RS/NUL Datan2.ŒA321/c14132/NULŒA321/c14121;ŒA321/c14122CŒA321/c14131/ifŒA321/c14113<0 (2.174b) We ﬁnally discuss the extraction of the angles for Davenport’s general axis sequences. We will accomplish this in a way that uses the results obtained above for extracting the 3/NUL1/NUL3Euler angles. This technique can be applied to any sequence of conventional Euler or Tait-Bryan angles, as well as to the general Davenport angles, by selecting the rotation axes from the set of coordinate axes fe1;e2;e3g[19]. We note that the proper orthogonal matrix CD2 4eT /DC2 .e/RS/STXe/DC2/T eT /RS3 5 (2.175) has the property that Ce/DC2De1andCe/RSDe3. Then we have from Eq. ( 2.156 ) CA.e/RS;e/DC2;e I/RS;/DC2; /CTDCA.e/DC2;/DC20/CTCA.e/RS;e/DC2;e/RSI/RS;/DC20; /CT DA.e1;/DC20/CA. e/RS; /CTC.e/DC2;/DC20/CTCA.e/RS;/RS/CT DA.e1;/DC20/A313./RS;/DC20; / (2.176) Thus we can extract /RS,/DC20, and fromAT.e1;/DC20/CA. e/RS;e/DC2;e I/RS;/DC2; /CTby the standard technique for the 3/NUL1/NUL3sequence, and then compute /DC2D/DC20C/DC20. An easily-veriﬁed special case of Eq. ( 2.176 )i s 2 4010 001 1003 5A321./RS;/DC2; /2 40/NUL10 10 0 00 13 5DA313./RS;/DC2C/EM=2; / (2.177) Explicit expressions for the Euler angles resulting from successive transforma- tions have been found in some special cases [ 17], but they have not been widely applied in practice.2.10 Attitude Error Representations 59 2.10 Attitude Error Representations The attitude matrix represents the rotation ABRfrom some reference frame Rto the spacecraft body frame B. Attitude estimation errors can be represented either as a small rotation AORRbetweenRand an estimated reference frame OR ABRDABORAORR(2.178) or more commonly as a small rotation ABOBbetweenBand an estimated body frameOB ABRDABOBAOBR(2.179) The estimated attitude is represented by ABORin the former case and by AOBRin the latter. In either case the matrix representing the errors, AORRorABOB, is expected to be close to the identity matrix. The most natural representation of attitude errors is in terms of the rotation vector, Eq. ( 2.123 ), and its small-angle approximation A.ı#/Dexp./NULŒı#/STX/c141//EMI3/NULŒı#/STX/c141C1 2Œı#/STX/c1412(2.180) Other attitude parameterizations can be used to represent attitude errors, such as the quaternion, Eq. ( 2.125 ), A.ıq//EMI3/NUL2Œıq1W3/STX/c141C2Œıq1W3/STX/c1412(2.181) the Gibbs vector, Eq. ( 2.139 ), A.ıg//EMI3/NUL2Œıg/STX/c141C2Œıg/STX/c1412(2.182) or the MRPs, Eq. ( 2.149 ), A.ıp//EMI3/NUL4Œıp/STX/c141C8Œıp/STX/c1412(2.183) It is notable that these representations are all equivalent through second order in the errors with the identiﬁcation ı#D2ıq1W3D2ıgD4ıp (2.184) In fact, only the ﬁrst-order approximation is required for most applications. It must be emphasized that Eqs. ( 2.180 )–(2.184 ) are only true in the (very useful) approximation of small error angles. Attitude error representations are often used for errors that are not especially small. In that case, the quaternion, Gibbs vector,or MRP representation is often preferred to the rotation vector for computational convenience. The small-angle approximation of the Tait-Bryan or asymmetric Euler angle representation, Eq. ( 2.161 ), is to second order60 2 Matrices, Vectors, Frames, Transforms Aijk.ı/RS;ı/DC2;ı //EM/DC2 I3/NULı Œek/STX/c141C1 2ı 2Œek/STX/c1412/DC3 /STX/DC2 I3/NULı/DC2Œej/STX/c141C1 2ı/DC22Œej/STX/c1412/DC3/DC2 I3/NULı/RSŒei/STX/c141C1 2ı/RS2Œei/STX/c1412/DC3 /EMI3/NULŒı#1/STX/c141C1 2Œı#1/STX/c1412/BEL1 2Œ.ı/DC2ı ei/NULı ı/RS ejCı/RSı/DC2 ek//STX/c141 (2.185) where ı#1/DC1ı/RSeiCı/DC2ejCı ek (2.186) The upper sign in the last term in Eq. ( 2.185 ), which was derived with the use of Eq. (2.56c ), holds iffi;j;kgis an even permutation of f1;2;3g, and the lower sign applies if it is an odd permutation. With the identiﬁcation ı#Dı#1Eq. (2.185 ) agrees with Eq. ( 2.180 ) to ﬁrst order, but not to second order. Agreement to second order would require ı#D/DC2 ı/RS˙ı/DC2ı 2/DC3 eiC/DC2 ı/DC2/BELı ı/RS 2/DC3 ejC/DC2 ı ˙ı/RSı/DC2 2/DC3 ek(2.187) This identiﬁcation has never been used to our knowledge, however, because ﬁrst- order approximations in the errors are generally adequate. Problems 2.1. Prove that any real n/STXnmatrixAcan be decomposed into the sum of a symmetric and skew symmetric matrix. Hint: the matrix A/NULATis clearly skew symmetric. 2.2. It is known that a general n/STXnsymmetric matrix Amust possess nmutually orthogonal eigenvectors, even if some of the eigenvalues are repeated. Here, you willprove that this is true when the eigenvalues are not repeated. Let Ax iD/NAKixifor iD1;2, where/NAKiis theith eigenvalue and xiis theith eigenvector. Assume that /NAK1¤/NAK2. Start by taking the transpose of Ax1D/NAK1x1and right multiplying both sides by x2, and prove that when ADATthe vectors x1andx2must be orthogonal. 2.3. Suppose that the characteristic equation of an n/STXnmatrixAis given by /SOH./NAK/Ddet./NAKIn/NULA/D/NAKnCa1/NAKn/NUL1C/SOH/SOH/SOHCan/NUL1/NAKCan The Cayley-Hamilton theorem states that the matrix Aobeys its characteristic equation so thatProblems 61 AnCa1An/NUL1C/SOH/SOH/SOHCACanInD0 Multiplying by Agives AnC1Ca1AnC/SOH/SOH/SOHCA2CanAD0 This implies that AnC1can be written as a linear combination of A;A2;:::;An, which in turn can be written as a linear combination of In;A;:::;An/NUL1. In fact, anyAmwithm>n/NUL1can be written using the same linear combination. Use this fact to compute a closed-form expression for the following: 2 4104 0010/NUL103 5100 Note thatf.A/ is the same linear combination of powers of Aasf.J/ is of powers ofJ, whereJis a diagonal matrix of the eigenvalues of A. 2.4. Consider the following 2/STX2matrix for real a,bandd: AD/DC4ab bd/NAK Determine the eigenvalues /NAK1and/NAK2ofAin terms ofa,bandd. SinceAis symmetric then the eigenvalue/eigenvector decomposition gives VTAVD/DC4/NAK10 0/NAK2/NAK whereVis an orthogonal matrix. Suppose that Vis given by the form VD/DC4cs /NULsc/NAK wheres/DC1sin/DC2andc/DC1cos/DC2for some angle /DC2.F i n dcandsin terms ofa,b andd. 2.5. A matrix that is used to reﬂect an object over a line or plane is called a reﬂection matrix. Consider the following natural basis, given by Eq. ( 2.35), for nD2: e1D/DC41 0/NAK ;e2D/DC40 1/NAK62 2 Matrices, Vectors, Frames, Transforms Chief Inertial OrbitDeputy Inertial OrbitChiefDeputyRelative Orbit rohoo Fig. 2.8 Hill frame Let/RSbe the counterclockwise angle between some line `through the origin and the x-axis. Consider the following matrix that rotates the x-axis onto`: AD/DC4cos/RS/NULsin/RS sin/RScos/RS/NAK Noting thatAe1lies on`andAe1is perpendicular to `, determine the reﬂection matrix that sends any vector not on `to its mirror image about `. Provide simulation plots for various angles /RSand any chosen 2/STX1vector to reﬂect. 2.6. Write a computer program that takes some latitude, longitude and height, and converts these quantities to ECEF position using Eq. ( 2.74). Also, write a computer program that takes ECEF position and converts it to latitude, longitude and height using Eq. ( 2.77). Pick some latitude, longitude and height. Then compute the ECEF position and convert this position to latitude, longitude and height to ensure that the original quantities are obtained. 2.7. A useful frame for formation ﬂying applications is the “Hill frame” shown in Fig. 2.8[6]. The frame is given by for;o/DC2;ohg, where orpoints in the chief spacecraft’s radial direction, ohis along the chief orbit momentum vector and o/DC2 completes the right-handed coordinate system, so that orDrI krIk;o/DC2Doh/STXor;ohDhI khIkProblems 63 where hIDrI/STXvI. Using the dot product approach similar to Eq. ( 2.43), fully derive the attitude matrix that rotates vectors from the Hill frame to an inertial frame. Also, determine the relationship between the Hill frame and the LVLH frame. 2.8. This is an alternative proof of Euler’s Theorem that avoids eigenvalues [ 12]. a) First assume that the attitude matrix is not symmetric, i.e. that A¤AT. Deﬁne the skew symmetric matrix S/DC11 2.A/NULAT/DŒs/STX/c141. Prove thatASATDS. Next show that d/DC1s=kskis equivalent to the Euler axis e, to within a sign ambiguity, b) Now assume that ADAT. Why does the above argument fail in this case? If A is symmetric the orthogonality relation is A2DI3. Show that this gives A.AC I3/DACI3, so all the columns of ACI3are unchanged by A. Complete the proof by showing that at least one of these columns is not a column of zeros, and is therefore equivalent to the Euler axis e, to within a sign ambiguity. What Euler angles of rotation, #, correspond to the case of ADAT? 2.9. The generalized Rodrigues parameters [ 15] (GRPs) can be written as /SUBDfq1W3 aCq4 whereais a parameter from 0 to 1 and fis a scale factor. a) Draw a plot of the rotation angle #versesathat causes the GPRs to become singular. b) Determine the inverse transformation for q1W3andq4in terms of/SUB,aandf.N o t e that your answer for q4may seem to provide two solutions, but only one of them is correct. c) Determine fin terms ofaso that the small angle approximation gives k/SUBk/EM#. 2.10. Show that the square of the quaternion elements can be extracted from the attitude matrix by using the following equations: q2 1D1 4.1Ca11/NULa22/NULa33/ q2 2D1 4.1Ca22/NULa11/NULa33/ q2 3D1 4.1Ca33/NULa11/NULa22/ q2 4D1 4.1Ca11Ca22Ca33/ 2.11. Derive the attitude matrix for a 1/NUL2/NUL3sequence. Also, explicitly compute the determinant of this matrix to show that it is C1.64 2 Matrices, Vectors, Frames, Transforms 2.12. Derive the direct relationship from Euler angles to quaternion for a 1/NUL2/NUL3 sequence and for a 1/NUL2/NUL1sequence. Compare your results to the ones shown in Table 9.5to make sure they are equivalent. References Bate, R.R., Mueller, D.D., White, J.E.: Fundamentals of Astrodynamics. Dover Publications, New York (1971) Davenport, P.B.: Rotations about nonorthogonal axes. AIAA J. 11(6), 853–857 (1973) Farrell, J., Barth, M.: The Global Positioning System & Inertial Navigation. McGraw-Hill, New York (1998) Fraiture, L.: A history of the description of the three-dimensional ﬁnite rotation. J. Astronaut. Sci.57(1/2), 207–232 (2009) Goldstein, H.: Classical Mechanics, 2nd edn. Addison-Wesley, Reading (1980)6. Hill, G.W.: Researches in lunar theory. Am. J. Math. 1(1), 5–26 (1878) Lefferts, E.J., Markley, F.L., Shuster, M.D.: Kalman ﬁltering for spacecraft attitude estimation. J. Guid. Contr. Dynam. 5(5), 417–429 (1982) Ma, C., Arias, E.F., Eubanks, T.M., Frey, A.L., Gontier, A.M., Jacobs, C.S., Sovers, O.J., Archinal, B.A., Charlot, P.: The International Celestial Reference Frame as realized by verylong baseline interferometry. Astron. J. 116, 516–546 (1998) Marandi, S.R., Modi, V .J.: A preferred coordinate system and the associated orientation representation in attitude dynamics. Acta Astronautica 15(11), 833–843 (1987) Markley, F.L.: Unit quaternion from rotation matrix. J. Guid. Contr. Dynam. 31(2), 440–442 (2008) Montenbruck, O., Gill, E.: Satellite Orbits: Models, Methods, and Applications. Springer, Berlin Heidelberg New York (2000) Palais, B., Palais, R.: Euler’s ﬁxed point theorem: The axis of a rotation. J. Fixed point Theory Appl. 2(2), 215–220 (2007) Pittelkau, M.E.: An analysis of the quaternion attitude determination ﬁlter. J. Astronaut. Sci. 51(1) (2003) Rodrigues, O.: Des lois géométriques qui régissent les déplacements d’un système solide dans l’espace, et de la variation des coordonnées provenant de ces déplacements considérésindépendamment des causes qui peuvent les produire. J. de Mathématiques Pures et Appliquées 5, 380–440 (1840) Schaub, H., Junkins, J.L.: Stereographic orientation parameters for attitude dynamics: A gen- eralization of the Rodrigues parameters. J. Astronaut. Sci. 44(1), 1–19 (1996) Schaub, H., Junkins, J.L.: Analytical Mechanics of Aerospace Systems, 2nd edn. American Institute of Aeronautics and Astronautics, New York (2009) Shuster, M.D.: A survey of attitude representations. J. Astronaut. Sci. 41(4), 439–517 (1993) Shuster, M.D., Markley, F.L.: Generalization of the Euler angles. J. Astronaut. Sci. 51(2), 123–132 (2003) Shuster, M.D., Markley, F.L.: General formula for extracting the Euler angles. J. Guid. Contr. Dynam. 29(1), 215–217 (2006) Sofair, I.: Improved method for calculating exact geodetic latitude and altitude revisited. J. Guid. Contr. Dynam. 23(2), 369 (2000) Stewart, G.W.: Introduction to Matrix Computations. Academic Press, New York (1973)22. Stuelpnagel, J.: On the parametrization of the three-dimensional rotation group. SIAM Rev. 6(4), 422–430 (1964) Tsiotras, P., Junkins, J.L., Schaub, H.: Higher-order Cayley transforms with applications to attitude representations. J. Guid. Contr. Dynam. 20(3), 528–534 (1997)References 65 Vallado, D.A.: Fundamentals of Astrodynamics and Applications, 3rd edn. Microcosm Press, Hawthorne and Springer, New York (2007) Weinberg, S.: Gravitation and Cosmology: Principles and Applications of the General Theory of Relativity. Wiley, Chichester (1972) Wiener, T.F.: Theoretical analysis of gimballess inertial reference equipment using delta- modulated instruments. Ph.D. dissertation, Massachusetts Institute of Technology, Cambridge(1962)Chapter 3 Attitude Kinematics and Dynamics This chapter begins with a discussion of the kinematics of rotations, or attitude kinematics, and then moves on to attitude dynamics. The distinction betweenkinematics and dynamics is that kinematics covers those aspects of motion that can be analyzed without consideration of forces or torques. When forces and torques are introduced, we are in the realm of dynamics. To make this distinction clear,consider the motion of a point particle in Newtonian physics. If rdenotes position, vdenotes velocity, and time derivatives are indicated by a dot, then the kinematic equation of motion is simply PrDv. The dynamic equation of motion is mPvDF orPpDF, where Fis the applied force and p/DC1mPvis the translational momentum. Kinematics and dynamics are often subsumed under the single term dynamics by combining the kinematic and dynamic equations in the single relation mRrDF. In fact, it is common in ﬁltering theory to apply the term dynamics to any relation expressing time dependence. The role of the position vector ris taken in attitude kinematics by the attitude matrixAor one of its parameterizations, and the role of the velocity vis taken by the angular velocity !. The role of translational momentum pis played by the angular momentum H. The kinematic and dynamic equations of rotational motion are not as simple as those for translational motion. In particular, the angular momentum is not a scalar multiple of the angular velocity in general. We discuss attitude kinematics ﬁrst, deriving equations for the time derivatives of the attitude matrix and of its various parameterizations introduced in the previous chapter. We also discuss the time derivatives of representations of a vector in frames that undergo relative rotational motion. Our treatment of dynamics begins by considering the separation of center-of- mass motion from rotational motion, emphasizing the fundamental role played by angular momentum. We next introduce the concept of a rigid body, an extremelyuseful approximation for many spacecraft. We summarize the kinematic and dynamic equations of motion and collect them in one place for easy reference, and then analyze the torque-free motion of a rigid body. We follow this with discussions F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _3, © Springer Science+Business Media New York 20146768 3 Attitude Kinematics and Dynamics of the modeling of internal and external torques, which include both undesired disturbance torques and deliberately applied control torques. Finally, we examine the special case of Earth-pointing spacecraft. 3.1 Attitude Kinematics We will discuss the kinematics of the attitude matrix ﬁrst, since this is thefundamental representation of a rotation. This discussion introduces the concept of the angular velocity orangular rate vector. We then discuss the kinematics of column vectors in rotating reference frames. 3.1.1 Attitude Matrix The time dependence of the attitude matrix expressing the rotation from a frame F to a frameGis given by the fundamental deﬁnition of a derivative as PAGF.t//DC1lim /SOHt!0AGF.tC/SOHt//NULAGF.t/ /SOHt Dlim /SOHt!0AGF.tC/SOHt/AFG.t//NULI3 /SOHtAGF.t/ (3.1) becauseAFG.t/AGF.t/is equal to the identity matrix. As /SOHtgoes to zero, the productAGF.tC/SOHt/AFG.t/differs from the identity matrix by a small rotation that we can represent by a rotation vector, AGF.tC/SOHt/AFG.t/Dexp/NUL /NULŒ/SOH#GF G/STX/c141/SOH /EMI3/NULŒ/SOH#GF G/STX/c141 (3.2) The higher-order terms omitted in the approximation go to zero faster than /SOHtas/SOHt goes to zero. The /SOHin front of#expresses the fact that this is a small rotation, the superscriptGFmeans that it relates to the rotation from frame Fto frameG, and the subscriptGmeans that the rotation vector is represented in the frame G. We know that the rotation vector is represented in frame GbecauseAGF.tC/SOHt/AFG.t/is a rotation from frame Gat one time to frame Gat a different time, and these two frames coincide in the limit that /SOHtgoes to zero. The kinematic relations do not distinguish between the situations where frame For frameGor both frames are rotating in an absolute sense; they only care about the relative rotation between the two frames. Substituting Eq. ( 3.2) into Eq. ( 3.1)g i v e s PAGF.t/Dlim /SOHt!0/NULŒ/SOH#GF G/STX/c141 /SOHtAGF.t/D/NULŒ!GF G.t//STX/c141AGF.t/ (3.3)3.1 Attitude Kinematics 69 where the angular rate vector or angular velocity vector is deﬁned by !GF G.t//DC1lim /SOHt!0/SOH#GF G /SOHt(3.4) The rotation vector is always speciﬁed in radians, so the units of the angular velocity are rad/s, assuming that time is measured in seconds. Equation ( 3.3) is the fundamental equation of attitude kinematics. We can also write this, omitting the time arguments, as PAGFD/NULAGFAFGŒ!GF G/STX/c141AT FGD/NULAGFŒAFG!GF G/STX/c141D/NULAGFŒ!GF F/STX/c141(3.5) which expresses the kinematics in terms of the components of !GFin frame Finstead of its components in frame G. Taking the transpose of Eq. ( 3.3) and remembering that the cross-product matrix is skew-symmetric gives PAFGDAT GFŒ!GF G/STX/c141DAFGŒ!GF G/STX/c141 (3.6) The frame labels are arbitrary, so we can exchange the labels FandGin this expression to get PAGFDAGFŒ!FG F/STX/c141 (3.7) Comparing with Eq. ( 3.5) establishes the identity !FG FD/NUL!GF F (3.8) expressing the perfectly reasonable result that the rotational rate of frame Fwith respect to frame Gis the negative of the rate of frame Gwith respect to frame F. Although we have derived this as a relationship of the components in frame F, the properties of orthogonal transformations show that it must be true for the components in any frame. The kinematic equations preserve the orthogonality of the attitude matrix because the derivatives of AGFAT GFDI3andAT GFAGFDI3are PAGFAT GFCAGFPAT GFD/NULŒ!GF G/STX/c141I3CI3Œ!GF G/STX/c141D0 (3.9a) PAT GFAGFCAT GFPAGFD/NULŒ!FG F/STX/c141I3CI3Œ!FG F/STX/c141D0 (3.9b) 3.1.2 Vector Addition of Angular Velocity The specialization of Eq. ( 2.47) for rotation matrices is AHFDAHGAGF (3.10)70 3 Attitude Kinematics and Dynamics Taking the time derivative of this equation gives PAHFD/NULŒ!HF H/STX/c141AHFDPAHGAGFCAHGPAGF D/NULŒ!HG H/STX/c141AHGAGF/NULAHGŒ!GF G/STX/c141AGF D/NULfŒ!HG H/STX/c141CAHGŒ!GF G/STX/c141AT HGgAHF (3.11) which means, by Eq. ( 2.63), that !HF HD!HG HCAHG!GF GD!HG HC!GF H (3.12) The ﬁrst form of this equation is more useful in applications, but the second shows that the angular velocity of the motion of frame Hrelative to frame Fis just the vector sum of angular velocity of the motion of Hrelative toGand the angular velocity of the motion of Grelative toF, provided that they are expressed in the same reference frame. Equation ( 3.8) is a special case of this general result. 3.1.3 Vector Kinematics Consider the representations of a vector xin two different frames: xGDAGFxF (3.13) The time derivative of this equation is PxGDAGFPxFCPAGFxFDAGFPxF/NULŒ!GF G/STX/c141AGFxF DAGFPxF/NUL!GF G/STXxG (3.14) This is a fundamental equation. It expresses the derivative PxGof a vector in one frame, as seen in that frame, as the sum of two terms: the mapping by orthogonal transformation of the derivative PxFin another frame, as seen in that frame, and an “!/STX” term reﬂecting the rotational motion between the two frames. Note that no judgement is made as to which frame is moving in an absolute sense; only the relative rotation matters. Differentiating Eq. ( 3.14)a g a i ng i v e s RxGDAGFRxF/NULŒ!GF G/STX/c141AGFPxF/NUL!GF G/STXPxG/NULP!GF G/STXxG DAGFRxF/NULŒ!GF G/STX/c141.PxGC!GF G/STXxG//NUL!GF G/STXPxG/NULP!GF G/STXxG DAGFRxF/NUL!GF G/STX.!GF G/STXxG//NUL2!GF G/STXPxG/NULP!GF G/STXxG (3.15) This equation is more useful for translational motion than for rotational motion. The terms on the right side have special names when xis a position vector; the second term is the centripetal acceleration, the third term is the Coriolis acceleration,and the last term is sometimes called the Euler acceleration.3.2 Kinematics of Attitude Parameterizations 71 3.2 Kinematics of Attitude Parameterizations As discussed in Chap. 2, attitude simulation and attitude estimation usually employ a representation of the attitude having fewer parameters and fewer constraints thanthe attitude matrix. We will now derive the kinematic equations for several of these parameterizations. Frame-specifying subscripts are omitted in this section and in most of the book, unless they are necessary to avoid ambiguity. We alwaysunderstand the attitude rate vector relating to an attitude matrix A GFto be!GF G, unless explicitly indicated otherwise. 3.2.1 Quaternion Kinematics The derivation of the kinematic equation for the quaternion is similar to that for the attitude matrix. The derivative is Pq.t//DC1lim /SOHt!0q.tC/SOHt//NULq.t/ /SOHt(3.16) We can use Eq. ( 2.127 ) to represent the rotation from q.t/toq.tC/SOHt/ as the exponential of a rotation vector, q.tC/SOHt/DexpŒ./SOH#=2/˝/c141q.t//EMq.t/CŒ./SOH#=2/˝/c141q.t/ (3.17) Inserting this into Eq. ( 3.16) and taking the limit as /SOHtgoes to zero gives Pq.t/D1 2Œ!.t/˝/c141q.t/D1 2!.t/˝q.t/D1 2˝.!.t//q.t/ (3.18) where the angular velocity vector is deﬁned by Eq. ( 3.4). This result is very similar to Eq. ( 3.3). The fact that Œ!.t/˝/c141is a skew-symmetric matrix ensures that Eq. ( 3.18) preserves the quaternion norm, because the derivative of kqk2D1is PqTqCqTPqD/DC21 2Œ!˝/c141q/DC3T qCqT/DC21 2Œ!˝/c141q/DC3 D1 2/NUL /NULqTŒ!˝/c141qCqTŒ!˝/c141q/SOH D0 (3.19) It is often more convenient to use Eqs. ( 2.84a ) and ( 2.86) to write the kinematic equation for the quaternion in the form PqD1 2qˇ!D1 2/EOT.q/! (3.20) where/EOT.q/is deﬁned by Eq. ( 2.88). Then Eq. ( 2.89a )g i v e s!as a function of the quaternion rate as !D2/EOTT.q/Pq (3.21)72 3 Attitude Kinematics and Dynamics 3.2.2 Rodrigues Parameter Kinematics The kinematic equation satisﬁed by the Gibbs vector is most easily obtained from the kinematic equation for the quaternion. Taking the time derivative of Eq. ( 2.136 ), inserting Eq. ( 3.18) for the quaternion derivative, and then substituting Eq. ( 2.137 ) gives PgD.1=2/Œ!Cg/STX!C.g/SOH!/g/c141D.1=2//NUL I3CŒg/STX/c141CggT/SOH ! (3.22) The inverse of this equation is !D2/NUL I3CŒg/STX/c141CggT/SOH/NUL1PgD2/NUL 1Ckgk2/SOH/NUL1.Pg/NULg/STXPg/ (3.23) 3.2.3 Modiﬁed Rodrigues Parameter Kinematics The kinematic equation for the modiﬁed Rodrigues parameters can also be obtained from the kinematic equation for the quaternion. Taking the time derivative ofEq. (2.144 ), inserting Eq. ( 3.18) for the quaternion derivative, and then substituting Eq. (2.145 )g i v e s PpD.1=4//STX .1/NULkpk 2/!C2p/STX!C2.p/SOH!/p/ETX D.1=4/˚ .1/NULkpk2/I3C2Œp/STX/c141C2ppT/TAB ! D1Ckpk2 4/DC2 I3C2Œp/STX/c1412CŒp/STX/c141 1Ckpk2/DC3 ! (3.24) The matrix in parentheses in the last line of this equation is the transpose of the matrix appearing in Eq. ( 2.149 ), which is orthogonal, so the inverse of the kinematic equation for the MRPs is !D4 1Ckpk2/DC2 I3C2Œp/STX/c1412/NULŒp/STX/c141 1Ckpk2/DC3 Pp D4/NUL 1Ckpk2/SOH/NUL2/STX .1/NULkpk2/Pp/NUL2p/STXPpC2.p/SOHPp/p/ETX (3.25) 3.2.4 Rotation Vector Kinematics The kinematic equation for the rotation vector #De#is also most easily obtained from the kinematic equation for the quaternion. Taking the time derivative of #D2.cos/NUL1q4/q1W3 kq1W3k(3.26)3.2 Kinematics of Attitude Parameterizations 73 and substituting Eq. ( 3.18)g i v e s P#D/SUBq1W3qT 1W3 kq1W3k2Ccos/NUL1q4 kq1W3k3/NUL kq1W3k2I3/NULq1W3qT 1W3/SOH .q4I3CŒq1W3/STX/c141//ESC ! (3.27) after replacingq 1/NULq2 4bykq1W3k. We now substitute Eq. ( 2.124 ) for the quaternion, use the identities eeTDŒe/STX/c1412CI3andŒe/STX/c1413D/NULŒe/STX/c141, and collect terms to yield the desired kinematic equation P#D!C1 2#/STX!C1 #2/DC2 1/NUL# 2cot# 2/DC3 #/STX.#/STX!/ (3.28) The coefﬁcient of the last term is singular for #equal to any nonzero multiple of 2/EM, making the rotation vector parameterization unsuitable for numerical simulations.This coefﬁcient is difﬁcult to evaluate numerically for #/EM0, but it is nonsingular in this limit, and expanding the cotangent in a power series leads to the small angle approximation P#/EM!C.1=2/#/STX!C.1=12/#/STX.#/STX!/ (3.29) The inverse of Eq. ( 3.28)i s !DP#/NUL1/NULcos# #2#/STXP#C#/NULsin# #3#/STX.#/STXP#/ (3.30) This is easily veriﬁed with the use of the relation Œe/STX/c1413D/NULŒe/STX/c141and some trigonometric identities. 3.2.5 Euler Angle Kinematics The product rule for differentiation gives the time derivative of a generalized Euler angle representation of a rotation, deﬁned by Eq. ( 2.152 ), as PA.e/RS;e/DC2;e I/RS;/DC2; /DPA.e ; /A. e/DC2;/DC2/A. e/RS;/RS/ CA.e ; /PA.e/DC2;/DC2/A. e/RS;/RS/CA.e ; /A. e/DC2;/DC2/PA.e/RS;/RS/ (3.31) which can be seen to be a speciﬁc application of the methods of Sect. 3.1.2 . Differentiating Eq. ( 2.109 ) and remembering that e/DC2is constant gives PA.e/DC2;/DC2/DP/DC2./NULcos/DC2Œe/DC2/STX/c141Csin/DC2Œe/DC2/STX/c1412/D/NULP/DC2Œe/DC2/STX/c141A.e/DC2;/DC2/ (3.32)74 3 Attitude Kinematics and Dynamics Analogous relations hold for PA.e ; /andPA.e/RS;/RS/,s o PA.e/RS;e/DC2;e I/RS;/DC2; /D/NULP Œe /STX/c141A.e ; /A. e/DC2;/DC2/A. e/RS;/RS/ /NULP/DC2A.e ; /Œ e/DC2/STX/c141A.e/DC2;/DC2/A. e/RS;/RS/ /NULP/RSA.e ; /A. e/DC2;/DC2/Œe/RS/STX/c141A.e/RS;/RS/ D/NULfP Œe /STX/c141CP/DC2A.e ; /Œ e/DC2/STX/c141AT.e ; / CP/RSA.e ; /A. e/DC2;/DC2/Œe/RS/STX/c141AT.e/DC2;/DC2/ /STXAT.e ; /gA.e/RS;e/DC2;e I/RS;/DC2; / (3.33) But we know thatPAD/NULŒ!/STX/c141A,s ou s i n gE q .( 2.63)g i v e s !DP e CP/DC2A.e ; /e/DC2CP/RSA.e ; /A. e/DC2;/DC2/e/RS (3.34) where!,P ,P/DC2, andP/RSare expressed all in rad/s. This expression is intuitively plausible. It expresses the total angular velocity as the sum of the components P e ,P/DC2e/DC2, andP/RSe/RS, all mapped into the frame into which A.e/RS;e/DC2;e I/RS;/DC2; / transforms. The axis e is already in this frame, but e/DC2ande/RSmust be rotated by the matricesA.e ; /andA.e ; /A. e/DC2;/DC2/, respectively. We have obtained an expression for the angular velocity as a function of the Euler angle rates, but the inverse expression for the Euler angle rates in terms of theangular velocity is more useful. Because e is not affected by the rotation A.e ; /, we can write Eq. ( 3.34)a s !DA.e ; /ŒP e CP/DC2e/DC2CP/RSA.e/DC2;/DC2/e/RS/c141DA.e ; /M2 4P/RS P/DC2 P 3 5 (3.35) whereMis the3/STX3matrix M/DC1/STX A.e/DC2;/DC2/e/RSe/DC2e /ETX D/STX A.e/DC2;/DC2/AT.e/DC2;/DC20/e e/DC2e /ETX D/STX cos./DC2/NUL/DC20/e Csin./DC2/NUL/DC20/.e /STXe/DC2/e/DC2e /ETX (3.36) We have used Eqs. ( 2.154 ), (2.155 ), and ( 2.117 ) in the above. The determinant of Mis detMDŒcos./DC2/NUL/DC20/e Csin./DC2/NUL/DC20/.e /STXe/DC2//c141/SOH.e/DC2/STXe /D/NUL sin./DC2/NUL/DC20/(3.37) because e ande/DC2are orthogonal. Equations ( 2.16) and ( 2.61)g i v et h ei n v e r s eo f Eq. (3.35)a s 2 4P/RS P/DC2 P 3 5DM/NUL1AT.e ; /!DB./DC2; /! (3.38)3.2 Kinematics of Attitude Parameterizations 75 where B./DC2; //DC11 sin./DC2/NUL/DC20/2 4.e /STXe/DC2/T sin./DC2/NUL/DC20/eT /DC2 sin./DC2/NUL/DC20/eT /NULcos./DC2/NUL/DC20/.e /STXe/DC2/T3 5AT.e ; / (3.39) Although hidden by the notation, B./DC2; / also depends on e ,e/DC2, and e/RS,t h el a s t implicitly through /DC20; but it is independent of /RS. Equations ( 3.38) and ( 3.39) exhibit the gimbal-lock phenomenon; both P andP/RS become inﬁnitely large as sin ./DC2/NUL/DC20/!0unless the angular velocity vector !is orthogonal to A.e ; /. e /STXe/DC2/. Gimbal lock is a real physical phenomenon for gimbaled platforms, where the Euler or Bryan-Tait angles are the actual physical angles of the gimbal mechanisms, which clearly cannot attain inﬁnite rates. UsingA.e ; /e De andA.e ; /e/DC2Dcos e/DC2/NULsin .e /STXe/DC2/allows us to express Eq. ( 3.39)a s B./DC2; /D2 4csc./DC2/NUL/DC20/Œcos .e /STXe/DC2/Csin e/DC2/c141T cos eT /DC2/NULsin .e /STXe/DC2/T eT /NULcot./DC2/NUL/DC20/Œcos .e /STXe/DC2/Csin e/DC2/c141T3 5 (3.40) Now let us look at some speciﬁc examples of conventional Euler angle sequences. The axes for the 3/NUL1/NUL3sequence are e De3,e/DC2De1, and e /STXe/DC2De2, and/DC20D0,s oE q .( 3.35)g i v e s !/DC12 4!1 !2 !33 5DA.e3; /2 401 0 00 sin/DC2 10 cos/DC23 52 4P P/DC2 P/RS3 5D2 4P/RSsin/DC2sin CP/DC2cos P/RSsin/DC2cos /NULP/DC2sin P CP/RScos/DC23 5 (3.41) and Eq. ( 3.40)g i v e s B./DC2; /D2 4csc/DC2sin csc/DC2cos 0 cos /NULsin 0 /NULcot/DC2sin /NULcot/DC2cos 13 5 (3.42) The axes for the 3/NUL2/NUL1sequence are e De1,e/DC2De2, and e /STXe/DC2De3, and /DC20D/NUL/EM=2,s oE q .( 3.35)g i v e s !DA.e1; /2 410/NULsin/DC2 01 0 00 cos/DC23 52 4P P/DC2 P/RS3 5D2 4P /NULP/RSsin/DC2 P/RScos/DC2sin CP/DC2cos P/RScos/DC2cos /NULP/DC2sin 3 5 (3.43) and Eq. ( 3.40)g i v e s B./DC2; /D2 40sec/DC2sin sec/DC2cos 0 cos /NULsin 1tan/DC2sin tan/DC2cos 3 5 (3.44)76 3 Attitude Kinematics and Dynamics Expressions for B./DC2; / and its inverse for all the conventional Euler and Tait-Bryan representations can be derived in a parallel fashion, and explicit formulas for them can be found in Chap. 9. 3.2.6 Attitude Error Kinematics The analysis of attitude error kinematics uses the results of Sects. 2.10 and3.1.2 . To ﬁrst order in the attitude error, the angular velocity of the attitude error is givenby Eqs. ( 3.5) and ( 2.180 )a s Œ!.ı#//STX/c141D/NULPA.ı#/A T.ı#/DŒıP#/STX/c141.I3CŒı#/STX/c141/DŒıP#/STX/c141 (3.45) Thus we have simply !.ı#/DıP#. Consider ﬁrst the case where the attitude errors are deﬁned in the spacecraft body frame. Equation ( 2.179 )g i v e sABRDABOBAOBR,s oE q .( 3.12)g i v e s !BR BD!BOB BCABOB!OBR OB(3.46) In this case the attitude error rate is !.ı#B/D!BOB BDıP#B,s ow eh a v e ıP#BD!BR B/NULABOB!OBR OBD!/NULABOBO! (3.47) where the second form uses the compact notation of !for the true body rate, !BR B, andO!for the estimated body rate, !OBR OB. Inserting Eq. ( 2.180 )f o rABOBgives ıP#BD!/NUL.I3/NULŒı#B/STX/c141/O!D.!/NULO!//NULO!/STXı#B (3.48) The ﬁnal form of this equation is the one most commonly applied. It appears to be inconsistent because it involves the difference of !andO!, which are referenced to two different coordinate frames. Equation ( 3.47) shows that the attitude error rate is really deﬁned consistently; the apparent contradiction arises from inserting theapproximate form for A BOB. In fact, it is just this approximation that gives rise to theO!/STXı#term in the kinematic equation. Now consider the case where the attitude errors are deﬁned in the reference frame. Equation ( 2.178 )g i v e sABRDABORAORR,s oE q .( 3.12)g i v e s !BR BD!BOR BCABOR!ORR OR(3.49) In this case the attitude error rate is !.ı#R/D!ORR ORDıP#R,s o ıP#RDAT BOR.!BR B/NUL!BOR B/DOAT.!/NULO!/ (3.50) where in this caseOADABORis the estimated attitude and O!D!BOR Bis the estimated body rate.3.3 Attitude Dynamics 77 The error kinematics in these two cases look quite different. Equations ( 3.47) or (3.48) involves the attitude error, while Eq. ( 3.50) involves the attitude estimate. The difference arises because either attitude dynamics or strapdown gyro measure-ments give the components of the body rate in the spacecraft body frame. If the attitude errors are speciﬁed in the body frame, there are two slightly different body frames, the true frame and the estimated frame. If the attitude errors are speciﬁed inthe reference frame, on the other hand, there is only one body frame. The difference between the two formulations is purely kinematic, it has nothing to do with either frame being inertial or non-inertial. 1 3.3 Attitude Dynamics We now turn to attitude dynamics, emphasizing the fundamental role of angularmomentum. We begin by deﬁning the center of mass of a collection of mass points and showing how the rotational motion of this system can be treated separately from the motion of the center of mass. We then specialize to the case of a rigid body,deﬁning the moment of inertia tensor and expressing the angular momentum and rotational kinetic energy in terms of the moment of inertia and the angular velocity. We collect the rotational equations of motion, kinematic and dynamic, in one placefor easy reference, and then discuss the torque-free motion of a rigid body. Then we show how to include internal and external torques in the dynamics. 3.3.1 Angular Momentum and Kinetic Energy We will consider a spacecraft (or anything else) to be made up of a collection of npoint masses. The angular momentum with respect to the origin 0of an inertial coordinate frame is deﬁned in terms of the masses mi, positions ri0, and velocities vi0DPri0of the points relative to 0by H0/DC1nX iD1ri0/STXmivi0(3.51) Newton’s second law of motion tells us that miPvi0 IDFi Iin an inertial reference frame, and vi0/STXvi0D0, so the angular momentum obeys the equation PH0 IDnX iD1ri0 I/STXFi IDnX iD1ri0 I/STX0 @nX jD1Fij ICFiext I1 A (3.52) 1The situation would be different if the gyros were used to stabilize a platform to serve as an inertially ﬁxed reference, but such platforms are now used only infrequently in space.78 3 Attitude Kinematics and Dynamics 0rc0 rj0rjcric ji crij ri0 Fig. 3.1 Center of mass, c, and two representative mass points where Fijis the force exerted on mass point iby mass point jandFiextis the force exerted on iby everything external to the system of mass points.2Any pair of mass points with indices kand`appears twice in the double sum over iandj,a s rk0 I/STXFk` Iand as r`0 I/STXF`k I. Newton’s third law of motion says that F`kD/NULFk`,s o these two terms sum to .rk0 I/NULr`0 I//STXFk` IDrk` I/STXFk` I. This geometry is illustrated in Fig. 3.1. We assume that the force between two mass points acts along the line between them, an assumption known as the strong law of action and reaction [10], so the cross product vanishes and PH0 IDnX iD1ri0 I/STXFiext I/DC1L0 I (3.53) where L0 Iis the net torque about 0exerted on the collection of mass points by all the external forces.3Note that internal forces give no contribution to the net torque. We will now deﬁne the center of mass of the collection of mass points and prove the important result that the motion of the center of mass and the motion of the mass points about their center of mass are uncoupled. The location of the center of mass cwith respect to the origin 0is deﬁned as rc0/DC1 nX iD1miri0!, M (3.54) whereM/DC1Pn iD1miis the total mass of the collection of mass points. It follows from this deﬁnition that nX iD1miricDnX iD1mi.ri0/NULrc0/DMrc0/NULMrc0D0 (3.55) 2We assume that Fii, the force exerted by a mass point on itself, is zero. 3Warning! Many authors use the letter Lto denote angular momentum.3.3 Attitude Dynamics 79 where these vectors are illustrated in Fig. 3.1. Using this result and its derivative, the angular momentum about the arbitrary point 0can be written as the sum of the angular momentum about the center of mass and the angular momentum of thecenter-of-mass motion, namely H 0DnX iD1mi.ricCrc0//STX.vicCvc0/DnX iD1miric/STXvicCrc0/STXMvc0 DHcCrc0/STXMvc0(3.56) The net torque can similarly be expressed as L0DnX iD1.ricCrc0//STXFiextDnX iD1ric/STXFiextCrc0/STXnX iD1Fiext DLcCrc0/STXF (3.57) where Fis the net external force on the collection of point masses. Now in an inertial frame, we have FIDMPvc0 I, so substituting Eqs. ( 3.56) and ( 3.57) into Eq. ( 3.53) and canceling the term due to motion of the center of mass gives Euler’s equation PHc IDLc I (3.58) This is the fundamental equation of attitude dynamics. It is important to note that this result holds even if the center of mass undergoes acceleration, as it usually does.Equation ( 3.58) only holds in a non-rotating frame, however. 4 The separation into contributions from center-of-mass motion and motion about the center of mass also holds for the kinetic energy. We have E0 k/DC11 2nX iD1mikvi0k2D1 2nX iD1mi.vicCvc0//SOH.vicCvc0/ D1 2nX iD1mikvick2C1 2Mkvc0k2DEc kC1 2Mkvc0k2(3.59) The derivative of the kinetic energy is PE0 kDnX iD1mivi0 I/SOHPvi0 IDnX iD1.vic ICvc0 I//SOHFi IDnX iD1vic I/SOHFi ICvc0 I/SOHFI (3.60) The internal forces cancel in the vc0 I/SOHFi Isum due to the weak form of Newton’s third law of motion, i.e. this cancelation does not require the force between twomass points to be along the line joining them. The internal forces do not cancel in 4This is discussed in Sect. 2.6.2 .80 3 Attitude Kinematics and Dynamics the other term, though. This means that internal forces cannot affect the energy of center-of-mass motion, but they can modify the energy of rotation about the center of mass. It is apparent that the last term of Eq. ( 3.60) is equal to the derivative of the last term of Eq. ( 3.59), from which it follows that PEc kDnX iD1vic I/SOHFi I (3.61) 3.3.2 Rigid Body Dynamics A rigid body is deﬁned by the existence of a reference frame, called the body frame Bin which all the vectors ric Bare constant. The body frame is not unique; any frame related to it by a constant orthogonal transformation is also a body frame. The constancy of the vectors in the body frame and Eq. ( 3.14) allow us to obtain the velocity of a mass point in the inertial frame as vic IDPric IDAIBPric B/NUL!IB I/STXric ID!BI I/STXric I (3.62) w h e r ew eh a v eu s e dE q .( 3.8) to obtain the last form. Substituting this into Eq. ( 3.56) gives Hc IDnX iD1miric I/STXvic IDnX iD1miric I/STX.!BI I/STXric I/D/NULnX iD1miŒric I/STX/c1412!BI IDJc I!BII (3.63) The last equality deﬁnes the representation in the frame Iof the symmetric 3/STX3 matrixJc Iknown as the moment of inertia tensor ,o rM O I .5The MOI in Eq. ( 3.63) is speciﬁc to frame I, but we can deﬁne it in a general frame by Jc/DC1/NULnX iD1miŒric/STX/c1412DnX iD1mi/STX krick2I3/NULric.ric/T/ETX (3.64) which deﬁnes the MOI in the frame in which the vectors ricare represented, whatever that frame is. In fact the MOI is almost always expressed in the bodyframe J c BD/NULnX iD1miŒric B/STX/c1412DnX iD1mi/STX kric Bk2I3/NULric B.ric B/T/ETX (3.65) 5The MOI is more speciﬁcally a second-rank tensor , which means that it transforms by Eq. ( 2.52) under reference frame transformations. This follows directly from the fact that ric BDABIric I.3.3 Attitude Dynamics 81 because it is constant in that frame. The angular momentum in the body frame is given, using Eqs. ( 2.52) and ( 2.42), by Hc BDABIHc IDABIJc I!BIIDABIJc IATBIABI!BIIDJc B!BIB: (3.66) Theparallel axis theorem can be used to ﬁnd the MOI of a rigid body about an arbitrary point pin terms of its MOI about its center of mass: JpDnX iD1mi/STX kripk2I3/NULrip.rip/T/ETX DnX iD1mi/STX k.ricCrcp/k2I3/NUL.ricCrcp/.ricCrcp/T/ETX DM/STX krcpk2I3/NULrcp.rcp/T/ETX CJc(3.67) with Eq. ( 3.55) causing the other terms in the sum to vanish. This allows us to express the MOI of a large body in terms of the MOIs of msubassemblies as JcDmX kD1˚ Mk/STX krckck2I3/NULrckc.rckc/T/ETX CJck/TAB (3.68) wherecis the center of mass of the whole system and Mk,ck, andJckdenote the mass, location of the center of mass, and MOI about ckof thekth subassembly. This is the method used to compute MOIs in practice, where the subassemblies can be structural elements, electronics boxes, reaction wheel assemblies, star trackers, etc. The MOIs of the subassemblies can be directly measured or they can be computedby breaking the subassemblies down into sub-subassemblies. The matrix elements of the MOI tensor are given explicitly by ŒJ c/c14111DnX iD1mi/STX .ric 2/2C.ric 3/2/ETX (3.69a) ŒJc/c14122DnX iD1mi/STX .ric 3/2C.ric 1/2/ETX (3.69b) ŒJc/c14133DnX iD1mi/STX .ric 1/2C.ric 2/2/ETX (3.69c) ŒJc/c141k`D/NULnX iD1miric kric `;fork¤` (3.69d)82 3 Attitude Kinematics and Dynamics The off-diagonal elements, ŒJc/c141k`, or their negatives, /NULŒJc/c141k`, are often referred to as the products of inertia .6 Being a real symmetric 3/STX3matrix, the MOI tensor has three orthogonal eigenvectors ek Band three real eigenvalues Jksatisfying the relation Jc BekBDJkek B;forkD1;2;3 (3.70) The unit vectors ek Bare called the principal axes and the scalars Jkare known as theprincipal moments of inertia . The transformation of the MOI tensor from an arbitrary body frame to the principal axis frame is given by AT BPJc BABPDJc PDdiag.ŒJ1J2J3/c141/ (3.71) whereABPDŒe1 Be2Be3B/c141. In the principal axis frame Eq. ( 3.69) has the form J1DnX iD1mi/STX .ric P2/2C.ric P3/2/ETX (3.72a) J2DnX iD1mi/STX .ric P3/2C.ric P1/2/ETX (3.72b) J3DnX iD1mi/STX .ric P1/2C.ric P2/2/ETX (3.72c) 0DnX iD1miric Pkric P`;fork¤` (3.72d) The sum in the last of these equations must have balancing positive and negative contributions, expressing the intuitive idea that the mass is distributed symmetricallyabout the principal axes. In particular, any axis of rotational symmetry of a mass distribution is a principal axis. The ﬁrst three equations show that the principal moments are all positive, unless the mass is all concentrated on a mathematicalstraight line, which is impossible for a real physical body. It can also be seen from these equations that the principal moments of inertia satisfy the triangle inequalities J k/DC4J`CJm (3.73) where equality holds only if all the mass is concentrated in the `/NULmplane, and wherek,`, andmare any permutation of the indices 1;2;3 . 6Be warned that notation varies. The majority of authors use Ifor the MOI, but we reserve this notation for the identity matrix. Some denote our JkkbyIkkand ourJk`fork¤`by/NULIk`,b u t this unfortunate notation should be shunned.3.3 Attitude Dynamics 83 It also follows from this analysis that the MOI tensor of any real physical body has an inverse in any body frame, and we can write Eq. ( 3.66)a s !BI BD.Jc B//NUL1Hc B (3.74) Implicit in Eqs. ( 3.66) and ( 3.74) is the key fact that the angular momentum and angular velocity of a rigid body are parallel if and only if the body rotates about a principal axis. The rotational kinetic energy of a rigid body can also be expressed in terms of the MOI tensor. Substituting Eq. ( 3.62) into Eq. ( 3.59)g i v e s Ec kD1 2nX iD1mikvick2D1 2nX iD1mi.!BI I/STXric I/T.!BI I/STXric I/ D1 2nX iD1mi/NUL Œric I/STX/c141!BI I/SOHT/NUL Œric I/STX/c141!BI I/SOH D1 2.!BI I/TJc I!BII(3.75) The rotational kinetic energy can be computed in any frame Fby Ec kD1 2.!BI F/TJc F!BIFD1 2!BI F/SOHHc FD1 2.Hc F/T.Jc F//NUL1Hc F (3.76) The time derivative of Eq. ( 3.75) is, with Eqs. ( 3.63) and ( 3.58), PEc kD.!BI I/TJc IP!BI ID!BI I/SOHLc ID!BI B/SOHLc B (3.77) showing that only external torques can modify the energy of rotation of a rigid body about its center of mass. This can be seen more explicitly by substituting Eq. ( 3.62) into Eq. ( 3.61), giving PEc kDnX iD1.!BI I/STXric I//SOH0 @nX jD1Fij ICFiext I1 AD!BI I/SOHLc I (3.78) The sum over the internal forces Fij Ivanishes for the same reason that the corresponding sum in Eq. ( 3.52) gave zero contribution, and the ﬁnal equality follows from applying Eqs. ( 2.56a ) and ( 3.57). We can now collect in one place the basic equations needed to model the attitude motion of a rigid body. We will assume that the attitude is parameterized by a quaternion, but any other representation could be used instead: PHc IDLc I (3.79a) Hc BDA.qBI/Hc I (3.79b)84 3 Attitude Kinematics and Dynamics !BI BD.Jc B//NUL1Hc B (3.79c) PqBID1 2!BI B˝qBI (3.79d) The external torques are often more easily computed in the body frame, so Eq. ( 3.14) is often employed to replace the ﬁrst two of these equations by PHc BDLc B/NUL!BI B/STXHc B (3.80) A further reduction in the number of equations can be achieved by combining the above equation with Eq. ( 3.66) to obtain Euler’s rotational equation P!BI BD.Jc B//NUL1/STX Lc B/NUL!BI B/STX.Jc B!BIB//ETX (3.81) This equation and a kinematics equation, such as the quaternion kinematics equation, provide a complete description of the motion of a rigid body. Use of the principal axis reference frame is generally not especially advantageous for numerical integration of the equations of motion, since a computer can easily deal with a full 3/STX3inertia tensor. The principal axis frame is almost invariably employed for analytical studies of attitude motion, however, and we will use it inthe next subsection. 3.3.3 Rigid Body Motion We now begin a discussion of the motion produced by the rigid body dynamic and kinematic equations. This section will consider the qualitative aspects of the motion, without solving the kinematic and dynamic differential equations explicitly. ThenSect. 3.3.4 will discuss in detail the solutions in the absence of torques. We will simplify the notation by omitting the superscript c, with the understanding that we always treat motion with respect to the center of mass unless explicitly indicatedotherwise. We will denote the components of H Bin a principal axis frame by H1;H2;H3and the components of !BI Bby!1;!2;!3. There are many discussions of rigid body motion in the literature, including notable ones by Goldstein [ 10], Kaplan [ 17], Markley [ 20], and Hughes [ 14]. 3.3.3.1 Spin Stabilization Equation ( 3.58) tells us that HIis constant if there are no external torques. This has led to the technique of spin stabilization of spacecraft. The basic idea is to stabilize the pointing direction of one axis by spinning the spacecraft about that axis.3.3 Attitude Dynamics 85 If a torque of magnitude Ltransverse to the direction of the spin angular momentum acts on a spinning spacecraft, the change in angular momentum over a time interval /SOHtwill be k/SOHHIkDL/SOHt/EMH/SOH# (3.82) whereHis the magnitude of the angular momentum and /SOH#is the angle (measured in radians) over which it rotates. It is clear that a larger amount of angular momentum will result in a smaller angular motion for a given level of disturbancetorque. Spin stabilization was widely employed early in the space program, then was largely displaced by active control methods, but has made a comeback in the era of microsatellites and nanosatellites. It is important for spin stabilization that the angular momentum also have a constant direction in the body frame. Equation ( 3.80) says that this will be the case if! BI B/STXHBD0, which requires the rotation axis to be a principal axis of the inertia tensor. Thus we want the spacecraft to rotate about a principal axis. If the spacecraft spins about a principal axis, but this does not align precisely with the desired pointing axis, coning results, with the pointing axis rotating at the spin rate around a cone centered on the inertially ﬁxed angular momentum. The only way to eliminate coning is to carefully balance the spacecraft. This is generally accomplished by adding balance weights before launch similar to balancing anautomobile tire, but some spacecraft have carried movable weights into orbit to allow compensation for inertia shifts caused by launch forces or to provide better balance than can be measured on the ground. If the angular momentum is not perfectly aligned with a principal axis of inertia, the angular momentum will not be constant in the body frame. The resulting motion of the angular momentum, and of the angular velocity, is called nutation . 7For torque-free motion, kHBkDk HIk/DC1His constant during nutation, so the angular momentum vector moves on the surface of a sphere of radius Hin the body frame. Investigating the stability of the motion for angular velocity close to, but not exactly on, a principal axis shows that all principal axes are not created equal for the purpose of spin stabilization. We will see that spin stabilization should always be about the principal axis with the largest or smallest principal moment of inertia,known as the major orminor principal axis, respectively, with a strong preference for the major principal axis. If there are no torques, the component form of Eq. ( 3.80) in the principal axis frame is PH 1D.J/NUL1 3/NULJ/NUL1 2/H2H3DŒ.J2/NULJ3/=.J2J3//c141H2H3 (3.83a) PH2D.J/NUL1 1/NULJ/NUL1 3/H3H1DŒ.J3/NULJ1/=.J3J1//c141H3H1 (3.83b) PH3D.J/NUL1 2/NULJ/NUL1 1/H1H2DŒ.J1/NULJ2/=.J1J2//c141H1H2 (3.83c) 7This is the usual aerospace meaning of the term nutation ; it is used quite differently in other applications of classical mechanics to refer to a wobbling or nodding motion.86 3 Attitude Kinematics and Dynamics eee e 213ab 3 Fig. 3.2 Constant energy paths on the angular momentum sphere. ( a) Axisymmetric inertia ratios J1WJ2WJ3D4W4W6.(b) Triaxial inertia ratios J1WJ2WJ3D3W4W6 We will choose the spin axis to be close to the e3axis for the purpose of the following argument, which means that H1andH2are both much less than H3. Thus their product on the right side of Eq. ( 3.83c ) is negligibly small, and we can approximate H3as being constant. Then differentiating Eq. ( 3.83a ) and substituting Eq. ( 3.83b ) gives RH1.t/DŒ.J2/NULJ3/.J3/NULJ1/=.J1J2//c141.H3=J3/2H1.t/ (3.84) IfJ3is the largest or smallest principal moment, the product .J2/NULJ3/.J3/NULJ1/ is negative, resulting in a periodic motion of H1. Then Eq. ( 3.83a ) shows that H2 also undergoes periodic motion with the same period. This is nutation about the e3 axis. The product .J2/NULJ3/.J3/NULJ1/is positive if J3is intermediate between J1 andJ2, however, and H1andH2both grow exponentially.8Thus rotation about an intermediate principal axis is inherently unstable. It is also possible that J3is equal to one of the other principal moments. If J3DJ1, for instance, then Eq. ( 3.83b ) tells us thatH2is exactly constant, and Eq. ( 3.83a ) says thatH1grows linearly with time. This motion is also unstable, although not exponentially unstable. This behavior is illustrated in Fig. 3.2a,b, which show the torque-free motion of HBon the sphere of radius Hfor two different inertia tensors. The rotational kinetic energy in a principal axis frame is given by 2EkDH2 1=J1CH2 2=J2CH2 3=J3 (3.85) 8Exponential growth continues until the right side of Eq. ( 3.83c ) is no longer negligible.3.3 Attitude Dynamics 87 For a given angular momentum magnitude, the kinetic energy is restricted to the range H2=Jmax/DC42Ek/DC4H2=Jmin (3.86) whereJminandJmaxare the minimum and maximum principal moments of inertia. Conservation of energy conﬁnes the motion of HBto a path on the sphere and Fig. 3.2a,b show these paths for energy levels with even spacing 0:025H2=Jmax in the range allowed by Eq. ( 3.86). We will ﬁrst discuss the simpler axially symmetric, or axisymmetric case, with two principal moments equal. We will take e3to be the axis of symmetry of the inertia tensor in this case, which is shown in Fig. 3.2a. The axes e1ande2are not shown on the ﬁgure because they can be any two axes in the equatorial plane thatform a right-handed orthogonal triad with e WithJ1DJ2/DC1Jt, where the subscripttdenotes “transverse,” Eq. ( 3.85) becomes 2EkD.H2 1CH2 2/=JtCH2 3=J3 (3.87) It follows that H3D˙/DC4J3.H2/NUL2JtEk/ J3/NULJt/NAK1=2 (3.88a) Ht/DC1/STX H2 1CH2 2/ETX1=2D/DC4Jt.2J3Ek/NULH2/ J3/NULJt/NAK1=2 (3.88b) This shows that nutation of an axisymmetric body is motion of the angular momentum vector in the body frame along circles of constant radius Hta constant distance ofH3above or below the equatorial plane, as shown in Fig. 3.2a. This extends the analysis of Eq. ( 3.84) to nutation with any allowable magnitude about the major or minor principal axis ˙e3. The ﬁgure also shows that there are no small nutation paths close to the e1/NULe2plane. Figure 3.2b illustrates the triaxial case, where no two principal moments are equal. We have labeled the principal axes for this discussion so that J1<J2<J3. The paths followed by nutational motion about the major and minor axes are notsimple circles in this case; their exact form will be found in Sect. 3.3.4 . We see that there is no stable motion about the intermediate axis ˙e 2in this case. Instead, we ﬁnd motion along two great circles passing through e2. They are called separatrices , because they separate nutational motion about ˙e1from nutational motion about ˙e3. The separatrices are the curves for 2EkDH2=J2, so they satisfy the equation .H2 3CH2 2CH2 1/=J2DH2 1=J1CH2 2=J2CH2 3=J3 (3.89) which gives H3 H1D/DC4J3.J2/NULJ1/ J1.J3/NULJ2//NAK1=2 (3.90)88 3 Attitude Kinematics and Dynamics Fig. 3.3 William Pickering, James Van Allen, and Wernher von Braun holding a Full-Scale Model of Explorer 1. Source: NASA 3.3.3.2 Energy Dissipation We have seen that stable rotation is possible around either a major or minor principal axis of inertia. However, internal forces in a body that is not completely rigid can lead to energy dissipation. If external torques are absent, HIwill be constant, but the rotational energy will decrease to its minimum value of H2=Jmax, resulting in stable rotation about a major principal axis. If the intended spin axis is a minor axis, energy dissipation will result in ﬂat spin , an undesirable rotation about an axis perpendicular to the preferred axis. A famous example of this is the pencil-shaped Explorer 1, the ﬁrst Earth satellite successfully launched by the United States, which was intended to spin about its longitudinal axis. Its entry into ﬂat spin was attributed to energy dissipation in the ﬂexible turnstile antenna array, comprising the four wires attached to the fuselage just aft of Wernher von Braun’s right hand in Fig. 3.3[5]. Steady spin about the major principal axis is commonly the desired outcome, with spin-stabilized spacecraft designed to be more nearly disc-shaped than pencil- shaped; and passive nutation dampers are often placed on these spacecraft to produce this result. For triaxial inertia, energy dissipation can result in motion starting with increasing nutation about ˙e1, then crossing one of the separatrices, followed by decreasing nutation about either e3or/NULe3, depending on where a separatrix is crossed. Because HIis ﬁxed in the inertial frame, these two outcomes result in the pointing axis being oriented in opposite directions in inertial space. It is usually the case that only one of these pointing directions is satisfactory, which requires careful control of the energy damping to ensure the correct crossing of the separatrix.3.3 Attitude Dynamics 89 3.3.3.3 Poinsot’s Construction The discussion up to this point has not provided a picture of the motion in the inertial frame. Poinsot’s construction supplies this picture by focusing on angular velocity rather than angular momentum [ 10,14,17]. Conservation of energy in torque-free motion restricts angular velocity to the surface of the inertia ellipsoid deﬁned by 2EkD.!BI B/TJB!BIBDJ1!2 1CJ2!2 2CJ3!2 3 (3.91) with semimajor axes of lengthp 2Ek=J1;p 2Ek=J2;p 2Ek=J3. A small change /SOH!in the angular velocity would result in an energy change /SOHEkD.!BI B/TJc B/SOH!DHB/SOH/SOH! (3.92) which is zero if /SOH!is perpendicular to the angular momentum. Changes /SOH!that do not change Ekare in the plane tangent to the inertia ellipsoid, leading to the conclusion that the normal to the inertia ellipsoid at any !BI Bis in the direction of the angular momentum HBDJB!BI B. Each closed path on the momentum sphere illustrated in Fig. 3.2a or b maps onto a closed path called a polhode on the inertia ellipsoid. As the angular velocity moves along the polhode, the inertia ellipsoid (which is ﬁxed in the rigid body) moves insuch away that the normal to its surface at the position of the instantaneous angular velocity maintains a ﬁxed direction (that of H I) in inertial space. But Poinsot tells us more. Writing the energy equation in the form 2EkD!BI I/SOHHIreveals that the component of !BI Iparallel to HIhas the constant value 2Ek=H. Thus the tip of the vector!BI Ialways lies in a ﬁxed plane normal to HIat a distance of 2Ek=H from the center of the inertia ellipsoid. The path followed by the angular velocity inthis invariant plane is called the herpolhode . Thus the inertia ellipsoid rolls on the invariant plane with its center at a ﬁxed point a distance 2E k=Habove the plane and with the tip of the angular velocity vector as the point of contact. Since the angularvelocity is the instantaneous axis of rotation, there is no slippage at the contact point, and Poinsot’s construction can be succinctly summarized by the statement that the polhode rolls without slipping on the herpolhode lying in the invariant plane. 9 Goldstein [ 10], Kaplan [ 17], and Hughes [ 14] have pictures illustrating Poinsot’s construction. Poinsot’s construction is not especially easy to visualize, and there is a simpler picture for the familiar axial symmetry case. In any case, we now turn to analytic solutions of the equations of motion, which are often more useful than pictures for estimation and control applications. 9A statement aptly characterized by Goldstein [ 10] as “jabberwockian.”90 3 Attitude Kinematics and Dynamics 3.3.4 Torque-Free Motion of a Rigid Body Analytic solutions of the rigid body equations of motion are customarily expressed in terms of angular velocity rather than angular momentum. Thus we will consider the component form of Eq. ( 3.81) in the principal axis frame in the absence of torques: P!1.t/DŒ.J2/NULJ3/=J1/c141!2.t/!3.t/ (3.93a) P!2.t/DŒ.J3/NULJ1/=J2/c141!3.t/!1.t/ (3.93b) P!3.t/DŒ.J1/NULJ2/=J3/c141!1.t/!2.t/ (3.93c) As we saw in Sect. 3.3.3 , the rate of rotation about one of the principal axes is constant if the moments of inertia about the other two principal axes are equal. We will treat this simpler case of axial symmetry ﬁrst, and then turn to the case of atriaxial inertia tensor. 3.3.4.1 Axial Symmetry Taking e 3to be the axis of symmetry of the inertia tensor, we have P!1.t/D.1/NULJ3=Jt/!2.t/!3.t/ (3.94a) P!2.t/D/NUL.1/NULJ3=Jt/!3.t/!1.t/ (3.94b) P!3.t/D0 (3.94c) This means that !3is constant, so we can omit the time argument. Note that !3is exactly constant for axial symmetry, as opposed to its approximate constancy in the stability analysis of Sect. 3.3.3 . It follows from Eq. ( 3.88a ) that !3DH3 J3D˙/DC4H2/NUL2JtEk J3.J3/NULJt//NAK1=2 (3.95) Differentiating Eq. ( 3.94a ) and substituting Eq. ( 3.94b )g i v e s R!1.t/D/NUL.1/NULJ3=Jt/2!2 3!1.t/ (3.96) which has the solution !1.t/D!tsin. 0C!pt/ (3.97) where 0is a constant initial phase, !p/DC1.1/NULJ3=Jt/!3 (3.98)3.3 Attitude Dynamics 91 and, from Eq. ( 3.88b ), !tDHt JtD/DC42J3Ek/NULH2 Jt.J3/NULJt//NAK1=2 (3.99) Then!2.t/is given by Eq. ( 3.94a )a s !2.t/D!tcos. 0C!pt/ (3.100) The angular rate !pis called the body nutation rate because it is the rate at which the angular velocity vector rotates about the symmetry axis in the body frame. Note that!phas the same sign as !3ifJt>J3and the opposite sign if Jt<J3. IfJtDJ3, there is no nutation, only steady rotation, since all axes are principal axes in that case. The angular momentum rotates about the symmetry axis in the body frame at the same rate, because the three vectors H;!, and e3are coplanar in the case of triaxial symmetry, as is easily seen from the relation HDJt2 4!1 !2 03 5CJ32 40 0 !33 5DJt!C.J3/NULJt/!3e3 (3.101) The speed at which the angular momentum vector moves over the sphere of radiusHin the body frame can also be computed by kPHBk2Dk!BI B/STXHBk2DH2k!BI Bk2/NUL.!BI B/SOHHB/2DH2k!BI Bk2/NUL.2Ek/2 (3.102) Substituting Eqs. ( 3.95), (3.99), (3.97) and ( 3.100 ) and performing some straight- forward algebra gives kPHBkDj.J3/NULJt/!t!3jDHtj!pj (3.103) It is easy to see that these equations give kPHBkD0for rotation about a principal axis, for which either !tor!3is zero. By using the addition formulas for the sine and cosine, we can express the transverse components of the angular velocity in terms of their initial values: !1.t/D!01cos!ptC!02sin!pt (3.104a) !2.t/D!02cos!pt/NUL!01sin!pt (3.104b) where!01D!tsin 0and!02D!tcos 0. We must now solve the kinematic equations of motion in order to have a complete mathematical description of the torque-free motion. We will follow the almost universal practice for torque-free motion of specifying the attitude by 3/NUL1/NUL3Euler angles. This gives us three ﬁrst-order equations to integrate, which would lead to92 3 Attitude Kinematics and Dynamics three constants of integration in addition to the three we have already found: H;Ek, and 0. Two of these constants can be thought of as specifying the ﬁxed direction ofHI, and we eliminate these by choosing the inertial reference frame with its third axis in the direction of HI. Then the angular momentum in the body frame is given by HBD2 4Jt!1 Jt!2 J3!33 5DABIHIDA313./RS;/DC2; /2 40 0 H3 5DH2 4sin sin/DC2 cos sin/DC2 cos/DC23 5(3.105) where Eq. ( 2.162 ) provides the last equality. We immediately see that the nutation angle/DC2has constant value between 0and/EMgiven by /DC2Dcos/NUL1.J3!3=H/ (3.106) and comparison of the ﬁrst two components of Eq. ( 3.105 ) with Eqs. ( 3.97) and ( 3.100 ) shows that sin/DC2DJt!t=H/NAK0 (3.107) and D 0C!pt (3.108) up to an irrelevant multiple of 2/EM. This explains our choice of the notation 0in Eq. (3.97). The third Euler angle is found by integrating Eq. ( 3.38)u s i n gE q .( 3.42): P/RSDcsc/DC2.!1sin C!2cos /D!tcsc/DC2DH=Jt/DC1!` (3.109) so that /RSD/RS0C!`t (3.110) The angular rate !`is called the inertial nutation rate because it is the rate at which the angular velocity vector and the symmetry axis of the rigid body rotate about theﬁxed angular momentum vector in the inertial frame. Equation ( 3.98) can be used to write Eq. ( 3.101 )a s !DH=J tC.1/NULJ3=Jt/!3e3DH=JtC!pe3 (3.111) This shows that the angular velocity in the axisymmetric case can be expressed as the sum of two (nonorthogonal) vectors of magnitude !`and!p. We complete the analysis of axisymmetric motion by ﬁnding the components of the angular velocity in the inertial frame. These are given by3.3 Attitude Dynamics 93 !BI IDAIB!BI BDAT 313./RS;/DC2; /2 4!1 !2 !33 5 DA.e3;/NUL/RS/A. e1;/NUL/DC2/A. e3;/NUL /2 4!tsin !tcos !33 5 (3.112) Performing the matrix multiplications and applying Eqs. ( 2.108 ), (3.106 ), and ( 3.107 )g i v e s A.e1;/NUL/DC2/A. e3;/NUL /2 4!tsin !tcos !33 5DA.e1;/NUL/DC2/2 40 !t !33 5 D2 40 !tcos/DC2/NUL!3sin/DC2 !3cos/DC2C!tsin/DC23 5D1 H2 40 .J3/NULJt/!t!3 2Ek3 5 (3.113) Thus the component of !BI Iparallel to HIhas the constant value 2Ek=H,a sw es a w in our discussion of Poinsot’s construction; and the component transverse to HIhas a magnitude agreeing with Eq. ( 3.103 ) and rotates around a circular herpolhode at the inertial nutation rate. We now present a pictorial view of this motion, which is the specialization of Poinsot’s construction to the axisymmetric case. The angular velocity vector precesses at rate !`and at an angle /DC2from the angular momentum vector around aspace cone ﬁxed in the inertial frame. At the same time, the angular velocity vector precesses at rate !pand at an angle ˇfrom the e3axis around a body cone ﬁxed in the body frame. These cones are illustrated in Fig. 3.4a for the prolate case and in Fig. 3.4b for the oblate case.10The cones are tangent at the angular velocity because H;!, and e3are coplanar, and there is no slippage along the line of tangency because that is the axis around which the rotation takes place. Thus, as viewed from the inertial frame, the body cone (and the spacecraft which is ﬁxed to it) rolls withoutslipping around the ﬁxed space cone; while, as viewed from the body frame, the space cone (and the universe which is ﬁxed to it) rolls without slipping around the ﬁxed body cone. The body cone angle ˇobeys cosˇD! 3=k!kand sinˇD!t=k!k (3.114) 10The ﬁgure illustrates the case of !3>0, but a corresponding ﬁgure for !3<0shows that all the discussion of this section holds in that case also.94 3 Attitude Kinematics and Dynamics H e3H e3ab Fig. 3.4 Torque-free motion of an axisymmetric rigid body. ( a) Prolate rigid body J3<Jt. (b) Oblate rigid body J3>Jt and comparison with Eqs. ( 3.106 ) and ( 3.107 ) shows that the space cone rolls on the outside of the body cone for a prolate rigid body and on the inside for an oblate body, as shown in the ﬁgure. This explains why !phas the same sign as !3in the prolate case and the opposite sign in the oblate case, in agreement with Eq. ( 3.98). Finally, we note from the ﬁgure that ˛, the angle between Hand!, is equal toj/DC2/NULˇj.T h i s relation can be veriﬁed algebraically by applying Eqs. ( 3.106 ), (3.107 ) and ( 3.114 ) to get Hk!k.cosˇcos/DC2Csinˇsin/DC2/D2EkDH/SOH!DHk!kcos˛ (3.115) 3.3.4.2 Triaxial Symmetry We will designate the intermediate principal moment of inertia by J2in the triaxial case. We saw in the discussion of Fig. 3.2b that the separatrices divide the motion into two regimes. For 2Ek<H2=J2the motion has the form of nutation about the principal axis having the largest moment of inertia, and 2Ek>H2=J2results in nutation about the principal axis with the smallest moment of inertia. Motion along a separatrix is a limiting case of either of these regimes. In order that oneanalytic formulation will cover both of these cases, we label the principal axes so that nutation is always about ˙e Thus J1<J2<J3if2Ek/DC4H2=J2; (3.116a) J1>J2>J3if2Ek/NAKH2=J2 (3.116b)3.3 Attitude Dynamics 95 No component of the angular velocity is constant in the triaxial symmetry case, so the solutions cannot be expressed in terms of sines and cosines. The closed-form solutions are expressed in terms of the Jacobian elliptic functions [ 1] sn.ujm/;cn.ujm/, and dn.ujm/with argument u andparameterm.11We deﬁne two signs,s1ands3equal to˙1, a dimensionless constant /DC4/DC1/DC4J1.J3/NULJ1/ J2.J3/NULJ2//NAK1=2 (3.117) and the angular rates !1m/DC1/DC42J3Ek/NULH2 J1.J3/NULJ1//NAK1=2 (3.118a) !3m/DC1/DC4H2/NUL2J1Ek J3.J3/NULJ1//NAK1=2 (3.118b) Then !1.t/Ds1!1mcn/NUL u0C!ptjm/SOH (3.119a) !2.t/D/NULs1/DC4!1msn/NUL u0C!ptjm/SOH (3.119b) !3.t/Ds3!3mdn/NUL u0C!ptjm/SOH (3.119c) where !pDŒ.J2/NULJ3/=J1/c141/DC4s3!3m (3.120) and mD.J2/NULJ1/.2J3Ek/NULH2/ .J3/NULJ2/.H2/NUL2J1Ek/(3.121) Note thatmD0for2EkDH2=J3,mD1for2EkDH2=J2, and Eq. ( 3.116 ) restrictsmto always lie between these limits. Figure 3.5a shows the Jacobian elliptic functions for mD0:7, which is the value for 2J2EkD.16=17/H2with the inertia ratios used in Fig. 3.2b. The Jacobian elliptic functions obey the differential equations sn0.ujm/Dcn.ujm/dn.ujm/ (3.122a) cn0.ujm/D/NULsn.ujm/dn.ujm/ (3.122b) dn0.ujm/D/NULmsn.ujm/cn.ujm/ (3.122c) 11Some authors, including Hughes [ 14], use the modulusk/DC1m1=2in place of the parameter.96 3 Attitude Kinematics and Dynamics 0 2K 3K 4K−1−0.500.51 usn(u|m) cn(u|m)dn(u|m) K 0 0.2 0.4 0.6 0.8 11.522.533.5 mKab Fig. 3.5 Jacobian elliptic functions. ( a) Elliptic functions for mD0:7.(b) Dependence of the quarter-period Konm where the prime denotes differentiation with respect to the argument. These equations can be used to show that Eq. ( 3.119 ) obeys Eq. ( 3.93). The Jacobian elliptic functions also satisfy the quadratic relations cn2.ujm/Csn2.ujm/Ddn2.ujm/Cmsn2.ujm/D1; (3.123) which verify that EkandHare the rotational kinetic energy and angular momentum magnitude, respectively, of the solutions. The Jacobian elliptic functions are relatedto the usual trigonometric functions by sn.ujm/Dsin' (3.124a) cn.ujm/Dcos' (3.124b) dn.ujm/D.1/NULmsin 2'/1=2(3.124c) where'is an implicit function of uandmdeﬁned by the integral relation uDZ' 0d/DC2 .1/NULmsin2/DC2/1=2(3.125) These equations lead directly to Eqs. ( 3.122 ) and ( 3.123 ). The quarter-period of the sine or cosine function is /EM=2, so the quarter-period of the Jacobian elliptic functions is K.m/DZ/EM=2 0d/DC2 .1/NULmsin2/DC2/1=2(3.126) This integral is known as a complete elliptic integral of the ﬁrst kind [1]. Figure 3.5b shows that the quarter-period is an increasing function of m, equal to/EM=2 formD0 and becoming inﬁnite as mgoes to 1.3.3 Attitude Dynamics 97 We can use the addition formulas for the Jacobian elliptic functions to write the triaxial solutions in terms of initial values. The addition formulas are, with the parametermomitted for notational convenience, sn.uCv/DsnucnvdnvCsnvcnudnu 1/NULmsn2usn2v(3.127a) cn.uCv/Dcnucnv/NULsnudnusnvdnv 1/NULmsn2usn2v(3.127b) dn.uCv/Ddnudnv/NULmsnucnusnvcnv 1/NULmsn2usn2v(3.127c) The angular rates can then be written in terms of the initial values as !1.t/D!01cn.!pt/CŒ.J2/NULJ3/=J1/c141.!02!03=!p/sn.!pt/dn.!pt/ 1/NULŒ.J2/NULJ3/=J1/c141Œ.J1/NULJ2/=J3/c141.!02=!p/2sn2.!pt/(3.128a) !2.t/D!02cn.!pt/dn.!pt/CŒ.J3/NULJ1/=J2/c141.!03!01=!p/sn.!pt/ 1/NULŒ.J2/NULJ3/=J1/c141Œ.J1/NULJ2/=J3/c141.!02=!p/2sn2.!pt/(3.128b) !3.t/D!03dn.!pt/CŒ.J1/NULJ2/=J3/c141.!01!02=!p/sn.!pt/cn.!pt/ 1/NULŒ.J2/NULJ3/=J1/c141Œ.J1/NULJ2/=J3/c141.!02=!p/2sn2.!pt/(3.128c) Comparison with Eq. ( 3.93) suggests the alternative form !1.t/D!01cn.!pt/C.P!01=!p/sn.!pt/dn.!pt/ 1/NUL!/NUL2p.P!01=!03/.P!03=!01/sn2.!pt/(3.129a) !2.t/D!02cn.!pt/dn.!pt/C.P!02=!p/sn.!pt/ 1/NUL!/NUL2p.P!01=!03/.P!03=!01/sn2.!pt/(3.129b) !3.t/D!03dn.!pt/C.P!03=!p/sn.!pt/cn.!pt/ 1/NUL!/NUL2p.P!01=!03/.P!03=!01/sn2.!pt/(3.129c) but neither form is especially convenient for computation. Equations ( 3.124 ) and ( 3.125 ) show that the Jacobian elliptic functions are equal to the usual trigonometric functions for mD0: sn.uj0/Dsinu (3.130a) cn.uj0/Dcosu (3.130b) dn.uj0/D1 (3.130c) They are equal to hyperbolic functions for mD1: sn.uj1/Dtanh u (3.131a) cn.uj1/Dsech u (3.131b) dn.uj1/Dsech u (3.131c)98 3 Attitude Kinematics and Dynamics which give the solution for motion on the separatrices with 2EkDH2=J2. These solutions are not periodic, because the quarter-period is inﬁnite for mD1;t h e y approach pure rotation about the principal axis e2in the inﬁnite past and future. The speed at which the angular momentum vector moves over the sphere of radiusHin the body frame is also given by Eq. ( 3.102 ) in the triaxial case, but substituting Eq. ( 3.119 ) shows that the speed is not constant in this case. However, nice expressions can be found for the maximum and minimum speeds. The maximum, reached when !2D0or equivalently where the path of the angular momentum crosses the plane perpendicular to e2,i s kPHBkmaxD.J3/NULJ1/!1m!3m (3.132) The minimum, reached when j!2jobtains its maximum value on the path, is kPHBk2 minD.H2/NUL2J2Ek/.2J3Ek/NULH2/=.J2J3/ (3.133) The maximum speed has the same form as for an axisymmetric body, but the minimum speed is speciﬁc to the triaxial case. It is not difﬁcult to see thatthese equations give kPH BkD0for rotation about a principal axis, for which 2EkDH2=Jk. Solution of the kinematic equations proceeds in parallel with the axisymmetric case. We again specify the attitude by 3/NUL1/NUL3Euler angles and choose the inertial reference frame with its third axis in the direction of HI. Then Eq. ( 3.105 ) holds, and substituting Eq. ( 3.119 )g i v e s 2 4J1!1 J2!2 J3!33 5D2 4s1J1!1mcn/NUL u0C!ptjm/SOH /NULs1J2/DC4!1msn/NUL u0C!ptjm/SOH s3J3!3mdn/NUL u0C!ptjm/SOH3 5DH2 4sin sin/DC2 cos sin/DC2 cos/DC23 5 (3.134) Thus cos/DC2D.s3J3!3m=H/dn/NUL u0C!ptjm/SOH (3.135a) Datan2/NUL s1J1cn/NUL u0C!ptjm/SOH ;/NULs1J2/DC4sn/NUL u0C!ptjm/SOH/SOH (3.135b) The third Euler angle is found by integrating Eq. ( 3.38)u s i n gE q .( 3.42): P/RSDcsc/DC2.!1sin C!2cos /DHJ1!2 1CJ2!2 2 J2 1!2 1CJ2 2!2 2 DHJ3/NULJ2C.J2/NULJ1/sn2.u0C!ptjm/ J1.J3/NULJ2/CJ3.J2/NULJ1/sn2.u0C!ptjm/(3.136) The quantities /DC2;P , andP/RSare all time-varying for triaxial inertia.3.3 Attitude Dynamics 99 We complete the analysis of motion for triaxial inertia by ﬁnding the components of the angular velocity in the inertial frame. These are given by Eq. ( 3.112 ). Performing the matrix multiplications gives A.e1;/NUL/DC2/A. e3;/NUL /2 4!1 !2 !33 5DA.e1;/NUL/DC2/2 4.J2/NULJ1/!1!2=.H sin/DC2/ .J1!2 1CJ2!2 2/=.H sin/DC2/ !33 5 D1 H2 4.J2/NULJ1/!1!2csc/DC2 .J2 1!2 1CJ2 2!2 2//NUL1=2J1.J3/NULJ1/!2 1m!3 2Ek3 5(3.137) The component of !BI Iparallel to HIhas the constant value 2Ek=H, as required by Poinsot’s construction and as we saw for axial symmetry. The component of! BI Itransverse to HIhas a varying magnitude, so the herpolhode is not a circle. In fact, the herpolhode is not a closed curve in general, because the motion of /RSis not commensurate with that of /DC2and . It is not difﬁcult to see that all the equations for the triaxial case reduce to the axisymmetric results, with 0D.u0Cs1/EM=2/ ,i fJ1DJ2. 3.3.5 Internal Torques Although some spacecraft can be modeled as a single rigid body, many are more complex. These complexities can be of several types. The ﬁrst is that the spacecraft consists of a number of rigid bodies connected by joints having one, two, orthree degrees of rotational freedom, and sometimes admitting sliding motion as well. Powerful and general commercial software packages, many employing Kane’s method [ 15,16] are available to analyze the dynamics of these systems. We will only treat the simple cases of reaction wheels and control moment gyros, the more complex systems being beyond the scope of this text. The rigid model of a spacecraft will also be inadequate if we cannot ignore ﬂexibility, which is always present at some level. Analysis of ﬂexible body dynamics generally uses ﬁnite element methods [ 30], which are almost always applied to the analysis of large spacecraft but are also beyond the scope of this text. A third complication often encountered is ﬂuid motion, or slosh of liquid fuels or cryogens. We will only give a basic introduction to the treatment of slosh, with references to the literature. These internal torques are also known as momentum exchange torques because they result in, or are a result of, the exchange of angular momentum between components of complex spacecraft without a change in the net system momentum ofthe entire spacecraft. As the listing above indicates, some internal torques constitute undesirable disturbances, while others are provided by control mechanisms.100 3 Attitude Kinematics and Dynamics 3.3.5.1 Reaction Wheels and Control Moment Gyros Let us consider a spacecraft with nreaction wheels or control moment gyros, labeled by an index`. Each wheel rotates about its spin axis with an angular velocity !w ` with respect to the body. The wheel is axially symmetric about its spin axis, so the spin axis is a principal axis with principal moment of inertia Jk `, and every axis perpendicular to the spin axis is a principal axis with moment J? `.12Thus the inertia tensor of the`th wheel in the body reference frame is Jw `DJ? `.I3/NULw`wT `/CJk `w`wT ` (3.138) where the unit vector w`deﬁnes the spin axis in the body frame. Letting QJB represent the moment of inertia of the spacecraft without the wheels, the body frame representation of total angular momentum with respect to inertial space ofthe spacecraft with its wheels is H BDQJB!BI BCnX `D1Jw `.!BI BC!w `w`/ DJB!BI BCHw B (3.139) where JB/DC1QJBCnX `D1J? `.I3/NULw`wT `/ (3.140) and Hw BDnX `D1Jk `.w`/SOH!BI BC!w `/w`/DC1nX `D1Hw `w` (3.141) The body moment of inertia JBis deﬁned to include the inertia of the wheels transverse to their spin axes, but not their inertia along their spin axes. Note that Hw Bdenotes only the angular momentum of the wheels along their spin axes; the momentum of their transverse rotation is included in JB!BI B. The difference between reaction wheels and control moment gyros is that w`is ﬁxed and!w `is changing for reaction wheels, while !w `is constant and w`is moved by a gimbal (or gimbals) for control moment gyros. Some control wheels have been designed to vary both w`and!w `, but these have not been widely employed. 12This describes an ideal wheel. The effects of deviations from this ideal case will be discussed in Sect. 4.8.3.3 Attitude Dynamics 101 The rotational dynamics of the spacecraft with wheels are still described by Eq. (3.80) but with Eq. ( 3.79c ) replaced by !BI BDJ/NUL1 B.HB/NULHw B/ (3.142) where the superscript cis understood but has been omitted for economy of notation. For many attitude determination problems, !BI BandHw Bcan be computed from Eqs. ( 3.141 ) and ( 3.142 ) using tachometer data for reaction wheels or axis orientation data for control moment gyros.13To complete the dynamics analysis, however, a dynamic equation for Hw Bis required. The rotational kinetic energy of a spacecraft with reaction wheels or control moment gyros is given by EkD1 2.!BI B/TQJB!BI BC1 2nX `D1.!BI BC!w `w`/TJw `.!BI BC!w `w`/ D1 2.!BI B/TJB!BIBC1 2nX `D1Jk `.w`/SOH!BI BC!w `/2 D1 2.!BI B/TJB!BIBC1 2nX `D1.Jk `//NUL1.Hw `/2(3.143) Now let us specialize to reaction wheels, which have been more commonly employed in small to medium size spacecraft than control moment gyros. The representations in the body frame of the angular momenta of the wheels are the terms in the sum in Eq. ( 3.139 ). It follows that the equation of motion of the `th wheel in the body frame, using Eq. ( 3.138 ), is Jw `.P!BI BCP!w `w`/DQLw `/NUL!BI B/STXŒJw `.!BI BC!w `w`//c141 DQLw `CŒJ? `.w`/SOH!BI B//NULHw `/c141.!BI B/STXw`/ (3.144) whereQLw `is the applied torque. The other term on the right side of this equation is perpendicular to the spin axis; it is provided by the wheel bearings and is not under our direct control. Thus we are only interested in the spin axis component of thetorque, which is denoted by L w `and is given by Lw `DwT `Jw `.P!BI BCP!w `w`/DJk `.w`/SOHP!BI BCP!w `/DPHw ` (3.145) Then Eq. ( 3.141 )g i v e s14 13Giving!BI BD.JBCPn `D1Jk `w`wT `//NUL1.HB/NULPn `D1Jk `!w `w`/andHw BDHB/NULJB!BI B. 14Including an!BI B/STXHw Bterm in this equation would be double-counting, because this term was already accounted for in Eq. ( 3.144 ). It can be seen explicitly in Eq. ( 3.147 ).102 3 Attitude Kinematics and Dynamics PHw BDnX `D1PHw `w`DnX `D1Lw `w`/DC1Lw B (3.146) We ﬁnd the generalization of Eq. ( 3.81) to include reaction wheels by substituting this and Eq. ( 3.139 ) into Eq. ( 3.80), yielding P!BI BDJ/NUL1 BŒLB/NULLw B/NUL!BI B/STX.JB!BI BCHw B//c141 (3.147) The negative sign before Lw Bon the right side reﬂects Newton’s third law of motion. The rate of change of the kinetic energy is given by the derivative of Eq. ( 3.143 ), PEkD!BI B/SOHŒLB/NULLw B/NUL!BI B/STXHB/c141CnX `D1.w`/SOH!BI BC!w `/Lw` D!BI B/SOHLBCnX `D1!w `Lw`(3.148) This shows that the change in rotational kinetic energy is the sum of work done by the external torques and by the internal torques, a concrete illustration of the observation made near the end of Sect. 3.3.1 that internal forces can modify the energy of rotational motion. 3.3.5.2 Slosh Spacecraft often contain ﬂuids, the most common being propellants or cryogens for cooling scientiﬁc instruments. The motion of these ﬂuids, commonly called slosh , is often a source of undesirable attitude disturbances. Slosh is very difﬁcult to analyze, and we will only provide a very brief introduction to some of the issues;the monograph by Dodge provides a much more thorough discussion [ 8]. Fuel slosh can be a major problem for spin-stabilized spacecraft. In particular, the energy dissipated by sloshing liquid can destabilize the motion of a spacecraftspinning about an axis of minimum MOI, as discussed in Sect. 3.3.3.2 . Slosh is also a problem for repointing maneuvers of ﬁne-pointing spacecraft. A strong coupling of the ﬂuid motion to the rigid spacecraft can cause large pointing errors. Weakcoupling of the ﬂuid motion, on the other hand, leads to smaller pointing errors, but the perturbations take a correspondingly longer time to damp out. The resulting long resettling times after attitude maneuvers decrease the time available for ﬁne-pointing observations. The main dynamic effects of slosh result from the motion of the center of mass of the moving ﬂuid. This is usually represented by the mechanical modelof a pendulum or a mass on a spring to represent the motion of the ﬂuid, along with some mechanism to provide damping. Dodge presents methods for computing the frequencies and damping coefﬁcients for ﬂuid containers of various shapes,including a variety of bafﬂes, diaphragms, and ﬂuid management devices. The ﬁll factor of the container, the ratio of the amount of ﬂuid contained to the capacity of3.3 Attitude Dynamics 103 the full tank, is a critical factor. Slosh is much less of a factor for a nearly full tank, because the center of mass cannot move much, or for a nearly empty tank, because there is less moving mass. Fluid motion in microgravity is different from motion under acceleration forces. The relative importance of inertia forces, gravity forces, and capillary forces on ﬂuid motion are characterized by the Bond number ,t h e Weber number , and the Froude number , while the Reynolds number determines the importance of viscosity. All these considerations are important for providing a slosh model from ﬁrst principles, but it is quite common for the parameters in a slosh model to be determinedempirically. 3.3.6 External Torques External torques involve an interaction with entities external to the spacecraft. As opposed to internal torques, external torques change the overall momentum of the spacecraft. In common with internal torques, external torques include bothundesirable disturbance torques and torques deliberately applied for control. 3.3.6.1 Gravity-Gradient Torque Any nonsymmetrical rigid body in a gravity ﬁeld is subject to a gravity-gradient torque. We compute this torque by summing the contributions of the gravitational forces on the various point masses constituting the rigid body as in Eq. ( 3.57). The gravitational force on the ith particle is F iextDmig.ri0/DmirrU.r/jrDri0 (3.149) whereU.r/is the gravity potential.15Assuming that only ﬁrst-order variations in the gravitational ﬁeld over the rigid body are signiﬁcant allows us to expand in a power series, retaining only the ﬁrst two terms: FiextDmig.ricCrc0/DmiŒg.rc0/CG.rc0/ric/c141 (3.150) where G.rc0//DC1@g.r/ @rˇˇˇˇ rDrc0D@2U.r/ @r@rTˇˇˇˇ rDrc0(3.151) 15As is customary in astrodynamics, this is the negative of the potential energy.104 3 Attitude Kinematics and Dynamics is the gravity-gradient tensor, evaluated at the center of mass. It follows from Eq. (3.151 ) that the gravity-gradient tensor is a symmetric 3/STX3matrix. Substituting into Eq. ( 3.57) gives the gravity-gradient torque about the center of mass as Lc ggDnX iD1miric/STX/STX g.rc0/CG.rc0/ric/ETX D nX iD1miric! /STXg.rc0/CnX iD1miric/STX/STX G.rc0/ric/ETX DnX iD1miric/STX/STX G.rc0/ric/ETX (3.152) using the property of the center of mass expressed in Eq. ( 3.55). It is usually adequate to approximate the gravity ﬁeld as spherically symmetric for computing gravity-gradient torques. In this case, we have g.r/D/NUL/SYNr r3(3.153) and therefore G.r/D/NUL/SYN r3/DC2 I3/NUL3rrT r2/DC3 (3.154) where/SYNis the gravitational parameter of the central body, the product of its mass and Newton’s universal gravitational constant, ris the radius vector from the center of the central body, and r/DC1krk. Inserting this into Eq. ( 3.152 ), letting rc0D/NULrn, where nis the body frame representation of a nadir-pointing unit vector, and using various identities for dot and cross products gives Lc ggD/NUL/SYN r3nX iD1miric/STX/NUL ric/NUL3nnTric/SOH D/NUL3/SYN r3n/STXnX iD1mi.ric/.ric/Tn D3/SYN r3n/STXnX iD1mi/STX krick2I3/NUL.ric/.ric/T/ETX nD3/SYN r3n/STX.Jcn/ (3.155) whereJcis the moment of inertia tensor about the center of mass. Several properties of the gravity-gradient torque are apparent from this equation: its magnitude is inversely proportional to the cube of the distance from the center of the centralbody, its direction is perpendicular to the radius vector from the central body, and it vanishes if the radius vector is along any principal axis of inertia. To investigate the gravity-gradient torque in more detail, consider a spacecraft orbiting the Earth (or any celestial body) and oriented to the nadir. We represent the3.3 Attitude Dynamics 105 attitude relative to the LVLH frame16by a3/NUL2/NUL1Euler angle sequence of yaw D/RS, pitchD/DC2, and rollD angles. The nadir vector is the e3axis in the LVLH frame, so the nadir vector in the body frame is given by Eq. ( 2.164 )a s nDA321./RS;/DC2; /2 40 013 5D2 4/NULsin/DC2 cos/DC2sin cos/DC2cos 3 5 (3.156) Substituting this into Eq. ( 3.155 ) and assuming that the body frame is a principal axis frame gives L c ggD3/SYN r32 4.J3/NULJ2/cos2/DC2cos sin .J3/NULJ1/cos/DC2sin/DC2cos .J1/NULJ2/cos/DC2sin/DC2sin 3 5 (3.157) We notice that the torque does not depend on the yaw angle, which is one of the reasons for choosing a 3/NUL2/NUL1sequence to specify the attitude.17The yaw angle can be quite large for some missions, with 180ıyaw maneuvers used to keep one side of the spacecraft cool by facing it away from the Sun. The roll and pitch anglesare usually small, though, and almost certainly less than 90 ıin magnitude. It is clear that the gravity-gradient torque vanishes if the roll and pitch are both zero, so this is an equilibrium conﬁguration. For small pitch and roll angles, the third (yaw)component of the gravity-gradient torque is small, so we will not be concerned with it. Comparing Eqs. ( 3.156 ) and ( 3.157 ) shows that the ﬁrst (roll) component of the gravity-gradient torque will drive the roll angle toward zero if J 3<J2and away from zero if J3>J2. Similarly, the second (pitch) component of the gravity- gradient torque will drive the pitch angle toward zero if J3<J1and away from zero ifJ3>J1. Thus the equilibrium at zero roll and pitch is a stable equilibrium if J3 is the smallest principal moment, otherwise the equilibrium is unstable for rotations about one or both axes. Another way of stating this is that gravity-gradient torque will tend to align a spacecraft with its principal axis of minimum inertia alignedwith the nadir vector. Gravity-gradient torques are often used for passive stabilization of a spacecraft. Agravity-gradient boom with a mass at the end can be deployed along the positive or negative yaw axis to increase the J 1andJ2moments of inertia relative to theJ3inertia about the desired nadir-pointing axis. The boom deployment must be carefully timed to avoid an inverted orientation, with the desired nadir-pointingaxis pointing in the zenith direction. Pendular motions, known as libration , can be damped out by energy-dissipating libration dampers , which are very similar in design and function to nutation dampers. Finally, we note that the gravity-gradienttorque cannot provide stability against rotations around the nadir vector. These are controlled either by active means or by employing a momentum wheel to provide a 16The LVLH frame is deﬁned in Sect. 2.6.4 . 17A3/NUL1/NUL2sequence would serve as well.106 3 Attitude Kinematics and Dynamics momentum bias along the pitch axis. Issues arising from the deployment of gravity- gradient booms are described on pp. 669–677 of [ 19]. To handle cases more general than a spherically symmetric gravity ﬁeld, we can use Eq. ( 2.56c ) to ﬁnd an expression for the gravity-gradient torque for a general gravity-gradient tensor. This identity gives, suppressing the argument of Gfor notational convenience, ŒLc gg/STX/c141DnX iD1miŒ.ric/STXGric//STX/c141DnX iD1miŒGric.ric/T/NULric.Gric/T/c141 DnX iD1mi/STX krick2I3/NUL.ric/.ric/T/ETX GT/NULGnX iD1mi/STX krick2I3/NUL.ric/.ric/T/ETX D.GJc/T/NULGJc(3.158) making use of Eq. ( 2.7c) and the fact that both GandJcare symmetric. 3.3.6.2 Magnetic Torque The torque generated by a magnetic dipole min a magnetic ﬁeld Bis LmagDm/STXB (3.159) The most basic source of a magnetic dipole is a current loop. A current of Iamperes ﬂowing in a planar loop of area Aproduces a dipole moment of magnitude mDIA in the direction normal to the plane of the loop and satisfying a right-hand rule.It follows from this deﬁnition that the natural unit for the dipole moment is Am When mis in Am2and the magnetic ﬁeld is speciﬁed in Tesla, Eq. ( 3.159 )g i v e s the torque in Nm. If there are Nturns of wire in the loop, the dipole moment has magnitude mDNIA . The dipole moment can be signiﬁcantly increased by wrapping the wire loops around a ferromagnetic core, as will be discussed in Sect. 4.10. Magnetic control torques are used almost exclusively in near-Earth orbits, where the magnitude of the Earth’s magnetic ﬁeld is roughly in the range of 20–50 /c157T. Commercially available torquers can provide dipole moments from 1 to 1,000 Am2, so the resulting magnetic control torques range from 2/STX10/NUL5to 0.05 Nm. As described in Sect. 11.1, the ﬁeld strength falls off as the inverse cube of the distance from the center of the Earth, so magnetic control has rarely been employedin higher orbits, but it has sometimes been used even in geosynchronous orbits. Undesirable magnetic dipoles can lead to magnetic disturbance torques, which are generally several orders of magnitude smaller than the above estimates of controltorques. It is customary to express L mag,m, and Bin body-frame coordinates. There are two ways to determine the body-frame magnetic ﬁeld. The ﬁrst employs3.3 Attitude Dynamics 107 measurements by an onboard three-axis magnetometer (TAM), as described in Sect. 4.5. The other method is to compute the magnetic ﬁeld vector, R, in reference- frame coordinates from a model, either a simple dipole model, the InternationalGeomagnetic Reference Field (IGRF), or some truncated version of the IGRF, as described in Sect. 11.1. The attitude matrix then rotates the ﬁeld to the body frame byBDAR. In addition to an attitude estimate, this method requires an onboard ephemeris, which in modern spacecraft would be provided by GPS, as well as an onboard magnetic ﬁeld model. One advantage of magnetic torques is that they produce no force, so they do not perturb the spacecraft’s orbit. A signiﬁcant disadvantage is that the torques are constrained to lie in the plane orthogonal to the magnetic ﬁeld, as is clear from Eq. (3.159 ), so only two out of three axes can be controlled at a given time instant. However, full three-axis control is available over a complete orbit provided that the spacecraft’s orbital plane does not coincide with the geomagnetic equatorial plane and does not contain the magnetic poles [ 3]. The Earth’s rotation causes this geometry to change, so any simulation involving magnetic control should be at least 24 h in length to ensure that unfavorable magnetic ﬁeld geometry does not cause a problem at some point. 18 Because magnetic torques cannot provide three-axis control at any instant of time, they are generally employed in conjunction with some other form of attitude control. This can be passive control, such as spin stabilization [ 9,11,13,23]o r gravity-gradient stabilization [ 7,28,29], but it is more common to employ magnetic control in conjunction with reaction wheels. In this application, the wheels provide the actual pointing and maneuvering torques, and magnetic torques are used tounload the secular angular momentum buildup in the wheels. Reference [ 6] provides an analysis of the orbit-averaged behavior of magnetic control for unloading angular momentum. Some speciﬁc examples of magnetic control laws can be found inChap. 7. 3.3.6.3 Aerodynamic Torque For objects in low-Earth orbit, atmospheric drag is a signiﬁcant source of perturbing torque. Aerodynamic torque is generally computed by modeling the spacecraft as a collection of Nﬂat plates of area S iand outward normal unit vector ni Bexpressed in the spacecraft body-ﬁxed coordinate system. The torque depends on the velocityof the spacecraft relative to the atmosphere. This is not simply the velocity of the spacecraft in the GCI frame, because the atmosphere is not stationary in that frame. The most common assumption is that the atmosphere co-rotates with the Earth. Therelative velocity in the GCI frame is then given by v relIDvICŒ!˚I/STX/c141rI (3.160) 18This point was often emphasized by Henry Hoffman of Goddard Space Flight Center.108 3 Attitude Kinematics and Dynamics where rIandvIare the position and velocity of the spacecraft expressed in the GCI coordinate frame. The Earth’s angular velocity vector is !˚ID!˚Œ 001 /c141Twith !˚D0:000072921158553 rad/s. Inserting this !˚Igives the relative velocity in the body frame as vrelBDA2 4PxC!˚y Py/NUL!˚x Pz3 5 (3.161) whereAis the attitude matrix. The inclination of the ith plate to the relative velocity is given by cos/DC2i aeroDni B/SOHvrelB kvrelk(3.162) The aerodynamic force on the ith plate in the ﬂat plate model is Fi aeroD/NUL1 2/SUBCDkvrelkvrelBSimax/NUL cos/DC2i aero;0/SOH (3.163) where/SUBis the atmospheric density and CD, is a dimensionless drag coefﬁcient .T h e drag coefﬁcient is determined empirically, and is usually in the range between 1.5and 2.5. Methods for computing the atmospheric density are presented in Sect. 11.2. The aerodynamic torque on the spacecraft is then L i aeroDNX iD1ri/STXFi aero (3.164) where riis the vector from the spacecraft center of mass to the center of pressure of theith plate. Note this algorithm does not account for potential self-shielding that would exist on concave spacecraft. In principle, aerodynamic torques could be used for attitude control, either for passive control like the feathers on an arrow, or even for active control by providing movable surfaces. Applications of this concept have been exceedingly rare, however. 3.3.6.4 Solar Radiation Pressure Torque Solar radiation pressure (SRP) is another source of disturbance torque. In low- Earth orbit, the effect of SRP is dominated by aerodynamics, but SRP torques will generally dominate aerodynamic torques in higher altitude orbits ( /NAK800 km). The SRP torque is zero when the spacecraft is in the shadow of the Earth or any otherbody, of course. In contrast to the case of aerodynamic torques, movable surfaces have been used on some spacecraft in geosynchronous orbits to balance the SRP torques. In most applications, the surfaces have been moved by daily commands,and not controlled autonomously or in real time by an onboard computer [ 12].3.3 Attitude Dynamics 109 As for aerodynamic torque, we model the surface of the spacecraft as a collection of Nﬂat plates of area Si, outward normal ni Bin the body coordinate frame, specular reﬂection coefﬁcient Ri spec, diffuse reﬂection coefﬁcient Ri diff, and absorption coefﬁcient Ri abs. Diffuse reﬂection is assumed to be Lambertian, which means that the intensity of the reﬂected light in any direction is proportional to thecosine of the angle between the reﬂection direction and the normal. The coefﬁcients sum to unity; R i specCRi diffCRi absD1. The spacecraft-to-Sun unit vector in the body frame is sDAesatˇ (3.165) whereAis the attitude matrix and esatˇis the spacecraft-to-Sun vector in the GCI frame. The angle between the Sun vector and the normal to the ith plate is given by cos/DC2i SRPDni B/SOHs (3.166) The SRP force on the ith plate can then be expressed as [ 26] FSRPD/NULPˇSi/DC4 2/DC2Ri diff 3CRi speccos/DC2i SRP/DC3 ni BC.1/NULRi spec/s/NAK max/NUL cos/DC2i SRP;0/SOH (3.167) wherePˇis the solar radiation pressure. Section 11.3 present methods for comput- ing the Sun position, solar radiation pressure, and conditions for shadowing. The SRP torque on the spacecraft is then Li SRPDNX iD1ri/STXFi SRP (3.168) where riis the vector from the spacecraft center of mass to the center of pressure of the SRP on the ith plate. This formulation has several limitations. First, the Sun is not the only source of radiation, although it is by far the largest for Earth-orbiting spacecraft. Reﬂectedlight from the Earth or the Moon, called albedo , can be signiﬁcant if very precise dynamical modeling is required; and models incorporating this effect have been developed [ 4]. Secondly, the torque due to thermal radiation emitted from the spacecraft has been ignored. A spacecraft is usually in a long-term energy balance, so all the absorbed radiation is emitted as thermal radiation, although not necessarily atthe same time or from the same surface as its absorption. Accurate modeling of thermal radiation requires knowledge of the absolute temperature T iand emissivity /SIi(a dimensionless constant between 0 and 1) of each surface. Then the thermal radiation ﬂux from the surface is given by the Stefan-Boltzmann law Fi thermalD/SIi/ESCT4 i (3.169)110 3 Attitude Kinematics and Dynamics where/ESCD5:67/STX10/NUL8Wm/NUL2K/NUL4is the Stefan-Boltzmann constant. If the thermal radiation from every surface is Lambertian, it gives rise to a net torque LthermalD/NUL2 3NX iD1Fi thermalSi.ri/STXni B/ (3.170) Thermal radiation torque can usually be neglected because the thermal ﬂux is emitted roughly equally in all directions, so that the net torque is small. Finally, Eqs. ( 3.168 ) and ( 3.170 ) ignore potential self-shadowing of concave spacecraft. If the conﬁguration of the spacecraft is known a priori, self-shadowing can be taken into account by replacing Siwith the area of the ﬂat plate that is visible to the Sun after accounting for shadowing. Modeling the effects of reﬂected radiation or thermal radiation from one surface striking another surface is an additional complication. Another drawback to Eq. ( 3.167 ) is that it is only valid for a collection of ﬂat surfaces with uniquely deﬁned outward normals. Most real spacecraft have some curved surfaces, and accurately approximating these surfaces by a collection of ﬂat plates causes the size of the model to grow, increasing thecomputational burden. 3.3.6.5 Mass-Expulsion Torques Translational momentum is the product mvof mass and velocity. We generally think of a force producing a rate of change of momentum mPv. Mass-expulsion forces, on the other hand, are the result of a change of momentum F mexpD/NULPmvrel, wherePm is the rate at which mass is expelled, and vrelis the velocity of the expelled mass relative to the spacecraft. Newton’s third law of motion gives the negative sign, because this is a reaction force on the spacecraft. Another way to state this is to say that the mass-expulsion force reﬂects the conservation of momentum of the systemconsisting of the spacecraft and the expelled mass. Mass-expulsion forces provided by thrusters can be used to adjust the trajectories of spacecraft that require such corrections. A mass-expulsion force will generally be accompanied by a torque L mexpDr/STXFmexpD/NULPmr/STXvrel (3.171) where ris the vector from the spacecraft center of mass to the point where the mass is expelled. Undesirable mass-expulsion torques during orbit maneuvers canbe minimized either by requiring the line of action of the thrust to pass through the spacecraft’s center of mass or by using multiple thrusters whose torques cancel. It is impossible in practice to ensure exact cancelation, however. Thrusters can also be used speciﬁcally as sources of torque. Attitude control thrusters are generally much smaller than orbit adjustment thrusters, because atti- tude control requires less force. An advantage of using thrusters for attitude control3.3 Attitude Dynamics 111 is that they can be used anywhere, unlike magnetic torquers or gravity-gradient booms that require an ambient magnetic or gravitational ﬁeld. They have the disadvantage of requiring expendable propellant, which can often be the elementlimiting the lifetime of a mission. Another disadvantage is that attitude control thrusters are accompanied by orbit-perturbing forces unless their forces are arranged in exact couples, equal and opposite pairs, which are impossible to attain in practice. Use of thrusters for attitude control will be considered in more detail in Sect. 4.11 and Chap. 7, so this section will concentrate on mass-expulsion torques as a disturbance source. One source already mentioned is residual torques from orbitmaneuvers, which can result from thruster misalignments or from impingement of thruster plumes on the spacecraft structure. Other common sources are outgassing of water vapor from the spacecraft structure during early stages of a mission orventing of cryogens. These can be minimized by arranging the vents to provide cancelation of the torques. Disturbances can also result from leaks of fuel, fuel pressurizing agents, or air from pressurized compartments, as on the InternationalSpace Station [ 18]. The Wilkinson Microwave Anisotropy Probe (WMAP) provided an interesting example of a mass-expulsion torque [ 25]. WMAP had a warm Sun-facing side and a cold side separated by a Sun shield of radius 2.5 m (see Fig. 7.4). Shortly after launch, WMAP executed three highly elliptical orbits with periods of approximately 7 days and with perigees on the sunlit side of the Earth. WMAP’s attitude wasinertially ﬁxed prior to planned orbit adjustments at the perigees. About 40 min before the ﬁrst perigee passage, the spacecraft angular momentum began to increase, peaking at about 2 Nms approximately 20 min before perigee and then decreasing.Various mechanisms for this anomalous torque were considered and rejected. The ﬁnal explanation was that water vapor outgassing from the spacecraft had condensed on the cold side of the Sun shield as ice while WMAP was on the dark side of theEarth and had sublimated, ﬁrst from one half of the Sun shield and then from the other, when the cold side was subjected to reﬂected sunlight from the Earth near perigee. The average velocity of the sublimated water molecules was estimated,assuming a temperature of 150 K, to be v relDp 2kBT=mH2OD370 m/s (3.172) wherekBD1:38/STX10/NUL23J/K is the Boltzmann constant and mH2OD3/STX10/NUL26kg is the mass of a water molecule. Assuming an average lever arm of RD1:1m, the quantity of sublimated ice required to explain the anomalous torque is only /SOHmD /SOHH=Rv relD5g. 3.3.7 Angular Momentum for Health Monitoring We have emphasized that internal momentum-exchange torques can lead to rapid variation of a spacecraft’s angular velocity, but not of the system angularmomentum. This insight led to an application of angular momentum conservation112 3 Attitude Kinematics and Dynamics for spacecraft failure detection [ 21]. A computer onboard the Hubble Space Telescope (HST) calculates the total system angular momentum HBby means of Eqs. ( 3.139 )–(3.141 ), with the angular velocity being sensed by the gyros and the wheel angular momentum computed using wheel tachometer data. The high torque of the reaction wheels can cause both the wheel angular momentum and the body angular momentum to change rapidly, but their vector sum only changes slowly.Subtracting easily computable gyroscopic, magnetic, and gravity-gradient torques from the rate of change of the computed system momentum gives an apparent disturbance torque: L disturbanceDPHBC!/STXHB/NULm/STXB/NULLgg (3.173) with all the vectors computed in the spacecraft body frame. A large value of this disturbance torque indicates a failure of either a reaction wheel tachometer or a gyro. A tachometer failure could be identiﬁed by an independent test, so thisangular momentum test was implemented onboard HST to identify gyro failures. The test initiated entry to a gyroless safehold mode three times in late 2002 and early 2003 [ 22]. 3.3.8 Dynamics of Earth-Pointing Spacecraft A great many spacecraft are pointed at the Earth to study its weather, climate, and resources. Thus it is useful to consider the special case of Earth-pointing spacecraft, whose body axes are closely aligned with the LVLH frame deﬁned in Sect. 2.6.4 . The attitudeABOspecifying the orientation of the spacecraft body axes to the axes of the LVLH frame, denoted by index O, is conveniently described by a 3/NUL2/NUL1 Euler sequence of yaw D/RS, pitchD/DC2, and rollD angles. The dynamic equations give the motion relative to an inertial frame, so we write ABIDABOAOIand use the Eq. ( 3.12) with the appropriate assignment of frame indices to ﬁnd !BI B. The matrixABOis given by Eq. ( 2.164 ), so Eq. ( 3.43)g i v e st h e components of !BO B. The matrixAIOi sg i v e nb yE q .( 2.79), so Eq. ( 3.3) can be used to ﬁnd the angular velocity of the Oframe with respect to the Iframe: /NULŒ!OI O/STX/c141DPAOIAT OIDPAT IOAIOD2 4PoT 1I PoT 2I PoT 3I3 5/STX o1Io2Io3I/ETX D2 4Po1I/SOHo1IPo1I/SOHo2IPo1I/SOHo3I Po2I/SOHo1IPo2I/SOHo2IPo2I/SOHo3I Po3I/SOHo1IPo3I/SOHo2IPo3I/SOHo3I3 5 (3.174) Considering the derivatives of oiI/SOHojIDıijconﬁrms that this 3/STX3matrix is skew- symmetric. The inner products are frame-independent, but the subscript Iis needed3.3 Attitude Dynamics 113 to specify the frame used for differentiation. We substitute Eq. ( 2.78) and carry out some tedious but straightforward vector algebra to ﬁnd the angular velocity of the LVLH frame relative to the inertial frame as !OI OD2 4/NULPo3I/SOHo2I Po3I/SOHo1I /NULPo2I/SOHo1I3 5D2 4.Pg3rICg3vI//SOHo2I /NUL.Pg3rICg3vI//SOHo1I .Pg2rI/STXvICg2rI/STXPvI//SOHo1I3 5 D2 40 /NULkrI/STXvIk=krIk2 krIk.o2I/SOHPvI/=krI/STXvIk3 5 (3.175) The roll component of this angular velocity is zero, and the yaw component is also zero if the spacecraft’s acceleration PvIis perpendicular to o2I, as it is for a purely central force. As shown in Sect. 10.4.3 , a non-central force causes the orbit plane to precess, producing a small but ﬁnite yaw rotation rate. The pitch component of !OI O is by far the largest. We can obtain the attitude motion in the general case by solving the dynamic equations from Sect. 3.3.2 with!BI Bgiven by the procedure described above. However, it is useful to study the special case of uncontrolled attitude motion in a nearly circular Keplerian orbit with only small excursions from perfect alignmentwith the LVLH coordinate frame. Applying Eqs. ( 10.32 ), (10.39 ), (10.40 ), (10.15 ), and ( 10.43 ) of Chap. 10to the pitch component of ! OI Oshows that krI/STXvIk=krIk2Dn.1/NULe2//NUL3=2.1Cecos/ETB/2(3.176) wherenis the mean motion, eis the eccentricity, /ETBis the true anomaly. Now we ignore all terms of higher than ﬁrst order in the Euler angles, their rates, and the eccentricity, and we approximate the cosines of the Euler angles by unity and their sines by the angles themselves. With these approximations,Eqs. ( 3.12), (3.43), (2.164 ), and ( 3.176 )g i v e ! BI BD!BO B/NULkrI/STXvIk=krIk22 4cos/DC2sin/RS cos cos/RSCsin sin/DC2sin/RS /NULsin cos/RSCcos sin/DC2sin/RS3 5 /EM2 4P P/DC2 P/RS3 5/NULn.1C2ecos/ETB/2 4/RS 1 /NUL 3 5/EM2 4P /NULn/RS P/DC2/NULn.1C2ecos/ETB/ P/RSCn 3 5 (3.177) The ﬁrst and third components of this equation exhibit the phenomenon of roll/yaw coupling. If we assume that the roll and yaw components of !BI Bare exactly zero, we haveP Dn/RSandP/RSD/NULn , with the solution .t/D .t0/cosn.t/NULt0/C/RS.t0/sinn.t/NULt0/ (3.178a) /RS.t/D/RS.t0/cosn.t/NULt0//NUL .t0/sinn.t/NULt0/ (3.178b)114 3 Attitude Kinematics and Dynamics Direction of MotionOrbital PlaneH H Fig. 3.6 Roll/yaw coupling Thus a positive yaw becomes a positive roll one quarter orbit later and a negative yaw a quarter orbit after that, etc., which is why roll/yaw coupling is also knownas quarter-orbit coupling. Figure 3.6illustrates this effect, where Hindicates the orientation of the spacecraft’s total rotational angular momentum, which is assumed to be directed along the spacecraft’s negative pitch axis but not exactly perpen-dicular to the orbit plane. Angular momentum conservation keeps the direction of this momentum ﬁxed in inertial space, thereby ensuring that the roll and yaw components of ! BI Bremain small. Let us now investigate the dynamic equations of motion, assuming that a reaction wheel, or possibly a combination of several wheels, provides a constant angular momentum bias halong the pitch axis. This is a common method for enhancing the roll/yaw coupling effect. Differentiating Eq. ( 3.177 ) and substituting Eq. ( 3.147 ) with Lw BD0as required by Eq. ( 3.146 )g i v e s 2 4R /NULnP/RS R/DC2C2en2sin/ETB R/RSCnP 3 5DJ/NUL1 BŒLB/NUL!BI B/STX.JB!BI BChe2//c141 (3.179) This makes the further approximation P/ETBDn, ignoring terms that would be of order e2in Eq. ( 3.179 ). Next assume that the body axes are principal axes and that the only signiﬁcant external torque is the gravity-gradient torque, given by Eq. ( 3.157 ). Applying Eqs. ( 10.20 ) and ( 10.43 ) of Chap. 10shows that /SYN r3Dn2/DC21Cecos/ETB 1/NULe2/DC33 (3.180) We make the small-angle approximation for the trigonometric functions and ignore products of the eccentricity and the small angles, giving LBDLggD3n22 4.J3/NULJ2/ .J3/NULJ1//DC2 03 5 (3.181)3.3 Attitude Dynamics 115 Substituting Eq. ( 3.177 ) for the components of !BI Bon the right side of Eq. ( 3.179 ), ignoring second-order terms in small quantities, and collecting terms gives J1R DnŒ4n.J3/NULJ2/Ch/c141 CŒn.J1/NULJ2CJ3/Ch/c141P/RS (3.182a) J2R/DC2D3n2.J3/NULJ1//DC2/NUL2en2J2sin/ETB (3.182b) J3R/RSDnŒn.J1/NULJ2/Ch/c141/RS/NULŒn.J1/NULJ2CJ3/Ch/c141P (3.182c) The ﬁrst property of these equations to notice is that pitch motion is decoupled from the roll and yaw motion. The pitch equation gives unstable motion with linear growth ifJ1DJ3and unstable motion with exponential growth if J1<J3, so pitch stability demands that J1>J3. With the approximation P/ETBDn, the solution for J1>J3is found to be /DC2D/DC2libcos.!libtC˛/C2en2 n2/NUL!2 libsin/ETB (3.183) where/DC2liband˛are constants of integration, and !libDnp 3.J1/NULJ3/=J2 (3.184) is the libration frequency. The ﬁrst term on the right side of Eq. ( 3.183 )i st h e libration term, describing a pendular motion at the libration frequency. The second term gives a sinusoidal error at the orbit rate in a non-circular orbit, a result of the conﬂicting tendencies of rotational inertia to keep the pitch rate constant andof gravity-gradient torque to keep the yaw axis pointing along the nadir. This term grows very large near the pitch resonance case of ! libDn, which must be avoided.19 Its amplitude for the GEOS-3 spacecraft, with eD0:0054 , was 0.03ı[27]. Now consider the roll/yaw dynamics expressed in Eqs. ( 3.182a ) and ( 3.182c ). The general solution of these two coupled second-order linear differential equation is a superposition of four components of the form /DC4 .t/ /RS.t//NAK D/DC4 .0/ /RS.0//NAK est(3.185) with coefﬁcients satisfying initial conditions. Substituting Eq. ( 3.185 ) into the roll/yaw dynamics gives a result expressible in matrix form as /DC4J1s2CnŒ4n.J2/NULJ3//NULh/c141 Œn.J 2/NULJ1/NULJ3//NULh/c141s /NULŒn.J2/NULJ1/NULJ3//NULh/c141s J3s2CnŒn.J2/NULJ1//NULh/c141/NAK/DC4 .0/ /RS.0//NAK estD0 (3.186) 19In the exact resonance case, Eq. ( 3.182b ) has the growing solution /DC2Dentcos/ETB.116 3 Attitude Kinematics and Dynamics This has a nontrivial solution only if the determinant of the 2/STX2matrix is zero, which means that J1J3s4Cbs2CcD0 (3.187) where bDŒn.J2/NULJ1/NULJ3//NULh/c1412CnJ3Œ4n.J2/NULJ3//NULh/c141CnJ1Œn.J2/NULJ1//NULh/c141 (3.188a) cDn2Œ4n.J2/NULJ3//NULh/c141Œn.J2/NULJ1//NULh/c141 (3.188b) Stable motion in roll and yaw requires that none of the roots of Eq. ( 3.187 ) has a positive real part. It is clear that if sis a root, then/NULsis also a root, so stability requires all the roots to be purely imaginary numbers. The well-known solution of Eq. (3.187 )i s 2J1J3s2D/NULb˙p b2/NUL4J1J3c (3.189) Both of the solutions, s2,o fE q . ( 3.189 ) must be real and negative, with purely imaginary square roots, for roll/yaw stability. This will hold if and only if c>0 andb/NAK2p J1J3c (3.190) The ﬁrst of these conditions is easier to satisfy; we see from Eq. ( 3.188b ) that it requires h>n max.4.J2/NULJ3/;.J2/NULJ1//or (3.191a) h<n min.4.J2/NULJ3/;.J2/NULJ1// (3.191b) The second condition is harder to analyze, but a large enough positive or negative momentum bias hcan provide roll/yaw stabilization for any moments of inertia, becausebtends asymptotically to h2, whilecis asymptotic to n2h2.I nt h i s asymptotic limit Eq. ( 3.189 ) becomes 2J1J3s2D/NULh2/DLE 1˙p 1/NUL4J1J3n2=h2/DC1 /EM/NULh2Œ1˙.1/NUL2J1J3n2=h2//c141 /EM( /NUL2h2 /NUL2J1J3n2(3.192) Comparison of the ﬁrst root, !Dp /NULs2Dh=pJ1J3, with Eq. ( 3.109 ) identiﬁes this as a nutation frequency. The second root gives !Dn, the frequency of the quarter-orbit roll/yaw coupling. These two frequencies do not separate as cleanly for general moments of inertia and bias angular momentum.3.3 Attitude Dynamics 117 −1−0.75 −0.5−0.25 00.25 0.50.75 1−1−0.75−0.5−0.2500.250.50.751 J3<J1<J2 DD Fig. 3.7 Stability region map for gravity-gradient stabilization. Unshaded areas are regions of stable motion. The label DD identiﬁes the DeBra-Delp region. Areas with horizontal hatching are unstable in roll and yaw; those with vertical hatching are unstable in pitch. The dotted line is the locus of the pitch orbital eccentricity resonance We now investigate stability in the case of hD0, a spacecraft with only gravity- gradient stabilization, which has been analyzed in detail. In this case, Eq. ( 3.188 ) reduces to bDJ1J3n2.1C3/DC41C/DC41/DC43/ (3.193a) cD4J1J3n4/DC41/DC43 (3.193b) where /DC41/DC1.J2/NULJ3/=J1and/DC43/DC1.J2/NULJ1/=J3 (3.194) The triangle inequality for principal moments of inertia, Eq. ( 3.73), implies that /NUL1</DC41<1 and/NUL1</DC43<1. Note that/DC41D0for axially-symmetric inertia about the roll axis, /DC43D0for symmetry about the yaw axis, and /DC41D/DC43for symmetry about the pitch axis. Figure 3.7shows the stability regions in terms of these variables in the hD0 case. The requirements for roll/yaw stability in this case are simply /DC41/DC43>0 and1C3/DC41C/DC41/DC43/NAK4p/DC41/DC43 (3.195)118 3 Attitude Kinematics and Dynamics These two requirements together demand that /DC41>/NUL1=3. Squaring the second requirement and collecting terms gives the quadratic inequality .3C/DC43/2/DC42 1C2.3/NUL7/DC43//DC41C1/NAK0 (3.196) The roots of the equality are /DC41D.3C/DC43//NUL2Œ.7/DC43/NUL3˙4p 3/DC43./DC43/NUL1//c141 (3.197) Neither root is real if 0</DC43<1, so the inequality of Eq. ( 3.196 ) is satisﬁed for any/DC41. Thus both parts of Eq. ( 3.195 ) are satisﬁed and roll/yaw stability is assured for 0</DC43<1 and0</DC41<1 (3.198) The roots of Eq. ( 3.197 ) are real if/DC43<0, with the consequence that roll/yaw stability requires /DC41to be either greater than the larger root or less than the smaller root. The smaller root is never greater than /NUL1=3, though, so the only roll/yaw stability region for negative /DC43is /NUL1</DC43<0 and.3C/DC43//NUL2Œ.7/DC43/NUL3C4p 3/DC43./DC43/NUL1//c141/DC4/DC41<0 (3.199) This region, called the DeBra-Delp region [ 2], hasJ2<J3<J1.I th a sr a r e l y been employed in practice; almost all gravity-gradient-stabilized spacecraft are inthe range of inertia values speciﬁed by Eq. ( 3.198 ), i.e.J 3<J1<J2. It is always possible, and sometimes necessary, to supplement passive stabiliza- tion with active control using thrusters, magnetic torquers or reaction wheels. Activecontrol effort can be minimized by starting with a stable conﬁguration, however. A single pitch wheel can be used to control pitch and even to stabilize the pitch dynamics ifJ 1/DC4J3. Roll/yaw coupling means that only two wheels are needed for three-axis control. Quite often the two wheels are slightly misaligned from the pitch axis so they can provide the momentum bias and also torques on two axes by commanding them in the same or opposite directions. GOES I-M, for instance, hadtwo 51 Nms wheels with their spin axes tilted 1:66 ıin the positive and negative yaw directions from the negative pitch axis [ 24]. A much smaller 2.1 Nms wheel with its spin axis along yaw protected against failure of one of the two larger wheels. Problems 3.1. Consider the Hill frame shown in Fig. 2.8. The deputy position expressed in Hill frame coordinates, denoted by rdhill, is given by rdhillDrchillC/SUBhillD.rcCx/orCyo/DC2CzohProblems 119 where rchillis the chief position vector expressed in Hill frame coordinates, /SUBhillis the relative position vector expressed in Hill frame coordinates and rcis the chief position magnitude. The vectors expressed in inertial coordinates are given by rdIDrcICAIhill/SUBhill Using Eq. ( 3.14) derive an expression for the derivative of rdIin terms of rcI,AIhill, /SUBhill, and/or their derivatives, and the derivative of the true anomaly of the chief. 3.2. Another way to derive the quaternion kinematics in Eq. ( 3.20)i st ou s et h e attitude matrix kinematics. Using the quaternion representation of the attitude matrix given by Eq. ( 2.125 ) and the attitude matrix kinematics equation given by PAD/NULŒ!/STX/c141A, derive the quaternion kinematics equation. 3.3. Beginning with Eq. ( 3.21) and the deﬁnition of the quaternion in Eq. ( 2.124 ) show thatk!kDP#if the axis of rotation is ﬁxed. 3.4. Prove that the inverse of Eq. ( 3.28) is given by Eq. ( 3.30). 3.5. Another way to derive the Euler angle kinematics in Eq. ( 3.38)i st ou s et h e attitude matrix kinematics. Using the Euler angle representation of the attitude matrix for a 1/NUL2/NUL3sequence in Table 9.2and the attitude matrix kinematics equation given by PAD/NULŒ!/STX/c141A, derive the matrix B./DC2; / in Eq. ( 3.38)f o ra 1/NUL2/NUL3sequence. Also, derive an analytical expression for B/NUL1./DC2; / for a1/NUL2/NUL3 sequence. 3.6. Consider the following inertia matrix: Jc BD2 4100 0 0 05 0000 2 53 5kg-m 2 Numerically integrate Eq. ( 3.81) with Lc BD03for a time span of 2.5 h with the following initial conditions: a)!BI B.0/DŒ0 0:01 0/c141Trad/s b)!BI B.0/DŒ0:01 0:0001 0:0001/c141Trad/s c)!BI B.0/DŒ0:0001 0:01 0:0001/c141Trad/s Explain the differences between these cases. 3.7. Consider the angular velocity solution for the axially symmetric case given in Eq. (3.104 ). Show that the closed-form solution for the quaternion is given by q.t/Dz.t/˝q0120 3 Attitude Kinematics and Dynamics where z.t/is given by z.t/D2 664h01cos.˛/sin.ˇ/Ch02sin.˛/sin.ˇ/ h02cos.˛/sin.ˇ//NULh01sin.˛/sin.ˇ/ h03cos.˛/sin.ˇ/Csin.˛/cos.ˇ/ cos.˛/cos.ˇ//NULh03sin.˛/sin.ˇ/3 775 with the deﬁnitions ˛D1 2!pt,ˇD1 2!`t,h0DH0=kH0kDŒh01h02h03/c141T, where!`DH=Jtis the inertial nutation rate and H0DJ!0is the initial angular momentum vector. 3.8. Instead of Eq. ( 3.139 ), we could write HBDJ/ETX B!BIBCH/ETX B where J/ETX B/DC1QJBCnX `D1Jw `and H/ETX BDnX `D1Jk `!w `w` This form is sometimes more convenient for attitude estimation problems where the wheel speeds are known better than the applied torques, but it is less well suited todynamics analysis. Show that the equivalent of Eq. ( 3.147 ) in this formulation is P! BI BD.J/ETX B//NUL1ŒLB/NULPH/ETX B/NUL!BI B/STX.J/ETX B!BIBCH/ETX B//c141 Then show that the dynamics of a spacecraft with constant H/ETX Bare basically the same as the dynamics for constant Hw BusingJ/ETX Brather thanJBfor the MOI. 3.9. Prove the relationship shown in Eq. ( 3.175 ). 3.10. The roll/yaw motion of a gravity-gradient-stabilized spacecraft would exhibit a resonant motion analogous to the pitch motion exhibited by Eq. ( 3.183 )i ft h e solution of Eq. ( 3.189 )g a v es2D/NULn2. Show that this roll/yaw resonance condition forhD0is equivalent to /DC41.1/NUL/DC43/D0, and thus that the roll/yaw resonance condition is never satisﬁed inside a region of stable motion. 3.11. Show that the condition for pitch resonance with orbit eccentricity, !libDn, is equivalent to /DC41D.1C3/DC43/=.3C/DC43/, which is the curve plotted in Fig. 3.7. 3.12. If the principal moments of inertia are all equal, both the gyroscopic and gravity-gradient torques will vanish. Find the solutions of Eq. ( 3.189 ) in this case without any assumptions on hexcept that it is nonzero.References 121 References Abramowitz, M., Stegun, I.A.: Handbook of Mathematical Functions with Formulas, Graphs and Mathematical Tables. Applied Mathematics Series - 55. National Bureau of Standards,Washington, DC (1964) BeDra, D.B., Delp, R.H.: Rigid body attitude stability and natural frequencies in a circular orbit. J. Astronaut. Sci. 8(1), 1–14 (1961) Bhat, S.P., Dham, A.S.: Controllability of spacecraft attitude under magnetic actuation. In: Proceedings of the 42nd IEEE Conference on Decision and Control, pp. 2383–2388. Maui(2003) Borderies, N., Longaretti, P.: A new treatment of the albedo radiation pressure in the case of a uniform albedo and of a spherical satellite. Celestial Mech. Dyn. Astron. 49(1), 69–98 (1990) Bracewell, R.N., Garriott, O.K.: Rotation of artiﬁcial Earth satellites. Nature 182(4638), 760–762 (1958) Camillo, P.J., Markley, F.L.: Orbit-averaged behavior of magnetic control laws for momentum unloading. J. Guid. Contr. 3(6), 563–568 (1980) Damaren, C.J.: Comments on ‘fully magnetic attitude control for spacecraft subject to gravity gradient’. Automatica 38(12), 2189 (2002) Dodge, F.T.: The New “Dynamic Behavior of Liquids in Moving Containers”. Southwest Research Inst., San Antonio (2000). URL http://books.google.com/books?id=RltitwAACAAJ Gambhir, B.L., Sood, D.R.: Spin axis magnetic coil maneuvers. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and Control, chap. 16. Kluwer Academic, Dordrecht (1978) Goldstein, H.: Classical Mechanics, 2nd edn. Addison-Wesley, Reading (1980) Grell, M.G., Shuster, M.D.: Spin plane magnetic coil maneuvers. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and Control, chap. 16. Kluwer Academic, Dordrecht (1978) Harvie III, E., Rowe, J., Tsui, Y .K.J.: Performance analysis of the GOES trim tab solar pressure torque angular momentum control. In: Proceedings of SPIE, GOES-8 and Beyond, vol. 2812.Denver (1996) Hecht, E., Manger, W.P.: Magnetic attitude control of the Tiros satellites. Appl. Math. Mech. 7, 127–135 (1964) Hughes, P.C.: Spacecraft Attitude Dynamics. Wiley, New York (1986)15. Kane, T.R., Levinson, D.A.: Dynamics: Theory and Application. McGraw-Hill, New York (1985) Kane, T.R., Likens, P.W., Levinson, D.A.: Spacecraft Dynamics. McGraw-Hill, New York (1983) Kaplan, M.H.: Modern Spacecraft Dynamics and Control. Wiley, New York (1976)18. Kim, J.W., Crassidis, J.L., Vadali, S.R., Dershowitz, A.L.: International Space Station leak localization using attitude respone data. J. Guid. Contr. Dynam. 29(5), 1041–1050 (2006) Lerner, G.M.: Attitude acquisition. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and Control, chap. 19. Kluwer Academic, Dordrecht (1978) Markley, F.L.: Attitude dynamics. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and Control, chap. 16. Kluwer Academic, Dordrecht (1978) Markley, F.L., Kennedy, K.R., Nelson, J.D., Moy, E.W.: Autonomous spacecraft gyro failure detection based on conservation of angular momentum. J. Guid. Contr. Dynam. 17(6), 1385–1387 (1994) Markley, F.L., Nelson, J.D.: Zero-gyro safemode controller for the Hubble Space Telescope. J. Guid. Contr. Dynam. 17(4), 815–822 (1994) Parkinson, B.W., Kasdin, N.J.: A magnetic attitude control system for precision pointing of the rolling GP-B spacecraft. Acta Astronautica 21(6–7), 477–486 (1990) Space Systems Loral: GOES I–M data book (1996). http://goes.gsfc.nasa.gov/text/goes. databook.html (accessed Jan. 27, 2014)122 3 Attitude Kinematics and Dynamics Starin, S.R., O’Donnell Jr., J.R., Ward, D.K., Wollack, E.J., Bay, P.M., Fink, D.R.: Anomalous force on the Wilkinson Microwave Anisotropy Probe. J. Spacecraft Rockets 41(6), 1056–1062 (2004) Vallado, D.A.: Fundamentals of Astrodynamics and Applications, 3rd edn. Microcosm Press, Hawthorne and Springer, New York (2007) Wertz, J.R. (ed.): Spacecraft Attitude Determination and Control. Kluwer Academic, Dordrecht (1978) Wi ´sniewski, R.: Linear time-varying approach to satellite attitude control using only electro- magnetic actuation. J. Guid. Contr. Dynam. 23(4), 640–647 (2000) Wi ´sniewski, R., Blanke, M.: Fully magnetic attitude control for spacecraft subject to gravity gradient. Automatica 35(7), 1201–1214 (1999) Zienkiewicz, O.C., Taylor, R.L., Zhu, J.Z.: Finite Element Method - Its Basis and Fundamen- tals, 6th edn. Elsevier Butterworth-Heineman, Oxford (2005)Chapter 4 Sensors and Actuators This chapter will discuss several kinds of sensors and actuators used to determine and control spacecraft attitude [ 26,44,54,66]. The history of attitude sensor development has emphasized increased resolution and accuracy as well as decreased size, weight, and power (often abbreviated as SWaP). Actuator technologies have also been scaled down to be appropriate for microsatellites and cubesats. We beginwith a brief introduction to redundancy considerations, and then consider some speciﬁc sensors and actuators. 4.1 Redundancy The space environment is stressful, and failures of ACS components have sometimes led to the degradation or premature termination of space missions. A requirement formany missions is the ability to survive the failure of any one component, a single- point failure , without any loss of capability. This is often accomplished by providing redundant components. Some designs leave the redundant equipment unpowereduntil a failure of the operating unit occurs, a conﬁguration usually referred to as a cold backup conﬁguration. If a primary unit fails in a cold backup conﬁguration, there is some delay from the time that the backup component is powered on untilit is available for use. A warm backup conﬁguration, in which the redundant device is powered on but not used, allows a quicker recovery in the event of failure of the primary component. A hot backup conﬁguration, with the redundant component being used all the time, is often preferred for actuators such as reaction wheels or CMGs, where the increased control authority is useful. Redundant components can be connected in a block-redundant or a cross- strapped fashion. This is illustrated schematically in Fig. 4.1, where Sensors A and B might be a star tracker and a gyro, Actuators A and B could be two reaction wheels, and the numerical subscripts represent redundant components.An actual control system would likely incorporate more sensors and actuators, F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _4, © Springer Science+Business Media New York 2014123124 4 Sensors and Actuators sensorB 1sensorA 1 actuatorB 1actuatorA 1 CPU 1 sensorA 2 sensorB 2actuatorA 2 actuatorB 2CPU 2sensorB 1sensorA 1 actuatorB 1actuatorA 1 CPU 1 sensorA 2 sensorB 2actuatorA 2 actuatorB 2CPU 2ab Fig. 4.1 Alternative redundancy conﬁgurations. ( a) Block redundant. ( b) Cross strapped of course. The block-redundant system of Fig. 4.1a has two entirely separate strings ; a single-string system would just be the upper half of the ﬁgure. A failure in the active string of a block-redundant system causes a switch to all the components ofanother string. A failure in the cross-strapped system of Fig. 4.1b would generally result in replacing only the failed unit with its backup. It can be seen that the block-redundant and cross-strapped conﬁgurations are both single-fault-tolerant.The block-redundant system would only tolerate a second fault if it were in the same string as the ﬁrst fault. We can see that cross-strapping usually leads to a more robust system, because it can accommodate a greater range of multiple failures. There areinstances, however, where cross-strapping can reduce reliability by allowing a fault in one component to propagate through the system. Cross-strapping increases system complexity and cost. The increased expense is especially prominent in the testing phase, where it is desirable to test all the paths through the control system. It can be seen from the ﬁgure that the number of paths in a block-redundant system increases linearly with the degree of redundancy, butthe number of paths increases exponentially in a fully cross-strapped system. It is often cost-effective to build a system with limited redundancy and/or partial cross- strapping. A careful reliability analysis must be performed as part of the designprocess, to assess the degree of redundancy and cross-strapping needed to provide the desired probability of completing the mission successfully. Hardware redundancy is not the only option for protecting against single-point failures. Instead, it is often possible to provide the function of a failed component by using an entirely different component or set of components. This often involves extra computation, and is referred to as analytic redundancy . One example is the provision for attitude determination of the Tropical Rainfall Measuring Mission (TRMM) spacecraft using gyros, Sun sensors, and a three-axis magnetometer in place of the horizon sensor, which is described in Sect. 5.8. This contingency mode was designed to cope with potential degradation of the horizon sensor, which never occurred, but it enabled raising the TRMM altitude above the operational altitude of the horizon sensor in order to conserve propellant and extend the mission.4.2 Star Trackers 125 4.2 Star Trackers 4.2.1 Overview Reference [ 66] describes several types of star trackers, many of which are no longer used. Beginning around 1990, they were superseded by solid state star trackers that track many stars simultaneously [ 43]. We will discuss only these state-of-the-art trackers, many of which autonomously match the tracked stars with stars in an internal catalog and use one of the methods described in Chap. 5to compute the star tracker’s attitude with respect to a celestial reference frame. A typical tracker has an update rate between 0.5 and 10 Hz, a mass of about 3 kg and a power requirement on the order of 10 W. It provides accuracy of a few arcseconds in the boresight pointing direction, with larger errors for rotation about the boresight. References [ 43] and [34] review the operation and performance of star trackers, and [ 64] provides a detailed description of the star tracker used by the WMAP spacecraft. A star tracker is basically a digital camera with a focal plane populated by either CCD (charge-coupled device) or CMOS (complementary metal-oxide semicon- ductor) pixels (picture elements). CCDs have lower noise, but CMOS has several advantages. It is the same technology used for microprocessors, so the pixels can include some data processing capabilities on the focal plane itself. Sensors taking advantage of this capability are known as active pixel sensors (APS). CMOS is more resistant to radiation damage than CCDs, and also provides the capability of reading out different pixels at different rates, which is not feasible with CCDs. Figure 4.2shows the geometry of a star tracker, which is basically the geometry of a pinhole camera. The x,y, and zaxes constitute a right-handed coordinate system with its origin at the vertex of the optical system and its zaxis along the optical axis, the tracker’s boresight. The focal plane is a distance f, the focal length of the optics, behind the vertex. The optics are slightly defocused so a star image covers several pixels. This enables the location of the centroid of a star image, computed as the “center of mass” of the photoelectrons in an n/STXnblock of pixels, to y vx zs u(u0,v0) (u,v)f Fig. 4.2 Star tracker geometry126 4 Sensors and Actuators be determined to an accuracy of a fraction of a pixel [ 34]. Optimal defocusing gives a point spread function (PSF) with a width between 1.5 and 2 pixels, with ntypically equal to 2 or 3 [ 56,57]. The resulting accuracy, /DC4cent, of the centroid depends on the star brightness, the exposure time, and various noise sources. Centroiding to an accuracy of/DC4centD0:1pixel widths is generally achieved. Computing a weighted center of mass may reduce the effect of noise and improve this accuracy [ 46]. The focal plane has a .u;v/coordinate system whose origin can be at its center or at one of its corners. The center of the focal plane, at the point where the zaxis pierces it, is designated by .u0;v0/. The unit vector sfrom the spacecraft to a star can be computed from the focal plane coordinates of the centroid of its image as sD1p f2C.u/NULu0/2C.v/NULv0/22 4u/NULu0 v/NULv0 f3 5 (4.1) It is conventional to deﬁne ˛/DC1tan/NUL1.s2=s3/andˇ/DC1tan/NUL1.s1=s3/so that sD1p 1Ctan2ˇCtan2˛2 4tanˇ tan˛ 13 5 (4.2) The focal plane coordinates of the centroid in terms of the star vector are uDu0Cfs1=s3Du0Cftanˇ (4.3a) vDv0Cfs2=s3Du0Cftan˛ (4.3b) 4.2.2 Modes of Operation A star tracker has two modes of operation: tracking mode and initial attitude acquisition. We will ﬁrst discuss the more straightforward tracking mode, in which the tracker is following several stars that have already been matched with cataloguedstars. After a ﬁxed integration time, the star tracker reads out the number of accumulated photoelectrons in the pixels in regions of interest (ROI) around the expected positions of the tracked stars. The location of each ROI is based on thestar’s position at the time of previous readout and the estimated attitude motion of the spacecraft in the intervening time, and its size depends on the accuracy of the attitude knowledge. The brightest pixels in each ROI are identiﬁed, and theappropriaten/STXnblock of pixels is used to compute the centroid of each star. If a tracked star moves out of the ﬁeld of view (FOV), the tracker searches for another star, preferably well separated from the other tracked stars. The a priori knowledgeof the approximate spacecraft attitude makes this search relatively easy.4.2 Star Trackers 127 Initial attitude acquisition mode is more picturesquely known as lost-in-space mode [ 62]. In this case the tracker searches the entire FOV for the brightest clusters of pixels, and computes at least three centroids. The arc length separation betweenthese stars, their brightness, and some other computed properties are used to match them with entries in the star catalog. This can be accomplished in a few seconds using sophisticated algorithms for pattern matching and for rapidly searching thecatalog. Reference [ 62] provides a very useful survey of these methods and a complete guide to the literature. 4.2.3 Field of View, Resolution, Update Rate We will consider some trades in the design of star trackers, following the discussions by McQuerry, et al. [ 43] and Liebe [ 34]. The resolution of the star tracker depends on the number of pixels, the size of the FOV , and the accuracy of the centroiding. We will consider a square focal plane of size Npixels/STXNpixels, typical values being 512/STX512or1;024/STX1;024 . Assuming that the focal plane assembly is centered on the optical axis, it images a spherical quadrilateral on the celestial sphere bounded by the four great circles given by Eq. ( 4.2) with˛D˙˛maxandˇD˙ˇmax.T h e area of this FOV on the sphere is given by spherical geometry1as ˝rectangleD4sin/NUL1.sin˛maxsinˇmax//EM.2˛ max/.2ˇ max/steradians (4.4) The approximation is for small angles, and it is quite good, having an error of only 1% f o r˛maxDˇmaxD10ı. Optical distortions often make it desirable to ignore stars in the corners of the FOV , reducing the useful area for ˛maxDˇmaxto that of a small circle of radius ˛max, ˝circleD2/EM.1/NULcos˛max//EM/EM˛2 max steradians (4.5) Each pixel of a square focal plane subtends an angle 2ˇmax=Npixels in the small angle approximation, so the resolution of the tracker is 2/DC4centˇmax=Npixels. Higher resolution can be obtained by decreasing the size of the FOV , increasing the number of pixels in the focal plane, or improving the centroiding. If the physical size of a pixel and the ﬁeld of view are held constant, adding pixels requires a larger focalplane and thus a proportionally larger focal length, increasing the weight of the optics. Pixel sizes have historically decreased, however, allowing more pixels in a smaller focal plane. Star trackers have several sources of errors. Optical distortions can be reduced by calibration, and temperature-dependent errors can be minimized by controlling the temperature of both the focal plane and the optics. Shot noise results from the 1This can be derived, for example, from Eqs. (A-12) and (A-22) in [ 66].128 4 Sensors and Actuators random nature of photons, which obey Poisson statistics. Thus if a pixel accumulates nephotoelectrons on average, this number will have a ﬂuctuation with standard deviationpne.Dark current , the accumulation of electrons in the absence of light, can also be minimized by cooling the focal plane, but this increases the power demands of the tracker. Sometimes the tracker software must be modiﬁed to ignore hot pixels , i.e. pixels with anomalously large dark currents. The effects of shot noise and dark currents can be minimized by gathering more light to increase the number of photoelectrons, which requires either increasing the aperture of the optics, with concomitant weight gain, or increasing the integration time, i.e. the time allowedfor photoelectrons to accumulate before counting them. Increasing integration time obviously slows the attainable update rate of star tracker data and also makes it more difﬁcult for the tracker to deal with spacecraft attitude motion. IfN starsare tracked simultaneously, averaging of random errors reduces the errors in the attitude estimate about the two axes perpendicular to the boresight by a factor ofN/NUL1=2 stars, with resulting accuracy /SOH/DC2cross-boresightD2/DC4centˇmax NpixelspNstars(4.6) For/DC4centD0:1,NpixelsD1;024 , andNstarsD5, this gives 3.1 arcsec for a 20ı/STX20ı FOV , and 1.3 arcsec for an 8ı/STX8ıFOV . The rotation angle around the tracker’s boresight, often called roll, cannot be determined with equal accuracy. Its estimation requires some separation between the tracked stars to provide a lever arm. The methods of Sect. 5.5.2 can be used to show that roll accuracy is reduced relative to the cross-axis accuracy by the root-mean-square (RMS) distance of stars from the boresight (in radians).2This distance for a large collection of stars uniformly distributed over a square FOV is ˇRMSDvuutRˇmax /NULˇmaxRˇmax /NULˇmax.x2Cy2/dxdy Rˇmax /NULˇmaxRˇmax /NULˇmaxdxdyD2ˇmaxp 6(4.7) Using this RMS value gives the error in the rotation about the boresight as /SOH/DC2rollDp 6/DC4cent NpixelspNstars(4.8) This error is independent of the size of the FOV; for /DC4centD0:1,NPD1;024 , and NstarsD5, it is equal to 22 arcsec. We see that a large-FOV star tracker and a small- FOV tracker with the same focal plane will produce equally accurate roll attitude estimates, but Eq. ( 4.6) shows that the tracker with the smaller FOV will provide better measurements of the cross-axis attitude. 2An example calculation is set as an exercise in Chap. 5.4.2 Star Trackers 129 4.2.4 Star Catalogs Both for lost-in-space star identiﬁcation and for averaging of random errors, it is desirable to track at least four stars, and preferably more. This drives the size of the star catalog. The star availability requirement is usually stated as the probability that at leastNstars will be available in the tracker’s FOV . The number of stars in the FOV can be assumed to follow a Poisson distribution, which says that the probability of ﬁnding Nstars in the FOV is given by P.N/De/NULNNNNN NŠ(4.9) whereNNis the average number of stars in the FOV . Representative values following from this assumption are that NND6:75 gives a 90 % probability of ﬁnding 4 stars in the FOV ,NND8gives a 90 % probability of ﬁnding 5 stars in the FOV , NND10 gives a 99 % probability of ﬁnding 4 stars in the FOV , and NND11:7 gives a 99 % probability of ﬁnding 5 stars in the FOV . These values can immediately be used to estimate the required size of the star catalog. The size of the celestial sphere is 4/EM.180=/EM/2D41;253 deg2, so the star catalog should contain 11:7/STX41;253=64>7;500 stars to offer a 99 % probability of ﬁnding 5 stars in a 8ı/STX8ıFOV . On the other hand, only 6:75/STX41;253=400/EM700 stars are needed to offer a 90 % probability of ﬁnding 4 stars in a 20ı/STX20ıFOV . The required size of the catalog can then be used to estimate the magnitude range of stars that must be tracked. Haworth [ 24] has counted the number of stars in the Tycho star catalog [ 60] in visual magnitude ranges from /NUL0.5 to 11.5. His values for the number of stars of magnitude less than MVfor3:5/DC4MV/DC410:5 can be ﬁtted to within 3 % by the simple relation N.MV/D3:9exp.1:258MV/NUL0:011M2 V/ (4.10) TheM2 Vterm in this expression gives a curvature to the plot of differential star counts as shown, for example, in Figure 2 of [ 4], but neither Eq. ( 4.10) nor Haworth’s estimates are reliable for magnitudes greater than MVD10:5. According to Eq. ( 4.10), a catalog containing 7,542 stars must include stars as dim as MVD 6:4, while a catalog with 696 stars need only extend to MVD4:3, a magnitude signifying100:4.6:4 /NUL4:3//EM7times as much energy ﬂux as MVD6:4. These magnitude estimates are only approximate for two reasons. Firstly, the magnitude of a star depends on the spectral response of the detector, and theresponse of a CCD or APS pixel is not the same as that of the human eye. For this reason, star catalogs are created using instrument magnitudes , which are speciﬁc to the detector technology employed by the tracker. Secondly, stars are notuniformly distributed on the celestial sphere, but tend to be concentrated in our galaxy, the Milky Way. Because star densities are lower at the galactic poles, it is often necessary to ﬁll in a star catalog with dimmer stars in these regions.130 4 Sensors and Actuators 4.2.5 Proper Motion, Parallax, and Aberration Star catalogs give the apparent positions of stars in the inertial ICRF frame with its origin at the center-of-mass of the solar system, as discussed in Sect. 2.6.2 .S t a r s are not all absolutely stationary in this frame, and a few exhibit proper motion of as much as several arseconds per year. Star catalogs include the proper motion of anystar for which it is signiﬁcant, so the star location can be corrected for it when the catalog is accessed. Stars with near neighbors, including double stars, are generally omitted from star catalogs. Parallax , the change in the apparent location of a star due to the change in the position of the observer, is negligible for all but the nearest stars. For a satellite in near-Earth orbit, the maximum parallax is equal to the radius of the Earth’sorbit divided by the distance to the star. For the nearest star, Proxima Centauri at a distance of 4.24 light years, the maximum parallax is 3.7 /c157rad, or 0.77 arcsec. However, Proxima Centauri would likely be excluded from a star catalog because itappears to form a triple star system with ˛Centauri A and B [ 65]. In fact, some star catalogs only include stars at distances greater than 100 light years from the solar system, so that their parallax is less than 0.03 arcsec near the Earth, and less than1 arcsec anywhere inside the orbit of Neptune [ 59]. Stellar aberration is a change in the apparent position of a star due to the velocity of the observer. It is also known as astronomical aberration or Bradley aberration,after James Bradley who showed in 1729 that it was a result of the ﬁnite speed of light. Stellar aberration is not to be confused with distortions in optical systems such as spherical aberration or chromatic aberration, which are completely unrelated.We will explain aberration using Bradley’s classical argument, which gives a result correct to the ﬁrst order in v=c, the ratio of the observer’s velocity to the speed of light. A complete explanation requires special relativity, but our analysis will avoidthis reﬁnement [ 59]. Figure 4.3a illustrates Bradley’s argument in the ICRF frame, in which the star tracker is moving with velocity vand the star is assumed to be stationary. 3The vertexVand focal plane FPof the tracker are shown at times t1, when the starlight passes through the effective pinhole at V, andt2when it strikes the focal plane; the tracker is displaced a distance v/SOHt/DC1v.t2/NULt1/between these times. Light travels in a straight line with speed cin an inertial reference frame, so the light from the star at positionStruepasses through V.t1/toFP.t2/. The vector from FP.t2/toV.t1/ iscstrue/SOHt, as indicated on the ﬁgure. The star appears to the star tracker to have come through V.t2/toFP.t2/, so the apparent direction to the star is the direction of the vector sum .cstrueCv//SOHt. Thus the apparent unit vector to the star is sapparentDstrueCv=c kstrueCv=ck(4.11) 3Proper motion is accounted for separately.4.2 Star Trackers 131 FP(t2) FP(t1)V(t1)V(t2)vΔt−vΔtStrueSapparent cstrue Δt(cstrue+v)Δt (csapparent –v)ΔtS(temit) S(tdetect) star trackera b csapparentΔt Fig. 4.3 Stellar aberration. ( a) Celestial reference frame. ( b) Star tracker frame It can be seen that the apparent star vector is tilted forward from the true star vector in the direction of the velocity. A moving telescope with a very small ﬁeld of view must be tilted forward to catch the photons, much as someone walking in the rain must tilt an umbrella forward to catch the raindrops. Figure 4.3b illustrates an alternative derivation in an inertial reference frame moving at velocity vwith respect to the ICRF, where vis the instantaneous velocity of the star tracker at the time the star is detected. The star tracker is stationary inthis frame, and the star moves with velocity /NULv. The apparent position of the star is the direction from the tracker to the position of the star S.t emit/when the light was emitted. The star moves a distance /NULv/SOHt0/DC1/NULv.tdetect/NULtemit/during the time the light travels the distance c/SOHt0from the star to the tracker. Thus the catalogued position of the star at time tdetect is in the direction of .csapparent/NULv//SOHt0, namely strueDsapparent/NULv=c ksapparent/NULv=ck(4.12) Equations ( 4.11) and ( 4.12) agree to order v=c, but disagree in order .v=c/2, which is not surprising because they were derived using completely classical arguments.Equation ( 4.12) has the appearance of a correction for the actual motion of the star during the light transmission time, but that is not at all what it represents. The star tracker certainly did not have a constant velocity while the light was traveling fromthe star, and it is unlikely that the tracker even existed for most of that time.132 4 Sensors and Actuators Both strueandsapparentare unit vectors, so the transformation between them is a rotation. To see this explicitly, we rewrite Eq. ( 4.11) to ﬁrst order in v=cas sapparent/EM.strueCv=c/.1C2strue/SOHv=c//NUL1=2/EM.strueCv=c/.1/NULstrue/SOHv=c/ /EMstrueCv=c/NUL.strue/SOHv=c/strueD.I3/NULŒ/DC2aber/STX/c141/strue /EMexp./NULŒ/DC2aber/STX/c141/strue(4.13) where /DC2aber/DC1.v=c//STXstrue(4.14) The matrix exponential is the rotation vector representation of the rotation matrix, as deﬁned in Sect. 2.9.2 . The direction of the rotation vector, /DC2aber, is normal to the plane containing the star vector and the velocity. The principal component of the aberration for Earth-orbiting spacecraft, with an amplitude of approximately 20 arcsec, is due to the motion of the Earth aboutthe Sun. 4Aberration arising from the motion of the spacecraft about the Earth is less than 5 arcsec. Aberration can be neglected when matching stars for attitude initialization, but it must be taken into account in determining the attitude ofany spacecraft with ﬁne pointing requirements. A straightforward procedure is to use Eq. ( 4.1) to compute an aberrated vector to a star from its centroid, then use Eq. (4.12) to compute the true vector, which can then be used for precise attitude estimation. The difference in the aberration of two stars is /DC2 aber 1/NUL/DC2aber 2D.v=c//STX.strue 1/NULstrue 2/ (4.15) The maximum magnitude of this differential aberration is2.v=c/ sin./DC212=2/, where /DC212is the angular separation of the star vectors. The differential aberration between the boresight direction and any star is a maximum of 25 % of the full aberration for a tracker with a 20ı/STX20ıFOV , and 10 % of the full aberration for a tracker with an8ı/STX8ıFOV . Tracked stars are usually not at the extreme edge of the focal plane, though, and they tend to be more or less uniformly distributed around the focal plane, causing the average of their differential aberrations with respect to theboresight to be small. Thus aberration is often computed assuming that all stars are on the boresight of the tracker, i.e. at the point .u 0;v0/in the focal plane. With the approximation that the aberration angle is the same for all stars, an autonomous star tracker can compute its attitude with respect to the celestial reference frame using the apparent star vectors without any aberration correction. The resulting attitude matrix, Aaber, maps the star vectors from the celestial frame 4This isv=c/EM100 /SYN rad, so.v=c/2/EM0:002 arcsec, which indicates that a fully relativistic analysis is not required.4.3 Sun Sensors 133 to their aberrated representations in the body frame, and thus it maps all reference frame vectors to tracker frame values rotated by /DC2aber. The true attitude matrix that maps the reference vectors to their true values is found by rotating by the negative of the aberration vector AtrueDexp.Œ/DC2aber T/STX/c141/AaberDAaberexp.Œ/DC2aber I/STX/c141/ (4.16) where the aberration angle is computed assuming the stars are all along the tracker’s boresight. Note that the aberration correction is applied on the left or the rightside of the attitude matrix depending on whether /DC2 aberis represented in the tracker frameTor the celestial frame I. Equation ( 2.63) establishes the equivalence of these two procedures. If the star tracker uses the aberrated measurements to compute anattitude quaternion q aber, the true quaternion is given to order v=cby qtrueD1q 1Ck/DC2aber Tk2/DC4/NUL/DC2aber T 1/NAK ˝qaberD1q 1Ck/DC2aber Ik2qaber˝/DC4/NUL/DC2aber I 1/NAK (4.17) If the star tracker is used to point a telescope or other instrument at an object that is closely aligned with the tracker’s boresight, i.e. if the tracker is co-boresighted with the instrument, we can often omit the aberration correction of both the tracker’s attitude and the science target’s location, since these will cancel. Other instruments,such as magnetometers or Sun sensors, will appear to be misaligned in this case, but a 20 arcsec error may be insigniﬁcant compared with other error sources in their measurements. 4.3 Sun Sensors Sun sensors fall into two classes, coarse Sun sensors (CSSs) and ﬁneordigital Sun sensors (DSSs). The most common form of a CSS is a photocell (an eye)o r an assembly of photocells. To a good approximation, the output of a photocell is an electric current directly proportional to the intensity of the light falling on it.This may include light from Earth albedo or glint off nearby components of the spacecraft, which can pull CSS outputs off the true Sun direction by as much as 20 ı in extreme cases [ 5,6]. The output of a CSS eye basically gives the average direction to sources of light energy falling on it. It is usually an adequate approximation to ignore these effects and treat the Sun as a point source, giving IjD( Imax.nj/SOHs/fornj/SOHs>0 0 fornj/SOHs/DC40(4.18)134 4 Sensors and Actuators where njis the unit vector in the direction of the eye’s outward normal and sis the unit vector in the direction from the spacecraft to the Sun. The response as a function of angle can be calibrated, and compensation for albedo and glint can beapplied if necessary. A second eye, with normal vector n /NULjD/NULnj, would have the output I/NULjD( Imax.n/NULj/SOHs/D/NULImax.nj/SOHs/forn/NULj/SOHsD/NULnj/SOHs>0 0 forn/NULj/SOHsD/NULnj/SOHs/DC40(4.19) so differencing the two outputs gives Ij/NULI/NULjDImax.nj/SOHs/for all nj/SOHs (4.20) Six CSS eyes, with normal vectors ˙nj,˙nk, and˙n`,g i v e 2 4Ij/NULI/NULj Ik/NULI/NULk I`/NULI/NUL`3 5DImax2 4nj/SOHs nk/SOHs n`/SOHs3 5DImax2 4nT j nT k nT`3 5s (4.21) Ifnj,nk, and n`are not coplanar, the Sun unit vector can be computed as sD1 Imax2 4nT j nT k nT`3 5/NUL12 4Ij/NULI/NULj Ik/NULI/NULk I`/NULI/NUL`3 5 D.Ij/NULI/NULj/.nk/STXn`/C.Ik/NULI/NULk/.n`/STXnj/C.I`/NULI/NUL`/.nj/STXnk/ ImaxŒnj/SOH.nk/STXn`//c141(4.22) The eye currents are slowly varying functions of the Sun direction near normal incidence, so the Sun vector is least well determined when the Sun vector is alignedwith one of the eye normal vectors. A six-eye CSS conﬁguration (actually two redundant sets of six eyes) was chosen for WMAP, for which the expected position of the Sun was 22:5 ıfrom the/NULzaxis (see Fig. 7.4). The eyes were located at the outer edges of the six solar panels pointing alternately 35:26ıup and35:26ı down from the x/NULyplane. Thus the unit normal vectors formed an orthogonal triad, perpendicular to the faces of a cube with one of its body diagonals along the /NULzaxis. Fine Sun sensors have historically relied on arrays of slits (or reticles) with linear photosensitive surfaces behind them. Sun sensors of this design are described in Wertz [ 66] and in Sect. 7.7of this text. A newer DSS design is basically a star tracker with a pinhole in place of the light-gathering optics, which are not needed because of the Sun’s brightness. The resolutions of DSSs range from 1 deg to better than 1 arc min. They have medium-size ﬁelds of view, a typical value being 128ı/STX128ı, so CSSs are usually employed to maneuver the spacecraft to move the Sun into the DSS FOV .4.5 Magnetometers 135 Two-slit Sun sensors for spinning spacecraft are also described by Wertz [ 66]. Acommand slit parallel to the spin axis notes the time at which the slit azimuth is in the Sun direction. A second measurement slit perpendicular to the spin axis directs the sunlight to a linear array of detectors to determine the elevation of the Sun unit vector with respect to the spin axis. 4.4 Horizon Sensors Horizon sensors have been used on many Earth-orbiting spacecraft, especially on Earth-pointing spacecraft. The Earth has a ﬁnite size and cannot be treated as apoint to any degree of accuracy, so a horizon sensor detects points on the Earth’s horizon, as its name implies. The appearance of the Earth in visible wavelengths is quite complicated; aside from having oceans, vegetation, and deserts, it has phaseslike the Moon. The appearance is more uniform at infrared wavelengths, especially in the narrow 14–16 /c157m emission band of the CO 2molecule, so almost all horizon sensors are designed to detect infrared radiation in this range [ 66]. Horizon sensors are fundamentally of two types: static sensors that look in ﬁxed directions, and scanning sensors that move a small FOV of a detector across the Earth. Static sensors, by their nature, are limited to Earth-pointing spacecraft atsmall pitch and roll angles and in a limited altitude range. Static horizon sensors looking at four points roughly equally spaced around the Earth’s horizon were used by TRMM and by the Television Infrared Observation Satellite (TIROS) andDefense Meteorological Satellite Program (DMSP) spacecraft. Scanning sensors can use an oscillatory or rotational scan, with rotation provided by incorporating the horizon scanner into a reaction wheel, by providing a separate mechanism, orby using the spin of a spin-stabilized spacecraft. Unlike star trackers and Sun sensors that detect objects with deﬁnite positions in a reference frame, horizon sensors detect a point on the Earth’s horizon withan a priori unknown location. Multiple horizon crossings can be used to ﬁnd a nadir vector by means discussed in [ 66], which contains a wealth of information on horizon sensors. The nadir computed from horizon sensor measurements on anoblate Earth is a better approximation to the geodetic nadir normal to the surface of the ellipsoidal ﬁgure of the Earth than to the geocentric nadir pointing to the center of the Earth. As shown in Sect. 2.6.3 , these directions can differ by as much as 12 arc min. The accuracy of horizon sensors is limited to about 0:1 ı, mainly by the ability to accurately model the height of the CO 2layer in the Earth’s atmosphere. 4.5 Magnetometers Most spacecraft magnetometers are ﬂuxgate magnetometers [ 66], which are rela- tively small, lightweight, rugged, and inexpensive. They have no moving parts anddo not require a clear ﬁeld of view. They do require a well-modeled magnetic ﬁeld136 4 Sensors and Actuators if they are to be used as attitude sensors, which practically limits their use in this capacity to low-Earth orbit. A magnetic ﬁeld model is not needed if magnetometer measurements are used only to compute magnetic torque commands. Magnetometers measure the sum of the ambient ﬁeld that is of interest and any local ﬁelds produced by the spacecraft. Local ﬁelds can be produced by ferromagnetic materials or by current loops in solar arrays, electric motors, payloadinstruments, or most especially attitude control torquers. If the local ﬁelds are known, they can be compensated for. If they are not known, the magnetometers can be located far from the sources of magnetic contamination, on a deployableboom if necessary, to take advantage of the 1=r 3falloff of a magnetic dipole ﬁeld (see Sect. 11.1). 4.6 Global Positioning System Using the GPS for satellite navigation is now widespread. The GPS constellation was originally developed to permit a wide variety of user vehicles an accuratemeans of determining position for autonomous navigation [ 51]. The original constellation included 24 space vehicles (SVs) in known semi-synchronous (12-h) orbits, providing a minimum of six SVs in view for ground-based navigation. Theunderlying principle involves geometric triangulation with the GPS SVs as known reference points to determine the user’s position to a high degree of accuracy. A minimum of four SVs is required so that, in addition to the three-dimensionalposition of the user, the time of the solution can be determined and in turn employed to correct the user’s clock. As of December 2012, 8 more satellites have been added to the constellation, which was also changed to a nonuniform arrangement.This allows nearly 9 SVs to be available at any time and location on the Earth, which provides considerable redundancy and improvements in user location. The number of available GPS satellites for space-based applications depends on the userspacecraft’s altitude. The fundamental signal in GPS is the pseudo-random code (PRC), which is a complicated binary sequence of pulses. Each SV has its own complex PRC, whichguarantees that the receiver will not be confused with another SV’s signal. The GPS satellites transmit signals on two carrier frequencies: L1 at 1575.42 MHz and L2 at 1227.60 MHz. The modulated PRC at the L1 carrier is called the Coarse Acquisition(C/A) code, which repeats every 1,023 bits and modulates at a 1 MHz rate. The C/A code is the basis for civilian GPS use. Another PRC is called the Precise (P) code, which repeats on a 7-day cycle and modulates both the L1 and L2 carriersat a 10 MHz rate. This code is intended for military users and can be encrypted. Position location is made possible by comparing how late in time the SV’s PRC appears relative to the receiver’s code. Multiplying the travel time by the speed oflight, one obtains the distance to the SV . This requires very accurate timing in the receiver, which is provided by using a fourth SV to correct a “clock bias” in the receiver’s internal clock.4.6 Global Positioning System 137 b antenna 1 antenna 2To GPS q Fig. 4.4 GPS waves and wavefront angle Attitude determination using phase differences of GPS signals received by antennas located at different locations is a later development, even though the original concept was proposed in 1976 by Spinney [ 61]. The ﬁrst practical appli- cation for GPS attitude determination was shown by Cohen in 1993 [ 15]. Cohen and Trimble Navigation, Ltd. designed the TANS Vector sensor system, which was then primarily used for airborne applications and tracked up to 6 satellites on 4 separate antennas. The Radar Calibration (RADCAL) satellite was the ﬁrst satelliteto provide spaced-based GPS measurements that determined spacecraft attitude using post-processed data. The ﬁrst realtime space-based attitude determination application was the Cryogenic Infrared Spectrometers and Telescopes for theAtmosphere/Shuttle Pallet Satellite (CRISTA-SPAS) based on algorithms developed by Lightsey [ 35]. Attitude determination using GPS signals is based on measuring the magnitude of the carrier wavelength directly. At least two antennas are required to form a “baseline” vector bexpressed in body-frame coordinates, as depicted in Fig. 4.4. It is assumed that the baseline distance is signiﬁcantly smaller than the distanceto the GPS satellites so that planar waves are given to the receiver. The different path lengths from each GPS satellite to the antennas at the two ends of the baseline create a phase difference of the received signals. Note that an integer number ofcycles may be present in this phase difference if the baseline distance, given by kbk, is larger than the GPS carrier wavelength, which is 19 cm for the L1 carrier. This leads to the classic “integer ambiguity” problem [ 16]. There are several steps required to perform attitude determination. A short list of the general ones is as follows: (1) performing a “self survey” to determine several system parameters, such as integer ambiguities, line biases, and baselines [ 50], (2) determining the sightline vectors to all available GPS satellites, (3) maintaining a count of the integer cycles as the attitude changes, and (4) using the known multiple baseline vectors, sightline vectors, and phase differences (with integers removed) to determine the attitude,which is discussed in Sect. 5.9.138 4 Sensors and Actuators Even though the theory behind GPS-based attitude determination is sound, its practical implementation is susceptible to many error sources. One of the largest error sources is its susceptibility to reﬂections off spacecraft, called multipath [10]. This essentially causes a slowly-varying bias in the measurements with time constants determined by spacecraft dynamics relative to the GPS constellation. Other error sources include ephemeris errors, satellite clock errors, ionosphereerrors, troposphere errors, and receiver errors [ 52]. The accuracy of GPS attitude determination is a function of the error sources, accuracy of the self survey, lengths of the baselines, and satellite geometry. Another approach for GPS attitudedetermination involves using the signal-to-noise ratio, which can be accomplished using a single antenna [ 3,36,39,58]. Pseudolites, which are small transceivers that are used to create local GPS-like signals, can also be used for attitude determination.However, this leads to more complicated solutions because planar wavefronts cannot be assumed in general [ 49]. A GPS receiver built for terrestrial applications will not work properly for space applications in general. Lightsey [ 35] discusses the issues involved with modifying a GPS receiver for space. The ﬁrst issue is that higher vehicle velocities exist in space than for ground and air applications. For example, for low-Earth orbitapplications this results in Doppler shifts that are more than 10 times greater than those observed from the ground and Doppler shift rates that can be more than 100 times higher. The conclusion from these facts is that the carrier and code trackingloops must be redesigned for space applications. The next issue is the “full sky pointing” problem. For ground applications one side of the vehicle generally points in the same direction at all times. This is vastly different for rotating spacecraft,which may cause signiﬁcant outages if all the hemispherical antennas are pointed in the same direction. This can be mitigated by using a carrier phase measurement correction, which Lightsey deﬁnes as a design of a “non-aligned” antenna array.Another issue is that the GPS electronics, especially the processor units, must be redesigned to handle the harsh space environment. Other issues include vibrational effects on the antennas, which can change their baseline length, and larger multipatherrors than ground applications due to more reﬂections from the metallic spacecraft components. All of these issues can decrease the attitude performance if they are not properly accounted for in the GPS receiver design. 4.6.1 GPS Satellites The onboard GPS satellite information is usually given by a GPS ephemeris. Forsimulation purposes a less-precise almanac is used, 5which provides orbital element information, including the time of applicability, ta, eccentricity, e, inclination, i, 5The U.S. Coast Guard Navigation Center maintains a website that contains GPS almanacs, and as of this writing this website is given by http://www.navcen.uscg.gov/ .4.6 Global Positioning System 139 Table 4.1 Equations to compute GPS ECEF positions over time aDp a2 Semimajor Axis nDr/SYN a3Computed Mean Motion tkDt/NULta Time Since Applicability MkDM0Ctkn Mean Anomaly EkDMkCesinEk Solve Kepler’s Equation for Ek tan/ETBk 2Dr 1Ce 1/NULetanEk 2True Anomaly ˝kD˝0CP˝tk/NUL!et Corrected Ascending Node /NAKkDvkC! Argument of Latitude rkDa.1/NULecosEk/ Orbital Radius r0 kD/DC4rkcos/NAKk rksin/NAKk/NAK Orbit Plane Position rE kD2 4cos˝k/NULcosisin˝k sin˝kcosicos˝k 0 sini3 5r0 k ECEF Position semimajor axis, a, right ascension, ˝0, rate of right ascension, P˝, argument of perigee,!, and mean anomaly, M0. See Chap. 10for a discussion of the orbital elements. We should note that the right ascension is given with respect to the prime meridian, which allows us to compute the ECEF position directly. It should be noted that GPS time is based on the atomic standard time and is continuous withoutthe leap seconds that Universal Time (UT) uses to account for the non-smooth rotation of the Earth. GPS epoch is midnight of January 6, 1980, and GPS time is conventionally represented in weeks and seconds from this epoch. The GPS weekis represented by an integer from 0 to 1,023. A rollover occurred on August 22, 1999, so that 1,024 needs to be added for references past this date. To simulate the GPS sightline vector a simple algorithm using GPS almanac data is sufﬁcient. The broadcast ephemeris, which contains more parameters such as amplitude of second-order harmonic perturbations [ 32], should be used if more accuracy is needed. For simulation purposes, counting the days past GPS epoch todetermine UT is adequate (ignoring leap seconds, but not leap days). The position vector of the GPS satellite is denoted by r Eand the position of the GPS receiver is denoted by pE. Table 4.1gives the equations necessary to determine the GPS ECEF positions. The variable !eD7:292115/STX10/NUL5rad/s is the Earth’s rotation rate given from WGS-84, /SYND3:98600441/STX1014m3/s2is the Earth’s gravitational parameter, and tkis the time past the time of applicability (the subscript kdenotes thekth time-step). The sightline vector is computed using sjDrE j/NULpE krE j/NULpEk(4.23) where the subscript jnow denotes the jth available GPS satellite.140 4 Sensors and Actuators 4.7 Gyroscopes Gyroscopes on spacecraft are almost exclusively used in strapdown mode, which means that the gyro is solidly attached to the spacecraft rather than being used to control a separate gimbaled platform. Gyros generally fall into two broad classes: rate gyros that read angular rates, and rate-integrating gyros (RIGs) that measure integrated rates or angular displacements [ 19,44,54]. Gyros can also be classiﬁed by the physical mechanisms they use: spinning-mass gyros, optical gyros, or Coriolis vibratory gyros (CVGs). Before the 1980s, all operational gyros were spinning-mass gyros, which depend on the tendency of the angular momentum of a rotating mass to remain ﬁxed in inertial space. These are used in torque rebalance mode, meaning that the angular momentum is held constant in the spacecraft frame. Equation ( 3.80) tells us that the torque required to keep the gyro’s angular momentum HBconstant is LBD!BI B/STXHB (4.24) The two components of !BI Balong the input axes perpendicular to HBdetermine the required two components of LBalong the output axes, given by the cross products of the input axes with the direction of HB. Single-axis gyros supply and sense one of these torques electromagnetically, depending on mechanical pivots to provide the other torque, while two-axis gyros provide and sense both of these torques electromagnetically. The most accurate spacecraft gyros have been single-axis ﬂoated gyros, as depicted in Fig. 4.5. These have the gyro rotor and its drive motor contained in a cylindrical “can,” with the rotor’s spin direction along one of its diameters. The perpendicular diameter is the input axis, and the output axis is directed from one end of the can to the other. The can is supported by pivots at its ends and by the buoyancy of a ﬂuid having a density equal to the total mass of the can and its contents divided by its volume. Neutral buoyancy allows the pivots to control two RotorOutput AxisCanSensing & Control Pickoff CaseFluidPivotPivot Fig. 4.5 Single-axis ﬂoated gyro4.7 Gyroscopes 141 degrees of freedom of the can while leaving it essentially free to rotate about its output axis. This rotation is sensed and controlled electromagnetically to measure the angular rate about the input axis. In order to minimize perturbations on the can,the power and signals to drive and sense the gyro rotation are carried through the ﬂotation ﬂuid by thin ﬂexible leads. Two-axis gyros are called dry tuned-rotor gyros (DTGs), because they are not ﬂoated [ 44]. The motor is rigidly ﬁxed to the spacecraft, and the rotor is attached to the shaft by gimbals and torsion springs carefully designed and tuned to the spin speed of the rotor to minimize their effective restoring torque, allowing the rotor toﬂex in two directions. The rotor deﬂection is sensed on two axes and controlled on the two cross-product axes electromagnetically. DTGs have come very close to the performance of ﬂoated gyros, but never achieved performance equivalent to the bestﬂoated gyros. However, their relative simplicity and ruggedness led to their use on a great number of spacecraft in the three decades beginning around 1978. The most common failure modes of spinning-mass gyros are due to problems with the rotor bearings. The ﬂoated gyros on HST, which use bromotriﬂuoroethylene (BTFE) as the ﬂotation ﬂuid to provide the required high density, experience a different failure mode. Corrosion of the silver-copper alloy ﬂex leads by the BTFEhas caused multiple gyro failures requiring on-orbit replacement during Space Shuttle servicing missions [ 29]. The problems with spinning-mass gyros, including the difﬁculty and expense of their fabrication, has led to the development of alternative rate-sensing technologies, speciﬁcally optical gyros and CVGs. Optical gyros depend on the Sagnac effect, which applies to light traveling in opposite directions around a closed path thatis rotating with respect to inertial space [ 14,44]. Consider a circular path of radiusRin a plane that is rotating with clockwise angular velocity !about an axis perpendicular to the plane. Light making a complete circuit clockwise must travel adistance L CDctCD2/EMRCR!tC(4.25) wheretCis the time to complete the circuit and cis the speed of light. For light traveling counterclockwise, we have L/NULDct/NULD2/EMR/NULR!t/NUL(4.26) The difference in the path lengths is /SOHLDLC/NULL/NULDc.tC/NULt/NUL/Dc/DC22/EMR c/NULR!/NUL2/EMR cCR!/DC3 D4/EMcR2! c2/NULR2!2/EM4/EMR2! cD4A! c(4.27) This equation generalizes to noncircular and nonplanar paths, with Abeing the area enclosed by the path projected onto the plane perpendicular to the angularvelocity [ 55].142 4 Sensors and Actuators The Sagnac path difference can in principle be detected as a phase difference /SOH/RSD2/EM/SOHL=/NAK rad, where/NAKis the wavelength of the light. However, detecting a rate of 0.001 deg/h D4:85 nrad/s using helium-neon laser light with a wavelength of 632.8 nm in a circular loop with RD0:1m requires measuring a phase difference of only2/STX10/NUL11rad, which is impossible. There are two ways to circumvent this problem. The ﬁrst is to make the light travel around the closed path many times,by using many turns of an optical ﬁber. An interferometric ﬁber optic gyro (IFOG) using 5,000 turns for a total ﬁber length of 3,142 m only has to measure a phase difference of 10 /NUL7rad for the example above, which is feasible.6We will discuss IFOGs later. The second way to circumvent the problem of measuring small phase differences is to use an active laser medium in the path to replace the phase measurement by afrequency measurement. This is the basic idea of a ring laser gyro (RLG). The rota- tion splits the laser wavelength and frequency into clockwise and counterclockwise modes /ETB ˙Dc /NAK˙Dkc L˙(4.28) wherekis the integer number of wavelengths in the cavity. Then7 /SOH/ETBD/ETB/NUL/NUL/ETBCDkc L/NUL/NULkc LCDkc/SOHL LCL/NUL/EMkc/SOHL L2D4A! L/NAK(4.29) where we have substituted Eq. ( 4.27) andkDL=/NAK to obtain the last form. This form holds for a path of any shape, where Lis the perimeter and Ais the enclosed area projected onto the plane perpendicular to the rotation. Most RLGs have paths in the shape of an equilateral triangle with reﬂecting mirrors at the vertices. If `is the length of one side then LD3`,AD.p 3=4/`2, and /SOH/ETBD`!p 3/NAK(4.30) With/NAKD632:8 nm and`D0:1m, this gives /SOH/ETBD.9:1/STX104/!, which is equal to442/c157 Hz for!D0:001 deg/h. The relative ease of detecting small frequency differences has led to the widespread use of RLGs on aircraft and, to a lesser extent, on spacecraft. An RLG has difﬁculty in detecting very slow rotations, because nonlinear interactions between the clockwise and counterclockwise oscillations cause their frequencies to lock in to each other. This is usually solved by introducing a sinusoidal dither of the gyro about its input axis, with typical frequency of 400 Hz 6Equation ( 4.27) assumes that the light travels through a vacuum. The ﬁber’s index of refraction complicates the analysis, but does not change the order-of-magnitude estimates. 7Note that/ETBis measured in Hz, and !in rad/s.4.7 Gyroscopes 143 and amplitude of 0.1ı[44]. Using laser oscillations with four frequencies traveling in a non-planar path can avoid lock-in without dithering. Although RLGs have established themselves as the best rate sensing technology in terms of performanceand reliability in a wide range of applications, they have not been perfect. A slow decrease of laser intensity, thought to be a combined effect of degradation of the mirror surfaces and of the lasing medium, has been observed on many RLGs. Thisis less of a problem on aircraft, which are serviced periodically, than on spacecraft. Although the basic concept of the IFOG is simple, the implementation is not. Reference [ 45] provides many details. By the mid 1980s, the IFOG had become competitive with the RLG, despite its lower sensitivity, typically about 0.1 deg/h as contrasted with 0.001 deg/h achieved by RLGs. The reason for the IFOG’s success includes some desirable features like light weight, small size, limitedpower consumption, projected long lifetime and, not least, lower price. Continuing development has led to increased sensitivity, although a market for navigation- grade IFOGs has not yet materialized; economic forces have concentrated IFOGdevelopment to low price, medium sensitivity applications. CVGs detect the motion of a vibrational mode in a structure caused by Coriolis forces. The ﬁrst CVG to be developed was the hemispheric resonator gyroscope(HRG), which uses a ﬂexural mode in a thin wine-glass-shaped resonator anchored by a thick stem. Coriolis forces arising from rotation about the stem axis cause a slow precession of a standing wave around the resonator with an angular rate thatdiffers from the input rate. An HRG has two modes of operation: a rebalance mode that applies forces to keep the standing wave pattern ﬁxed and a less accurate “whole-angle” mode that measures the free motion of the pattern. HRGs haveachieved accuracy equal to that of the best DTGs and have found many spacecraft applications. CVGs manufactured with micro-electro mechanical systems (MEMS) technol- ogy are the newest development. These are packaged similarly to other integrated circuits with a single part often including gyroscopic sensors for multiple axes. The resonant structures of MEMS gyroscopes are lithographically constructed tuningforks, vibrating wheels, or resonant solids of various designs. MEMS gyros have low cost, low mass, and low power requirements, but also low performance and a short lifetime compared to other gyros. MEMS gyros using components qualiﬁedfor the radiation environment of space have only recently become available. 4.7.1 Gyro Measurement Model A widely used three-axis continuous-time mathematical model for a rate-integratinggyro is given by [ 20] !.t/D! true.t/Cˇtrue.t/C/DC1v.t/ (4.31a) Pˇtrue.t/D/DC1u.t/ (4.31b)144 4 Sensors and Actuators where!trueis the true rate, !is the measured rate, ˇtrueis the true bias or drift, and /DC1vand/DC1uare independent zero-mean Gaussian white-noise processes with E˚ /DC1v.t//DC1T v./FS//TAB D/ESC2 vı.t/NUL/FS/I3 (4.32a) E˚ /DC1u.t//DC1T u./FS//TAB D/ESC2 uı.t/NUL/FS/I3 (4.32b) whereı.t/NUL/FS/is the Dirac delta function deﬁned as ı.t/NUL/FS/D0ift¤/FS Z1 /NUL1ı.t/NUL/FS/d/FSD1(4.33) A more general gyro model includes scale factors and misalignments, which can also be estimated in realtime [ 48,53]. The general gyro model including scaling factors and misalignments is given by !D/NUL I3CStrue/SOH !trueCˇtrueC/DC1v (4.34) withStruedenoting the matrix of scale factors and misalignments. Both Eq. ( 4.31) and Eq. ( 4.34) represent continuous-time gyro models but in practice discrete-time gyro measurements are employed and therefore discrete- time models are required. Because the white-noise processes are assumed to beuncorrelated we can treat each axis separately. Dividing the single-axis version of Eq. (4.31a ) by the gyro sampling interval, /SOHt, and integrating gives 1 /SOHtZt0C/SOHt t0!.t/dtD1 /SOHtZt0C/SOHt t0/STX !true.t/Cˇtrue.t/C/DC1v.t//ETX dt (4.35) Approximating the measured and true values as constant over the interval yields8 !.t0C/SOHt/D!true.t0C/SOHt/C1 /SOHtZt0C/SOHt t0/STX ˇtrue.t/C/DC1v.t//ETX dt (4.36) Integrating Eq. ( 4.31b )g i v e s ˇtrue.t0C/SOHt/Dˇtrue.t0/CZt0C/SOHt t0/DC1u.t/dt (4.37) The variance of the gyro drift bias is given by E˚ Œˇtrue.t0C/SOHt//c1412/TAB DE(/DC4 ˇtrue.t0/CZt0C/SOHt t0/DC1u.t/dt/NAK2) (4.38) 8Note that we cannot make the same assumption for the stochastic variables.4.7 Gyroscopes 145 UsingEf/DC1u.t//DC1 u./FS/gD/ESC2 uı.t/NUL/FS/gives E˚ Œˇtrue.t0C/SOHt//c1412/TAB DE˚ Œˇtrue.t0//c1412/TAB C/ESC2 u/SOHt (4.39) Therefore, the bias can be simulated using ˇtrue m.t0C/SOHt/Dˇtrue m.t0/C/ESCu/SOHt1=2Nu (4.40) where the subscript mdenotes a modeled quantity and Nuis a zero-mean random variable with unit variance. The bias at time tis given by ˇtrue.t/Dˇtrue.t0/CZt t0/DC1u./FS/d/FS (4.41) Substituting Eq. ( 4.41) into Eq. ( 4.36)g i v e s !.t0C/SOHt/DzC1 /SOHtZt0C/SOHt t0Zt t0/DC1u./FS/d/FSdtC1 /SOHtZt0C/SOHt t0/DC1v.t/dt (4.42) where z/DC1!true.t0C/SOHt/Cˇtrue.t0/. The correlation between the drift and rate measurement is given by E˚ ˇtrue.t0C/SOHt/!.t0C/SOHt/gDE/SUB/DC4 ˇtrue.t0/CZt0C/SOHt t0/DC1u./FS/d/FS/NAK /STX/DC4 !true.t0C/SOHt/Cˇtrue.t0/ C1 /SOHtZt0C/SOHt t0Zt t0/DC1u./DLE/d/DLEdtC1 /SOHtZt0C/SOHt t0/DC1v.t/dt/NAK/ESC (4.43) Since/DC1u.t/and/DC1v.t/are uncorrelated we have E˚ ˇtrue.t0C/SOHt/!.t0C/SOHt//TAB DE˚ zˇtrue.t0//TAB C/ESC2 u /SOHtZt0C/SOHt t0Zt0C/SOHt t0Zt t0ı./FS/NUL/DLE/d/DLEd/FSdt DE˚ zˇtrue.t0//TAB C/ESC2 u /SOHtZt0C/SOHt t0.t/NULt0/dt DE˚ zˇtrue.t0//TAB C1 2/ESC2 u/SOHt (4.44) Equation ( 4.44) can be satisﬁed by modeling the gyro measurement using !m.t0C/SOHt/D!true m.t0C/SOHt/Cˇtrue m.t0/C1 2/ESCu/SOHt1=2NuCcNv (4.45)146 4 Sensors and Actuators where the quantity cis yet to be determined and Nvis a zero-mean random variable with unit variance. Note that Eq. ( 4.45) can be proven by evaluating Efˇtrue m.t0C/SOHt/!m.t0C/SOHt/g. Solving Eq. ( 4.40)f o rNuand substituting the resultant into Eq. ( 4.45) yields !m.t0C/SOHt/D!true m.t0C/SOHt/C1 2Œˇtrue m.t0C/SOHt/Cˇtrue m.t0//c141CcNv(4.46) Note that1 2Œˇtrue m.t0C/SOHt/Cˇtrue m.t0//c141is the “average” of the bias at the two times. This term is present due to the fact that the trapezoid rule for integration is exact for linear systems. To evaluate cwe compute the variance of the rate measurement: E˚ !2.t0C/SOHt/g DE/SUB/DC4 zC1 /SOHtZt0C/SOHt t0Z/FS t0/DC1u./GS/d/GSd/FSC1 /SOHtZt0C/SOHt t0/DC1v./FS/d/FS/NAK /STX/DC4 zC1 /SOHtZt0C/SOHt t0Zt t0/DC1u./DLE/d/DLEdtC1 /SOHtZt0C/SOHt t0/DC1v.t/dt/NAK/ESC (4.47) Since/DC1u.t/and/DC1v.t/are uncorrelated and using Ef/DC1v.t//DC1v./FS/gD/ESC2 vı.t/NUL/FS/, then Eq. (4.47) simpliﬁes to E˚ !2.t0C/SOHt//TAB D/ESC2 u /SOHt2Zt0C/SOHt t0Zt0C/SOHt t0Zt t0Z/FS t0ı./GS/NUL/DLE/d/GSd/DLEd/FSdt CE˚ z2/TAB C/ESC2 v /SOHt2Zt0C/SOHt t0Zt0C/SOHt t0ı.t/NUL/FS/d/FSdt (4.48) The quadruple integral in this equation is equal to Zt0C/SOHt t0Zt0C/SOHt t0min./FS/NULt0;t/NULt0/d/FSdtDZt0C/SOHt t0Zt0C/SOHt t0min.x;y/dxdy DZ/SOHt 0/DC2Zy 0xdxCZ/SOHt yydx/DC3 dyDZ/SOHt 0/DC41 2y2Cy./SOHt/NULy//NAK dyD1 3/SOHt3 (4.49) Therefore, Eq. ( 4.48) reduces down to E˚ !2.t0C/SOHt//TAB DE˚ z2/TAB C1 3/ESC2 u/SOHtC/ESC2 v /SOHt(4.50) The variance of the modeled rate measurement in Eq. ( 4.45) is given by E˚ !2 m.t0C/SOHt//TAB DE˚ z2 m/TAB C1 4/ESC2 u/SOHtCc2(4.51)4.8 Reaction Wheels 147 Comparing Eq. ( 4.51)t oE q .( 4.50)g i v e s c2D/ESC2 v /SOHtC1 12/ESC2 u/SOHt (4.52) Hence, the modeled rate measurement is given by !m.t0C/SOHt/D!true m.t0C/SOHt/C1 2Œˇtrue m.t0C/SOHt/Cˇtrue m.t0//c141 C/DC4/ESC2 v /SOHtC1 12/ESC2 u/SOHt/NAK1=2 Nv(4.53) Generalizing Eqs. ( 4.40) and ( 4.53) for all times, dropping the subscript m, and considering all three axes gives the following formulas for the discrete-time rate and bias equations: !kC1D!true kC1C1 2.ˇtrue kC1Cˇtrue k/C/DC2/ESC2 v /SOHtC1 12/ESC2 u/SOHt/DC31=2 Nvk (4.54a) ˇtrue kC1Dˇtrue kC/ESCu/SOHt1=2Nuk (4.54b) where the subscript kdenotes thekthtime-step, and NvkandNukare zero-mean Gaussian white-noise processes with covariance each given by the identity matrix. Replacing!true kC1with.I3CStrue/!true kC1in Eq. ( 4.54a ) provides the discrete-time model for Eq. ( 4.34). 4.8 Reaction Wheels Reaction wheels are used as the primary attitude control actuators on most spacecraft. Momentum-bias spacecraft may use one or two reaction wheels, but full three-axis attitude control requires three or more wheels. Although numerousreaction wheels have operated ﬂawlessly for decades, reaction wheel failures have been a problem on many space missions. Providing extra reaction wheels for redundancy gives some protection, but failure of one reaction wheel is oftenfollowed by failure of other wheels of the same design on the same spacecraft. For example, four reaction wheels failed on the Far Ultraviolet Spectroscopy Explorer (FUSE) spacecraft in 2001, 2002, 2004, and 2007; and two each on Hayabusa inJuly and October 2005, Dawn in 2010 and 2012, and Kepler in 2012 and 2013 [ 17].148 4 Sensors and Actuators 4.8.1 Reaction Wheel Characteristics Reference [ 8] provides an overview of reaction wheel design. A reaction wheel assembly contains a rotating ﬂywheel, typically supported by ball bearings, an internal brushless DC electric motor, and associated electronics. Reaction wheels are produced with a wide range of capabilities: maximum torque from 0.01 to1.0 Nm, maximum angular momentum from 2 to 250 Nms, and maximum rotational speeds from 1,000 to 6,000 rpm. A vendor will frequently use the same ﬂywheel and bearing assembly to construct a wheel with high angular momentum capacity and adifferent wheel with high torque capability. The back electromotive force developed at the high speeds required to provide high angular momentum makes it difﬁcult to provide high torque in the same wheel. The motor drives of some reaction wheels accept a torque command. Other reaction wheels have an internal closed-loop controller that holds the reaction wheel speed at a commanded value. The control electronics of some wheels are integralwith the wheel unit, while others locate the controller in a separate electronics box. A reaction wheel is generally provided with a digital or analog tachometer, or both, to provide a reading of the wheel’s rotational speed. Wheel friction, or drag, is usually modeled as a sum of viscous and Coulomb components L w dragD/NUL/FSv!w/NUL/FScsign.!w/ (4.55) where the coefﬁcients /FSvand/FScare empirically determined and can exhibit temperature dependence [ 8]. This model is adequate in many applications, but does not give a good description of friction at low speeds, especially when crossing zero speed. A dynamic model of friction incorporating hysteresis is required to represent these phenomena adequately. Reference [ 1] provides an excellent review of the issues involved in characterizing and modeling friction, and of the historical development of friction modeling. The ﬁrst dynamic friction model to ﬁnd widespread applications was the Dahl model, introduced in 1968 [ 18]. Many models have been proposed since, including the LuGre model developed by control groups in Lund and Grenoble [ 2,12]. This modiﬁcation of the Dahl model allows frictional forces to be larger at low speeds, an effect known as the Stribeck effect oras stiction. Increasing drag torque is often an indication of potential wheel failure, so it is a general practice to carefully monitor the drag torque on reaction wheels on orbiting spacecraft. 4.8.2 Reaction Wheel Disturbances Although reaction wheels are invaluable for providing ﬁne pointing control ofmany spacecraft, they are also one of the major sources of attitude disturbances. References [ 9] and [ 31] provide excellent overviews of the various categories of4.8 Reaction Wheels 149 reaction wheel disturbances, which can be classiﬁed as radial forces, axial forces, radial moments, and axial moments. Disturbance forces perturb the spacecraft’s attitude by creating an r/STXFtorque, where ris the vector from the spacecraft’s center of mass to the point of application of the force. Thus the effects of reaction wheel force disturbances can be minimized by locating the wheel close to the spacecraft’s center of mass. The effects of disturbance moments are independent of the locationof the wheel. Deviations of the wheels from the assumption of perfect balance made in Sect. 3.3.5.1 are a principal contributor to disturbances. These deviations are classiﬁed as static imbalance ordynamic imbalance . Static imbalance is the condition that the wheel’s center of mass is not on the axis of rotation. In this case, the spacecraft must provide, through the bearing assembly, the centripetal forceneeded to continuously accelerate the center of mass in a circular motion about the axis of rotation. If M wis the mass of the rotor, !wis the magnitude of its angular velocity, wis a unit vector along its axis of rotation, and xis a vector from the axis to the wheel’s center of mass, the static imbalance force is FsDMw.!w/2w/STX.w/STXx/D/NULMw.!w/22 4x1 x2 03 5 (4.56) where the last form assumes that wDŒ0 0 1/c141T. This is a radial force, constant in the wheel frame and rotating with angular velocity !win the spacecraft frame. It has magnitude FsDUs.!w/2, where the static imbalance Us/DC1Mwq x2 1Cx2 2is proportional to the perpendicular distance from the axis to the center of mass. The SI unit for static imbalance would be kg-m, but it is usually given in g-cm (or in ounce-inches) because it is so small. Dynamic imbalance is the condition that the axis of rotation of the wheel is not a principal axis. In this case, keeping the wheel rotating at a constant rate !wabout the spin axis, which we assume to be wDŒ001/c141T, requires a torque LdD!/STXHD.!w/2w/STX.Jw/D.!w/22 4/NULJ23 J13 03 5 (4.57) This is a radial moment, constant in the wheel frame and rotating with angular velocity!win the spacecraft frame. It has magnitude LdDUd.!w/2, where Ud/DC1q J2 23CJ2 13is called the dynamic imbalance. It is generally speciﬁed in g-cm2, although the proper SI unit would be kg-m2. In addition to static and dynamic imbalance, a reaction wheel also exhibits struc- tural dynamic modes resulting from compliance in the bearings. These modes fall into the three classes illustrated in Fig. 4.6: an axial translation mode, modes corresponding to radial translation in two orthogonal directions, and rocking modesabout two orthogonal rocking axes. If the bearing compliance is isotropic, the two radial translation modes will have equal frequencies.150 4 Sensors and Actuators ab c Fig. 4.6 Structural dynamic modes of a reaction wheel. ( a) Axial translation. ( b) Radial transla- tion. ( c) Rocking The rocking modes interact with the rotation of the wheel to give whirl modes. Assume that the rotor’s actual spin axis is misaligned by a small rotation vector ı#. Then the wheel’s angular momentum in a reaction wheel frame in which the nominalspin axis of the wheel is Œ001/c141 Tis HDdiag/DLEh J?J?Jki/DC1 ıP#C.I3/NULŒı#/STX/c141/h 00Jk!wiT D2 4J?ıP#1/NULJk!wı#2 J?ıP#2CJk!wı#1 Jk.ıP#3C!w/3 5 (4.58) to ﬁrst order in ı#, where theıP#term comes from Eq. ( 3.45). Note thatı#3only appears in this equation in the form of its derivative. We can absorb ıP#3into!w to eliminateı#3completely from the analysis. We can treat the wheel frame as inertial, because its motion is negligible compared to the motion of the rotor. Thus the equations of motion are PHD2 4J?ıR#1/NULJk!wıP#2 J?ıR#2CJk!wıP#1 JkP!w3 5DLD/NULJ?!2 02 4ı#1 ı#2 03 5 (4.59) The last equality assumes isotropic elastic restoring forces with coefﬁcients on both axes which we choose to write as J?!2 The third component of the equation says that!wis constant, which is not surprising. We are looking for periodic solutions, so we write /DC4ı#1.t/ ı#2.t//NAK D/DC4ı#1.0/ ı#2.0//NAK ei!t(4.60) Substituting this into Eq. ( 4.59)g i v e s 0D/DC4J?./NUL!2C!2 0//NULiJk!w! iJk!w!J?./NUL!2C!2 0//NAK/DC4ı#1.0/ ı#2.0//NAK (4.61)4.8 Reaction Wheels 151 0 1000 2000 3000 4000 5000 6000050100150200250300350 Wheel Speed (rpm)Disturbance Frequencies (Hz) Fig. 4.7 Frequencies of radial moment disturbances The determinant of the 2/STX2matrix must vanish for a solution to exist, which gives 0DJ?./NUL!2C!2 0/˙Jk!w!D/NULJ?.!2/NUL!2 0/BEL2/CR!w!/ (4.62) where we have written JkD2/CRJ?. Note that/CR<1 by the triangle inequality for principal moments, and that /CRD1for an ideal inﬁnitely thin disk. The frequencies of the positive and negative whirl modes are the roots of this quadratic equation; !˙Dq ./CR!w/2C!2 0˙/CR!w(4.63) We choose the positive sign of the square root because frequencies are convention- ally deﬁned to be positive. The higher frequency mode is a forward whirl, where the whirl is in the same direction as the wheel rotation, while the lower frequency modeis a negative whirl, with motion opposed to the wheel rotation [ 9]. It is useful to plot the frequencies of the disturbances as a function of the reaction wheel speed in a Campbell diagram. Figure 4.7is an example showing the radial moment disturbance frequencies of a notional reaction wheel. The radial moment diagram is the most interesting case because it exhibits the whirl modes. The fundamental mode !D! wis the disturbance arising from dynamic imbalance. The ﬁrst harmonic !D2!wis also apparent, as are frequencies at non-integral multiples of!warising from the bearing disturbances. The speciﬁc multiples shown in the ﬁgure are those shown in [ 9], which also has a table relating the frequencies of bearing disturbances to the physical properties of the bearings.152 4 Sensors and Actuators The Campbell diagram is especially useful in showing the intersections, or “collisions” of the frequencies of different disturbances. These intersections, marked by the small circles in Fig. 4.7, signify resonance conditions leading to larger disturbances. It is interesting to note that the intersections with the negative whirl mode, with frequency !/NUL, do not give rise to a resonant condition if the bearing restoring forces are perfectly isotropic, as was assumed in Eq. ( 4.59), because the excitation and response vectors are perfectly orthogonal in that case [ 9]. This is fortuitous, because these intersections, being at low frequencies, could be problematic. They are not completely absent, of course, because the bearings arenever perfectly isotropic. Simulation or measurement of actual reaction wheel disturbances are shown on a waterfall chart that looks like a Campbell diagram with a third axis to plot the disturbance level. Discussions of experimental validation of reaction wheel disturbance models with several examples of waterfall charts can be found in [ 42] and [ 38]. The study of reaction wheel disturbances is only one part of a general jitter analysis [ 37]. The reaction wheel’s motor can contribute to axial moment disturbances. The drive torque provided by the motor is a source of high frequency disturbances.Torque ripple is a result of the drive torque being a superposition of rectiﬁed sine waves. The torque ripple of a motor with a greater number of poles is at a higher frequency, where it is less problematic. Cogging torques, a result of the magnets in the rotor moving past a ferromagnetic stator, are present regardless of whether a torque is applied, but are absent from reaction wheels that have no ferromagnetic materials in the stator [ 9]. Migration of lubricant in the bearings can give rise to low frequency torque noise, which can have a signiﬁcant effect on spacecraft pointing. Light oils are less likely to produce torque noise than grease, but grease is less prone than oil to migration during storage at one g and during launch. The effects of reaction wheel disturbances on spacecraft jitter are often mitigated by mounting the reaction wheels on ﬂexible isolators. These must be carefully analyzed, however, because the interaction of the wheels’ rocking modes with theisolator modes can lead to potentially troublesome mode collisions [ 11]. 4.8.3 Redundant Wheel Conﬁgurations Spacecraft are often equipped with more than the three reaction wheels, both for redundancy and to provide greater torque and momentum storage capability. Redundant reaction wheels are quite commonly placed in a hot backup conﬁgurationfor this purpose. The torque provided by six reaction wheels allows the NASA Swift spacecraft to complete 50 ıslew maneuvers in 75 s in order to collect data on transient gamma ray bursts. Similar conﬁgurations also allow for longer timeintervals between momentum unloads for spacecraft, such as the James Webb Space Telescope (JWST), that cannot unload angular momentum continuously.4.8 Reaction Wheels 153 The momentum transfer maneuver has been studied in detail using multiple wheels. This problem is related to the initial acquisition after launch since the wheel or wheels are at rest while the spacecraft has some momentum imposed by thelaunch vehicle in a given axis. Reference [ 28] studied the strategy to transfer this initial momentum to the wheel(s) as well as to avoid occurrence of a singular state, and [ 63] introduced a near minimum time eigenaxis rotation maneuver using a set of three reaction wheels without momentum bias for a nadir pointing spacecraft in a circular low-Earth orbit. The combined eigenaxis maneuvers (using reaction wheels and thrusters) are presented in [ 13] to reduce the time spent on large rotations. The reaction wheel optimization problem has been extensively analyzed in the literature (e.g. see [ 22,23], and [ 41]). In the ﬁrst two of these references the assembly conﬁguration has been selected to minimize the power consumption of the wheelsin their task of absorbing the secular portion of the environmental torques. Our analysis will implicitly assume that all the reaction wheels on a spacecraft are identical, which is usually, but not universally, the case. We arrange the appliedtorque and the wheel angular momenta of the individual wheels, L w iandHw i,i n column vectors Lw WandHw W, where the subscript Wdenotes then-dimensional wheel frame. The transformation from the wheel frame to the body frame is givenby the3/STXndistribution matrix W n, whose columns are unit vectors in the body frame, wi, along the spin axes of the wheels: WnD/STX w1w2/SOH/SOH/SOHwn/ETX (4.64) The total wheel torque and angular momentum in the body frame are given by Lw BDWn/STX Lw 1Lw2/SOH/SOH/SOHLw n/ETXT/DC1WnLw W (4.65a) Hw BDWn/STX Hw 1Hw 2/SOH/SOH/SOHHw n/ETXT/DC1WnHw W (4.65b) Because the equations for torque and angular momentum are parallel, we will concentrate on angular momentum in the following. Every result we ﬁnd for angular momentum has a corresponding relation for torque. It is important to note that Hw W andHw Bwill not have the same magnitude in general, because Wnis generally not an orthogonal matrix. We really want to invert Eqs. ( 4.65), that is to transform a desired body frame angular momentum or torque vector into the wheel frame. This is trivial for nD3, we simply set Hw WDW/NUL1 3Hw B, assuming that the distribution matrix is invertible. Invertibility requires the distribution matrix to have full rank, rank three in this case, and is equivalent to the requirement that the spin axis unit vectors wido not all lie in a plane. This will be true for any reaction wheel conﬁguration designed to provide three-axis control. There is no unique way to distribute the torque or angular momentum for n>3 , and we will consider two approaches: the pseudoinverse and minimax methods. Equation ( 4.65b ) demands that the difference, /SOHHw W, between two distinct values of Hw Wthat produce the same Hw Bmust satisfy the equation Wn/SOHHw WD0. This says that/SOHHw Wmust lie in the null space of the matrix Wn, which is.n/NUL3/-dimensional ifWnhas full rank, as we assume.154 4 Sensors and Actuators w2w3 w1w2 w3 w4 e2e2 e3e1 Fig. 4.8 Pyramid conﬁguration Let us now look at some speciﬁc conﬁgurations of redundant reaction wheels. We will consider two popular four-wheel conﬁgurations: a pyramid conﬁguration and a conﬁguration known as the NASA standard conﬁguration that was used on the Multimission Modular Spacecraft (MMS). Figure 4.8shows the pyramid conﬁguration. This conﬁguration assumes symmetry on each coordinate plane. Its transformation matrix from the reaction wheel coordinate system to the body coordinate system is given by W4D2 4a/NULa0 0 bbcc 00d/NULd3 5 (4.66) wherea2Cb2Dc2Cd2D1. This matrix assumes a preferential direction along the body e2axis, with each wheel contributing to this direction. For aDdandbDc, the spin axes make the same angle with the .e1;e3/plane. This layout is the most common conﬁguration for Earth-pointing spacecraft in which a constant rate alongthe pitch axis is required to point the instruments toward the Earth’s surface. The preferred axis of the transformation in Eq. ( 4.66) or of any other distribution matrix can be changed by multiplying W non the left by the appropriate rotation matrix. The null space of W4is one-dimensional, consisting of scalar multiples of the unit vector n4D1p 2.b2Cc2/2 664c c /NULb /NULb3 775(4.67) The NASA Standard four-wheel conﬁguration places three orthogonal wheel spin axes along the body axes and the fourth, skew, wheel axis with projectedcomponents along each body axis, as shown in Fig. 4.9. The transformation matrix for this conﬁguration is given by W ND2 4100˛ 010ˇ001/CR3 5 (4.68)4.8 Reaction Wheels 155 w3 w4 w2w1 e1e3 e2Fig. 4.9 NASA standard conﬁguration where˛2Cˇ2C/CR2D1. The null space of WNis along the unit vector nND1p 1C˛2Cˇ2C/CR22 664˛ ˇ /CR /NUL13 775(4.69) For the special, but very common, case given by ˛DˇD/CRD1=p 3, the fourth wheel’s spin axis is at an angle of 54:7ıwith respect to the coordinate axes. We will also consider two six-wheel conﬁgurations, both with distribution matrix W6D2 4bc b c b c 0p 3d=2p 3a=2 0/NULp 3a=2/NULp 3d=2 ad = 2/NULa=2/NULd/NULa=2 d=23 5 (4.70) wherea2Cb2Dc2Cd2D1. The null space of W6is three-dimensional, requiring three linearly independent vectors to span it. The usual case, which we will refer to as the pyramid conﬁguration, has bDcandaDd, as on Swift and JWST, so the spin axis directions are evenly distributed around a cone centered on the e1 axis. The other six-wheel conﬁguration attains the maximum symmetry possible with six wheels by choosing the parameters bDsin˛,aDcos˛,cDsinˇ, and dDcosˇ, with tan˛D.3Cp 5/=4 and tanˇD.3/NULp 5/=4, so that the wheel spin axis vectors are normal to the faces of a regular dodecahedron.9 4.8.3.1 Pseudoinverse Distribution Law The method chosen to distribute torque or angular momentum among redundant wheels is speciﬁc to the mission’s requirements, but the most common method is to 9The authors thank John P. Downing for suggesting this conﬁguration.156 4 Sensors and Actuators use the pseudoinverse of W, denoted by W/c142. The pseudoinverse, or Moore-Penrose generalized inverse, of a real matrix satisﬁes the conditions: WW/c142WD W, W/c142WW/c142DW/c142, and WW/c142and W/c142Ware symmetric [ 21,25]. IfWnhas full rank, as we are assuming, the pseudoinverse is given by W/c142 nDWT n/NUL WnWT n/SOH/NUL1(4.71) In addition to all the conditions required of a pseudoinverse, this satisﬁes the stronger relation WnW/c142 nDI3 (4.72) Note, however, that W/c142 nWn¤Inforn>3 . Equation ( 4.72) guarantees that Eq. (4.65b ) is satisﬁed if we set Hw WDW/c142 nHwB(4.73) The most general wheel angular momentum vector Hw Wsatisfying Eq. ( 4.65b )i s given by Hw WDW/c142 nHwBCnnDWT n/NUL WnWT n/SOH/NUL1Hw BCnn (4.74) where nnis an arbitrary vector in the null space of Wn. This gives kHw Wk2Dk WT n/NUL WnWT n/SOH/NUL1Hw Bk2C2.Hw B/T/NUL WnWT n/SOH/NUL1WnnnCknnk2 D.Hw B/T/NUL WnWT n/SOH/NUL1Hw BCknnk2(4.75) by the deﬁnition of the null space. We see that the Euclidean norm, or L2norm, of the wheel momentum vector is minimized by setting nnD0, i.e. by using the pseudoinverse to distribute the angular momenta. Now let us consider some speciﬁc cases. The pseudoinverse of W4for the four- wheel pyramid is given by Eq. ( 4.71)a s W/c142 4D1 22 6641=a b=.b2Cc2/0 /NUL1=ab=.b2Cc2/0 0c = . b2Cc2/ 1=d 0c = . b2Cc2//NUL1=d3 775(4.76) It is easy to see that W/c142 4satisﬁes Eq. ( 4.72) and that W/c142 4W4DI4/NULn4nT 4 (4.77)4.8 Reaction Wheels 157 The pseudoinverse of WNfor the NASA standard conﬁguration is given by W/c142 ND1 1C˛2Cˇ2C/CR22 6641Cˇ2C/CR2/NUL˛ˇ/NUL˛/CR /NUL˛ˇ 1C˛2C/CR2/NULˇ/CR /NUL˛/CR/NULˇ/CR 1C˛2Cˇ2 ˛ˇ/CR3 775(4.78) which satisﬁes Eq. ( 4.72) and W/c142 NWNDI4/NULnNnT N (4.79) The pseudoinverse of W6for the six-wheel conﬁgurations is given by W/c142 6D1 32 66666664b=.b 2Cc2/0 2 a = . a2Cd2/ c=.b2Cc2/p 3d=.a2Cd2/d = . a2Cd2/ b=.b2Cc2/p 3a=.a2Cd2//NULa=.a2Cd2/ c=.b2Cc2/0 /NUL2d=.a2Cd2/ b=.b2Cc2//NULp 3a=.a2Cd2//NULa=.a2Cd2/ c=.b2Cc2//NULp 3d=.a2Cd2/d = . a2Cd2/3 77777775(4.80) We have seen that the pseudoinverse method for distributing torque or momen- tum among redundant reaction wheels minimizes the Euclidean norm of the torque or momentum vector in the wheel frame. That is, it minimizes the sum of the squares of the individual wheel torques or angular momenta. This may be optimal from anenergy standpoint, but it does not necessarily result in using the full capability of the reaction wheel array. The pseudoinverse has the advantage of being relatively simple to implement, and it also has a subtler advantage. If we distribute the angularmomentum according to Eq. ( 4.73), then the time derivative of this equation gives L w WDPHw WDW/c142 nPHw BDW/c142 nLwB(4.81) showing that the pseudoinverse momentum and torque distribution laws are mutu- ally consistent. 4.8.3.2 Minimax Distribution Law The ultimate capability of an assembly of reaction wheels is attained by minimizing the maximum effort expended by any wheel, rather than by minimizing the sum of squares of the efforts expended by the reaction wheels. Since the L1norm of a vector is deﬁned to be the magnitude of its largest component, this minimaxoptimization is also referred to as the L 1method [ 41]. We will continue to emphasize optimization of angular momentum, since the results obtained can easily be adapted to optimize torque distribution.158 4 Sensors and Actuators We will only consider reaction wheel conﬁgurations where no three of the wheel spin axis vectors, wi, lie in a plane. This is not a restrictive assumption, as almost all reaction wheel assemblies satisfy it. The following argument shows that minimizingthe largest magnitude of individual wheel angular momentum in an array of n reaction wheels will result in n/NUL2of the wheels all having momentum of the same magnitude. If this were not the case, we could reduce the magnitude of themomentum of the wheels having the largest momentum by distributing it among the other wheels. This process could be continued until there were only two wheels remaining with less than the maximum magnitude. The process cannot be carriedfurther because a general three-component excess momentum vector cannot be distributed between only two wheels. LetH 0denote the maximum wheel momentum magnitude. We will consider the problem of maximizing the body momentum Hw Bfor a given value of H0because this is equivalent to minimizing H0for a given Hw B. Let us ﬁrst maximize the angular momentum in the direction wi/STXwj. This angular momentum does not depend on Hw iandHw j, so the maximum in the direction wi/STXwjis obtained by assigning the maximum magnitude H0to all the other wheels with the signs given by Hw kDH0sign.sijk/fork¤i;j (4.82) where sijk/DC1.wi/STXwj//SOHwk (4.83) With this distribution, the angular momentum in the body frame is Hw BDHw iwiCHw jwjCH0vij (4.84) with vij/DC1nX kD1 k¤i;jwksign.sijk/ (4.85) Because the angular momenta of wheels iandjcan have any magnitude less than or equal toH0, the range of angular momenta described by Eq. ( 4.84) covers a rhombus with sides of length 2H0parallel to wiandwj. The distance in the normal direction from the origin to this rhombus is H0dij, where dij/DC1kwi/STXwjk/NUL1Œ.wi/STXwj//SOHvij/c141Dkwi/STXwjk/NUL1nX kD1 k¤i;jjsijkj (4.86) The rhombi for all n.n/NUL1/pairs of spin axis indices form an n.n/NUL1/-faced polyhedron. It is symmetrical about the origin, with its jiface opposite to its ijface, because vijD/NULvji. At the vertices of the polyhedron all the wheel momenta have4.8 Reaction Wheels 159 3 2 1 0 1 2 3Y3 2 1 0 1 2 3Z3210123 X newpoly.eps Fig. 4.10 Momentum polyhedron for six-wheel pyramid magnitudeH0, andn/NUL1of the momenta have this magnitude along the edges. The polyhedron for H0equal to the maximum storage capacity of a single wheel bounds the angular momentum storage capacity of the wheel conﬁguration. Figure 4.10 shows the polyhedron for a six-wheel pyramid conﬁguration with the parametersbDcDp 1=3,aDdDp 2=3, and axes labeled in units of H0.10 We now want to invert Eq. ( 4.84) in order to transform the body frame angular momentum into the wheel frame. Writing this as a matrix equation, Hw BD/STX wiwjvij/ETX2 4Hw i Hw j H03 5 (4.87) 10The momentum polyhedron of the dodecahedron reaction wheel conﬁguration takes the form of a rhombic tricontahedron, the shape of a 30-sided die.160 4 Sensors and Actuators and inverting gives 2 4Hw i Hw j H03 5D1 .wi/STXwj//SOHvij2 4.wj/STXvij/T .vij/STXwi/T .wi/STXwj/T3 5Hw B (4.88) The ﬁrst two rows of this equation give Hw iandHw j, and the third row and Eq. ( 4.82) give Hw kD.wij/SOHHw B/sign.sijk/fork¤i;j (4.89) where wij/DC1Œ.wi/STXwj//SOHvij/c141/NUL1.wi/STXwj/ (4.90) Comparing with Eq. ( 4.86) shows that kwijkDd/NUL1 ij (4.91) Equations ( 4.88) and ( 4.89) can be rearranged into the matrix form Hw WDWij nHwB(4.92) where the elements of the matrix Wij nare speciﬁed by Eqs. ( 4.88) and ( 4.89). This matrix was explicitly constructed to satisfy Eq. ( 4.65b ), so it follows that WnWij nDI3 (4.93) which is the same as Eq. ( 4.72) for the pseudoinverse. Thus Wij nsatisﬁes all the requirements for being a pseudoinverse except that Wij nWnis not symmetric in general. It appears that we have n.n/NUL1/matrices for computing the minimax momentum distribution, and we need a criterion to choose among them. Before proceeding, however, we note from the symmetry of the equations under interchange of the indices iandjthat Wij nDWji n, so we actually have only n.n/NUL1/=2 independent minimax distribution matrices. We will show the minimax distribution matrices for the four-wheel pyramid as an illustration. With /ESC/DC1sign.bc/, these matrices are found to be W12 4D1 22 6641=a 1=b 0 /NUL1=a1=b 0 0 0 1=d00/NUL1=d3 775; W 34 4D1 22 6641=a 0 0 /NUL1=a 0 0 0 1=c 1=d01 = c/NUL1=d3 775 W 13 4D1 2.bC/ESCc/2 664.bC2/ESCc/=a 1/NULc=d /NULb=a 1/NULc=d /NUL/ESCb=a /ESC.2bC/ESCc/=d /NUL/ESCb=a /ESC/NUL/ESCc=d3 7754.8 Reaction Wheels 161 OH0djkHw BH0dijfij fjkFig. 4.11 Identifying the correct face. See text forexplanation W14 4D1 2.bC/ESCc/2 664.bC2/ESCc/=a 1 c=d /NULb=a 1 c=d /NUL/ESCb=a /ESC /ESCc=d /NUL/ESCb=a /ESC/NUL.2bC/ESCc/=d3 775 W23 4D1 2.bC/ESCc/2 664b=a 1/NULc=d /NUL.bC2/ESCc/=a 1/NULc=d /ESCb=a /ESC.2bC/ESCc/=d /ESCb=a /ESC/NUL/ESCc=d3 775 W24 4D1 2.bC/ESCc/2 664b=a 1 c=d /NUL.bC2/ESCc/=a 1 c=d /ESCb=a /ESC /ESCc=d/ESCb=a /ESC/NUL.2bC/ESCc/=d3 775(4.94) Finding the correct matrix to compute the minimax distribution requires identify- ing the face of the polyhedron that the body momentum vector falls on. Figure 4.11 is an edge-on view of two adjoining faces, f ijandfjk, which means that wjis normal to the plane of the paper. The center of the polyhedron, the origin of body momentum space, is labeled O, and the normal distances from the origin to the faces are speciﬁed. The projection of the body momentum vector Hw Binto the plane of the paper is also shown. We assume that the momentum is on face fij, as indicated by the tip of the arrow. Equations ( 4.90) and ( 4.91) tell us that wijDd/NUL1 ijeij, where eij is the unit vector normal to fij, so we see from the ﬁgure that wij/SOHHw B wjk/SOHHw BDd/NUL1 ijeij/SOHHw B d/NUL1 jkejk/SOHHw B>1 (4.95) The inequality holds because eij/SOHHw BDH0dijandejk/SOHHw B, the distance from the origin to the dashed line in the ﬁgure, is less than H0djk, the distance to fjk. Thus the angular momentum will be on face fijifwij/SOHHw B>wjk/SOHHw B. Generalizing this to the entire polyhedron establishes that the correct face is the one producing162 4 Sensors and Actuators the maximum value of wij/SOHHw B.11Note thatfijisnotthe face whose normal vector is closest to Hw Bin general, because the distances dijto the different faces are not equal. The equality of Wij nand Wji nmeans the we only have to identify the correct pair of parallel faces, and the relation wijD/NULwjisays that this requires evaluating n.n/NUL1/=2 dot products and ﬁnding the maximum value of jwij/SOHHw Bj. It is often better to maximize the torque provided by a reaction wheel array, rather than its angular momentum storage capacity. The Swift spacecraft provides anexcellent example. Being in near-Earth orbit, it can unload momentum continuously, so the stored momentum is always small; and high torques are required to slew rapidly in order to image transient gamma-ray bursts. Thus we command the wheel torque vector L w WDWjk nLw B, wherefjkis the face that maximizes jwjk/SOHLw Bj. This torque will not necessarily maintain a minimax distribution of reaction wheel momenta, because the face on which jwjk/SOHLw Bjis maximized is generally not the same as the face on which jwij/SOHHw Bjis maximized. This can be dealt with by setting up a slower control loop to asymptotically drive the wheels to their minimax momentum distribution. The controller can use wheel tachometer data to computeH w Wand Eq. ( 4.65b ) to compute the body angular momentum. Maximizing jwij/SOHHw Bj identiﬁes the face providing the minimax momentum distribution and thus provides the desired wheel momentum Wij nHw BDWij nWnHw W. Then the torque command is Lw WDWjk nLwBC/DC4.Wij nWnHwW/NULHw W/DWjk nLwBC/DC4.Wij nWn/NULIn/Hw W(4.96) where Lw Bis the desired torque in the body frame and /DC4is a feedback gain. Equation ( 4.93) shows that the feedback term is in the null space of Wn, so it does not affect the resultant torque in the body frame. Another observation about minimax distribution of momentum is that unaccept- able jitter can result if n/NUL2wheel speeds coincide with the frequency of a ﬂexible mode of the spacecraft structure. It is also desirable to avoid sustained operation ofreaction wheels near zero speed. These problems can be avoided without perturbing the spacecraft pointing by using torque or momentum in the .n/NUL3/-dimensional null space of W nto separate equal wheel speeds or to drive a wheel’s speed rapidly through zero or past a resonant frequency [ 41]. Minimizing jitter is most important during stable pointing of the spacecraft, especially for a precision pointing mission like JWST with its milli-arcsecond level stability requirements. Avoidingwheel speeds near zero or a resonant frequency is less important and sometimes unavoidable while executing slews, as will be seen in the examples in the next section. 11This relation, which is crucial for real-time implementation of the minimax algorithm, was discovered by Frank X. Liu.4.8 Reaction Wheels 163 Table 4.2 Multiple wheel capability as a multiple of the capacity of a single wheel for pseudoinverse and minimax distribution Conﬁguration Wheel Failure Pseudoinverse Minimax NASA Standard None 1.155 1.414 Any Orthogonal 0.577 0.577 Skew 1.000 1.000 Four-Wheel Pyramid None 1.333 1.633 Any One 0.816 0.816 Six-Wheel Pyramid None 2.000 2.667 Any One 1.309 1.667 Dodecahedron None 2.000 2.753 Any One 1.581 1.902 4.8.3.3 Comparison of Pseudoinverse and Minimax Distribution Laws We will now examine the maximum momentum storage capacity in the least favorable direction of several wheel conﬁgurations, using the minimax or pseudoin- verse method to distribute the angular momentum. Recall that the same relations will hold for the torque capability of the array. We denote the momentum storagecapacity of a single wheel by H max. The momentum storage capacity is determined by considering the maximum momentum that can be assigned to any wheel for a given magnitude of body momentum. This occurs for the pseudoinverse methodwhen H w Bis parallel to the row of the pseudoinverse matrix corresponding to that wheel, and the magnitude of the momentum assigned to the wheel will be the product of the magnitude of the body momentum and the Euclidean norm of thatrow vector. Thus the momentum capacity in the least favorable direction is H max divided by the maximum of the norms of the rows of the pseudoinverse matrix. Analysis of the minimax method indicates that the maximum storage on face fijis at least as large as dij.12Thus the minimax storage capacity in the least favorable direction isHmaxtimes the minimum of dijover all the faces. Table 4.2shows the capabilities of four wheel conﬁgurations: the NASA Standard conﬁguration with ˛DˇD/CRD1=p 3, the four-wheel and six-wheel pyramids with bDcDp 1=3 andaDdDp 2=3, and the six-wheel dodecahedron. Reference [ 41] proves that these parameters for the pyramid con- ﬁgurations make their storage capability as isotropic as possible.13It must be emphasized that these choices will rarely be optimal for any speciﬁc mission, since moments of inertia, slewing requirements, and environmental torques arealmost never isotropic. However, they provide a baseline for comparing the different 12This is true for all the conﬁgurations considered here, but may not hold for some pathological conﬁgurations [ 41]. 13The four-wheel and six-wheel pyramids with these parameters, and also the dodecahedron, have WnWT nD.n=3/I3. Then Eq. ( 4.75) shows that the pseudoinverse distribution method gives kHw Wk2D.3=n/ kHw Bk2for these conﬁgurations.164 4 Sensors and Actuators conﬁgurations and distribution methods. We also present the storage capacities of the four conﬁgurations with one wheel failure. The minimax method provides more momentum storage or torque capability than the pseudoinverse method for almost all cases in Table 4.2. The only exceptions are the four-wheel conﬁgurations with a failed wheel, which are three-wheel con- ﬁgurations for which W3has a unique inverse. The NASA Standard conﬁguration provides less capability than the four-wheel pyramid with all wheels active, and is quite a bit less capable in the single-point failure case if one of its orthogonal wheels fails. It is better only in the statistically less likely case that the failed wheelis the skew wheel. The dodecahedron provides little advantage over the six-wheel pyramid conﬁguration if all six wheels are functioning, but it performs better in the single-point failure case. We also compare simulations of a rest-to-rest 90 ıslew using the minimax and pseudoinverse methods to distribute angular momentum among six wheels in the same pyramid conﬁguration as was used for the capacity comparisons. This exampleis motivated by JWST, but differs in several details. The slew is about the body e 1 axis, the cone axis of the wheel conﬁguration, and starts with system momentum of 2H maxin the bodyCe2direction. We ignore the very small changes in the system momentum during the slew arising from external torques. The slew begins with a constant angular acceleration of 1:6/STX10/NUL4deg/s2or90deg=.750 s/2for a time taccel/DC4750s. This is followed by a coast at a constant angular rate between taccel and.750 s/2=taccel. The slew ends with a deceleration at /NUL1:6/STX10/NUL4deg=s2for a timetaccel. There is no coast period if taccelD750s, so this limit represents an acceleration-limited slew in the minimum time of 25 min. The system momentumin the spacecraft body frame is H BDJ!CHw BDA.e1;/DC2/2 40 2H max 03 5 (4.97) which gives, assuming a diagonal inertia tensor, Hw BD2 4/NULJ1P/DC2 2H maxcos/DC2 2H maxsin/DC23 5 (4.98) The simulation uses J1DHmax/STX750s, consistent with values of 60 Nms for Hmaxand 45,000 kg-m2forJ1, the approximate values for JWST. It follows from Eq. ( 4.98) thatkHw Bk2D4H2 maxC.J1P/DC2/2. With the parameters used in the simulations, this has the maximum value kHw BkmaxD2H maxp 1C./EMt accel=3;000 s/2 (4.99) Figure 4.12 shows the wheel momenta that result from using the pseudoinverse algorithm to distribute the momentum of Eq. ( 4.98) among the six wheels, identiﬁed4.8 Reaction Wheels 165 0 5 10 15 20 25 30 35 40−1.0−0.8−0.6−0.4−0.200.20.40.60.81.0 2 3 6 4 51 Fig. 4.12 Wheel momenta for 36-min slew using pseudoinverse distribution 0 5 10 15 20 25 30 35 40−1.0−0.8−0.6−0.4−0.200.20.40.60.81.0 2 456423212 1126 3451 3 45 566 Fig. 4.13 Wheel momenta for 36-min slew using minimax distribution by the labels on the curves. The acceleration time is taccelD303s, which gives a slew time of 36 min. The magnitude of the angular momentum of wheel 5 reaches99:97 %o fH max,s ot h i s9 0ıslew cannot be performed in less than 36 min using the pseudoinverse momentum distribution method. By Eq. ( 4.99), the maximum angular momentum in the body frame during this slew is 2:098H max, greater than the maximum value of 2H maxallowed by Table 4.2. That is not a contradiction, because the angular momentum in this simulation is not in the least favorable direction. The minimax momentum distribution method can be used to either reduce the maximum wheel angular momentum for a given slew time or to slew more rapidly. Figure 4.13 shows the ﬁrst option, keeping taccelD303s and reducing the maximum wheel angular momentum magnitude to less than 75 % of Hmax, a reduction of 25 % compared to the pseudoinverse method. The plots show that there are always four wheels with the same angular momentum magnitude, and also that the minimax166 4 Sensors and Actuators 0 5 10 15 20 25 30 35 40−1.0−0.8−0.6−0.4−0.200.20.40.60.81.0 4223 345126 5662 3 1 4561 3456 Fig. 4.14 Wheel momenta for 25-min slew using minimax distribution method leads to discontinuous wheel torque commands when the momentum moves between faces of the polyhedron. The greater slope of the momentum vs. timecurves shows that the minimax momentum distribution method demands higher wheel torques than the pseudoinverse method. The maximum wheel torque in Fig. 4.12 isL 1DHmax=.776 s/, while the maximum wheel torque in Fig. 4.13 isL1DHmax=.353 s/, more than twice as great. Figure 4.14 shows a minimum-time, acceleration-limited ( taccelD750s) slew using minimax momentum distribution. The 25 min slew time is 30 % less thanthe time required by the pseudoinverse method, and the maximum wheel angular momentum magnitude is limited to 93.16 % of H max. The maximum body angular momentum during this slew is 2:543H max, which is less than the 2:667H maxallowed by Table 4.2. This slew would probably require high-torque wheels to provide the maximum wheel torque of L1DHmax=.179 s/, however. 4.9 Control Moment Gyros This section expands on the brief discussion of CMGs for attitude control in Sect. 3.3.5.1 . Although double-gimbal control moment gyros have been developed, their mechanical complexity has led to their being supplanted by single-gimbal control moment gyros (SGCMGs) in most applications. A SGCMG has a wheel spinning at constant speed about a spin axis wjwith an angular momentum of magnitude Hw j.14Rotating the angular momentum about a gimbal axis gj perpendicular to the spin axis requires a torque 14Variable-speed CMGs, combining the properties of CMGs and reaction wheels, have been proposed but are not widely employed.4.9 Control Moment Gyros 167 Lw jDd.Hw jwj/ dtDHw jPwjDHw jP/DC2jgj/STXwj (4.100) where/DC2jis the gimbal angle in radians. The reaction torque exerted on the spacecraft is the negative of this. CMGs are capable of providing higher torquesthan reaction wheels because it is easier to apply a torque to a slowly-moving gimbal than to a rapidly-rotating wheel. CMGs are also advantageous from energy considerations, because the rotational kinetic energy stored in a CMG rotor movingat constant speed does not change, whereas energy must be added to or subtracted from a reaction wheel to change its speed. The angular momentum of CMGs covers a wide range from less than 1 Nms to greater than 2,000 Nms. Maximum gimbalrates are typically in the range from 0.2 to 2 rad/s, which gives an idea of the available torques. It is clear that at least three SGCMGs are needed to provide three-axis control, and a system of nSGCMGs gives L wDnX jD1Hw jP/DC2jgj/STXwjDWCMG nP/DC2 (4.101) where WCMG n/DC1/STX Hw 1g1/STXw1Hw 2g2/STXw2/SOH/SOH/SOHHw ngn/STXwn/ETX (4.102) and P/DC2/DC1/STXP/DC21P/DC22/SOH/SOH/SOHP/DC2n/ETXT(4.103) The methods developed for reaction wheels in Sect. 4.8.3 can be used to invert these equations in order to ﬁnd P/DC2in terms of Lw, but there are additional complications for SGCMGs. The directions of the gimbal axes are ﬁxed, but the directions of the spin axes vary as the gimbal angles change, so the matrix WCMG n is not constant. A greater problem is that a system of SGCMGs can reach a singular conﬁgurationin which all the available torques lie in a plane, resulting in a loss of control authority about the axis perpendicular to the plane. These singular conﬁgurations, and methods for avoiding them, have been studied extensively [ 30,40,67]. In a system with only three SGCMGs, the commanded gimbal rates are determined uniquely by the inverse of W CMG n , so there are no extra degrees of freedom for steering around singular conﬁgurations. For this reason, systems of SGCMGsinvariably employ four or more CMGs.168 4 Sensors and Actuators 4.10 Magnetic Torquers Magnetic torquers create a magnetic dipole moment, m, which in turn creates a torque given by Eq. ( 3.159 ). Magnetic torques can be used either directly for attitude control or to unload momentum accumulated by reaction wheels or CMGs. The simplest torquers are made of Nturns of wire in a loop of area A; sending a current Ithrough such a coil produces a magnetic dipole moment of magnitude mDNIA in a direction perpendicular to the plane of the coil. This relation has the advantage of being a perfectly linear function of the current, but large areas or many turns are required to produce the dipole moments needed by many spacecraft. For thisreason torque rods , which are coils of wire wrapped around ferromagnetic cores, are employed to obtain greater dipole moments for a given amount of current. Ferromagnetic materials exhibit hysteresis, as shown in Fig. 4.15. The dipole moment has a maximum value known as the saturation value, m sat, when all the magnetic dipoles in the ferromagnetic material line up in the same direction. There is also a residual dipole, mres, when no current is applied. The sign of the residual dipole depends on the direction from which the zero-current condition is approached, as the hysteresis curve is traversed in a counterclockwise direction. For most commercially available torque rods, the residual dipole moment is less than1 % of the saturation moment, and the dipole moment is an approximately linear function of the current for dipole moments of at least 80 % of the saturation value, as indicated in the ﬁgure. Torque rods are available with saturation moments rangingfrom about1to1;000 Am 2and scale factors ranging from less than 0:1Am2=mA to almost3Am2=mA, with the larger scale factors corresponding to the larger moments. Note that attaining a scale factor of 1Am2=mA without a ferromagnetic core would require a number of turns and coil area satisfying NAD1;000 m2. Most applications of magnetic torquers use three torquers producing moments on orthogonal axes. It is generally not necessary to employ extra torque rodsfor redundancy, because they usually have dual windings to provide internal redundancy. Sometimes more than three torque rods are used to provide additional capability, giving a total magnetic dipole moment equal to the vector sum of themoments provided by the individual rods. In this case, the desired net magnetic m msat mres I Fig. 4.15 Typical hysteresis loop; magnetic dipolemoment as a function ofapplied current4.11 Thrusters 169 moment can be distributed among the torquers by using one of the algorithms developed in Sect. 4.8.3 to distribute torque or angular momentum among reaction wheels. 4.11 Thrusters Thrusters generate both forces and torques, so they can be used for both trajectorycontrol and attitude control, as was brieﬂy discussed in Sect. 3.3.6.5 . Reference [ 33] provides an excellent overview of spacecraft propulsion systems. Thrusters have the advantage of not being dependent on an ambient magnetic or gravitational ﬁeld,so they can be used for control or momentum unloading in any orbit. They have the disadvantage of requiring an expendable propellant, so that the life of a thruster- dependent mission is limited by the propellant supply. The force and torque providedby a thruster are F mexpD/NULPmvrel (4.104a) LmexpDr/STXFmexp (4.104b) wherePmis the rate at which mass is expelled, vrelis the velocity of the expelled mass relative to the spacecraft, and ris the vector from the spacecraft center of mass to the thruster. These equations show that the thrust and torque for a given mass expenditure are linearly proportional to the velocity vrel. Writing Eq. ( 4.104a ) asvrelD/SOHp=/SOHm shows that this parameter has the units of impulse per unit mass of propellant, so it is referred to as the speciﬁc impulse and can be expressed in units of Ns/kg. It is more common to normalize the speciﬁc impulse by the accelerationof gravity at the surface of the Earth, g 0D9:80665 m/s2, to express it in time units: Isp/DC1vrel=g0 (4.105) Three types of thrusters are in common use for attitude control. Cold gas thrusters use a non-reacting gas stored at high pressure, on the order of 30MPa. The most common gases are nitrogen, with a speciﬁc impulse of about 70s, and helium, with a speciﬁc impulse of about 175s. Using helium saves mass, but it is more expensive and more prone to leakage because of the small size of the helium molecule. Helium also requires a propellant tank with seven times as much volume or seven times higher pressure than the equivalent amount of nitrogen. Other propellants are used,but more rarely, in cold gas systems. Monopropellant thrusters use a propellant that is decomposed catalytically. Hydrazine, with I spD242 s, is by far the most common monopropellant. Monopropellant systems do not require the high pressures needed for cold gas, but hydrazine is a highly toxic material. This has led to interest in less toxic “green” propellants, such as hydroxyl ammonium nitrate (HAN), with IspD266 s, and170 4 Sensors and Actuators ammonium dinitramide (ADN), with IspD253s. These new propellants are less harmful to the environment, diminish operational hazards, and actually increase fuel efﬁciency due to their higher speciﬁc impulse [ 68]. The third class of thrusters uses electric ﬁelds to accelerate the expelled mass to a high velocity. The speciﬁc impulse of electric thrusters ranges from 500 to 3;000 s, so the saving in propellant mass is apparent. The kinetic energy that must be provided to the expelled mass is mv2 rel=2, so the power required by the thruster, assuming 100 % efﬁciency, is PthrusterD1 2Pmv2 relD1 2Fmexpvrel (4.106) This energy is stored in the pressure vessel for cold gas thrusters and is provided by chemical decomposition for monopropellant thrusters, but it must be providedby the spacecraft power system for electric propulsion. Thus we see that an electric propulsion system with a higher speciﬁc impulse requires less propellant but more power to generate a given level of thrust. An attitude torque provided by thrusters will perturb the spacecraft’s orbit unless it is provided by a pair of equal and opposite forces comprising a perfect couple L coupleDr1/STXFmexpCr2/STX./NULFmexp/D.r1/NULr2//STXFmexp (4.107) Couples also have the advantage of being insensitive to a shift in the spacecraft’s center of mass, which would give r1!r1/NUL/SOHrandr2!r2/NUL/SOHr, and thus would leave Lcouple unchanged. Several factors make it impractical to provide perfect couples, though. It is often desirable to have all the thrusters on one face of aspacecraft to facilitate modular integration of the propulsion system, to minimize the amount of propellant plumbing required, or to protect sensitive instruments from the deleterious effects of thruster plume impingement. The difﬁculty of providingperfect couples makes it important to minimize the migration of the spacecraft’s center of mass, either by locating a single propellant tank at the center of mass or by distributing tanks symmetrically around the center of mass and drawing equalmasses of propellant from them. 4.12 Nutation Dampers Nutation dampers are passive devices designed to dissipate energy, thereby produc- ing steady rotation of a spinning spacecraft about its axis of maximum principal moment of inertia, as described in Sect. 3.3.3.2 . Libration dampers are similar energy-dissipation mechanisms used to eliminate libration on spacecraft employing gravity gradient stabilization, as discussed in Sect. 3.3.8 . The energy-dissipating medium in either case can be a viscous ﬂuid, a ﬂexible spring with high structuraldamping, or electrical eddy currents [ 66].4.12 Nutation Dampers 171 Fig. 4.16 ST5 passive nutation damper. Source: NASA A very common type of nutation damper is the viscous ring nutation damper , a tube bent into the shape of a ring and ﬁlled with a viscous ﬂuid [ 7,27]. If the ﬂuid does not ﬁll the ring completely, surface tension at the interfaces of the ﬂuid and gas (or vacuum) can cause the ﬂuid to be locked in place, with a resultant loss of damping action. For this reason, viscous ring dampers are commonly fully ﬁlled and equipped with bellows to accommodate thermal expansion and contraction of the ﬂuid. Some dampers, however, have omitted bellows because of space limitations, tolerating vacuum bubbles at non-operational low temperatures and using tubing strong enough to handle high pressures at the upper end of the operational temperature range. The viscous ring nutation damper of NASA’s Space Technology-5 (ST5) mission, illustrated in Fig. 4.16 provides a good example [ 47]. We will use the methods of Sect. 3.3.5.1 to simulate the effect of a single fully-ﬁlled viscous ring nutation damper on a triaxial spacecraft with principal momentsJ1<J2<J3. The damper is modeled as a reaction wheel with its axis perpendicular to the plane of the ring, along the axis of intermediate inertia, the orientation providing the most effective damping. We will neglect external torques, so the system angular momentum will have a constant magnitude H. Letting HBDHu, where uis a unit vector, Eq. ( 3.80) can be written PuD/NUL!BI B/STXuD/NUL.H=J3/ŒD. u/NUL/USe2//c141/STXu (4.108)172 4 Sensors and Actuators where D/DC1J3J/NUL1 BDdiag.ŒJ3=J1J3=J21/c141//DC1diag.Œ/CR1/CR21/c141/ (4.109) and /US/DC1Hw=H (4.110) withHwbeing the angular momentum of the ﬂuid in the damper. These equations must be integrated numerically, but the unit vector nature of ucan be used to eliminate one degree of freedom. With u1Dq 1/NULu2 2cos/DLEandu3Dq 1/NULu2 2sin/DLE, the differential equation for u2is Pu2D.H=J3/.1=2/./CR1/NUL1/.1/NULu2 2/sin2/DLE (4.111) and the differential equations for u1andu3are equivalent to P/DLED.H=J3/f.1=2/Œ2/CR2/NUL/CR1/NUL1/NUL./CR1/NUL1/cos2/DLE/c141u2/NUL/CR2/USg (4.112) We assume that the torque acting on the damper ﬂuid is linearly proportional to and in the opposite direction from the ﬂuid’s angular velocity !w: LwD/NUL˛.Jk=J3/H!wD/NUL˛ˇH!w(4.113) where˛is a dimensionless damping coefﬁcient, Jkis the MOI of the moving ﬂuid, andˇis deﬁned by the last equality. The actual value of the damping coefﬁcient depends on the diameter of the tubing and the density and viscosity of the ﬂuid, incorporated in a “wobble Reynolds number,” but we will treat it simply as a tunable parameter [ 7,27]. Then Eqs. ( 3.145 ) and ( 3.141 ) give the equation of motion of the dimensionless damper angular momentum: P/USDLw=HD/NUL˛ˇ!wD/NUL˛ˇŒ.Hw=Jk//NULe2/SOH!BI B/c141 D/NUL˛ˇŒ./USH=Jk//NUL.u2/NUL/US/H=J2/c141D˛.H=J3/Œˇ/CR2u2/NUL.1Cˇ/CR2//US/c141(4.114) The MATLAB integrator ode45 was used to integrate Eqs. ( 4.111 ), (4.112 ), and ( 4.114 ) for a spacecraft with the inertia ratios of Fig. 3.2b, which give /CR1D2 and/CR2D3=2. The damper MOI was assumed to give ˇD0:005 , which about an order of magnitude larger than a reasonable damper could provide, but was chosen to give readable plots. The damping coefﬁcient was assigned the value ˛D1=p 2, which we will show to be the optimal value. The initial values of /DLED/NUL0:01 rad and u2D/USD0represent very nearly pure spin about e1, the spacecraft axis of minimum MOI. The results of the simulation, displayed in Fig. 4.17, illustrate quantitatively in non-dimensional units the qualitative behavior discussed4.12 Nutation Dampers 173 0 500 1000 1500 2000 2500−1−0.8−0.6−0.4−0.200.20.40.60.81 0 500 1000 1500 2000 2500−1−0.8−0.6−0.4−0.200.20.40.60.81 0 500 1000 1500 2000 250011.11.21.31.41.51.61.71.81.92ab cd Fig. 4.17 Simulation of spinning spacecraft with nutation damper. ( a) Intermediate axis angular momentum. ( b) Path on momentum sphere. ( c) Damping ﬂuid spin rate. ( d) Rotational kinetic energy in Sect. 3.3.3 . Figure 4.17a shows the component of the angular momentum along the axis of intermediate inertia; it begins at zero, then acquires an oscillatory behavior that grows to an amplitude close to the total system angular momentum,and ﬁnally decays to zero. The rotational kinetic energy in dimensionless form, 2J 3Ek=H2D.1/NULu2 2/./CR1cos2/DLECsin2/DLE/C/CR2.u2/NUL/US/2C/US2=ˇ (4.115) is plotted in Fig. 4.17d. It starts at the value /CR1D2, the value for pure rotation around the axis of minimum inertia, and ends at 1, the value for pure rotation around the axis of maximum inertia. It crosses the value /CR2D3=2, the value for pure rotation around the axis of intermediate inertia, at time t/ETXD1184J3=H, when the intermediate axis momentum reaches its maximum amplitude. Figure 4.17bs h o w s the path followed by the angular momentum on the angular momentum sphere;174 4 Sensors and Actuators it spirals out from e1, crosses the terminator at time t/ETX, and then spirals in toward e3. Slightly different initial conditions or a slightly different damping factor could very easily have caused the path on the momentum sphere to cross the other terminator,resulting in a ﬁnal spin about /NULe 3instead of e3. The path is only plotted for times between700J3=Hand1600J3=H, which is for 1:03<2J 3Ek=H2<1:98 , because the paths become even denser than those shown at earlier and later times. Finally,Fig.4.17c shows the spin rate of the damping ﬂuid in dimensionless form, J 3!w=HD/US=ˇ/NUL/CR2.u2/NUL/US/ (4.116) which attains its peak amplitude near t/ETX. The rate of energy dissipation is propor- tional to.!w/2, but it slows slightly at time t/ETXbecause energy dissipation vanishes instantaneously for steady rotation about the damper axis. We will now motivate our choice of the damping parameter ˛by analyzing motion near the minimum or maximum principal axis. We set /DLED/DLE0C/DLE0, where /DLE0D0or/EMfor nutation about the axis of minimum inertia, and /DLE0D˙/EM=2 for nutation about the axis of maximum inertia. We linearize Eqs. ( 4.111 ), (4.112 ), and ( 4.114 ) for small/DLE0,u2, and/US, noting that sin 2/DLE0D0. We also deﬁne c/DC1cos2/DLE0so thatcD1for/DLE0D0or/EM, andcD/NUL1for/DLE0D˙/EM=2.T h e linearized equations in matrix form are d dt2 4/DLE0 u2 /US3 5DH J32 40/NULc/SYN/NUL/CR2 c./CR1/NUL1/ 0 0 0˛ ˇ /CR 2/NUL˛.1Cˇ/CR2/3 52 4/DLE0 u2 /US3 5 (4.117) where /SYND( /CR1/NUL/CR2forcD1 /CR2/NUL1 forcD/NUL1(4.118) The general solution of these coupled linear differential equations is a superposition of three components of the form 2 4/DLE0.t/ u2.t/ /US.t/3 5D2 4/DLE0.0/ u2.0/ /US.0/3 5e/NAKt(4.119) with coefﬁcients satisfying initial conditions. A nontrivial solution exists only if /NAK is one of the three roots of the eigenvalue equation 0Ddet8 < :/NAKI3/NULH J32 40/NULc/SYN/NUL/CR2 c./CR1/NUL1/ 0 0 0˛ ˇ /CR 2/NUL˛.1Cˇ/CR2/3 59 = ; D./NAK2CQ!2 p/Œ/NAKCH˛.1Cˇ/CR2/=J3/c141Cc˛ˇ.H=J 3/3/CR2 2./CR1/NUL1/ (4.120)4.12 Nutation Dampers 175 where Q!pDH J3p /SYN./CR1/NUL1/D( .H=J3/p .J3/NULJ1/.J3/NULJ2/=J1J2forcD1 .H=J1/p .J2/NULJ1/.J3/NULJ1/=J2J3forcD/NUL1 (4.121) The cubic eigenvalue equation does not have nice analytic solutions, but its solutions are close to those obtained by ignoring the last term on the right side becauseˇis very small. Those approximate solutions are /NAK0D/NULH˛.1Cˇ/CR2/=J3and/NAK˙D˙iQ!p (4.122) The real eigenvalue /NAK0has the eigenvector Œ 001 /c141Tin theˇD0limit. It describes only uninteresting transient behavior, the rapid decay of an initial value of Hw. The purely imaginary eigenvalues are more interesting, describing sinusoidal motion with frequency Q!p. In the limit of small nutation about the e3axis, i.e. for cD/NUL1and2EkDH2=J3, this frequency agrees up to a sign with the nutation frequency given by Eq. ( 3.120 ). The expression for cD1, i.e. for nutation about the e1axis, has the same form with J1andJ3interchanged, as would be expected. Now we need to consider the effect of the term in Eq. ( 4.120 ) that we have ignored up to this point. This will cause a small change in /NAK˙, so we substitute /NAK˙D˙iQ!pC/SI˙ into Eq. ( 4.120 ), giving 0D.˙2iQ!p/SI˙C/SI2 ˙/Œ˙iQ!pC/SI˙CH˛.1Cˇ/CR2/=J3/c141Cc˛ˇ.H=J 3/3/CR2 2./CR1/NUL1/ /EM˙2iQ!p/SI˙.˙iQ!pCH˛=J3/Cc˛ˇ.H=J 3/3/CR2 2./CR1/NUL1/ (4.123) The approximation ignores all terms of higher than ﬁrst order in /SI˙andˇ. Solving for/SI˙gives /SI˙Dc˛ˇ.H=J 3/3/CR2 2./CR1/NUL1/ 2Q!p.Q!p/BELiH˛=J3/Dc˛ˇ.H=J 3/3/CR2 2./CR1/NUL1/.Q!p˙iH˛=J3/ 2Q!pŒQ!2pC.H˛=J3/2/c141 (4.124) and thus /NAK˙D˙iQ!p/SUB 1Cc˛2ˇ/CR2 2 2/SYNŒ.J3Q!p=H/2C˛2/c141/ESC CcH 2J3˛ˇ/CR2 2./CR1/NUL1/ .J3Q!p=H/2C˛2(4.125) The quantity in the curly brackets gives a small correction to the nutation frequency, less than 1 % for the parameters of our simulation. The second term is much more important; it gives an exponentially growing nutation amplitude for cD1and an exponentially decaying amplitude for cD/NUL1, exactly what we expect for motion near the axis of minimum or maximum principal MOI, respectively. The time constant of the growth or decay is176 4 Sensors and Actuators /FSD2J3 H.J3Q!p=H/2C˛2 ˛ˇ/CR2 2./CR1/NUL1/D2/SYN ˇ/CR2 2Q!p˛2C/SYN./CR1/NUL1/ ˛p /SYN./CR1/NUL1/(4.126) It is easy to see that the time constant is minimized for ˛Dp /SYN./CR1/NUL1/.F o r/CR1D2 and/CR2D3=2,˛D1=p 2provides the minimum time constant near both e1ande3, which is why this value was chosen for the simulation. As a check, simulations with ˛D0:6and˛D0:8both gave slower damping. Choosing the optimal damping coefﬁcient gives /FSminD4/SYN ˇ/CR2 2Q!p(4.127) which is on the order of 1=ˇ times the nutation period. A more realistic value of ˇ than was used in the simulations would result in damping times about ten times asgreat. Problems 4.1. Use the properties of the Poisson distribution to verify the probabilities for star availability presented in Sect. 4.2.4 , i.e.NND6:75 gives a 90 % probability of having four or more stars in the FOV , NND8gives a 90 % probability of having ﬁve or more stars in the FOV , NND10gives a 99 % probability of having four or more stars in the FOV , and NND11:7 gives a 99 % probability of having ﬁve or more stars in the FOV . 4.2. The discrete-time gyro simulation model in Eq. ( 4.54) can also be derived from Farrenkopf’s model given in Eq. ( 6.116 ), which is summarized by /DC2true kC1D/DC2true k/NUL/SOHtˇtrue kC/SOHt!kCw1k ˇtrue kC1Dˇtrue kCw2k whereE˚ wkwT k/TAB DQ, with wkDŒw1kw2k/c141Tand QD2 4/ESC2 v/SOHtC1 3/ESC2 u/SOHt3/NUL1 2/ESC2 u/SOHt2 /NUL1 2/ESC2 u/SOHt2/ESC2 u/SOHt3 5 To simulate the correlated process noise process a Cholesky decomposition of Qcan be used, with LTLDQ. First, prove that this can be done. Consider a zero-mean Gaussian white-noise variable wkwith covariance Q. Show that wkDLTpkcan be used to simulate the correlated process noise, where pkis zero-mean Gaussian white-noise process with covariance given by the identity matrix.Problems 177 Assume the following form for L: LD/DC4˛/CR ˇ0/NAK Determine˛,ˇand/CRfromQin terms of/ESCu,/ESCvand/SOHt. Next, using ./DC2true kC1/NUL /DC2true k/=/SOHtD!true kprove that the scalar version of Eq. ( 4.54) can be derived from Farrenkopf’s model. 4.3. Show that the discrete-time gyro simulation model in Eq. ( 4.54) can effectively be executed using the following model for each axis: !kC1D!true kC1CykC/DC2/ESC2 v /SOHtC1 12/ESC2 u/SOHt/DC31=2 Nvk ˇtrue kC1Dˇtrue kC/ESCu/SOHt1=2Nuk ykDˇtrue kC1 2/ESCu/SOHt1=2Nuk Note that the last two equations give the following discrete-time system matrices as deﬁned in Eq. ( 12.49 ):˚D1,/NULD1,HD1, andDD1=2with input given by/ESCu/SOHt1=2Nuk. Therefore,ykis ﬁrst obtained using the aforementioned discrete- time state model and then substituted into the !kC1equation to provide simulated discrete-time gyro measurements. 4.4. Find, as a function of /CRand!0, the wheel speed at which the upper whirl frequency!Cof Eq. ( 4.63) coincides with the ﬁrst harmonic of the wheel speed !D2!w. Find the numerical value of this in rpm for /CRD0:91 and!0D60Hz. Discuss. 4.5. This problem has two parts: a) Derive the wheel capabilities in Table 4.2. b) Derive the wheel capabilities in the two-failure cases for the six-wheel conﬁg- urations in Table 4.2. There are three different possibilities for the six-wheel pyramid: failure of adjacent wheels (e.g. 1&2), failure of opposite wheels (e.g. 1&4), and the intermediate case (e.g. 1&3). In contrast to this, all two-wheel failures in the dodecahedron conﬁguration are equivalent. 4.6. Repeat the analysis leading to Figs. 4.12,4.13, and 4.14 using the four-wheel conﬁguration W4of Eq. ( 4.66) withbDcDp 1=3andaDdDp 2=3.A si nt h e example in the text, assume a rest-to-rest 90ıslew about the body e1axis, beginning with a constant angular acceleration of 1:6/STX10/NUL4deg/s2for a timetaccel/DC4750s, followed by a coast at a constant angular rate between taccel and.750 s/2=taccel, and ending with a deceleration at /NUL1:6/STX10/NUL4deg/s2for a timetaccel.U s eJ1D Hmax/STX750s, but assume that the system momentum for the four-wheel case is only Hmaxin the bodyCe2direction rather than 2H max, as in the six-wheel case.178 4 Sensors and Actuators Find the minimum slew time for the pseudoinverse distribution law. Find the maximum value of any reaction wheel momentum for the minimax distribution law if the slew is performed in this time. Find the minimum slew time for the minimaxdistribution law. 4.7. A common thruster conﬁguration has four thrusters at the corners of the /NULx face of a spacecraft, which is a distance dfrom the center of mass, so the vectors from the center of mass to the thrusters are r 1D2 4/NULd aa3 5;r 2D2 4/NULd /NULa a3 5;r3D2 4/NULd /NULa /NULa3 5;r4D2 4/NULd a /NULa3 5 The thrusters are canted at an angle /DC2, with tan/DC2<a = d , so that F1DF2DF2 4cos/DC2 0 /NULsin/DC23 5;F3DF4DF2 4cos/DC2 0 sin/DC23 5 a) Find the torques due to ﬁring the thrusters individually. b) Show that ﬁring all four thrusters simultaneously gives a net thrust but no net torque. c) Show that ﬁring the thrusters in pairs can give a positive or negative torque about any axis. Thus attitude control is provided by on-pulsing pairs of thrusters whennot performing an orbit adjustment, or by off-pulsing pairs of thrusters when the orbit is being adjusted. References Al-Bender, F., Swevers, J.: Characterization of friction force dynamics. IEEE Contr. Syst. Mag. 28(6), 64–81 (2008) Åström, K.J., Canudas de Wit, C.: Revisiting the LuGre model. IEEE Contr. Syst. Mag. 28(6), 101–114 (2008) Axelrad, P., Behre, C.P.: Satellite attitude determination based on GPS signal-to-noise ratio. Proc. IEEE 87(1), 133–144 (1999) Bahcall, J.N.: Star counts and galactic structure. Annu. Rev. Astron. Astrophys. 24, 577–611 (1986) Bhanderi, D.D.V .: Modeling Earth albedo currents on Sun sensors for improved vector observation. In: AIAA Guidance, Navigation and Control Conference. Keystone (2006). AIAA2006-6592 Bhanderi, D.D.V ., Bak, T.: Modeling Earth albedo for satellites in Earth orbit. In: AIAA Guidance, Navigation and Control Conference. San Francisco (2005). AIAA 2005-6465 Bhuta, P.G., Koval, L.R.: A viscous ring damper for a freely precessing satellite. Int. J. Mech. Sci.8(5), 383–395 (1966)References 179 Bialke, B.: High ﬁdelity mathematical modeling of reaction wheel performance. In: Culp, R.D., Igli, D. (eds.) Guidance and Control 1998, Advances in the Astronautical Sciences, vol. 98,pp. 483–496. Univelt, San Diego (2007) Bialke, B.: Microvibration disturbance fundamentals for rotating mechanisms. In: Miller, K.B. (ed.) Guidance and Control 2011, Advances in the Astronautical Sciences, vol. 141,pp. 417–432. Univelt, San Diego (2007) Braasch, M.S.: Multipath effects. In: Parkinson, B., Spilker, J. (eds.) Global Positioning System: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64, chap. 14.American Institute of Aeronautics and Astronautics, Washington, DC (1996) Bronowicki, A.J.: Forensic investigation of reaction wheel nutation on isolator. In: AIAA/ASME/AHS/ASC Structures, Structural Dynamics, and Materials Conference. Schaum-berg (2008) Canudas de Wit, C., Olsson, H., Åström, K.J., Lischinsky, P.: A new model for control of systems with friction. IEEE Trans. Automat. Contr. 40(3), 419–425 (1995) Chen, X., Steyn, W.H.: Robust combined eigenaxis slew maneuver. In: AIAA Guidance, Navigation and Control Conference, pp. 521–529. Portland (1999). AIAA 1999-4048 Chow, W.W., Sanders, V .E., Schleich, W., Scully, M.O.: The ring laser gyro. Rev. Mod. Phys. 57(1), 61–103 (1985) Cohen, C.E.: Attitude determination using GPS. Ph.D. thesis, Stanford University (1993)16. Cohen, C.E.: Attitude determination. In: B. Parkinson, J. Spilker (eds.) Global Positioning System: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64, chap. 19.American Institute of Aeronautics and Astronautics, Washington, DC (1996) Cowen, R.: The wheels come off Kepler. Nature 497(7450), 417–418 (2013) Dahl, P.R.: A solid friction model. Contractor Report TOR-0158(3107-18)-1, The Aerospace Corporation, Los Angeles (1968) Fallon III, L.: Gyroscopes. In: J.R. Wertz (ed.) Spacecraft Attitude Determination and Control, chap. 6.5. Kluwer Academic, Dordrecht (1978) Farrenkopf, R.L.: Analytic steady-state accuracy solutions for two common spacecraft attitude estimators. J. Guid. Contr. 1(4), 282–284 (1978) Golub, G.H., Van Loan, C.F.: Matrix Computations, 3rd edn. The Johns Hopkins University Press, Baltimore (1996) Hablani, H.B.: Momentum accumulation due to solar radiation torque, and reaction wheel sizing, with conﬁguration optimization. In: Proceedings of the Flight Mechanics/EstimationTheory Symposium, pp. 3–22. NASA-Goddard Space Flight Center, Greenbelt (1992) Hablani, H.B.: Sun-tracking commands and reaction wheel sizing with conﬁguration optimiza- tion. J. Guid. Contr. Dynam. 17(4), 805–814 (1994) Haworth, D.: How many stars can you observe (2013). http://www.stargazing.net/David/ constel/howmanystars.html Horn, R.A., Johnson, C.R.: Matrix Analysis. Cambridge University Press, Cambridge (1985)26. Horri, N.M., Palmer, P., Giffen, A.: Active attitude control mechanisms. In: Blockley, R., Shyy, W. (eds.) Encyclopedia of Aerospace Engineering. Wiley, Chichester (2010) Hubert, C.: Modeling completely ﬁlled viscous ring nutation dampers. Technical Report B2027, NASA Goddard Space Flight Center (2002) Kawaguchi, J., Maeda, K., Matsuo, H., Ninomiya, K.: Closed loop momentum transfer maneuvers using multiwheels. J. Guid. Contr. Dynam. 18(4), 867–874 (1995) Kumar, K.: A microstructure study of corrosion in Ag-Cu ﬂex leads, Journal of the Electro- chemical Society, 127(4), 906–910 (1980) Kurokawa, H.: Survey of theory and steering laws of single-gimbal control moment gyros. J. Guid. Contr. Dynam. 30(5), 1331–1340 (2007) Lee, F.C., Werner, M.: Reaction wheel jitter analysis including rocking dynamics & bearing harmonic disturbances. In: Hollowell, H.E., Culp, R.D. (eds.) Guidance and Control 2007,Advances in the Astronautical Sciences, vol. 128, pp. 93–110. Univelt, San Diego (2007) Leick, A.: GPS Satellite Surveying, 3rd edn. Wiley, Chichester (2004)180 4 Sensors and Actuators Leyva, I.A.: Spacecraft subsystems I – propulsion. In: Wertz, J.R., Everett, D.F., Puschell, J.J. (eds.) Space Mission Engineering: The New SMAD, Space Technology Library. MicrocosmPress, Hawthorne (2011) Liebe, C.C.: Accuracy performance of star trackers – a tutorial. IEEE Trans. Aero. Electron. Syst. 38(2), 587–599 (2002) Lightsey, E.G.: Development and ﬂight demonstration of a GPS receiver for space. Ph.D. thesis, Stanford University (1997) Lightsey, E.G., Madsen, J.: Three-axis attitude determination using Global Positioning System signal strength measurements. J. Guid. Contr. Dynam. 26(2), 304–310 (2003) Liu, K.C., Kenney, T., Maghami, P., Mulé, P., Blaurock, C., Haile, W.B.: Jitter test program and on-orbit mitigation strategies for Solar Dynamics Observatory. In: 20th InternationalSymposium on Space Flight Dynamics. NASA Goddard Space Flight Center, Annapolis (2007) Liu, K.C., Maghami, P., Blaurock, C.: Reaction wheel disturbance modeling, jitter analysis, and validation tests for Solar Dynamics Observatory. In: AIAA Guidance, Navigation andControl Conference. Honolulu (2008). AIAA 2008-7232 Madsen, J., Lightsey, E.G.: Robust spacecraft attitude determination using Global Positioning System receivers. J. Spacecraft Rockets 41(4), 635–643 (2004) Margulies, G., Aubrun, J.N.: Geometric theory of single-gimbal control moment gyro systems. J. Astronaut. Sci. 26(2), 221–238 (1978) Markley, F.L., Reynolds, R.G., Liu, F.X., Lebsock, K.L.: Maximum torque and momentum envelopes for reaction-wheel arrays. J. Guid. Contr. Dynam. 33(5), 1606–1614 (2010) Masterson, R.A., Miller, D.W., Grogan, R.L.: Development and validation of reaction wheel disturbance models: Empirical model. J. Sound Vib. 249(3), 575–598 (2002) McQuerry, J.P., Radovich Jr., M.A., Deters, R.A.: A precision star tracker for the nineties: A system guide to applications. In: Culp, R.D., Gravseth, A.D. (eds.) Guidance and Control1990, Advances in the Astronautical Sciences, vol. 72, pp. 83–104. Univelt, San Diego (1990).AAS 90–014 Merhav, S.: Aerospace Sensor Systems and Applications. Springer, New York (1962)45. Merlo, S., Norgia, M., Donati, S.: Fiber gyroscope principles. In: Lòpez-Higuera, J.M. (ed.) Handbook of Optical Fibre Sensing Technology, chap. 16, pp. 331–347. Wiley, Chichester(2002) Nicolle, M., Fusco, T., Rousset, G., Michau, V .: Improvement of Shack-Hartmann wave-front sensor measurement for extreme adaptive optics. Optic Lett. 29(3), 2743–2745 (2004) O’Donnell Jr., J.R., Concha, M., Tsai, D.C., Placanica, S.J., Morrissey, J.R., Russo, A.M.: Space Technology 5 launch and operations. In: Hallowell, H.E., Culp, R.D. (eds.) Guidanceand Control 2007, Advances in the Astronautical Sciences, vol. 128, pp. 735–753. Univelt, SanDiego (1999). AAS 07–091 Pandiyan, R., Solaiappan, A., Malik, N.: A one step batch ﬁlter for estimating gyroscope calibration parameters using star vectors. In: AIAA/AAS Astrodynamics Specialist Conferenceand Exhibit. Providence (2004). AIAA 04–4858 Park, K., Crassidis, J.L.: Attitude determination methods using pseudolite signal phase measurements. J. Inst. Navigation 53(2), 121–134 (2006) Park, K., Crassidis, J.L.: A robust GPS receiver self survey algorithm. J. Inst. Navigation 53(4), 259–268 (2006) Parkinson, B., Spilker, J. (eds.): Global Positioning System: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64. American Institute of Aeronautics and Astronautics,Washington, DC (1996) Parkinson, B.W.: GPS error analysis. In: Parkinson, B., Spilker, J. (eds.) Global Positioning System: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64, chap. 11.American Institute of Aeronautics and Astronautics, Washington, DC (1996) Pittelkau, M.E.: Kalman ﬁltering for spacecraft system alignment calibration. J. Guid. Contr. Dynam. 24(6) (2001) Pittelkau, M.E.: Sensors for attitude determination. In: Blockley, R., Shyy, W. (eds.) Encyclopedia of Aerospace Engineering. Wiley, Chichester (2010)References 181 Post, E.J.: Sagnac effect. Rev. Mod. Phys. 39(2), 475–493 (1967) Salomon, P.M., Glavich, T.A.: Image signal processing in sub-pixel accuracy star trackers. In: Barbe, D.F. (ed.) Smart Sensors II, SPIE Proceedings, vol. 252, pp. 64–74 (1980) Secroun, A., Lampton, M., Levi, M.: A high-accuracy, small ﬁeld of view star guider with application to SMAP. Exp. Astron. 12(2), 69–85 (2000) Serrano, J., Potti, J., Bernedo, P., Silvestrin, P.: A new spacecraft attitude determination scheme based on the use of GPS line-of-sight vectors. In: Proceedings of the ION GPS-95,pp. 1797–1806. Institute of Navigation, Fairfax (1995) Shuster, M.D.: Stellar aberration and parallax: A tutorial. J. Astronaut. Sci. 51(4), 477–494 (2003) Sinnott, R., Perryman, M.: Millennium Star Atlas, vol. 1. Sky Publishing Corporation & European Space Agency, Cambridge (1997) Spinney, V .W.: Applications of the Global Positioning System as an attitude reference for near Earth users. In: ION National Aerospace Meeting, Naval Air Development Center. Warminster(1976) Spratling IV, B.B., Mortari, D.: A survey on star identiﬁcation algorithms. Algorithms 2(1), 93–107 (2009) Steyn, W.H.: Near-minimum-time eigenaxis rotation maneuvers using reaction wheels. J. Guid. Contr. Dynam. 18(5), 1184–1189 (1995) van Bezooijen, R.W.H., Anderson, K.A., Ward, D.K.: Performance of the AST-201 star tracker for the Microwave Anisotropy Probe. In: AIAA Guidance, Navigation and Control Conference.Monterey (2002). AIAA 2002-4582 Wertheimer, J.G., Laughlin, G.: Are Proxima Centauri and ˛Centauri gravitationally bound? Astron. J. 132(5), 1995–1997 (2007) Wertz, J.R. (ed.): Spacecraft Attitude Determination and Control. Kluwer Academic, Dordrecht (1978) Wie, B.: Singularity analysis and visualization for single-gimbal control moment gyro systems. J. Guid. Contr. Dynam. 27(2), 271–282 (2004) Witze, A.: Green fuels blast off. Nature 500(7464), 509–510 (2013)Chapter 5 Static Attitude Determination Methods Attitude determination typically requires ﬁnding three independent quantities, such as any minimal parameterization of the attitude matrix. The mathematicsbehind attitude determination can be broadly characterized into approaches that use stochastic analysis and approaches that do not. We restrict the term “estimation” to approaches that explicitly account for stochastic variables in the mathematicalformulation, such as a Kalman ﬁlter or a maximum likelihood approach [ 29]. Black’s 1964 TRIAD algorithm was the ﬁrst published method for determining the attitude of a spacecraft using body and reference observations, but his method couldonly combine the information from two measurements [ 2]. One year later, Wahba formulated a general criterion for attitude determination using two or more vector measurements [ 36]. However, explicit relations to stochastic errors in the body measurements are not shown in these formulations. The connection to the stochastic nature associated with random measurement noise was ﬁrst made by Farrell in a Kalman ﬁltering application that appeared in a NASA report in 1964 [ 11], but was not published in the archival literature until 1970 [ 12]. Farrell’s ﬁlter did not account for errors in the system dynamics, which were ﬁrst accounted for in a Kalman ﬁlter developed by Potter and Vander Velde in 1968 [ 27]. It is useful to divide attitude determination approaches into two other categories. The ﬁrst category comprises static determination approaches that depend on mea- surements taken at the same time, or close enough in time that spacecraft motionbetween the measurements can be ignored or easily compensated for. The second category comprises ﬁltering approaches that make explicit use of knowledge of the motion of the spacecraft to accumulate a “memory” of past measurements. Staticapproaches have the requirement that at each time there are enough observations available to fully compute the attitude, but they typically require no a priori attitude estimate. A purely deterministic approach incorporates just enough observationinformation to uniquely determine the attitude. For example, the TRIAD algorithm uses only three out of the four pieces of information obtainable from two measured vectors to compute an attitude solution. Another deterministic approach involves asingle vector measurement and a single angle measurement [ 30]. Over-determined F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _5, © Springer Science+Business Media New York 2014183184 5 Static Attitude Determination Methods approaches use more observation information than is required to compute a full attitude solution. For example, a star tracker onboard a space vehicle observes line-of-sight vectors to several stars, which are compared with known inertialline-of-sight vectors from a star catalog to determine the attitude of the vehicle. Statistical factors, such as an attitude error covariance, can be developed from a static solution. In many spacecraft attitude systems, the attitude observations are naturally rep- resented as unit vectors. Typical examples are the unit vectors giving the direction to the Sun or a star and the unit vector in the direction of the Earth’s magneticﬁeld. This chapter will consider the static approaches to attitude determination using vector measurements, beginning with TRIAD and then going on to consideration of methods accommodating more than two measurements. We will also consider theerror bounds of the various estimators. 5.1 The TRIAD Algorithm Some spacecraft attitude determination methods use exactly two vector measure- ments. The two vectors are typically the unit vector to the Sun and the Earth’s magnetic ﬁeld vector for coarse Sun-magnetic attitude determination or unit vectorsto two stars tracked by two star trackers for ﬁne attitude determination. TRIAD, the earliest published algorithm for determining spacecraft attitude from two vector measurements, has been widely used in both ground-based and onboard attitudedetermination. The name “TRIAD” can be considered either as the word “triad” or as an acronym for TRIaxial Attitude Determination. Suppose that we have measured the components of two unit vectors in the spacecraft body frame and also know these components in some reference frame. We consider only unit vectors because the length of the vector has no information relevant to attitude determination. Owing to the norm constraint, each of these unitvectors contains only two independent scalar pieces of attitude information. We have seen that three parameters are required to specify the attitude matrix A,s ot w o unit vector measurements are required to determine the attitude matrix, in general.In fact two vectors overdetermine the attitude. The notation we have been using up to now would denote the representation of a vector in the body frame as x Band the representation in the reference frame by xR. To avoid the proliferation of subscripts, we shall denote the representation of the two vectors in the body frame as b1and b2and the representations of the corresponding vectors in the reference frame by r1 andr2. It is clear that the attitude matrix is not uniquely determined if either the pair b1andb2or the pair r1andr2are parallel or antiparallel, because the attitude can only be determined up to a rotation by angle about the pair of vectors in that case. The attitude matrix to be determined is the matrix that rotates vectors from the reference frame to the spacecraft body frame, so we would like to ﬁnd an attitude matrix such that AriDbi;foriD1;2 (5.1)5.1 The TRIAD Algorithm 185 This is not possible in general, however, for Eq. ( 5.1)i m p l i e st h a t b1/SOHb2D.Ar1//SOH.Ar2/DrT 1ATAr2Dr1/SOHr2 (5.2) This equality is true for error-free measurements, but is not generally true in the presence of measurement errors. Thus it is impossible to satisfy both of Eq. ( 5.1) simultaneously if Eq. ( 5.2) is not obeyed. The classical TRIAD algorithm is based on the assumption that one of the unit vectors, which is conventionally denoted byb1, is much more accurately determined than the other, so the estimate satisﬁes Ar1Db1exactly, butAr2Db2only approximately. TRIAD is based on the following idea. If we have an orthonormal right-handed triad of vectorsfv1;v2;v3gin the reference frame, and a corresponding orthonormal right-handed triad fw1;w2;w3gin the spacecraft body frame, then the attitude matrix A/DC1Œw1w2w3/c141Œv1v2v3/c141TD3X iD1wivT i (5.3) will transform the vito the wiby AviDwi;foriD1;2;3 (5.4) TRIAD forms the triad fv1;v2;v3gfrom r1andr2, and the triadfw1;w2;w3gfrom b1andb2by means of v1Dr1;v2Dr/STX/DC1r1/STXr2 kr1/STXr2k;v3Dr1/STXr/STX (5.5a) w1Db1;w2Db/STX/DC1b1/STXb2 kb1/STXb2k;w3Db1/STXb/STX (5.5b) Then the estimate of the attitude matrix, indicated by a caret, is given by Eq. ( 5.3)a s OATRIADDb1rT 1C.b1/STXb/STX/.r1/STXr/STX/TCb/STXrT /STX (5.6) It can easily be seen that this solution satisﬁes the ﬁrst equality of Eq. ( 5.1), and some manipulation of dot and cross products shows that it satisﬁes the second equality if and only if Eq. ( 5.2) is obeyed. We note that the attitude matrix is undeﬁned if either the reference vectors or the observed vectors are parallel orantiparallel. This is the case noted above in which there is insufﬁcient information to determine the attitude uniquely. This TRIAD attitude estimate is completely independent of the component of b 2 along b1and the component of r2along r1. This is the information that is discarded to give the three pieces of information needed to specify the attitude matrix. Variants of TRIAD have been proposed that use other combinations of the reference and body186 5 Static Attitude Determination Methods vectors to form the orthonormal triads. These have been superseded by an algorithm to be derived later in this chapter that uses an arbitrary scalar weighting of the two vectors. 5.2 Wahba’s Problem We can improve on the TRIAD method in two ways: by allowing arbitrary weightingof the measurements and by allowing the use of more than two measurements. The latter is especially important for use with star trackers that can track many stars simultaneously. Almost all of these improvements are based on a problem posed in1965 by Grace Wahba [ 36]. Wahba’s problem is to ﬁnd the orthogonal matrix A with determinantC1that minimizes the loss function L.A//DC11 2NX iD1aikbi/NULArik2(5.7) wherefbigis a set ofNunit vectors measured in a spacecraft’s body frame, frig are the corresponding unit vectors in a reference frame, and faigare non-negative weights. We will discuss the choice of weights in Sect. 5.5. Using the orthogonality of A, the unit norm of the unit vectors, and the cyclic invariance of the trace, Eq. ( 2.11c ), gives kbi/NULArik2Dkbik2CkArik2/NUL2bi/SOH.Ari/D2/NUL2tr.AribT i/ (5.8) Thus we can write the loss function in the very convenient form L.A/D/NAK0/NULtr.ABT/ (5.9) with /NAK0/DC1NX iD1ai (5.10) and the “attitude proﬁle matrix” Bdeﬁned by B/DC1NX iD1aibirT i (5.11) Now it is clear the loss function is minimized when tr .ABT/is maximized. This has a close relation to the orthogonal Procrustes problem, which is equivalent to ﬁndingthe orthogonal matrix Athat is closest to Bin the Frobenius norm (also known as the Euclidean, Schur, or Hilbert-Schmidt norm) [ 17] kMk 2 F/DC1tr.MMT/ (5.12)5.3 Quaternion Solutions of Wahba’s Problem 187 It follows from kA/NULBk2 FDkAk2 FCkBk2 F/NUL2tr.ABT/D3CkBk2 F/NUL2tr.ABT/ (5.13) that Wahba’s problem is equivalent to the orthogonal Procrustes problem with the proviso that the determinant of Amust beC1. Algorithms for solving Wahba’s problem fall into two classes. The ﬁrst solves for the attitude matrix directly, and the second solves for the quaternion representation of the attitude matrix. With error-free mathematics, all algorithms should lead tothe same attitude, and testing shows this to be the case [ 5,24]. Some algorithms are faster than others, but execution speeds with modern processors make speed differences less important [ 4,24]. Quaternion solutions have proven to be much more useful in practice, so we will consider them ﬁrst. 5.3 Quaternion Solutions of Wahba’s Problem 5.3.1 Davenport’s q Method Paul Davenport provided the ﬁrst useful solution of Wahba’s problem for spacecraft attitude determination [ 18]. He substituted Eq. ( 2.129 ) into Wahba’s loss function to get L.A. q//D/NAK0/NULNX iD1aibT iA.q/riD/NAK0/NULNX iD1aibT i/EOTT.q//TAB.q/ri (5.14) Using several relations from Sect. 2.7gives bT i/EOTT.q//TAB.q/riD/DC4bi 0/NAKT Œqˇ/c141TŒq˝/c141/DC4ri 0/NAK D.qˇbi/T.q˝ri/ D.bi˝q/T.riˇq/DqTŒbi˝/c141TŒriˇ/c141q (5.15) This allows us to express the loss function as L.A. q//D/NAK0/NULqTK.B/ q (5.16) whereK.B/ is the symmetric traceless matrix K.B/DNX iD1aiŒbi˝/c141TŒriˇ/c141D/DC4BCBT/NUL.trB/I3z zTtrB/NAK (5.17)188 5 Static Attitude Determination Methods with z/DC12 4B23/NULB32 B31/NULB13 B12/NULB213 5DNX iD1ai.bi/STXri/ (5.18) It is known that a real symmetric n/STXnmatrix hasnreal eigenvalues and n real eigenvectors that can be chosen to form an orthonormal basis [ 15,17]. The eigenvalue/eigenvector decomposition of Kcan be written as K.B/D4X iD1/NAKiqiqT i (5.19) where qiis the eigenvector with eigenvalue /NAKi, and the eigenvalues are labeled so that/NAKmax/DC1/NAK1/NAK/NAK2/NAK/NAK3/NAK/NAK4. Taking the trace of this equation and using the cyclic invariance of the trace and the orthonormality of the eigenvectors gives thewell known result that the trace of a diagonalizable matrix is equal to the sum of its eigenvalues tr.K.B//D4X iD1/NAKi (5.20) Equation ( 5.17) shows that the trace of K.B/ is zero, so this means that the sum of the eigenvalues is zero: 4X iD1/NAKiD0 (5.21) Substituting Eq. ( 5.19) into Eq. ( 5.16)g i v e s L.A. q//D/NAK0/NUL4X iD1/NAKi.qTqi/2D/NAK0/NUL/NAK14X iD1.qTqi/2C4X iD1./NAK1/NUL/NAKi/.qTqi/2 D/NAK0/NUL/NAK1C4X iD2./NAK1/NUL/NAKi/.qTqi/2(5.22) where the third equality holds because the four eigenvectors constitute an orthonor- mal basis and because the iD1term in the second sum vanishes identically. The loss function is minimized if the quaternion is orthogonal to q2,q3, and q4, i.e. the optimal quaternion is the normalized eigenvector of Kcorresponding to the largest eigenvalue OqDq1 (5.23) This result can also be derived by using a Lagrange multiplier to append the quaternion norm constraint to the loss function [ 8].5.3 Quaternion Solutions of Wahba’s Problem 189 The optimized loss function is easily seen to be equal to L.A.Oq//D/NAK0/NUL/NAKmax (5.24) which explains our choice of the notation /NAK0for the sum of the weights. The loss function is non-negative by deﬁnition, so it must be true that /NAKmax/DC4/NAK0. Since we expect the optimal value of the loss function to be small, the value of /NAK0/NUL/NAKmax provides a very useful data quality check. Shuster has shown that if the measurement errors are Gaussian and the weights aiare chosen to be the inverse measurement variances, then TASTE /DC12./NAK0/NUL/NAKmax/will obey a/US2probability distribution with 2N/NUL3degrees of freedom to a very good approximation [ 33]. Davenport’s algorithm does not have a unique solution if the two largest eigenvalues of K.B/ are equal. This is not a failure of the qmethod; it means that the data are not sufﬁcient to determine the attitude uniquely. Very robust algorithms exist to solve the symmetric eigenvalue problem, and Davenport’s method remainsthe best method for solving Wahba’s problem if one has access to one of these eigenvalue decomposition algorithms. 5.3.2 Quaternion Estimator (QUEST) Davenport’sqmethod was used to compute attitude estimates for the High Energy Astronomy Observatory (HEAO-B) in 1978; but it could not provide the morefrequent attitude computations required by the MAGSAT spacecraft, launched 1 year later, using the computers of the time. The QUEST algorithm was devised to answer this need, and has become the most widely used algorithm for solvingWahba’s problem [ 24,31,35]. We can express Davenport’s eigenvalue condition as 0 4DH./NAK max/Oq (5.25) where H./NAK//DC1/NAKI4/NULK.B/D/DC4./NAKCtrB/I3/NULS/NULz /NULzT/NAK/NULtrB/NAK (5.26) and S/DC1BCBT(5.27) Equation ( 5.25) is equivalent to the two equations ./SUBI3/NULS/Oq1W3DOq4z (5.28a) ./NAKmax/NULtrB/Oq4/NULzTOq1W3D0 (5.28b)190 5 Static Attitude Determination Methods where /SUB/DC1/NAKmaxCtrB (5.29) If we knew/NAKmax,E q s .( 5.28a ) and ( 2.16) would give the optimal quaternion as OqD˛/DC4adj./SUBI3/NULS/z det./SUBI3/NULS//NAK (5.30) where˛is determined by normalization of Oq. Substituting Eq. ( 5.30) into Eq. ( 5.28b ) gives an implicit equation for the maximum eigenvalue ./NAKmax/NULtrB/det./SUBI3/NULS//NULzTadj./SUBI3/NULS/zD0 (5.31) This is just the characteristic equation of K.B/ . We convert it to an explicit equation for/NAKmaxby using the deﬁnitions of the adjoint and the determinant to write adj./SUBI3/NULS/DadjSC/SUBSC/SUB./SUB/NULtrS/I3 (5.32) and det./SUBI3/NULS/D/SUB3/NUL/SUB2trSC/DC4/SUB/NULdetS (5.33) where /DC4/DC1tr.adjS/ (5.34) The expression for the adjoint is further simpliﬁed by applying the Cayley-Hamilton Theorem, which says that a matrix obeys its own characteristic equation [ 17], to the matrixS. With Eq. ( 2.103 ) this means that S3/NULS2trSCStr.adjS//NULI3detSD03/STX3 (5.35) Multiplying through by adj Sand using Eq. ( 2.15) and a little algebra gives adjSDS2/NULStrSC/DC4I3 (5.36) With these substitutions Eq. ( 5.31) can be written as a quartic equation for /NAK: 0D QUEST./NAK//DC1/STX /NAK2/NUL.trB/2C/DC4/ETX/STX /NAK2/NUL.trB/2/NULkzk2/ETX /NUL./NAK/NULtrB/.zTSzCdetS//NULzTS2zD4Y iD1./NAK/NUL/NAKi/(5.37)5.3 Quaternion Solutions of Wahba’s Problem 191 We have written /NAKinstead of/NAKmaxbecause this equation has four roots. We are only interested in the largest root, though. Shuster’s important observation was that /NAKmax can be easily obtained by Newton-Raphson iteration of Eq. ( 5.37) starting from /NAK0as the initial estimate, since these two values will be very nearly equal if the optimized loss function is small, as we have previously observed. In fact, a single iteration is generally sufﬁcient, and the approximation /NAKmaxD/NAK0is adequate in many cases. It is useful to perform at least one iteration, however, in order to compute the quantity TASTE for data validation. The efﬁciency of the QUEST algorithm results from its replacement of the iterative operations on 4/STX4matrices required by Davenport’s qmethod with iterative scalar computations followed by straightforward matrix multiplications. Numerical analysts know that solving the characteristic equation is not the bestway to ﬁnd eigenvalues, in general, so QUEST is in principle less robust than Davenport’s method. QUEST has proven to be extremely robust in practice, though, as long as the characteristic equation is evaluated in the partially-factored formshown in Eq. ( 5.37)[5]. The quartic characteristic equation has an analytic solution, but this solution is slower, no more accurate, and sometimes less reliable than Newton-Raphson iteration. 5.3.3 Another View of QUEST The QUEST solution can be related to the adjoint of the matrix Hdeﬁned in Eq. (5.26). With Eq. ( 5.19) andI4DP4 iD1qiqT i, we can express Hin the form H./NAK/D4X iD1./NAK/NUL/NAKi/qiqT i (5.38) The adjoint of this matrix is adjH./NAK/D4X iD1./NAK/NUL/NAKj/./NAK/NUL/NAKk/./NAK/NUL/NAK`/qiqT i (5.39) wherefi;j;k;`gis a permutation off1;2;3;4g. Setting/NAKD/NAKmaxD/NAK1gives adjH./NAK max/D./NAKmax/NUL/NAK2/./NAK max/NUL/NAK3/./NAK max/NUL/NAK4/q1qT 1D/CROqOqT(5.40) where/CRis positive if /NAK1¤/NAK2, which we have seen to be the condition for uniqueness of the attitude solution. In fact, /CRis justd QUEST=d/NAK evaluated at /NAKD/NAKmax. Daniele Mortari was the ﬁrst to recognize the signiﬁcance of the matrix adjH[25].192 5 Static Attitude Determination Methods The4/NUL4component of Eq. ( 5.40)i s1 ŒadjH./NAK max//c14144Ddet./SUBI3/NULS/D/CROq2 4 (5.41) and the other three elements of the fourth column are ŒadjH./NAK max//c141k4DŒadj./SUBI3/NULS/z/c141kD/CROq4OqkforkD1;2;3 (5.42) Comparison with Eq. ( 5.30) establishes that the QUEST quaternion estimate is just the normalized fourth column of adj H./NAK max/and that ˛D˙./CROq4//NUL1D˙Œ/CRdet./SUBI3/NULS//c141/NUL1=2(5.43) Equation ( 5.41) clearly shows that q4is zero if/SUBI3/NULSis singular, or equivalently that the estimate in this case is a 180ırotation. We can also see that ˛is inﬁnite in this limit. Quaternion normalization requires that kadj./SUBI3/NULS/zktends to Œ/CRdet./SUBI3/NULS//c1411=2in the singular limit, so it is clear that the QUEST computation of the quaternion loses all numerical signiﬁcance. This is quite different from the failure of Wahba’s problem to have a unique solution if the two largest eigenvalues ofK.B/ are equal, and it can be avoided by a method discussed in the following section. 5.3.4 Method of Sequential Rotations Shuster discovered the indeterminacy of the QUEST solution when /SUBI3/NULSis singular, and he introduced the method of sequential rotations to deal with the problem [ 31,34,35]. The idea behind this method is to solve for a quaternion qk/DC1qBRkrepresenting the attitude with respect to a rotated reference frame Rk. The attitude quaternion q/DC1qBRwith respect to the original frame Ris the product ofqkand the quaternion qRkRrepresenting the rotation between frames RandRk. For simplicity, the frames are related by a 180ırotation about one of the coordinate axes, i.e. q/DC1qBRDqBRk˝qRkRDqk˝q.ek;/EM/ D/DC4qk 1W3 qk 4/NAK ˝/DC4ek 0/NAK D/DC4qk 4ekCek/STXqk 1W3 /NULek/SOHqk 1W3/NAK DEkqk(5.44) where ekis the unit vector along the kth coordinate axis and where Ek/DC1/DC4Œek/STX/c141ek /NULeT k0/NAK (5.45) 1We are indebted to Yang Cheng for providing the basis of the discussion in this paragraph.5.3 Quaternion Solutions of Wahba’s Problem 193 The matrixEkis skew-symmetric and orthogonal. It has exactly one element with the value˙1in each column and exactly one element with the value ˙1in each row; all its other elements are zero. Thus Ekis like a permutation matrix except for the minus signs. This means that the transformation from qktoqrequires no multiplications; it merely permutes the components of the quaternion with some sign changes. The inverse transformation is qkDq˝q.ek;/NUL/EM/DET kq (5.46) We see that the kth component of qends up as the fourth component of qk. Because qis a unit quaternion, at least one of its components must have magnitude greater than or equal to 1=2, so it is always possible to ﬁnd a reference frame rotation that results in qk 4having magnitude of at least 1=2. Since QUEST prefers to keep the magnitude of this component away from zero, it follows that the optimal reference frame rotation is a rotation about the axis corresponding to the component ofqhaving the largest magnitude. If the fourth component of qhas the largest magnitude, no reference frame rotation is required. These rotations are easy to implement on the input data, since a 180ırotation about thekth coordinate axis simply changes the signs of the ith andjth components of each reference vector, where fi;j;kgis a permutation of f1;2;3g. This is equivalent to changing the signs of the ith andjth columns of the Bmatrix. The reference system rotation is easily undone by Eq. ( 5.44) after the optimal quaternion in the rotated frame has been computed. The original QUEST implementation performed sequential rotations one axis at a time, until an acceptable reference coordinate system was found. It is not necessaryto ﬁnd a rotation resulting in q k 4/NAK1=2, it is only necessary for qk 4to be larger than some chosen value. It is clearly preferable to save computations by choosing a single desirable rotation as early in the computation as possible. This can be accomplishedby considering the components of an a priori quaternion if one is available. An a priori quaternion is generally available before computing the ﬁnal attitude estimate in a star tracker application since an approximate attitude estimate is needed toidentify the stars in the tracker’s ﬁeld of view. This is either available from a previous estimate or is produced by a “lost-in-space” algorithm using fewer (generally three or four) stars than are employed for the ﬁnal attitude estimate. We now want to show the effect of reference frame rotations on Davenport’s Kmatrix. This is not part of the implementation of QUEST, but serves to show the relation to the next algorithm we will consider. Putting A.q/instead ofBinto Davenport’s deﬁnition of the Kmatrix gives K.A. q//D4qq T/NULI4 (5.47) Equation ( 5.21) allows us to rewrite Eq. ( 5.19)a s K.B/DK.B//NUL1 4 4X iD1/NAKi! I4D1 44X iD1/NAKi.4qiqT i/NULI4/D1 44X iD1/NAKiK.A. qi// (5.48)194 5 Static Attitude Determination Methods BecauseK./SOH/is a linear function of its argument, it follows from Eq. ( 5.17) that2 BD1 44X iD1/NAKiA.qi/ (5.49) In the rotated reference frame, we have BkDBA.ek;/NUL/EM/D1 44X iD1/NAKiA.qi/A.ek;/NUL/EM/ D1 44X iD1/NAKiA.qi˝q.ek;/NUL/EM//D1 44X iD1/NAKiA.ET kqi/ (5.50) But then we have K.Bk/D1 44X iD1/NAKiK.A.ET kqi//D1 44X iD1/NAKiET k.4qiqT i/NULI4/EkDET kK.B/Ek (5.51) This result would be achieved much more directly if we could simply assert that all the eigenvectors of Ktransform according to Eq. ( 5.46) under reference frame rotations, but that is not necessarily true unless the four eigenvalues of K.B/ are distinct. We have shown that the effect of a reference frame rotation on K.B/ is to permute its rows and columns, with some sign changes. The form of Ekshows that rows and columns 4 and kare interchanged, as are the rows and columns labeled i andj. From this viewpoint, the purpose of reference frame rotations is to move the kth row and column of K.B/ to the lower-right corner of K.Bk/. 5.3.5 Estimator of the Optimal Quaternion (ESOQ) ESOQ avoids the need for explicit reference frame rotations by treating the four components of the quaternion more symmetrically than QUEST [ 24,25]. It is similar in ﬁnding /NAKmaxby Newton-Raphson iteration of the characteristic equation of Davenport’s Kmatrix and in locating the component of qwith the maximum magnitude. The algorithm is based on Mortari’s observation that the optimal 2LetMdenote the3/STX3matrix deﬁned by the right side of Eq. ( 5.49). The4/NUL4component of Eq. ( 5.48) means that tr BDtrM. Then the upper left 3/STX3submatrix of Eq. ( 5.48)s a y s thatBCBTDMCMT. Finally, the remaining 3/STX1and1/STX3submatrices tell us that B/NULBTDM/NULMT, establishing Eq. ( 5.49).5.3 Quaternion Solutions of Wahba’s Problem 195 quaternion can be computed by normalizing any column of adj H./NAK max/, not just the fourth column. The implementation of this idea is straightforward. LetHkdenote the symmetric 3/STX3matrix obtained by deleting the kth row and kth column from H./NAK max/, wherekcan be any index between 1 and 4, and let hkdenote the three-component column vector obtained by deleting the kth element from thekth column ofH./NAK max/. Then thekth component of the optimal quaternion is given by OqkD/NUL˛0detHk (5.52) and the other three components are given by3 /DC4Oq1Wk/NUL1 OqkC1W4/NAK D˛0.adjHk/hk (5.53) where˛0can be determined by quaternion normalization. The index kis chosen by ﬁnding the largest diagonal element ŒadjH./NAK max//c141kkDdetHkof the adjoint matrix, or as the index of the largest component of an a priori quaternion. Assuming that QUEST and ESOQ use the same value for /NAKmax, it is obvious that their equations for the optimal quaternion are identical for kD4. The results of the previous section show that the only difference for other values of kis in some intermediate multiplications, for which any reasonable computer gives ./NULa/bD a./NULb/and./NULa/./NULb/Dabexactly. Variations in implementation details may give rise to some differences, of course. Between these two algorithms, ESOQ may be preferred for replacing some computations with simple indexing operations. However, the computational savings are not large, and implementations of QUEST incorporating extensive error checks have a long history of successful application. 5.3.6 Second Estimator of the Optimal Quaternion (ESOQ2) The following presentation differs somewhat from Mortari’s original derivation,but is equivalent [ 24,26]. Multiplying Eq. ( 5.28a )b y./NAK max/NULtrB/, substituting Eq. (5.28b )f o r./NAKmax/NULtrB/Oq4on the right side, and rearranging gives MOq1W3D03 (5.54) where M/DC1./NAKmax/NULtrB/./SUBI3/NULS//NULzzTDŒm1m2m3/c141 (5.55) Computing the determinant of Mand comparing with Eq. ( 5.31)g i v e s detMD./NAKmax/NULtrB/2det./NAKmaxI4/NULK/ (5.56) 3We employ the convention that x1W0orx5W4is an empty vector, with no components.196 5 Static Attitude Determination Methods It follows from /NAKmaxbeing an eigenvalue of K.B/ thatMis singular, as it must be for Eq. ( 5.54) to have a non-trivial solution. Thus the three columns of Mlie in a plane to whichOq1W3must be orthogonal, so we can write Oq1W3D˛00./NAKmax/NULtrB/.mi/STXmj/ (5.57) for some scalar ˛00and for any pair of non-equal indices iandj. It is best to choose the indices to select the cross product with maximum norm.4ThenOq4is determined by Eq. ( 5.28b ), giving OqD˛00/DC4./NAKmax/NULtrB/.mi/STXmj/ z/SOH.mi/STXmj//NAK (5.58) where˛00can be determined by quaternion normalization. These computations lose numerical signiﬁcance if ./NAKmax/NULtrB/is close to zero, but we can avoid this singular condition by using a reference system rotation to minimize tr B. No rotation is performed if tr Bis the minimum offB11;B22;B33;trBgwhile a rotation about the ith axis is performed if Biiis the minimum. As in the QUEST case, the rotation is easily undone by Eq. ( 5.44) after the quaternion has been computed. Note that either an optimal or a merely acceptable rotated frame for ESOQ2 can be foundby inspection of the Bmatrix, requiring neither an a priori attitude estimate nor an iterative search. 5.4 Matrix Solutions of Wahba’s Problem 5.4.1 Singular Value Decomposition (SVD) Method J. L. Farrell and J. C. Stuelpnagel presented one of the ﬁrst solutions of Wahba’s problem [ 13]. They performed a polar decomposition of Binto the product of an orthogonal matrix and a symmetric positive semideﬁnite matrix, followed by adiagonalization of the symmetric matrix. This two-step process is equivalent to the single-step procedure known as the singular value decomposition, for which very robust algorithms have been developed, so we will only discuss the latter method[15,17,19]. The singular value decomposition of the attitude proﬁle matrix is given by BDU˙V TDUdiag.Œs1s2s3/c141/VT(5.59) 4One of the eigenvalues of the singular matrix Mis zero, so its eigenvalue decomposition is MD /SYN1vvTC/SYN2wwT.T h e n mi/STXmjD/SYN1/SYN2.v/STXw/k.v/STXw/,w h e r e fi;j;k gis a cyclic permutation off1;2;3 g. The optimal indices are thus those with maximum j.mi/STXmj/kj.5.4 Matrix Solutions of Wahba’s Problem 197 whereUandVare orthogonal, and s1/NAKs2/NAKs3/NAK0[15]. The matrices Uand Vare not guaranteed to have determinant C1, and we are only interested in proper orthogonal matrices, so it is convenient to deﬁne the rotation matrices UC/DC1Udiag.Œ11 detU/c141/ andVC/DC1Vdiag.Œ11 detV/c141/ (5.60) Then BDUC˙0VT CDUCdiag.Œs1s2s0 3/c141/VT C (5.61) where s0 3/DC1s3detUdetV (5.62) ands1/NAKs2/NAKjs0 3j. We now deﬁne a rotation matrix and its Euler axis/angle representation by W/DC1UT CAVCD.cos#/I3/NULsin#Œe/STX/c141C.1/NULcos#/eeT(5.63) Using the cyclic invariance of the trace, Eq. ( 2.11c ), gives tr.ABT/Dtr.W˙0/DeT˙0eCcos#/NUL tr˙0/NULeT˙0e/SOH DeT˙0eCcos#Œs2Cs0 3Ce2 2.s1/NULs2/Ce2 3.s1/NULs0 3//c141 (5.64) The trace is maximized for #D0, which gives WDI3and thus the optimal attitude matrix OADUCVT CDUdiag.Œ11 detUdetV/c141/VT(5.65) The optimized loss function is easily seen to be equal to L.OA/D/NAK0/NULtr.OABT/D/NAK0/NULtr˙0D/NAK0/NUL.s1Cs2Cs0 3/ (5.66) and comparison with Eq. ( 5.24) shows that /NAKmaxDs1Cs2Cs0 3 (5.67) Equation ( 5.64) reduces to tr .ABT/Ds1/NUL.1/NULcos#/Œe2 2.s1/NULs2/Ce2 3.s1/NULs0 3//c141if s2Cs0 3D0. The loss function does not have a unique minimum in this case because it is invariant under a rotation by any angle about the axis e1/DC1Œ100/c141T. We will see shortly that this non-uniqueness is the same as the one found in Davenport’s method when the two largest eigenvalues of K.B/ are not distinct.198 5 Static Attitude Determination Methods 5.4.2 Fast Optimal Attitude Matrix (FOAM) This method bears the same relationship to the SVD method as QUEST bears to Davenport’s qmethod. It computes /NAKmaxiteratively and uses simple matrix operations to avoid the need to perform the singular value decomposition of the attitude proﬁle matrix [ 20]. Equation ( 5.61) allows us to write detBDs1s2s0 3 (5.68a) kBk2 FDs2 1Cs2 2C.s0 3/2(5.68b) adjBTDUCdiag.Œs2s0 3s0 3s1s1s2/c141/VT C (5.68c) BBTBDUCdiag.Œs3 1s3 2.s0 3/3/c141/VT C (5.68d) Then the optimal attitude matrix can be represented as OAD/NUL /NAK2 maxCkBk2 F/SOH BC2/NAKmaxadjBT/NUL2BBTB /NAKmax/NUL /NAK2max/NULkBk2 F/SOH /NUL2detB(5.69) Substituting Eqs. ( 5.61), (5.67) and ( 5.68) into this representation, performing some straightforward algebra, and comparing the result with Eq. ( 5.65) establishes its validity. With the exception of /NAKmax, all the quantities in Eq. ( 5.69) can be computed by straightforward algebraic operations. We ﬁnd the maximum eigenvalue from /NAKmaxD/NAK0/NULL.OA/Dtr.OABT/ (5.70) Substituting Eq. ( 5.69) and taking the trace, with /NAKin place of/NAKmax,g i v e s 0D FOAM./NAK//DC1/NUL /NAK2/NULkBk2 F/SOH2/NUL8/NAKdetB/NUL4kadjBk2 FD4Y iD1./NAK/NUL/NAKi/(5.71) where we have used the identity kBk4 F/NULtr.BBTBBT/D2kadjBk2 F (5.72) which is easily veriﬁed using the singular value decomposition. The numerical coef- ﬁcients in QUEST./NAK/and FOAM./NAK/must be identical with error-free mathematics, since both functions are forms of the characteristic equation of Davenport’s K matrix. The FOAM form is somewhat simpler, though, and has also been employedin ESOQ and ESOQ2 implementations.5.4 Matrix Solutions of Wahba’s Problem 199 Substituting Eqs. ( 5.68a )–(5.68c ) into Eq. ( 5.71) gives the eigenvalues of the K matrix in terms of the singular values5: /NAK1Ds1Cs2Cs0 3 (5.73a) /NAK2Ds1/NULs2/NULs0 3 (5.73b) /NAK3D/NULs1Cs2/NULs0 3 (5.73c) /NAK4D/NULs1/NULs2Cs0 3 (5.73d) The denominator of Eq. ( 5.69) is equal to 2.s2Cs0 3/.s0 3Cs1/.s1Cs2/D./NAK1/NUL/NAK2/./NAK1/NUL/NAK3/./NAK1/NUL/NAK4/=4 (5.74) This clearly shows that the FOAM algorithm fails if s2Cs0 3D/NAK1/NUL/NAK2D0, which is the same indication of unobservability that we noted with Davenport’s qmethod and the SVD method. 5.4.3 Wahba’s Problem with Two Observations The two-observation case is of special interest for two reasons. The ﬁrst is that the characteristic equation for K.B/ has a simple closed-form solution in this case, as was noted very early [ 35]. The second reason is that the solution to Wahba’s problem with two observations gives a generalization of the TRIAD method for arbitrary measurement weights [ 21,22]. Several simpliﬁcations follow from having only two observations: detBD0 (5.75a) BBTDa2 1b1bT1Ca2 2b2bT2Ca1a2.r1/SOHr2/.b1bT 2Cb2bT 1/ (5.75b) kBk2 FDa2 1Ca2 2C2a1a2.b1/SOHb2/.r1/SOHr2/ (5.75c) adjBTDa1a2.b1/STXb2/.r1/STXr2/T(5.75d) kadjBkFDa1a2kb1/STXb2kkr1/STXr2k (5.75e) It then follows from Eq. ( 5.71) that /NAKmaxD˚ a2 1Ca2 2C2a1a2Œ.b1/SOHb2/.r1/SOHr2/Ckb1/STXb2kkr1/STXr2k/c141/TAB1=2(5.76) 5Paul Davenport discovered these relations, but did not publish them.200 5 Static Attitude Determination Methods This can be used in QUEST, ESOQ, ESOQ2, or FOAM, avoiding the need for Newton-Raphson iteration. If we deﬁne /DC2bto be the angle between b1andb2, and /DC2rto be the angle between r1andr2, then /NAKmaxD/DC4 /NAK2 0/NUL4a1a2sin2/DC2/DC2b/NUL/DC2r 2/DC3/NAK1=2 (5.77) This form provides some insight, but is less useful for computation than Eq. ( 5.76). Substituting Eqs. ( 5.75a )–(5.75e )i n t o( 5.69) gives, after some algebra OAD.a1=/NAKmax//STX b1rT 1C.b1/STXb/STX/.r1/STXr/STX/T/ETX C.a2=/NAKmax//STX b2rT 2C.b2/STXb/STX/.r2/STXr/STX/T/ETX Cb/STXrT /STX (5.78) using the notation of Sect. 5.1. It is obvious from this equation that the optimal attitude estimate maps r1andr2into the plane spanned by b1andb2. The TRIAD solution also has this property, so the difference between the Wahba and TRIADestimates can be represented as a rotation about the axis b /STX, which is the normal vector to the plane containing b1andb2. It is also easy to see that the solution has a unique limit as either observation weight goes to zero. This limit is the TRIAD solution of Eq. ( 5.3)i fa2D0, and it is the TRIAD solution with the roles of the two observations interchanged if a1D0. This limit was already noted in [ 35]. For general weights, the optimal solution is some sort of an average of the two TRIAD solutions. It is not a simple average, though, because a simple average would not give an orthogonal attitude matrix. It is interesting that Eq. ( 5.78) has a unique limit as either observation weight goes to zero even though Wahba’s loss function does not have a unique minimum in either limit, because it effectively includes only one observation. There is an equivalent closed-form solution for the quaternion [ 21]: OqD8 ˆˆˆˆˆˆˆ< ˆˆˆˆˆˆˆ:1 2p /CR./CRC˛/.1Cb/STX/SOHr/STX/" ./CRC˛/.b/STX/STXr/STX/Cˇ.b/STXCr/STX/ ./CRC˛/.1Cb/STX/SOHr/STX/# for˛/NAK0 1 2p /CR./CR/NUL˛/.1Cb/STX/SOHr/STX/" ˇ.b/STX/STXr/STX/C./CR/NUL˛/.b/STXCr/STX/ ˇ.1Cb/STX/SOHr/STX/# for˛<0 (5.79) where ˛/DC1.1Cb/STX/SOHr/STX/.a1b1/SOHr1Ca2b2/SOHr2/C.b/STX/STXr/STX//SOH.a1b1/STXr1Ca2b2/STXr2/ (5.80a) ˇ/DC1.b/STXCr/STX//SOH.a1b1/STXr1Ca2b2/STXr2/ (5.80b) /CR/DC1p ˛2Cˇ2 (5.80c)5.5 Error Analysis of Wahba’s Problem 201 The above expressions are indeterminate when b/STXD/NUL r/STX, and are unreliable near this singular condition. This problem can be avoided by applying one of the reference frame rotations of Sect. 5.3.4 . The effect of a 180ırotation about the ith axis on the inner product b/STX/SOHr/STXis .b/STX/SOHr/STX/rotatedDŒ.b/STX/i/SOH.r/STX/i/NUL.b/STX/j/SOH.r/STX/j/NUL.b/STX/k/SOH.r/STX/k/c141unrotated DŒ2.b/STX/i/SOH.r/STX/i/NULb/STX/SOHr/STX/c141unrotated (5.81) We ensure the largest value for .b/STX/SOHr/STX/rotated by performing the estimation in the original reference frame if b/STX/SOHr/STXis larger than any of the products .b/STX/i/SOH.r/STX/iin this frame, or by rotating about the axis with maximum .b/STX/i/SOH.r/STX/iif this is greater than b/STX/SOHr/STX. More details can be found in [ 21]. 5.5 Error Analysis of Wahba’s Problem The value of an estimate is greatly enhanced by knowledge of its accuracy. In fact, Malcolm Shuster’s covariance analysis of the QUEST algorithm was at least asimportant as his invention of the algorithm itself. 6This section will provide an estimate of the accuracy of a solution to Wahba’s problem. Because all algorithms yield the same estimate, assuming that it is unique, we only need to analyze theerrors exhibited by one algorithm. We will use Davenport’s qmethod, which leads most directly to the desired result. 5.5.1 Attitude Error Vector Attitude errors are most usefully expressed in the spacecraft’s body frame, so weparameterize the attitude errors by the ﬁrst-order rotation vector ı#representing the rotation between the estimated body frame OBand the true body frame B.T h e goal of this section is to ﬁnd an expression for ı#in terms of the errors of the body and reference frame vectors. Attitude errors are expected to be small, so we do not have to worry about singularities of the rotation vector representation. We representthe attitude by a quaternion, so Oq/DC1q OBRDqOBB˝qBRDŒqOBB˝/c141qBRDexpŒ.ı#=2/˝/c141qBR (5.82) where we have used Eq. ( 2.127 ). All our error analysis will be carried out only to ﬁrst order in small quantities, so we can approximate expŒ.ı#=2/˝/c141DI4CŒ.ı#=2/˝/c141 (5.83) 6Much more important, in Paul Davenport’s opinion.202 5 Static Attitude Determination Methods which gives OqDqBRC.1=2/ı#˝qBR (5.84) The analysis of errors in the spacecraft’s body frame does not depend on the speciﬁcation of the reference frame R, so we are free to choose this to coincide with the body frame. With this choice, qBRis the identity quaternion, and Eq. ( 5.84) reduces to OqD/DC403 1/NAK C1 2/DC4ı# 0/NAK (5.85) The body frame vectors biand reference frame vectors riare equal to their true, error-free, values plus some errors. Because we take the reference frame to be thebody frame, the true values of the reference vectors and body vectors are identical. Thus the attitude proﬁle matrix is BDNX iD1ai.btrue iC/SOHbi/.btrue iC/SOHri/TDB0C/SOHB (5.86) where B0/DC1NX iD1aibtrue i.btrue i/T(5.87) /SOHB/DC1NX iD1aiŒbtrue i/SOHrT iC/SOHbi.btrue i/T/c141 (5.88) and we have ignored terms of higher than ﬁrst order. The matrix B0is symmetric, and its trace is /NAK0,s o K.B0/D/DC42B0/NUL/NAK0I303 0T 3/NAK0/NAK (5.89) We see thatK.B0/qBRDK.B0/IqD/NAK0Iq, so the maximum eigenvalue is equal to/NAK0for error-free measurements. This is expected because the loss function must be zero if the measurement errors are zero. The other three eigenvectors of K0have three-vector part q1W3Dxiand scalar part q4D0, where xiis an eigenvector of .2B0/NUL/NAK0I3/with eigenvalue /NAKiC1,f o riD1;2;3 . Now let us turn to /SOHB.B o t h btrue iC/SOHbiandbtrue iare unit vectors, so 1Dkbtrue iC/SOHbik2D1C2btrue i/SOH/SOHbiCk/SOHbik2(5.90)5.5 Error Analysis of Wahba’s Problem 203 The same relation holds for riDbtrue iC/SOHri,s o btrue i/SOH/SOHbiD/NUL1 2k/SOHbik2and btrue i/SOH/SOHriD/NUL1 2k/SOHrik2(5.91) It follows that tr ./SOHB/D0, to ﬁrst order in the vector errors. The zvector associated with/SOHBis, also to ﬁrst order /SOHzDNX iD1ai.btrue iC/SOHbi//STX.btrue iC/SOHri/DNX iD1aibtrue i/STX./SOHri/NUL/SOHbi/(5.92) and so K./SOHB/D/DC4/SOHBC/SOHBT/SOHz /SOHzT0/NAK (5.93) Putting all this into Davenport’s eigenvalue equation gives K.B/OqDŒK.B0/CK./SOHB//c141/DC2/DC403 1/NAK C1 2/DC4ı# 0/NAK/DC3 D/NAKmaxOqD./NAK0C/SOH/NAK//DC2/DC403 1/NAK C1 2/DC4ı# 0/NAK/DC3 (5.94) Multiplying this out, discarding terms of second order, and canceling the common zeroth-order term K.B0/IqD/NAK0Iqon the two sides gives 1 2K.B0//DC4ı# 0/NAK CK./SOHB//DC403 1/NAK D1 2/NAK0/DC4ı# 0/NAK C/SOH/NAK/DC403 1/NAK (5.95) Inserting the explicit forms of K.B0/andK./SOHB/ gives /DC4.1=2/.2B 0/NUL/NAK0I3/ı#C/SOHz 0/NAK D/DC4.1=2//NAK0ı# /SOH/NAK/NAK (5.96) The fourth component of this equation says that /SOH/NAKis zero to ﬁrst order in the errors in the vectors. This means that the loss function is of second order in these errors,which is in accordance with its deﬁnition. The ﬁrst three components of Eq. ( 5.96) are more interesting; they give ı#D./NAK 0I3/NULB0//NUL1/SOHzD./NAK0I3/NULB0//NUL1NX iD1aibtrue i/STX./SOHri/NUL/SOHbi/ (5.97)204 5 Static Attitude Determination Methods This is the key result; it expresses the attitude error rotation vector in terms of the errors in the body frame vectors and the reference vectors, with the latter mapped into the true body frame. Is is also interesting to note that /NAK0I3/NULB0DNX iD1ai/STX I3/NULbtrue i.btrue i/T/ETX (5.98) The discussion following Eq. ( 5.89) shows that this matrix is singular if the largest two eigenvalues of K0are equal. 5.5.2 Covariance Analysis of Wahba’s Problem If we knew the errors of the vectors in the spacecraft body frame and the reference frame, we would correct the vectors before performing the estimation, and they would no longer be errors. The usual situation is that the errors are unknown, but they have some statistical distribution with known properties. These propertiesare given by expected values over the probability distribution. The details of the probability distribution are not important for this section; we only need to know the expected values of some quantities. We assume that the vector errors have zero mean, except for components along b true ithat are necessary to satisfy the norm constraint of Eq. ( 5.91). Thus their expected values are assumed to satisfy, for all i Ef/SOHbigD/NUL1 2Efk/SOHbik2gbtrue i andEf/SOHrigD/NUL1 2Efk/SOHrik2gbtrue i (5.99) The usual justiﬁcation of this assumption is that we would estimate and correct for any other non-zero means of these quantities before estimating the attitude. Now the only stochastic quantities in Eq. ( 5.97)a r eı#,/SOHz,/SOHri, and/SOHbi; the other quantities are deterministic. Computing expected values is a linear operation, andthe cross product of a vector with itself is zero, so it follows that Efı#gD./NAK 0I3/NULB0//NUL1NX iD1aibtrue i/STX.Ef/SOHrig/NULEf/SOHbig/D03 (5.100) This shows that the expected value of the attitude error ı#is zero, which means that a solution of Wahba’s problem is an unbiased estimator. We are interested in the expected spread of the attitude estimates about the mean value. This is given by the covariance matrix P##/DC1E˚ .ı#/NULEfı#g/.ı#/NULEfı#g/T/TAB DEfı#ı#Tg (5.101)5.5 Error Analysis of Wahba’s Problem 205 Substituting Eq. ( 5.97)g i v e s P##D./NAK0I3/NULB0//NUL1Ef/SOHz/SOHzTg./NAK0I3/NULB0//NUL1(5.102) Further progress requires some assumptions about the covariance of the vector errors. We assume that the errors in the individual vectors are uncorrelated, meaningthat Ef/SOHb i/SOHbT jgDEf/SOHri/SOHrT jgD0fori¤j (5.103a) Ef/SOHbi/SOHrT jgD0for alli;j (5.103b) We also deﬁne the measurement covariance matrices by Rbi/DC1Ef/SOHbi/SOHbT ig (5.104a) Rri/DC1Ef/SOHri/SOHrT ig (5.104b) Then Ef/SOHz/SOHzTgDNX i;jD1aiajŒbtrue i/STX/c141Ef./SOHri/NUL/SOHbi/./SOHrj/NUL/SOHbj/TgŒbtrue j/STX/c141T DNX iD1a2 iŒbtrue i/STX/c141.RriCRbi/Œbtrue i/STX/c141T(5.105) and P##D./NAK0I3/NULB0//NUL1(NX iD1a2 iŒbtrue i/STX/c141.RriCRbi/Œbtrue i/STX/c141T) ./NAK0I3/NULB0//NUL1 (5.106) We now make a further simplifying assumption about the vector errors, namely that they are axially symmetric about the true vectors. We also ignore the compo- nents along the true vectors shown in Eq. ( 5.99), which are of higher order than the terms we retain. These assumptions are expressed in the equations RriD/ESC2 ri/STX I3/NULrtrue i.rtrue i/T/ETX D/NUL/ESC2 ri/STX rtrue i/STX/ETX2(5.107a) RbiD/ESC2 bi/STX I3/NULbtrue i.btrue i/T/ETX D/NUL/ESC2 bi/STX btrue i/STX/ETX2(5.107b) This has become known as the QUEST Measurement Model (QMM). If we think of the error-corrupted vectors as arrows with a common base, their points should all lie on a unit sphere. The QUEST measurement model is essentially the approximationthat the points all lie on the plane that is tangent to the unit sphere at the location of206 5 Static Attitude Determination Methods the true unit vector. This is certainly a good approximation if the errors are small. We note that Efk/SOHrik2gD trRriandEfk/SOHbik2gD trRbi,s oE q .( 5.99) becomes, for the QMM, Ef/SOHrigD/NUL/ESC2 rirtrueiandEf/SOHbigD/NUL/ESC2 bibtrue i (5.108) It is useful to combine the error variances of the body frame vectors and reference frame vectors into overall measurement variances /ESC2 i/DC1/ESC2 riC/ESC2 bi(5.109) Remembering that we have assumed rtrue iDbtrue ifor our error analysis, the error covariance with the QMM is P##D./NAK0I3/NULB0//NUL1M./NAK0I3/NULB0//NUL1(5.110) where M/DC1NX i;D1a2 i/ESC2 iŒbtrue i/STX/c141Œbtrue i/STX/c141TDNX i;D1a2 i/ESC2 i/STX I3/NULbtrue i.btrue i/T/ETX (5.111) It is interesting to note that using the nonsingular, but nonphysical, measurement covariance matrices RriD/ESC2 riI3andRbiD/ESC2 biI3yields the same result. If we choose the weights to be proportional to the inverses of the measurement variances, aiDc=/ESC2 i (5.112) for some constant c, we get the very simple result MDc2F; /NAK0I3/NULB0DcF; andP##DF/NUL1(5.113) where F/DC1NX iD1/ESC/NUL2 i/STX I3/NULbtrue i.btrue i/T/ETX (5.114) We will show in Sect. 5.6.1 that this choice of weights in Wahba’s loss function also results in the best estimate.7Note that the covariance is independent of the scaling 7We can show that Eq. ( 5.112 ) gives an extremum of P##by differentiating Eq. ( 5.110 ) with respect to anyak, then substituting Eqs. ( 5.112 )a n d( 5.113 ) after differentiating, which gives zero for the derivative.5.5 Error Analysis of Wahba’s Problem 207 parameterc. Most recent work sets cD1, so the weights are equal to the inverse variances, but earlier treatments often set cD/ESC2 tot, where /ESCtot/DC1 NX iD1/ESC/NUL2 i!/NUL1=2 (5.115) so that the weights sum to unity. Equation ( 5.114 ) has a nice physical interpretation. The covariance matrix is a measure of the uncertainty, or the lack of complete information, in computing the estimate. The inverse of the covariance matrix, F, is therefore a measure of the information contributing to the estimate. Each term in the sum in Eq. ( 5.114 ) can be interpreted as the information contributed by a single vector measurement. For an efﬁcient estimatorFis equivalent to the Fisher Information Matrix . See Sect. 12.3.4 for more details. In practice, we would like to compute an estimate of the covariance without requiring knowledge of the true body frame vectors. We could simply use themeasured body frame vectors b iin Eq. ( 5.114 ), but it is better to use the predicted body frame vectors OAri, which usually have smaller errors. We can avoid the need to perform the additional summation of Eq. ( 5.114 )b yu s i n gt h e Bmatrix, which must be computed as part of the attitude estimation. Dispensing with the assumption that the reference frame coincides with the body frame, we see from Eq. ( 5.113 ) that a good estimate of the covariance is P##Dc./NAK maxI3/NULBOAT//NUL1(5.116) We use/NAKmaxinstead of/NAK0in this equation to preserve the important property that the covariance is inﬁnite if the two largest eigenvalues of Kare equal. Analysis parallel to that used to derive the FOAM attitude estimate gives the alternative form for the covariance P##Dc/NUL /NAK2 max/NULkBk2 F/SOH I3C2BBT /NAKmax/NUL /NAK2max/NULkBk2 F/SOH /NUL2detB(5.117) which avoids a matrix inversion. 5.5.3 Covariance with Two Observations The covariance for the case of two observations can be found by substituting Eqs. ( 5.75a )–(5.75c ) and ( 5.76) into Eq. ( 5.117 ). We also assume for simplicity that r1/SOHr2Db1/SOHb2, which leads tokb1/STXb2kDk r1/STXr2kand/NAKmaxDa1Ca2. Putting all this together gives P##Dc a1Ca2/DC4 I3Ca2 1b1bT1Ca2 2b2bT2Ca1a2.b1/SOHb2/.b1bT 2Cb2bT 1/ a1a2kb1/STXb2k2/NAK (5.118)208 5 Static Attitude Determination Methods We now use the expansion of the identity matrix in terms of the orthonormal triad of Sect. 5.1: I3Dw1wT 1Cw2wT 2Cw3wT 3 Db1bT 1Cb2bT 2/NUL.b1/SOHb2/.b1bT 2Cb2bT 1/ kb1/STXb2k2Cb/STXbT /STX (5.119) and substitute aiDc=/ESC2 ito get the ﬁnal result P##D/ESC2 2b1bT1C/ESC2 1b2bT2 kb1/STXb2k2C/ESC2 1/ESC2 2 /ESC2 1C/ESC2 2b/STXbT /STX (5.120) It is easy to see with the help of Eq. ( 5.119 ) that this is the inverse of Eq. ( 5.114 )i f measurement errors are negligible. The covariance of the TRIAD estimate is found as a limiting case of the covariance of the Wahba estimate. We have seen that the TRIAD estimate is the limiting case of Eq. ( 5.78)f o ra1/GSa2, or equivalently for /ESC2/GS/ESC1. Taking this limit of Eq. ( 5.120 )g i v e s PTRIADD/ESC2 2b1bT1C/ESC2 1b2bT2 kb1/STXb2k2C/ESC2 1b/STXbT/STX(5.121) We noted that the Wahba and TRIAD attitude estimates only differ by a rotation around b/STX, so it is not surprising that the only difference in the covariance of the two estimates is in that direction. The TRIAD information matrix is the inverse of the covariance, namely FTRIADD/ESC/NUL2 1.I3/NULb1bT 1/C/ESC/NUL2 2.b2/STXb/STX/.b2/STXb/STX/T(5.122) The ﬁrst vector measurement contributes the same information to the TRIAD estimate as to the Wahba estimate, two components perpendicular to b1;b u t the second vector measurement contributes only one component of information,perpendicular to both b 2andb/STX, to the TRIAD estimate. This derivation of the TRIAD covariance and information matrices is somewhat heuristic, but a more rigorous analysis gives the same result [ 32,35]. 5.6 MLE for Attitude Determination In this section maximum likelihood estimation (MLE) for the attitude determination problem is studied. The treatment in Sect. 12.3.4 requires the measurement covari- ance matrixRto be nonsingular, as will usually be the case if the measurement vector ycontains actual measurements. Considering a star tracker, for example, the5.6 MLE for Attitude Determination 209 actual measurements are the horizontal and vertical positions of the centroids of the star images in the tracker’s ﬁeld of view.8The measurement covariance matrix for these measurements is nonsingular, but it is not particularly simple in the generalcase [ 3]. Here we want to focus on modeling the measurements as unit vectors, which leads to the elegant and useful estimation methods based on Wahba’s loss function.An apparent difﬁculty with this approach is that the measurement covariance matrix of the QMM is singular, as shown in Eq. ( 5.107 ). Shuster has shown how to deﬁne a conditional pdf for vector measurements that overcomes this problem [ 29], and we will follow his approach. We ﬁrst assume that no errors exist in the reference vectors, and will relax this assumption later. In this case, the conditional pdf for a unit-vector measurementb iis p.bijAtrue;rtrue i/DNbiexp /NUL1 2/ESC2 bikbi/NULAtruertrue ik2! (5.123) This pdf is deﬁned over the unit sphere i.e. for bithat satisﬁeskbikD1. In this pdf, the single parameter /ESC2 bitakes the place of the measurement covariance matrix, so this models measurement errors with a high degree of symmetry. In fact, the errors in this model are as symmetric as possible consistent with the unit vector constraint on the measurements. We will show that this model is equivalent to the QMM to avery good approximation. The normalization coefﬁcient N bimust be speciﬁed so that the total probability is unity. To compute the normalization and other integrals of interest, we parameterizeb iasbiDAtruertrue icos/DC2Cusin/DC2cos/RSCvsin/DC2sin/RS, where uandvare two unit vectors perpendicular to Atruertrue iand to each other. The area element on the unit sphere is sin /DC2d /DC2d /RSDd/DLEd/RS , where/DLE/DC11/NULcos/DC2. Then the normalization constant is given by NbiD/DC4Z2/EM 0Z2 0exp./NUL/DLE=/ESC2 bi/d/DLEd/RS/NAK/NUL1 Dh 2/EM/ESC2 bi/DLE 1/NULe/NUL2=/ESC2 bi/DC1i/NUL1 (5.124) The exponential term can be neglected even for extremely large errors, reﬂecting the fact that the pdf becomes extremely small over most of the unit sphere. For example, if/ESCiis10ı, or 0.175 rad, then e/NUL2=/ESC2 biD3/STX10/NUL29. Neglecting the exponential term is equivalent to taking the upper limit of the /DLEintegral to be inﬁnite, an approximation we will employ in the next paragraph. 8The really basic measurements are the electron counts in the individual pixels of the star tracker’s focal plane, but these are invariably reduced to centroids before being communicated to the attitudecontrol system.210 5 Static Attitude Determination Methods It is interesting to see how the unit vector pdf of Eq. ( 5.123 ) is related to the QMM. First, with btrue i/DC1Atruertrue iwe see that Efbi/NULbtrue ig/EM1 2/EM/ESC2 biZ2/EM 0Z1 0./NUL/DLE/exp./NUL/DLE=/ESC2 bi/d/DLEd/RS btrue i/EM/NUL/ESC2 bibtrue i (5.125) because the integral over /RSgives zero components along uand v. This shows that Eq. ( 5.108 ) holds in the approximation of ignoring e/NUL2=/ESC2 bi. Now we compute Ef.bi/NULbtrue i/.bi/NULbtrue i/Tg. The integrals involving an odd power of cos /RSor sin/RSwill vanish in the integration over /RS, and the integrals over /RSof cos2/RSand sin2/RSboth give/EM. We also note that sin2/DC2D2/DLE/NUL/DLE2and uuTCvvTD I3/NULbtrue i.btrue i/T,s o Ef.bi/NULbtrue i/.bi/NULbtrue i/Tg/EM/ESC/NUL2 biZ1 0/DLEexp./NUL/DLE=/ESC2 bi/d/DLE/STX I3/NULbtrue i.btrue i/T/ETX /NUL1 2/ESC/NUL2 biZ1 0/DLE2exp./NUL/DLE=/ESC2 bi/d/DLE/STX I3/NUL3btrue i.btrue i/T/ETX /EM/ESC2 bi/STX I3/NULbtrue i.btrue i/T/ETX /NUL/ESC4 bi/STX I3/NUL3btrue i.btrue i/T/ETX (5.126) The ﬁrst term is the covariance of the QMM, Eq. ( 5.107b ). The second term is a small correction, much larger than the neglected exponential terms but only 3 % for measurement errors as large as 10ı. It is interesting to note that this term has zero trace. The likelihood of a set of Nstatistically independent measurements is `.b1;:::; bNjAtrue;rtrue i/DNY iD1Nbiexp /NUL1 2/ESC2 bikbi/NULAtruertrue ik2! (5.127) Maximizing this likelihood is equivalent to minimizing the negative log-likelihood, which is given by /NULln`DNX iD1 1 2/ESC2 bikbi/NULAtruertrue ik2/NULlnNbi! (5.128) The data-dependent portion of the negative log-likelihood, i.e. the part exclusive of the ln Nbiterms, is Wahba’s loss function with the weights chosen according to Eq. (5.112 ), which establishes that Wahba’s problem is equivalent to MLE with this choice of weights. The MLE analysis up to this point has assumed that the reference vectors are perfectly known. This is never the case, although the reference vectors often have much smaller uncertainties than the body frame vectors. We can generalize the analysis by assuming that the reference vectors have a conditional pdf over theunit sphere of the form5.6 MLE for Attitude Determination 211 p.rijrtrue i/DNriexp /NUL1 2/ESC2rikri/NULrtrue ik2! (5.129) With the reasonable assumption of statistical independence of the reference vector errors and the errors in the body frame measurements, the likelihood of the referenceand body frame vectors is `.b 1;:::; bN;r1;:::; rNjAtrue;rtrue i/DNY iD1NbiNri /STXexp /NUL1 2/ESC2 bikbi/NULAtruertrue ik2/NUL1 2/ESC2rikri/NULrtrue ik2! (5.130) and the negative log-likelihood function is /NULln`DNX iD1" 1 2/ESC2 bikbi/NULAtruertrue ik2C1 2/ESC2rikri/NULrtrue ik2/NULln.NbiNri/# DNX iD1n /ESC/NUL2 biC/ESC/NUL2 ri/NUL/STX /ESC/NUL2 bi.Atrue/TbiC/ESC/NUL2 riri/ETXTrtruei/NULln.NbiNri/o (5.131) We have to use our error-corrupted reference vectors and body frame vectors to ﬁnd a maximum likelihood estimate of both the attitude matrix Atrueand each of the true reference vectors rtrue i. It is clear that we minimize the negative log-likelihood function with respect to the true reference vectors by taking rtrue ito be the unit vector in the direction of /ESC/NUL2 bi.Atrue/TbiC/ESC/NUL2 riri, i.e. rtrue iD/ESC/NUL2 bi.Atrue/TbiC/ESC/NUL2 riri ./ESC/NUL4 biC/ESC/NUL4riC2/ESC/NUL2 bi/ESC/NUL2ribT iAtrueri/1=2(5.132) This is exactly what we would expect, a weighted average of the estimates computed from the error-corrupted reference and body frame vectors. This estimate involves the as-yet-unknown attitude matrix. However, inserting this estimate of rtrue iinto Eq. (5.131 ) gives the effective negative log-likelihood function for the attitude /NULln`DNX iD1/STX /ESC/NUL2 biC/ESC/NUL2 ri/NUL./ESC/NUL4 biC/ESC/NUL4 riC2/ESC/NUL2 bi/ESC/NUL2 ribTiAtrueri/1=2/NULln.NbiNri//ETX (5.133) This does not look like Wahba’s loss function. However, we can write /ESC/NUL4 biC/ESC/NUL4 riC2/ESC/NUL2 bi/ESC/NUL2 ribTiAtrueriD./ESC/NUL2 biC/ESC/NUL2 ri/2/NUL2/ESC/NUL2 bi/ESC/NUL2 ri.1/NULbT iAtrueri/ D./ESC/NUL2 biC/ESC/NUL2 ri/2/NUL/ESC/NUL2 bi/ESC/NUL2 rikbi/NULAtruerik2 (5.134)212 5 Static Attitude Determination Methods It is always true that kbi/NULAtruerik/FS/ESCbi/ESCri./ESC/NUL2 biC/ESC/NUL2 ri/D/ESCbi=/ESCriC/ESCri=/ESCbi, because the right side of this inequality is never smaller than 2 and the left side is on the order of the /ESC2by Eq. ( 5.125 ). Thus expanding the square root in Eq. ( 5.133 ) as a Taylor series and retaining only the ﬁrst two terms gives the useful expression Œ./ESC/NUL2 biC/ESC/NUL2 ri/2/NUL/ESC/NUL2 bi/ESC/NUL2 rikbi/NULAtruerik2/c1411=2 /EM./ESC/NUL2 biC/ESC/NUL2 ri/2 641/NULkbi/NULAtruerik2 2/ESC2 bi/ESC2ri/DLE /ESC/NUL2 biC/ESC/NUL2ri/DC123 75 (5.135) and thus /NULln`/EMNX iD1/DC41 2/ESC2 ikbi/NULAtruerik2/NULln.NbiNri//NAK (5.136) with/ESC2 iD/ESC2 biC/ESC2 ri,a si nE q . ( 5.109 ). The data-dependent portion of this is just Wahba’s loss function with an effective measurement variance of /ESC2 biC/ESC2 ri. 5.6.1 Fisher Information Matrix for Attitude Determination To determine the Fisher information matrix using the negative log-likelihood in Eq. (5.136 ), we must ﬁrst decide what to use as the vector that we called xtruein Sect. 12.3.4 . The components of the attitude matrix are not appropriate, because they are constrained by the orthogonality requirement. We know that three parameters provide a minimal representation of a rotation, so we use the three incremental error angles as deﬁned in Eq. ( 2.123 ). Thus we replace Atrueby Atrue!exp./NULŒı#/STX/c141/Atrue/EM.I3/NULŒı#/STX/c141/Atrue(5.137) whereı#is the vector of error angles. Substituting Eq. ( 5.137 ) into Eq. ( 5.136 ) and inserting the true values for biandrigives /NULln`/EMNX iD1/DC41 2/ESC2 ikŒı#/STX/c141Atruertrue ik2/NULln.NbiNri//NAK /EMNX iD1/DC41 2/ESC2 iı#TŒbtrue i/STX/c141TŒbtrue i/STX/c141ı#/NULln.NbiNri//NAK (5.138) because btrue iDAtruertrue i. This approximate expression can be considered as exact for the purpose of computing the Fisher information matrix, because the higher order terms neglected in Eq. ( 5.135 ) are of third and higher order in ı#and vanish when computing the information matrix.5.6 MLE for Attitude Determination 213 Now the Fisher information matrix is given by FD/NUL@2.ln`/=Œ.@ı#/.@ı#T//c141ˇˇ ı#D0DNX iD1/ESC/NUL2 iŒbtrue i/STX/c141TŒbtrue i/STX/c141 DNX iD1/ESC/NUL2 i/STX I3/NULbtrue i.btrue i/T/ETX (5.139) remembering that btrue iis a unit vector. Comparing this result to Eq. ( 5.114 )s h o w s that any solution that minimizes Wahba’s problem leads to an efﬁcient estimator, towithin ﬁrst-order, since P ##DF/NUL1. An analysis of the observable attitude axes using the Fisher information matrix is shown in [ 8], which is repeated here. This analysis is shown for one and two vector observations. For observation of a single vector the Fisher information matrix is given by FD/ESC/NUL2/STX I3/NULbtrue.btrue/T/ETX (5.140) An eigenvalue/eigenvector decomposition can be useful to assess the observability of this system. Since Fis a symmetric positive semi-deﬁnite matrix, then all of its eigenvalues are greater than or equal to zero. Furthermore, the matrix of eigenvectors is orthogonal, which can be used to deﬁne a coordinate system. Theeigenvalues of this matrix are given by /NAK 1D0and/NAK2;3D/ESC/NUL2. This indicates that rotations about one of the eigenvectors are not observable. The eigenvector associated with the zero eigenvalue is along btrue. Therefore, rotations about the body vector are unknown, which intuitively makes sense. The other observable axes are perpendicular to this unobservable axis, which also intuitively makes sense. A more interesting case involves two vector observations. The information matrix for this case is given by FD/ESC/NUL2 1/STX I3/NULbtrue 1.btrue 1/T/ETX C/ESC/NUL2 2/STX I3/NULbtrue 2.btrue 2/T/ETX (5.141) If two non-collinear vector observations exist, then the system is fully observable and no zero eigenvalues of Fwill exist. The maximum eigenvalue of Fcan be s h o w nt ob eg i v e nb y /NAKmaxD/ESC/NUL2 1C/ESC/NUL2 2 (5.142) Factoring this eigenvalue out of the characteristic equation, det ./NAKI3/NULF/D0, yields the following form for the remaining eigenvalues: /NAK2/NUL/NAKmax/NAKC/ESC/NUL2 1/ESC/NUL2 2kbtrue 1/STXbtrue 2k2D0 (5.143) Therefore, the intermediate and minimum eigenvalues are given by214 5 Static Attitude Determination Methods /NAKintD/NAKmax.1C/US/ 2(5.144a) /NAKminD/NAKmax.1/NUL/US/ 2(5.144b) where /USD/DC4 1/NUL4kbtrue 1/STXbtrue 2k2 /ESC2 1/ESC2 2/NAK2max/NAK1=2 (5.145) Note that/NAKmaxD/NAKminC/NAKint. Also note thatkbtrue 1/STXbtrue 2kD0ifbtrue 1is collinear with btrue Equation ( 5.144 )s h o w s/NAKminD0and thus the inverse of the Fisher information matrix does not exist, as expected for this case. Also, /NAKintD/NAKmaxfor this case. The eigenvectors of Fare computed by solving /NAKvDFvfor each eigenvalue. The eigenvector associated with the maximum eigenvalue can be shown to begiven by v maxD˙btrue 1/STXbtrue 2 kbtrue 1/STXbtrue 2k(5.146) The sign of this vector is not of consequence since we are only interested in rotations about this vector. This indicates that the most observable axis is perpendicular to the plane formed by btrue 1andbtrue 2, which intuitively makes sense. The remaining eigenvectors must surely lie in the btrue 1-btrue 2plane. To determine the eigenvector associated with the minimum eigenvalue, we will perform a rotation about the vmaxaxis and determine the angle from b1. Using the Euler axis and angle parameterization in Eq. ( 2.108 )g i v e s vminD˙˚ .cos#/I3C.1/NULcos#/vmaxvT max/NULsin#Œvmax/STX/c141/TAB btrue 1 (5.147) where#is the angle used to rotate btrue 1tovmin. Using the fact that vmaxis perpendicular to btrue 1gives vT maxbtrue 1D0. Therefore, Eq. ( 5.147 ) reduces down to vminD˙f.cos#/I3/NULsin#Œvmax/STX/c141gbtrue 1 (5.148) Substituting Eq. ( 5.148 )i n t o/NAKminvminDFvminand using the property of the cross product matrix leads to the following equation for #: tan#DaCb c(5.149) where a/DC1/NAKmin/ESC/NUL2 1 (5.150a) b/DC1/ESC/NUL2 1/ESC/NUL2 2.btrue 1/TŒbtrue 2/STX/c1412btrue 1 (5.150b) c/DC1/NUL/ESC/NUL2 1/ESC/NUL2 2.btrue 1/TŒbtrue 2/STX/c1412Œbtrue 1/STX/c1412btrue 2 kbtrue 1/STXbtrue 2k(5.150c)5.6 MLE for Attitude Determination 215 b1trueb2truevmax vminFig. 5.1 Observable axes with two vector observations Equation ( 5.149 ) can now be solved for #, which can be used to determine vminfrom Eqs. ( 5.146 ) and ( 5.148 ). The intermediate axis is simply given by the cross product ofvmaxandvmin: vintD˙ vmax/STXvmin (5.151) A plot of the minimum and intermediate axes is shown in Fig. 5.1for the case when the angle between btrue 1andbtrue 2is less than90ı. Intuitively, this analysis makes sense since we expect that the least determined axis, vmin, is somewhere between btrue 1andbtrue 2if these vector observations are less than 90ıapart. The previous analysis greatly simpliﬁes if the reference vectors are unit vectors and the observation variances are equal, so that /ESC2 1D/ESC2 2/DC1/ESC2. These assumptions are valid for a single ﬁeld-of-view star camera. The eigenvalues are now given by /NAKmaxD2/ESC/NUL2(5.152a) /NAKintD/ESC/NUL2.1Cj.btrue 1/Tb2j/ (5.152b) /NAKminD/ESC/NUL2.1/NULj.btrue 1/Tb2j/ (5.152c) The eigenvectors are now given by vmaxD˙btrue 1/STXbtrue 2 kbtrue 1/STXbtrue 2k(5.153a) vintD˙btrue 1/NULsignŒ.btrue 1/Tbtrue2/c141btrue 2 kbtrue 1/NULsignŒ.btrue 1/Tbtrue2/c141btrue 2k(5.153b) vminD˙btrue 1CsignŒ.btrue 1/Tbtrue2/c141btrue 2 kbtrue 1CsignŒ.btrue 1/Tbtrue2/c141btrue 2k(5.153c) where signŒ.btrue 1/Tbtrue2/c141is used to ensure that the proper direction of the eigenvectors is determined when the angle between btrue 1andbtrue 2is greater than 90ı.216 5 Static Attitude Determination Methods If this angle is less than 90ıthen vminis the bisector ofbtrue 1andbtrue Intuitively this makes sense since we expect rotations perpendicular to the bisector of the twovector observations to be more observable than rotations about the bisector (again assuming that the vector observations are within 90 ıof each other). The analysis presented in this section is extremely useful for the visualization of the observability of the determined attitude. Closed-form solutions for special cases have been presented here. Still, in general, the eigenvalues and eigenvectors of the information matrix can be used to analyze the observability for cases involvingmultiple observations. 5.7 Induced Attitude Errors from Orbit Errors Missions sometime require accurate attitude knowledge for Earth-pointing space- craft. As discussed in Chap. 1this is true for the GOES series of spacecraft. A natural attitude sensor selection for Earth-pointing spacecraft is a horizon sensorbecause it provides an attitude estimate directly with respect to an Earth-centric frame. However, as is the case for GOES, a horizon sensor may not meet the desired attitude knowledge requirement. For GOES a star tracker was selectedto provide higher attitude accuracy. But a star tracker provides an estimate with respect to an inertial frame. The conversion to an Earth-centric frame, such as the LVLH described in Sect. 2.6.4 , requires an attitude rotation from an inertial frame to an Earth-centric frame. For the LVLH frame the required attitude matrix to accomplish this rotation is given by the transpose of the matrix in Eq. ( 2.79). Since this matrix depends on position and velocity, then these quantities will contributeto the overall attitude errors. This section derives the attitude error-covariance with additive position and velocity orbit errors in Eq. ( 2.79). Since the orbit determination errors are uncorrelated with the attitude sensor errors, then the overall attitude erroris the sum of the sensor and orbit errors. In this way the additional errors induced by the coupling of position and velocity to attitude can be accounted for in the overall attitude knowledge budget. First, the true variables must be deﬁned from Eq. ( 2.78): o true 3ID/NULrtrue I=krtrue Ik/DC1/NULgtrue 3rtrueI(5.154a) otrue 2ID/NUL.rtrue I/STXvtrue I/=krtrue I/STXvtrue Ik/DC1/NULgtrue 2.rtrue I/STXvtrue I/ (5.154b) otrue 1IDgtrue 2gtrue 3Œkrtrue Ik2vtrueI/NUL.rtrue I/SOHvtrue I/rtrue I/c141 (5.154c) Adding an error to position in o3Isimply gives o3ID/NULrtrue IC/SOHrI krtrue IC/SOHrIk(5.155)5.7 Induced Attitude Errors from Orbit Errors 217 where rtrue Iis the true position and /SOHrIis its associated error, which is assumed to be a zero-mean Gaussian noise process. In this section it is assumed that thesignal-to-noise ratio is large enough so that second-order and higher error terms are negligible. The denominator in Eq. ( 5.155 ) is thus approximated by kr true IC/SOHrIkD.krtrue Ik2C2rtrue I/SOH/SOHrICk/SOHrIk2/1=2 /EM.krtrue Ik2C2rtrue I/SOH/SOHrI/1=2(5.156) Next the following ﬁrst-order binomial expansion is used: .xC/SOHx/n/EMxnCnxn/NUL1/SOHx; /SOHx<<x (5.157) Using Eq. ( 5.157 ) withx/DC1krtrue Ik2,/SOHx/DC12rtrue I/SOH/SOHrIandnD/NUL1=2leads to o3I/EM/NUL.rtrue IC/SOHrI//NUL krtrue Ik/NUL1/NULkrtrue Ik/NUL3rtrue I/SOH/SOHrI/SOH (5.158) Ignoring second-order terms gives o3I/EMotrue 3IC1 krtrue Ik3/STX .rtrue I/.rtrue I/T/NULkrtrue Ik2I3/ETX /SOHrI Dotrue 3IC1 krtrue Ik3Œrtrue I/STX/c1412/SOHrI(5.159) Therefore the error in o3I, denoted by/SOHo3I, is given by /SOHo3ID1 krtrue Ik3Œrtrue I/STX/c1412/SOHrI (5.160) In a similar fashion the error in o2I, denoted by/SOHo2I, can by shown to be given by (which is left as an exercise to the reader) /SOHo2ID1 krtrue I/STXvtrue Ik3Œ.rtrue I/STXvtrue I//STX/c1412Œ.rtrue I/STX/SOHvI//NUL.vtrue I/STX/SOHrI//c141(5.161) where vtrue Iis the true velocity and /SOHvIis its associated error, which is assumed to be a zero-mean Gaussian noise process. The error in o1Iis more complicated than the other ones, but fortunately this term is not required in the analysis. The attitude matrix with errors can now be written as AIODAtrue IOC/SOHAIO (5.162) where AIO/DC1Œo1Io2Io3I/c141 (5.163a) Atrue IO/DC1Œotrue 1Iotrue2Iotrue3I/c141 (5.163b) /SOHAIO/DC1Œ/SOHo1I/SOHo2I/SOHo3I/c141 (5.163c)218 5 Static Attitude Determination Methods We wish to use a multiplicative attitude error in the orbit frame, which is given by Eq. (2.180 )a s ıAIOD.Atrue IO/TAIO/EMI3/NULŒı#/STX/c141 (5.164) Substituting Eq. ( 5.162 ) into Eq. ( 5.164 ) and cancelling the I3terms gives /NULŒı#/STX/c141D.Atrue IO/T/SOHAIOD2 40 otrue 1I/SOH/SOHo2Iotrue 1I/SOH/SOHo3I otrue 2I/SOH/SOHo1I0 otrue 2I/SOH/SOHo3I otrue 3I/SOH/SOHo1Iotrue 3I/SOH/SOHo2I03 5(5.165) This is very similar to the derivation of Eq. ( 3.174 ), and as in that case we choose the easier dot products to evaluate. After some algebra that is left to the reader as anexercise, this leads to ı#D2 4o true 2I/SOH/SOHo3I /NULotrue 1I/SOH/SOHo3I otrue 1I/SOH/SOHo2I3 5DO/DC4/SOHrI /SOHvI/NAK (5.166) where O/DC12 664gtrue 3.otrue 2I/T0T 3 /NULgtrue 3.otrue 1I/T0T 3 /NULgtrue 2gtrue 3.rtrue I/SOHvtrue I/.otrue 2I/Tgtrue 2gtrue 3krtrue Ik2.otrue 2I/T3 775(5.167) The position and velocity error-covariance matrix is deﬁned by PorbitDE/SUB/DC4/SOHrI /SOHvI/NAK/STX /SOHrT I/SOHvT I/ETX/ESC (5.168) which is given by the orbit determination system. Therefore, the induced attitude error-covariance is given by PorbitDE˚ .ı#/.ı#/T/TAB DOP orbit OT(5.169) Note thatPorbitis a function of the true position and velocity variables in O, but these can be replaced by their respective estimates from the orbit determination system in practice. 5.8 TRMM Attitude Determination The Tropical Rainfall Measuring Mission (TRMM) spacecraft was launched onNovember 27, 1997 from the Tanegashima Space Center in Tanegashima, Japan. The main objectives of this mission include: (1) to obtain multi-year measurements5.8 TRMM Attitude Determination 219 Fig. 5.2 TRMM spacecraft of tropical and subtropical rainfall, (2) to understand how interactions between the sea, air, and land masses produce changes in global rainfall and climate, and (3) to help improve the modeling of tropical rainfall processes and their inﬂuence on global circulation. TRMM’s nominal orbit altitude was 350 km, until raised to 402 km to prolong mission life by reducing the fuel expenditure used to compensate for atmospheric drag [ 1]. The spacecraft is three-axis stabilized with an orbit inclination of 35ı. A diagram of the TRMM spacecraft is shown in Fig. 5.2.T h eOb1axis is parallel to the orbital velocity direction, the Ob2axis is parallel to the negative of the orbital momentum vector, and the Ob3axis points in the nadir direction. The nominal mission mode requires a rotation once per orbit about the spacecraft’s Ob2axis while holding the remaining axis rotations near zero. Thus, the LVLH frame described in Sect. 2.6.4 can be used to compute the desired attitude matrix from the spacecraft’s position/velocity vector in order to maintain an Earth-pointing conﬁguration. The attitude determination hardware consists of an Earth Sensor Assembly (ESA), Digital Sun Sensors (DSSs), Coarse Sun Sensors (CSSs), a Three-AxisMagnetometer (TAM), and rate-integrating gyroscopes (RIGs). The allotted attitude knowledge accuracy of 0.18 ıper axis was achieved by using the ESA for pitch and roll and the RIGs, updated twice per orbit by DSS measurements, for yaw.As was discussed in Chap. 1, potential problems with the ESA resulted in an effort to220 5 Static Attitude Determination Methods develop alternative attitude determination methods using only the DSSs, TAM, and RIGs [ 1,7]. This effort led to several simple algorithms, one of which is used as an onboard backup to the full-up Kalman ﬁlter employed for the TRMM contingencymode. Simulations of this mode, which provides accuracies comparable to those given by the Kalman ﬁlter and by the ESA-based system, are presented here. The true magnetic ﬁeld reference is modeled using a 10th-order International Geomagnetic Reference Field (IGRF) model, which is described in Sect. 11.1 of Chap. 11. In order to simulate magnetic ﬁeld modeling error, a 6th order IGRF is used to develop measurements. TAM sensor noise is modeled by a Gaussian white-noise process with a mean of zero and a standard deviation of 50 nT. The two DSSs each have a ﬁeld of view of about 50 ı/STX50ı. The body to sensor transformations for each sensor is given by ADSS1 bodyD2 4/NUL0:5736 0/NUL0:8192 0:4096 0:8666/NUL0:2868 0:7094/NUL0:5/NUL0:49673 5 (5.170a) ADSS2 bodyD2 4/NUL0:5736 0 0:8192 /NUL0:40960:8666/NUL0:2868 /NUL0:7094/NUL0:5/NUL0:49673 5 (5.170b) The two DSSs combine to provide Sun measurements for about 2/3 of a complete orbit. The DSS sensor noise is also modeled by a Gaussian white-noise process with a mean of zero and a standard deviation of 0.05ı. The gyro measurements are simulated using Eqs. ( 4.31) and ( 4.32) of Sect. 4.7.1 , with/ESCuDp 10/STX10/NUL10rad/s3=2 and/ESCvDp 10/STX10/NUL7rad/s1=2. The initial bias for each axis is given by 0.1 deg/h. All sensors are sampled at 10-s intervals. Note that in general gyros are typically sampled at higher frequencies than other attitude sensors in order to provide rateinformation for other control aspects, such as spacecraft jitter. Attitude results using the uncorrupted TAM, i.e. using the 10th-order model to generate the truth and the measurements, with the two DSSs are shown in Fig. 5.3a. The actual errors are plotted with their 3 /ESCbounds, three times the square roots of the diagonal elements of the covariance matrix given by Eq. ( 5.120 ). Gaps are given when both of the DSSs are unavailable. The large values in the 3 /ESCbounds are due to the vectors becoming more co-aligned, i.e. the angle between the magnetic ﬁeld vector and Sun vector is small, thereby reducing usable information in the attitude determination solution. The computed 3 /ESCbounds provide an accurate measure to quantify the actual errors. Results using the corrupted TAM, i.e. using the 10th-order model to generate the truth and the 6th-order model to generate the measurements, with the two DSSs are shown in Fig. 5.3b. Clearly the errors are now larger but they are within the typical accuracy provided by a TAM/DSS sensor suite for attitude determination on actual spacecraft.5.8 TRMM Attitude Determination 221 0 1 2 3 4 5 6 7 8−101 0 1 2 3 4 5 6 7 8−0.500.5 0 1 2 3 4 5 6 7 8−101 Time (Hr)Roll (Deg) Pitch (Deg) Yaw (Deg)0 1 2 3 4 5 6 7 8−202 0 1 2 3 4 5 6 7 8−101 0 1 2 3 4 5 6 7 8−202 Time (Hr)Roll (Deg) Pitch (Deg) Yaw (Deg) 0 1 2 3 4 5 6 7 8−0.0500.050.10.15 Time (Hr)α0 1 2 3 4 5 6 7 8−0.100.1 0 1 2 3 4 5 6 7 8−0.100.1 0 1 2 3 4 5 6 7 8−0.100.1 Time (Hr)Roll (Deg) Pitch (Deg) Yaw (Deg)ab cd Fig. 5.3 TRMM attitude determination results. ( a) Uncorrupted TAM results. ( b) Corrupted TAM results. ( c) Filter gain. ( d) Filtered results The accuracy can be improved by employing a simple ﬁrst-order ﬁlter approach using the estimated quaternion together with gyro measurements [ 7]. Furthermore, the gyro can be used to propagate an attitude solution when no DSS measurements are available. The ﬁrst-order ﬁlter is given by OqC kD.1/NUL˛/Oq/NUL kC˛Qqk (5.171a) Oq/NUL kC1Dexp/DC21 2ŒQ!k˝/c141/SOHt/DC3 OqC k(5.171b) D/DC4 cos/DC21 2kQ!kk/SOHt/DC3 I4C1 kQ!kksin/DC21 2kQ!kk/SOHt/DC3 ˝.Q!k//NAK OqC k(5.171c) whereQqkis the quaternion determined from the TAM/DSS attitude determination system,Oq/NUL kis the propagated estimate, OqC kis the updated estimated, Q!kis the vector of gyro measurements, ˛is a scalar gain between 0 and 1, and /SOHtis the sampling interval in the gyro. Using an initial estimate, which is typically Qqk,E q . ( 5.171c )222 5 Static Attitude Determination Methods is used to propagate the quaternion until the next Qqkis available, at which point Eq. (5.171a ) is used to update the propagated estimate. The gain ˛is typically chosen to be constant [ 8], but a more judicious approach can be developed. Here, the following equation is used: ˛Dkr1/STXr2k2˛0 (5.172) where r1andr2are the normalized Sun and magnetic ﬁeld reference vectors, and ˛0 is a constant. The ﬁlter gain in Eq. ( 5.172 ) is automatically adjusted to accommodate periods of vector co-alignment, i.e. as the vectors become co-aligned the gain approaches 0. Also, ˛0is set to zero when no solution from the TAM/DSS attitude determination system is possible. The ﬁrst-order ﬁlter is essentially an “additive” approach because the updated quaternion is a weighted sum of the propagated quaternion and TAM/DSS deter- mined quaternion. As will be discussed in Chap. 6, an additive approach for the quaternion update does not result in an estimate that maintains quaternion normal- ization. To investigate how the additive update affects quaternion normalization, Eq. (5.171a ) may be rewritten as OqC kDOq/NUL k˝˚ IqC˛/STX .Oq/NUL k//NUL1˝Qqk/NULIq/ETX/TAB (5.173) where Iqis the identity quaternion. If the propagated quaternion is close to the TAM/DSS determined quaternion, then Eq. ( 5.173 ) can be approximated accu- rately by OqC k/EMOq/NUL k˝/DC41 2˛ı# 1/NAK (5.174) whereı#is the angle vector used to form the rotation matrix between Oq/NUL kand Qqk. Therefore, since ˛is between 0 and 1, then normalization is maintained to within ﬁrst order. For numerical precision, the quaternion estimates are explicitlynormalized after the update process. The simple ﬁlter is now applied to the TRMM example. Trial and error found that an initial gain of ˛ 0D0:1provides good ﬁltered estimates. A higher gain will produce estimates that are noisier and lower gain will result in estimates that suffer from greater gyro bias propagation errors. A plot of the ﬁlter gain is shown in Fig. 5.3c. Note that at the 1-h mark the gain becomes small, which is due to the fact that the Sun and magnetic ﬁeld vectors are nearly co-aligned at that time. This forces the estimate to follow the gyro propagation more closely, which results in smaller estimate errors, as shown in Fig. 5.3d. Also, note that when no TAM/DSS quaternion estimate is given, the errors are dictated by the gyro bias, which is given as 0.1 deg/h. For the TRMM mission the attitude drift during these periods is within the mission speciﬁcations.5.9 GPS Attitude Determination 223 5.9 GPS Attitude Determination GPS attitude determination uses phase differences of GPS signals received by antennas located at several locations on the spacecraft. Pairs of GPS antennas can beused to form a set of n/NAK2baselines b iin the spacecraft body frame, as illustrated in Fig. 4.4.T h em/NAK4unit vector sightlines sjfrom the user spacecraft to the GPS satellites can be computed from the GPS position solution, as discussed in Sect. 4.6. The different path lengths from each GPS satellite to the antennas at the two ends of each baseline create mnphase differences of the received signals /RStrue ijD2/EM.n/RS ijC/NAK/NUL1bT iAsj/ (5.175) whereAis the attitude matrix, /NAKis the wavelength of the GPS signal, and the integersn/RS ijare the number of full wavelength differences of the paths from GPS satellitejto the two antennas at the ends of baseline i. The latter are referred to as the integer phase ambiguities , and several algorithms have been proposed to compute them [ 6,10,28]. We will not discuss these, but assume that they have successfully solved for the integer ambiguities. We then use the measured phasedifferences to compute the normalized measurements z ij/DC1/NAK./RSij=2/EM/NULn/RS ij/ (5.176) The optimal attitude solution is the attitude matrix minimizing the loss function LGPS.A//DC11 2nX iD1mX jD1aij.zij/NULbT iAsj/2(5.177) for some weights aij. This is similar to Wahba’s loss function, but is not as easy to minimize. Solutions can be found with difﬁculty, however [ 6]. If we knew the representations of the baseline vectors in the reference frame, which we denote by rias in Sect. 5.2, we could use one of the algorithms of that section to compute the attitude matrix. In view of Eq. ( 5.1), we compute these as the riminimizing the loss function [ 9] Li.ri//DC11 2mX jD1aij.zij/NULrT isj/2(5.178) foriD1;2;:::;n . The minimization gives riDS/NUL1 imX jD1aijzijsj (5.179) where Si/DC1mX jD1aijsjsT j (5.180)224 5 Static Attitude Determination Methods These solutions only exist if the matrices Siall have rank three, which requires that the sightlines sjnot be coplanar, as will generally be the case. The computational burden is reduced if the weights aijare independent of the baseline label i, since then all theSiwill be equal, and only one matrix must to be computed and inverted for each set of sightlines. The computational burden would also be reduced if we reversed the roles of the baselines and sightlines, since the matrix corresponding to Siwould depend on the baselines in the body frame. Since these are constant, the matrix inverse in the analog of Eq. ( 5.179 ) would only need to be computed once, rather than at each measurement time. This would require at least three non-coplanar baselines, however, requiring more GPS antennas with unobstructed sightlines. The ﬁnal step of this method is to solve Wahba’s problem for the vector sets frigandfbig; the fact that they are not unit vectors is not important. There are several options for choosing the weights aiin Wahba’s loss function, but no choice produces an optimal minimum of the loss function of Eq. ( 5.177 ), in general. The estimates are nearly optimal unless the sightlines are nearly coplanar, though; and simulations show that the computational advantages of this method do not entail a signiﬁcant loss of accuracy [ 9]. Problems 5.1. A measure for the error between the estimated attitude, A, and the true attitude, Atrue, is given by A.Atrue/TD.cos#err/I3/NULsin#errŒe/STX/c141C.1/NULcos#err/eeT where#erris the error angle of rotation. Show that #erris given by the following equation: #errD2sin/NUL1/DLE kA.Atrue/T/NULI3kF=p 8/DC1 D2sin/NUL1/DLE kA/NULAtruekF=p 8/DC1 where the Frobenius norm is given by Eq. ( 5.12). 5.2. Consider the following four reference vectors: r1D2 40 013 5;r 2D1p 0:12C12 40 0:1 13 5 r3D1p 0:12C12 40 /NUL0:1 13 5;r4D1p 0:12C12 40:1 013 5Problems 225 Assume that the true attitude matrix is given by the identity matrix. To generate body measurements and measurement errors use the QMM in Eq. ( 5.107b ) with the true attitude, the given ri’s and/ESC1D/ESC2D/ESC3D/ESC4D0:001/STX/EM=180 rad. Run 1,000 Monte Carlo runs using Davenport’s method to compute the quaternion. Plot the small angle errors along with their respected 3/ESCbounds computed from the error- covariance given by the inverse of the Fisher information matrix in Eq. ( 5.139 ). 5.3. In this exercise you will compare Davenport’s method, QUEST, the SVD method and FOAM for a number of test cases. Let the true attitude be given by AtrueD2 40:352 0:864 0:360 /NUL0:864 0:152 0:460 0:360/NUL0:4800:8003 5 Consider the following four cases: a)r1DŒ 100 /c141T,r2DŒ 010 /c141T, and/ESC1D/ESC2D0:01 rad. b)r1DŒ 100 /c141T,r2DŒ1 0:01 0/c141T=kŒ1 0:01 0/c141Tk, and/ESC1D/ESC2D0:01 rad. c)r1DŒ 100 /c141T,r2DŒ1 0:01 0/c141T=kŒ1 0:01 0/c141Tk, and/ESC1D/ESC2D1/STX10/NUL6rad. d)r1DŒ 100 /c141T,r2DŒ0:96 0:28 0/c141T=kŒ0:96 0:28 0/c141Tk;/ESC1D0:001 rad, and /ESC2D1/STX10/NUL6rad. To generate body measurements with errors use the QMM in Eq. ( 5.107b ) with the true attitude, the given ri’s and aforementioned sigma values for each case. Run 1,000 Monte Carlo runs using Davenport’s method, QUEST, the SVD method and FOAM to compute the attitude, A, for each case. Then compute the following error metric: #errD2sin/NUL1/DLE kA/NULAtruekF=p 8/DC1 Compute the numerical mean and standard deviation of #errfor each algorithm and compare their relative accuracies. 5.4. Suppose that you wish to determine the average quaternion, denoted by qave, from a set of weighted quaternions given by qi,iD1;2:::;N , with weights wi. Simply summing the weighted set of quaternions and dividing by Nhas two issues. First, it does not produce a unit vector in general. Second, changing the sign of anyq ishould not change the average, but it is clear that the weighted sum approach does not have this property. To ﬁnd an averaged quaternion that overcomes these issues the following loss function is chosen to be minimized [ 23]: J.qave/DNX iD1wikA.qave//NULA.qi/k2 F;s.t.qT aveqaveD1 where the Frobenius norm is described in Problem 5.1. Show that the solution for qavecan be found by ﬁrst forming the following matrix: M/DC1NX iD1wiqiqT i226 5 Static Attitude Determination Methods and then taking the eigenvector associated with the maximum eigenvalue of Mto obtain qave. For this problem you will use a different solution approach than the one shown in [ 23] though. Start with the following relation given from Problem 5.1: kA.qave//NULA.qi/k2 FD8sin2.#i=2/, where#iis the angle of rotation of the matrix ıA.ıq//DC1A.qave/AT.qi/. Using the eigenvector associated with the maximum eigenvalue of Mis equiva- lent to Davenport’s solution of Wahba’s problem. But the QUEST solution cannot be used directly using the matrix M. How can this matrix be modiﬁed so that the QUEST solution can be used? Note that the matrix Kin the QUEST algorithm is traceless. Show that your modiﬁcation does not change the solution for qave. 5.5. Use Eqs. ( 5.113 ) and ( 5.114 ) to demonstrate the star tracker accuracies for multiple stars claimed in Sect. 4.2.3 . Assume there are ﬁve stars with the same error standard deviation /ESCiD/ESCat b1D2 40 013 5;b 2D2 4s 0c3 5;b 3D2 4/NULs 0c3 5;b 4D2 40 s c3 5;b5D2 40 /NULs c3 5 wheres/DC1sin/DC2,c/DC1cos/DC2, and where we have omitted the superscript true. Compute the information matrix and invert it to ﬁnd the covariance. The square roots of its diagonal elements are the standard deviations of the attitude errors about the three axes. You should ﬁnd that /ESCxD/ESCyD/ESCp 5/NUL2s2/EM/ESCpNstars /ESCzD/ESC 2s/EM/ESCpNstarsp 4=5/DC2 The two approximations are both valid for small /DC2, andp 4=5/DC2 is the RMS angular distance of the stars from the boresight, given by b1. 5.6. Suppose that you are given unit Sun and magnetic ﬁeld reference vectors, denoted by rsunandrmag, respectively, and a body TAM unit-vector observation, denoted by bmag. The Sun sensor is a “slit” type design that tells only when the Sun is in a particular slit plane, but not orientation in that plane. So the body Sun unit-vector, denoted by b sun, is unknown but another unit vector, denoted by vslit,e x i s t s such that bsun/SOHvslitD0. Assuming that rsun/SOHrmagDbsun/SOHbmag, ﬁnd bsunfrom the given unit vectors. Note this problem is equivalent to ﬁnding the intersection of acone and a plane with the vertex of the cone constrained to lie in the plane. 5.7. Consider the following true and measured vectors for a star tracker model, given by Eq. ( 4.2): b trueD1p 1Ck/CRtruek2/DC4/CRtrue 1/NAK ;bD1p 1Ck/CRk2/DC4/CR 1/NAKProblems 227 where/CRtrue/DC1Œtan2ˇtruetan2˛true/c141Tand/CR/DC1Œtan2ˇtan2˛/c141T. The measured and true vectors are related by /CRD/CRtrueC/SOH/CR, where/SOH/CRis a zero-mean Gaussian noise process with covariance R/CR. Using the analysis in Sect. 5.7show that the following expression is valid to within ﬁrst-order: bDbtrue/NUL1p 1Ck/CRtruek2Œbtrue/STX/c1412I3/STX2/SOH/CR where I3/STX2D2 410 01003 5 The covariance of bis then given by R bD1 1Ck/CRtruek2Œbtrue/STX/c1412I3/STX2R/CRIT 3/STX2Œbtrue/STX/c1412 DetermineR/CRin terms of/CRtrueDŒ/CRtrue 1/CRtrue 2/c141Tso thatRbis exactly equal to the QMM given by Eq. ( 5.107b ). 5.8. In this exercise noise will be added to both the body and reference vectors. This can occur when the errors in an assumed star catalog are signiﬁcant compared to the sensor errors. Assume that the reference vectors are modeled by rmodel iDztrue iC/SOHzi kztrue iC/SOHzik where ztrue iis some true position vector and /SOHziis a zero-mean Gaussian noise process with covariance Rzi. Using the analysis in Sect. 5.7show that the following expression is valid to within ﬁrst-order: rmodel iDrtrue iC/SOHri where rtrue iDztrue i=kztrue ikand /SOHriD/NUL1 kztrue ikŒrtrue i/STX/c1412/SOHzi The “measured” vector with errors is related to the true body vector through ri/DC1.Atrue/Tbtrue iC.Atrue/T/SOHbiC/SOHri228 5 Static Attitude Determination Methods This vector will be used in the nonlinear least squares solution. Here it is assumed that/SOHbiand/SOHriare uncorrelated. Using the QMM for /SOHbishow that the covariance of .Atrue/T/SOHbiC/SOHri, denoted byRi, can be given by RiD/NUL/ESC2 biŒrtrue i/STX/c1412C1 kztrue ik2Œrtrue i/STX/c1412RziŒrtrue i/STX/c1412 Note thatRiis independent of the attitude matrix. Also, Riis a singular matrix, but the rank-one approach of [ 3] can be employed to overcome this issue. Deﬁne the following matrix: NRiDRiC1 2tr.Ri/.rtrue i/.rtrue i/T The loss function to be minimized is given by JD1 2NX i/NUL1.ri/NULATbi/TNR/NUL1 i.ri/NULATbi/ Derive the attitude error-covariance. Note that to determine an optimal solution for the attitude a total least squares [8] solution must be employed since errors exist both in the body and reference vectors. However, the nonlinear least squares solution in Example 12.4 can provide near optimal solutions. The true body vectors are given by btrue 1D2 40 013 5;b true 2D2 40 0:1p 1/NUL0:123 5 Note that the angle between these vectors is 5.74ı. The MRP vector will be estimated for the attitude, as shown in Example 12.4. The true MRP and associated attitude matrix are given by ptrueD2 6641 1Cp 2 0 03 775;A . ptrue/D2 4100 0010/NUL103 5 Assume thatkz true 1kD30andkztrue 2kD50. To generate body measurements use the QMM in Eq. ( 5.107b ) with/ESCbiD0:001 deg foriD1;2. The covariances for Rz1 andRz1are equal, denoted by Rz, which is given by RzD2 47/STX10/NUL67/STX10/NUL71/STX10/NUL5 7/STX10/NUL73/STX10/NUL5/NUL5/STX10/NUL6 1/STX10/NUL5/NUL5/STX10/NUL62/STX10/NUL53 5Problems 229 xy xyFig. 5.4 Ellipse with rotation Using the approach outlined in Example 12.4 create synthetic measurements for both the body and reference vectors. Next, determine the estimated MRP using the estimate model OriDAT.Op/bi. Perform 1,000 Monte Carlo runs and show that the attitude errors are bounded from the 3 /ESCbounds computed from the derived attitude error-covariance. 5.9. A problem that is closely related to the attitude determination problem involves determining ellipse parameters from measured data. Figure 5.4depicts a general ellipse rotated by an angle /DC2. The basic equation of an ellipse is given by .x0/NULx0 0/2 a2C.y0/NULy0 0/2 b2D1 where.x0 0;y0 0/denotes the origin of the ellipse and .a;b/ are positive values. The coordinate transformation follows x0Dxcos/DC2Cysin/DC2 y0D/NULxsin/DC2Cycos/DC2 Show that the ellipse equation can be rewritten as Ax2CBxyCCy2CDxCEyCFD0 Many possibilities exist for this equation. Use the form that produces the following expression for F: FD1 2/DC4b ax0 02Ca by0 02/NULab/NAK With your determined coefﬁcients show that the following constraint is satisﬁed: 4AC/NULB2D1.230 5 Static Attitude Determination Methods Given a set of coefﬁcients A,B,C,D,E, andF, show that the formulas for /DC2, a,b,x0 0, andy0 0are given by cot.2/DC2/DA/NULC B aDr Q0 A0;bDr Q0 C0 x0 0D/NULD0 2A0;y0 0D/NULE0 2C0 where A0DAcos2/DC2CBsin/DC2cos/DC2CCsin2/DC2 B0DB.cos2/DC2/NULsin2/DC2/C2.C/NULA/sin/DC2cos/DC2D0 C0DAsin2/DC2/NULBsin/DC2cos/DC2CCcos2/DC2 D0DDcos/DC2CEsin/DC2 E0D/NULDsin/DC2CEcos/DC2 F0DF Q0/DC1A0/DC2D0 2A0/DC32 CC0/DC2E0 2C0/DC32 /NULF0 (hint: show that the new variables follow the rotated ellipse equation: A0x02C B0x0y0CC0y02CD0x0CE0y0CF0D0). Also, prove that B0D0.G i v e nt h e following quantities: AD3:0000; BD/NUL6:9282; CD7:0000 DD/NUL5:5359; ED17:5885; FD4:0000 compute/DC2,x0 0,y0 0,aandb. Suppose that a set of measurements for xandyexist, and we form the following vector of unknown parameters: xtrue/DC1/STX AtrueBtrueCtrueDtrueEtrueFtrue/ETXT Our goal is to determine an estimate of xtrue, denoted by x, from this measured data set. Show that the minimum norm-squared loss function can be written as J.x/DxTHTHx subject to xTZxD1References 231 where theith row ofHis given by HiD/STX x2 ixiyiy2 ixiyi1/ETX Determine the matrix Zthat satisﬁes the constraint 4AC/NULB2D1.F i n dt h ef o r m for the optimal solution for xusing an eigenvalue/eigenvector approach. Note, a more robust approach involves using a reduced eigenvalue decomposition [ 16]o ra singular value decomposition approach [ 14]. Write a computer program for your derived solution and perform a simulation to test your algorithm. Note that for a given set of x0values,y0can be determined using y0Dy0 0˙br 1/NUL.x0/NULx0 0/2 a2 where the˙term gives values for the upper and lower half of the ellipse. Use the computed/DC2,x0 0,y0 0,aandbfrom before and pick at least 1,200 samples of x0and y0values that span the entire ellipse. Then convert these to xandyusing the inverse transformation xDx0cos/DC2/NULy0sin/DC2 yDx0sin/DC2Cy0cos/DC2 Using your formulated eigenvalue/eigenvector solution compute the optimal solu- tion for x. Next add noise to xandyusing a zero-mean Gaussian white-noise process with standard deviation given by 0:01 and recompute your solution using measured values instead of the true ones. 5.10. Derive the expression given in Eq. ( 5.161 ). Also, derive the expression given in Eq. ( 5.167 ). 5.11. The loss function in Eq. ( 5.177 ) can be derived from a maximum likelihood approach by assuming that each aijis given by/ESC/NUL1 ij, which is the inverse of the variance of the assumed zero-mean Gaussian noise on zij. Using this loss function derive the attitude Fisher information matrix. References Andrews, S.F., Bilanow, S.: Recent ﬂight results of the TRMM Kalman ﬁlter. In: AIAA Guidance, Navigation and Control Conference. Monterey, CA (2002). AIAA 2002-5047 Black, H.D.: A passive system for determining the attitude of a satellite. AIAA J. 2(7), 1350–1351 (1964) Cheng, Y ., Crassidis, J.L., Markley, F.L.: Attitude estimation for large ﬁeld-of-view sensors. J. Astronaut. Sci. 54(3/4), 433–448 (2006)232 5 Static Attitude Determination Methods Cheng, Y ., Shuster, M.D.: The speed of attitude estimation. In: Akella, M.R., Gearhart, J.W., Bishop, R.H., Treder, A.J. (eds.) Proceedings of the AAS/AIAA Space Flight MechanicsMeeting 2007, Advances in the Astronautical Sciences, vol. 127, pp. 101–116. AAS/AIAA,Univelt, San Diego (2007) Cheng, Y ., Shuster, M.D.: Improvement to the implementation of the QUEST algorithm. J. Guid. Contr. Dynam. 37(1), 301–305 (2014) Cohen, C.E.: Attitude determination. In: Parkinson, B., Spilker, J. (eds.) Global Positioning System: Theory and Applications, Progress in Astronautics and Aeronautics, vol. 64, chap. 19.American Institute of Aeronautics and Astronautics, Washington, DC (1996) Crassidis, J.L., Andrews, S.F., Markley, F.L., Ha, K.: Contingency designs for attitude deter- mination of TRMM. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium,pp. 419–433. NASA-Goddard Space Flight Center, Greenbelt (1995) Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press, Boca Raton (2012) Crassidis, J.L., Markley, F.L.: New algorithm for attitude determination using Global Position- ing System signals. J. Guid. Contr. Dynam. 20(5), 891–896 (1997) Crassidis, J.L., Markley, F.L., Lightsey, E.G.: Global Positioning System integer ambiguity resolution without attitude knowledge. J. Guid. Contr. Dynam. 22(2), 212–218 (1999) Farrell, J.L.: Attitude determination by Kalman ﬁltering. Contractor Report NASA-CR-598, NASA Goddard Space Flight Center, Washington, DC (1964) Farrell, J.L.: Attitude determination by Kalman ﬁltering. Automatica 6, 419–430 (1970) Farrell, J.L., Stuelpnagel, J.C.: A least-squares estimate of satellite attitude. SIAM Rev. 7(3), 384–386 (1966) Gander, W., Golub, G.H., Strebel, R.: Least-squares ﬁtting of circles and ellipses. In: editorial board Bulletin Belgian Mathematical Society (ed.) Numerical Analysis (in honourof Jean Meinguet), pp. 63–84 (1996) Golub, G.H., Van Loan, C.F.: Matrix Computations, 3rd edn. The Johns Hopkins University Press, Baltimore (1996) Halí ˇr, R., Flusser, J.: Numerically stable direct least squares ﬁtting of ellipses. In: 6th Inter- national Conference in Central Europe on Computer Graphics and Visualization, WSCG ’98,pp. 125–132. University of West Bohemia, Campus Bory, Plzen - Bory (1998) Horn, R.A., Johnson, C.R.: Matrix Analysis. Cambridge University Press, Cambridge (1985)18. Lerner, G.M.: Three-axis attitude determination. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and Control, chap. 12. Kluwer Academic, Dordrecht (1978) Markley, F.L.: Attitude determination using vector observations and the singular value decomposition. J. Astronaut. Sci. 36(3), 245–258 (1988) Markley, F.L.: Attitude determination using vector observations: A fast optimal matrix algorithm. J. Astronaut. Sci. 41(2), 261–280 (1993) Markley, F.L.: Fast quaternion attitude estimation from two vector measurements. J. Guid. Contr. Dynam. 25(2), 411–414 (2002) Markley, F.L.: Optimal attitude matrix from two vector measurements. J. Guid. Contr. Dynam. 31(3), 765–768 (2008) Markley, F.L., Cheng, Y ., Crassidis, J.L., Oshman, Y .: Averaging quaternions. J. Guid. Contr. Dynam. 30(4), 1193–1196 (2007) Markley, F.L., Mortari, D.: Quaternion attitude estimation using vector observations. J. Astro- naut. Sci. 48(2/3), 359–380 (2000) Mortari, D.: ESOQ: A closed-form solution of the Wahba problem. J. Astronaut. Sci. 45(2), 195–204 (1997) Mortari, D.: Second estimator of the optimal quaternion. J. Guid. Contr. Dynam. 23(5), 885–888 (2000) Potter, J.E., Vander Velde, W.E.: Optimum mixing of gyroscope and star tracker data. J. Spacecraft 5(5), 536–540 (1968) Psiaki, M.L., Mohiuddin, S.: Global Positioning System integer ambiguity resolution using factorized least-squares techniques. J. Guid. Contr. Dynam. 30(2), 346–356 (2007)References 233 Shuster, M.D.: Maximum likelihood estimation of spacecraft attitude. J. Astronaut. Sci. 37(1), 79–88 (1989) Shuster, M.D.: Deterministic three-axis attitude determination. J. Astronaut. Sci. 52(3), 405–419 (2004) Shuster, M.D.: The quest for better attitudes. J. Astronaut. Sci. 54(3/4), 657–683 (2006) Shuster, M.D.: The TRIAD algorithm as maximum likelihood estimation. J. Astronaut. Sci. 54(1), 113–123 (2006) Shuster, M.D.: The TASTE test. J. Astronaut. Sci. 57(1/2), 61–71 (2009) Shuster, M.D., Natanson, G.A.: Quaternion computation from a geometric point of view. J. Astronaut. Sci. 41(4), 545–556 (1993) Shuster, M.D., Oh, S.D.: Attitude determination from vector observations. J. Guid. Contr. 4(1), 70–77 (1981) Wahba, G.: A least-squares estimate of satellite attitude. SIAM Rev. 7(3), 409 (1965)Chapter 6 Filtering for Attitude Estimation and Calibration Attitude estimation refers to the process of estimating the current attitude state of a system from a set of measured observations. The state estimation probleminvolves ﬁnding the best estimate of the true system state using a dynamic model and measurements that are both corrupted with random noise of known statistics. The variables to be estimated are usually collected into a state vector, whichtypically includes other variables in addition to the attitude. For example, star tracker measurements can be combined with a kinematics model, which is propagated using gyroscopic measurements. However, all gyros have inherent drift, or bias, whichcauses inaccuracies in the propagated model. A complementary ﬁlter is used to simultaneously estimate the attitude and gyro drift from the measurements. Filtering can generally provide a more accurate attitude estimate than static methods becauseit incorporates memory of past observations. This chapter presents the basics of ﬁltering for attitude estimation. It is assumed that the reader is familiar with the basic ideas of estimation/ﬁltering theory asreviewed in Chap. 12. Reference [ 21] includes a survey of early attitude estimation approaches, and a survey of more modern attitude estimation approaches can be found in [ 12]. We begin with general discussions of attitude representations for Kalman ﬁltering. This is followed by an overview of the equations for an extended Kalman ﬁlter (EKF) using the quaternion to represent the “global” attitude and a three-component representation of attitude errors. Alternative ways to use gyro datain attitude ﬁlters are then compared, followed by several applications. An EKF is developed for gyro calibration, which includes estimation of biases, scale factors, and misalignments, as well as the attitude. A “mission mode” EKF is then shownthat estimates attitude and gyro biases, which is the estimator typically used for actual onboard applications. We then examine a very useful single-axis covariance analysis of the accuracy that attitude ﬁlters can be expected to provide. Finally,batch and realtime methods for three-axis magnetometer calibration are developed. The batch approaches involve a suboptimal linear solution and an optimal nonlinear least squares solution, and the realtime approach uses an EKF formulation. F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _6, © Springer Science+Business Media New York 2014235236 6 Filtering for Attitude Estimation and Calibration 6.1 Attitude Representations for Kalman Filtering Section 2.9presented several different representations of spacecraft attitude, some of which are more suitable for ﬁltering applications than others. The only represen-tations that have seen widespread application are three-component representations and the four-component quaternion representation. We will brieﬂy discuss the advantages and drawbacks of the different representations, after which we willconcentrate on quaternion-based ﬁlters. 6.1.1 Three-Component Representations Three-component representations are the most natural representations for ﬁltering, because only three parameters are needed to represent rotations. As was pointed out in Sect. 2.9, though, all three-parameter representations of the rotation group have discontinuities or singularities. A ﬁlter using a three-dimensional attitude representation must provide some guarantee of avoiding these singular points. The earliest Kalman ﬁlters for spacecraft attitude estimation used Euler angles, speciﬁcally a roll, pitch, yaw sequence of Tait-Bryan angles, which have a very intuitive meaning if they do not become too large [ 13,14]. This is a very useful representation if the middle angle of the sequence, which is generally the pitchangle, stays well away from positive or negative rotations of 90 ı. Filters for pitch, roll, and yaw have been used mostly for Earth-pointing spacecraft, which typically have small pitch angles. One disadvantage of this representation is that it requiresa fair number of trigonometric function evaluations, but this has become less of an issue with increasing computing power, especially in onboard computers. The Gibbs vector or Rodrigues parameter representation has been used in a Kalman ﬁlter [ 18], but it is not well suited to ﬁltering because of its inability to represent180 ırotations. It provides an excellent representation of small attitude errors, however, as we shall see. The modiﬁed Rodrigues parameters (MRPs) are non-singular for rotations of less than360ı, and rotations greater than 180ıcan be represented by an MRP in the shadow set, as discussed in Sect. 2.9.5 . This has advanced the use of MRPs in attitude estimation Kalman ﬁlters [ 10,19]. The transformation to the shadow set is made at some angle greater than 180ıto avoid “chattering” between the two MRP representations if the rotation angle dwells for an extended period in the vicinityof180 ı. When transforming to the shadow set, it is necessary to transform the covariance matrix to the new parameters. This transformation is discussed in the literature. The rotation vector is very similar to the MRPs in having a singularity for 360ı rotations. When its magnitude k#kbecomes greater than 180ı, the representation can be switched to an equivalent rotation of magnitude 2/EM/NULk#kin the opposite direction. The rotation vector has no clear advantage over the MRPs for ﬁltering, though, and has the disadvantage of requiring the evaluation of trigonometric functions.6.1 Attitude Representations for Kalman Filtering 237 6.1.2 Additive Quaternion Representation The quaternion has become the representation of choice for attitude estimation because it is the lowest-dimensional parameterization that is free from singularities. However, the quaternion must obey its normalization constraint, which can cause issues in the standard EKF. The normalization problem is apparent in the Kalman ﬁlter update equation1 OqCDOq/NULCKŒy/NULh.Ox/NUL//c141 (6.1) whereOx/NULis the pre-update estimate of the state vector that includes the quaternion as four of its components. It is clear that OqCandOq/NULcannot both be normalized to unity unless there is some special relation between Oq/NULandKŒy/NULh.Ox/NUL//c141. No such relation holds in the general case, so the ﬁlter update can spoil the normalization. There is a deeper problem with quaternion normalization. An unbiased estimator has the property that the expectation of the estimated value is the true value, as discussed in Sect. 12.3.2 , i.e. EfOqgDqtrue(6.2) We deﬁne the additive quaternion error as the algebraic difference between the true quaternion and its estimate /SOHq/DC1qtrue/NULOq (6.3) so kOqk2Dkqtrue/NUL/SOHqk2Dkqtruek2/NUL2/SOHqTqtrueCk/SOHqk2(6.4) It follows trivially from Eq. ( 6.3) that the expectation of /SOHqis zero, as it is for every unbiased estimator, and the true quaternion is assumed to have unit norm, so theexpectation of this equation is EfkOqk 2gD1CEfk/SOHqk2gD1Ctr.Pqq/ (6.5) wherePqq/DC1Ef/SOHq/SOHqTgis the quaternion covariance. Thus we see that an unbiased estimate of the four-component quaternion must violate the unit normconstraint. Suppose that we give up on the requirement that the estimator be unbiased and develop a biased estimator obeying the unit norm constraint, i.e. an estimator givingkq truekDkOqkD1. We will show that this leads to a different problem. For such an estimator Eq. ( 6.4) would give 1See Sect. 12.3.7.1 for a review of the Kalman ﬁlter.238 6 Filtering for Attitude Estimation and Calibration 2/SOHqTqtrueDk/SOHqk2(6.6) Because the estimator is biased, the covariance is PqqDEf/SOHq/SOHqTg/NULEf/SOHqgEf/SOHqTg (6.7) Then .qtrue/TPqqqtrueDEf.qtrue/T/SOHq/SOHqTqtrueg/NULEf.qtrue/T/SOHqgEf/SOHqTqtrueg D1 4h Efk/SOHqk4g/NUL/NUL Efk/SOHqk2g/SOH2i D1 4/STX Efk/SOHqk4g/NULtr.Pqq/2/ETX (6.8) This becomes very small as the attitude errors become small, indicating that the covariance matrix is ill-conditioned in that limit.2The ill-conditioning has been observed in toy models [ 24], numerical studies [ 5], and analysis [ 31]. It is worth noting that if the norm constraint had been linear, the quaternion covariance would have been truly singular. At least four methods have been proposed to deal with these problems within the framework of additive quaternion ﬁltering, but none is completely satisfactory. The ﬁrst method is to renormalize the estimate by brute force Oq/DC1Efqtrueg=kEfqtruegk (6.9) If the update KŒy/NULh.Ox/NUL//c141is orthogonal toOq/NUL, then Eq. ( 6.1) shows that the renormalization makes only a second-order correction in the quaternion errors. In this case brute force normalization is consistent with the EKF, which is a ﬁrst-order estimator. If the update is not orthogonal to Oq /NUL, it is difﬁcult to justify brute force normalization. The second method is to modify the Kalman ﬁlter update equations to enforce the norm constraint by means of a Lagrange multiplier [ 42]. These two approaches both yield biased estimates of the quaternion. The third method is to give up on enforcing the quaternion norm, and to deﬁne the attitude matrix as A.q/Dkqk/NUL2˚/NUL q2 4/NULkq1W3k2/SOH I3C2q1W3qT 1W3/NUL2q4Œq1W3/STX/c141/TAB (6.10) This deﬁnition is guaranteed to provide an orthogonal attitude matrix. We call this the ray representation, because any quaternion along a ray through the origincorresponds to the same attitude matrix. This approach avoids the complications arising from enforcing the norm constraint, but introduces an unobservable degree of freedom, the quaternion norm. The result is that one eigenvalue of P qqis unaffected 2But not singular, as was claimed in [ 21].6.1 Attitude Representations for Kalman Filtering 239 by measurements and thus retains its initial value, which can cause loss of numerical precision if the attitude estimates become very accurate. This method has been used successfully, however [ 32,33]. The fourth method is to give up on enforcing the quaternion norm, but to continue to deﬁne the attitude matrix by Eq. ( 2.125 ), which is Eq. ( 6.10) without the factor ofkqk/NUL2. The attitude matrix is not orthogonal in this case. This is a signiﬁcant drawback of the method, but the lack of orthogonality gives rise to measurement residuals resulting in Kalman ﬁlter updates that tend to drive the quaternion norm to unity. This method can lead to an ill-conditioned covariance matrix [ 24]. 6.1.3 Multiplicative Quaternion Representation The basic idea of the multiplicative EKF (MEKF) is to use the quaternion as the “global” attitude representation and use a three-component state vector ı#for the “local” representation of attitude errors. Instead of writing the true quaternion as the sum of the estimated quaternion and an error quaternion, we write it as theproduct of an error quaternion and the estimate q trueDıq.ı#/˝Oq (6.11) Note that qtrue,ıq, andOqare all properly normalized unit quaternions. This idea was ﬁrst applied to the Space Precision Attitude Reference System (SPARS) in1969 [ 29,39], was later developed for NASA’s Multimission Modular Spacecraft (MMS) [ 27], and has been widely applied to a great number of space missions. The appearance of ıqon the left ofOqin Eq. ( 6.11) means that the attitude error vector is deﬁned in the body reference frame. This is the most widely used form of the MEKF, but some authors write q trueDOq˝ıq0in place of Eq. ( 6.11), deﬁning the attitude error vector to be in the reference frame [ 16]. We have written the error vector as ı#, but any of the error representations discussed in Sect. 2.10 can be used: the rotation vector, two times the vector part of the quaternion, two times the vector of Rodrigues parameters, four times thevector of MRPs, or the vector of roll, pitch, and yaw angles. The MEKF updates the error state /SOHx/DC1/DC4ı# /SOH/CAN/NAK (6.12) where/CAN trueDO/CANC/SOH/CANis a vector of other variables to be estimated. Thus we have a conventional EKF that computes an unconstrained and unbiased estimate of /SOHx.T h e correctly normalized four-component Oqis not actually part of the EKF, but a reset operation moves the updates into this global variable to keep the error quaternion240 6 Filtering for Attitude Estimation and Calibration small and thus far away from any singularities [ 21,23]. It is important to note that the estimateOqis not deﬁned as an expectation, which is how the MEKF avoids the pitfalls of Sect. 6.1.2 .3 If the vector/CANhasncomponents, the MEKF covariance is a well-conditioned .nC3//STX.nC3/matrix, while the covariance matrix of a ﬁlter estimating the full quaternion would be .nC4//STX.nC4/. The conceptual advantage of this dimensional reduction, as more truly representing the actual degrees of freedom of the system, has been debated at length [ 5,23,24,31,36,37], but the computational advantages are indisputable. Another great advantage of the MEKF is that the covariance ofthe attitude error angles has a transparent physical interpretation. The covariance of estimators using other attitude representations has a less obvious interpretation unless the attitude matrix is close to the identity matrix. Equation ( 6.11) is equivalent to A trueDA.qtrue/DA.ı#/A.Oq/DA.ı#/OA (6.13) This shows that the attitude matrix could also be used as the global representation, but the quaternion has two advantages. The ﬁrst is compactness; it only has fourcomponents rather than nine. The second is that if computational errors cause the quaternion norm to deviate from unity, it is easy to normalize the quaternion by dividing all its components by its norm. It is not so straightforward to restore theorthogonality constraint on the attitude matrix if computational errors cause the constraint to be violated. 6.2 Attitude Estimation 6.2.1 Kalman Filter Formulation Our attitude ﬁlters all use some variant of the MEKF, which proceeds by iteration of three steps: measurement update, state vector reset, and propagation to the next measurement time. The measurement update step updates the error state vector.The reset moves the updated information from the error state to the global attitude representation and resets the components of the error state to zero. The propagation step propagates the global variables to the time of the next representation. The errorstate variables do not need to be propagated because they are identically zero over the propagation step. We will now discuss these three steps in more detail. 3Reference [ 23] writes qtrueDıq.ı#/˝qref,w h e r e qrefis a “reference” quaternion, and derives the propagation and update equations to ensure that Efı#gis only nonzero between the measurement update and reset. It turns out that qrefobeys the same equations as our Oqand is the best attitude estimate, so the treatment here is mathematically equivalent, although less rigorous.6.2 Attitude Estimation 241 6.2.1.1 Measurement Update The observation model is given by Eq. ( 12.103 ), which for attitude estimation is yDh.qtrue;/CANtrue/Cv (6.14) where vis a vector of Gaussian errors with covariance matrix R. The MEKF updates the error state of Eq. ( 6.12), not the global state representation OqandO/CAN,s ot h e measurement sensitivity matrix is H.q;/CAN/D@h @./SOHx/D/DC4@h @.ı#/@h @/CAN/NAK /DC1/STX H#H/CAN/ETX (6.15) The alternative representations for ıq.ı#/are all equivalent to ﬁrst order in ı#,a s was shown in Sect. 2.10, so we can express the error quaternion to ﬁrst order in the error vector as ıq/EM/DC4ı#=2 1/NAK DIqC1 2/DC4ı# 0/NAK (6.16) Then Eqs. ( 6.11) and ( 2.98)g i v e qtrue/EM/DC2 IqC1 2/DC4ı# 0/NAK/DC3 ˝OqDOqC1 2ı#˝OqDOqC1 2/EOT.Oq/ı# (6.17) It follows that the attitude part of the measurement sensitivity matrix can be evaluated by using the chain rule H#D@h @q@q @.ı#/D1 2@h @q/EOT.Oq/ (6.18) An even more convenient form of the measurement sensitivity matrix for the common case of vector measurements will be derived in Sect. 6.2.2 . Immediately after a reset or propagation, the quantities ıO#and/SOHO/CANare zero. If several measurements are processed at one time without an intervening reset,though, these quantities may have ﬁnite values. In order to avoid recalculating the nonlinear function h.Oq;O/CAN/, we use the ﬁrst-order Taylor series to compute the expectation Efh.q true;/CANtrue/g/EMh.Oq;O/CAN/CH.Oq;O/CAN/" ıO# /SOHO/CAN# (6.19) The state update for the kth measurement is then " ıO#C k /SOHO/CANC k# D" ıO#/NUL k /SOHO/CAN/NUL k# CKk( yk/NULhk.Oq/NUL k;O/CAN/NUL k//NULHk.Oq/NUL k;O/CAN/NUL k/" ıO#/NUL k /SOHO/CAN/NUL k#) (6.20)242 6 Filtering for Attitude Estimation and Calibration The Kalman gain computation and covariance update have the standard Kalman ﬁlter forms. Many modern-day devices, such as star trackers, provide quaternion-out capabil- ities along with associated error covariances. The MEKF measurement model for incorporating these quaternion “measurements” can be derived from qk˝Oq/NUL1 kDıq.ı#k/ (6.21) where qkis the quaternion measurement and we understand Oqkto beOq/NUL k. Because it is important that the measurement update should agree closely with the measurement residual computation, the measurement model should use the same parameterization for ıq.ı#k/as is used in the reset, rather than a ﬁrst- order approximation. The Rodrigues vector parameterization has the advantage that the observation model is insensitive to the sign ambiguity in the tracker output quaternion qk. Using this parameterization, the measurement used in the ﬁlter and its predicted value are given by Eqs. ( 2.136 ), (2.184 ), (6.19), and ( 6.21)a s ykDı#kD2.qk˝Oq/NUL1 k/1W3 .qk˝Oq/NUL1 k/4(6.22a) hk.Oq/NUL k;O/CAN/NUL k/CHk.Oq/NUL k;O/CAN/NUL k/" ıO#/NUL k /SOHO/CAN/NUL k# D2.Oqk˝Oq/NUL1 k/1W3 .Oqk˝Oq/NUL1 k/4CŒI303/STXn/c141" ıO#/NUL k /SOHO/CAN/NUL k# DıO#/NUL k (6.22b) The measurement sensitivity matrix is simply given by HkDŒI303/STXn/c141, and the measurement covariance matrix, Rk,i sa3/STX3matrix of attitude measurement error angles. Using a quaternion-out approach simpliﬁes the computations in the EKF, but issues such as estimator consistency need to be considered when using the EKF tofuse multiple measurement sets. See [ 7] for more details. 6.2.1.2 Reset The discrete measurement update assigns ﬁnite post-update values to ıO#Cand /SOHO/CANC, but the components of the global state still retain the values Oq/NULandO/CAN/NUL.Ar e s e t procedure is used to move the update information to a post-update estimate global state vectorOqCandO/CANC, while simultaneously resetting ıO#and/SOHO/CANto zero. The reset does not change the overall estimate, so the reset must obey OqCDıq.03/˝OqCDıq.ıO#C/˝Oq/NUL(6.23a) O/CANCDO/CANCC0nDO/CAN/NULC/SOHO/CANC(6.23b)6.2 Attitude Estimation 243 After the update, ı#/NUL kand/SOH/CAN/NULare reset to zero. Thus the reset moves information from one part of the estimate to another part. This reset rotates the reference frame for the attitude covariance, so that we might expect the covariance to be rotated,even though no new information is added. However, the covariance depends on the assumed statistics of the measurements, not on the actual measurements. Therefore, because the update is zero mean, the mean rotation caused by the reset is actuallyzero, and so the covariance is in fact not affected by the reset. 4 If a reset is done after each measurement update, Eq. ( 6.20) simpliﬁes to " ıO#C k /SOHO/CANC k# DKkh yk/NULhk.Oq/NUL k;O/CAN/NUL k/i /DC1/DC4K#k K/CANk/NAKh yk/NULhk.Oq/NUL k;O/CAN/NUL k/i (6.24) In this case, the reset of the non-attitude state can be done implicitly as part of the measurement update, giving O/CANC kDO/CAN/NUL kCK/CANkh yk/NULhk.Oq/NUL k;O/CAN/NUL k/i (6.25) Then only the quaternion has to be reset explicitly. The reset is often delayed for computational efﬁciency until all the updates for a set of simultaneous measure- ments have been performed, though, in which case all the terms in Eq. ( 6.20)m u s t be included. It is imperative to perform a reset either implicitly or explicitly beforebeginning the time propagation, however, to avoid the necessity of propagating ı# /NUL k and/SOH/CAN/NULbetween measurements. The quaternion reset in Eq. ( 6.23a ) is the special feature of the MEKF. This reset has to preserve the quaternion norm, so an exact unit-norm expression for the functional dependence of ıqonı#must be used, not the linear approximation of Eq. ( 6.16). Using the Rodrigues parameter vector has the practical advantage that the reset operation for this parameterization is OqCDıq.ıO#C/˝Oq/NULD1q 1CkıO#C=2k2" ıO#C=2 1# ˝Oq/NUL(6.26) Using an argument similar to Eq. ( 6.17), this can be accomplished in two steps: q/ETXD" ıO#C=2 1# ˝Oq/NULDOq/NULC1 2/EOT.Oq/NUL/ıO#C(6.27) followed by OqCDq/ETX kq/ETXk(6.28) 4Not everyone agrees with this statement; see [ 25]a n d[ 34].244 6 Filtering for Attitude Estimation and Calibration The ﬁrst step is just the usual linear Kalman update, and the second step is mathematically equivalent to a brute force normalization. Thus the MEKF using Rodrigues parameters for the error vector provides a theoretical justiﬁcation forthe brute force update. It has the additional advantage of completely avoiding the possibility of accumulated errors in the quaternion norm after many updates. The Rodrigues parameters also have the conceptual advantage that they map the rotation group into three-dimensional Euclidean space, with the largest possible 180 ıattitude errors mapped to points at inﬁnity. Thus probability distributions with inﬁnitely long tails, such as Gaussian distributions, make sense in Rodriguesparameter space. 6.2.1.3 Propagation An EKF must propagate the expectation and covariance of the state. The MEKF is unusual in propagating the expectations OqandO/CANand the covariance of the error- state vector in Eq. ( 6.12). We now derive the expressions needed for propagation, beginning by differentiating Eq. ( 6.11): Pq trueDıPq˝OqCıq˝POq (6.29) The true and estimated quaternions satisfy the kinematic equations PqtrueD1 2/DC4!true 0/NAK ˝qtrue(6.30a) POqD1 2/DC4O! 0/NAK ˝Oq (6.30b) where!trueandO!are the true and estimated angular rates, respectively. Substituting these equations and Eq. ( 6.11) into Eq. ( 6.29)g i v e s 1 2/DC4!true 0/NAK ˝ıq˝OqDıPq˝OqC1 2ıq˝/DC4O! 0/NAK ˝Oq (6.31) Multiplying on the right by Oq/NUL1and rearranging terms gives [ 21] ıPqD1 2/DC2/DC4!true 0/NAK ˝ıq/NULıq˝/DC4O! 0/NAK/DC3 (6.32) Substituting!trueDO!Cı!into Eq. ( 6.32), whereı!is the error angular velocity, leads to6.2 Attitude Estimation 245 ıPqD1 2/DC2/DC4O! 0/NAK ˝ıq/NULıq˝/DC4O! 0/NAK/DC3 C1 2/DC4ı! 0/NAK ˝ıq D/NUL/DC4O!/STXıq1W3 0/NAK C1 2/DC4ı! 0/NAK ˝.ıq/NULIqCIq/ (6.33) Note that this is an exact kinematic relationship since no linearizations have been performed yet. The only nonlinearity in the errors appears in the last term on theright hand side. Both ı!andıq/NULI qare small, though, so we can ignore their product in the spirit of the linearized EKF, resulting in ıPqD/NUL/DC4O!/STXıq1W3 0/NAK C1 2/DC4ı! 0/NAK (6.34) The ﬁrst three components of this, after substituting Eq. ( 6.16), are ıP#D/NULO!/STXı#Cı! (6.35) and the fourth component is ıPq4D0. Equation ( 6.35), which is just Eq. ( 3.48)i n modiﬁed notation, is the equation needed to propagate the covariance of the attitude error-angle covariance. Detailed models will be provided during the presentations of speciﬁc estimators. The expectation of Eq. ( 6.35)i s ıPO#D/NULO!/STXıO# (6.36) becauseı!has zero expectation. This says that if ıO#is zero at the beginning of a propagation it will remain zero through the propagation, which is equivalent to saying thatıOqwill be equal to the identity quaternion throughout the propagation. 6.2.1.4 Gyros for Dynamic Model Replacement Precise angular rate information is required for precise pointing and attitude maneuvers, and also for ﬁltering noisy attitude sensor data. In principle, thiscould be provided by a dynamic model based on the equations in Chap. 3. Many spacecraft, including virtually all spacecraft with stringent pointing and/or maneuvering requirements, are provided with accurate gyros, which are the mostcrucial of all the attitude sensors. The usual Kalman ﬁlter update equations can be employed to include gyro data in an EKF as measurements. A great number of attitude ﬁlters incorporate gyro information as part of the dynamic model rather than using than using the gyro information as a Kalman measurement update. This alternative is often referred to as using gyros in the dynamic model replacement mode. The reasons for favoring this method246 6 Filtering for Attitude Estimation and Calibration are twofold. Firstly, gyro information may well be much more accurate than the available models of rotational dynamics and torques, and inaccurate dynamic models could actually corrupt the gyro data. The second reason for using gyros indynamic replacement mode, which is particularly important for onboard ﬁltering, is that it requires much less computation. A ﬁlter including actual rotational dynamic models and treating the gyro data as measurements should be more accurate intheory, but it can be inferior in practice. The basic idea of dynamic model replacement is to use Eq. ( 4.31a )o r( 4.34)t o get the true angular velocity ! truein terms of the gyro-sensed rate !.T h i st r u e angular rate or its expectation is then substituted directly into Eqs. ( 6.30) and ( 6.36). The details of this method will be presented in the following discussions of speciﬁc ﬁlters. 6.2.2 Gyro Calibration Kalman Smoother Gyros must be calibrated to provide accurate rate measurements. Both sequentialﬁltering [ 30] and batch [ 28] approaches can be used for this calibration. The tradi- tional attitude on-orbit calibration approach uses the 6-state EKF discussed in the following section to estimate the current attitude and gyro biases simultaneously[21]. This ﬁlter assumes unvarying alignment of the sensors involved in attitude estimation. However, sensor misalignment is inevitable and would contribute to unreliable attitude estimates [ 38]. More stringent attitude pointing accuracy requires misalignments to be estimated and incorporated into the attitude estimator. The importance of proper calibration for use in fault detection or rate derivation has been noted in several papers [ 3,4,41]. Although several methods exist for gyro calibration, we present a batch pro- cess based on the smoother shown in Sect. 12.3.7.3 . A sequential EKF is ﬁrst executed forwards in time and then smoothed estimates are provided by employ-ing Eq. ( 12.139 ) backwards in time with ﬁnal conditions given by Eq. ( 12.138 ). A calibration model for a 3-axis gyro often comprises a set of 3 biases and a 3 /STX3 scale factor/misalignment matrix containing 3 scale factors and 6 misalignments,for a total of 12 calibration parameters [ 30]. The term “bias” implies a constant offset in the measurements, but in reality this offset actually drifts and is typically modeled using a random walk process. However, in most cases, this drift occursslowly over many orbits. The other calibration parameters can vary as well but typically not as much as the gyro drift. Here a 15-state model is derived to estimate the attitude as well as all gyro calibration parameters. Unlike magnetometers, allgyro calibration procedures require an external attitude or independent rate sensor. Here it is assumed that star tracker measurements are available. Once the calibration parameters are determined using the smoother, then a realtime 6-state ﬁlter canbe employed for the spacecraft mission mode. Periodic calibration of the gyro is typically done throughout the spacecraft lifetime, at time intervals dictated by the required accuracy in the attitude estimates or rate estimates for other purposes, suchas jitter control.6.2 Attitude Estimation 247 The 16-component global state vector is made up of the true quaternion, qtrue, gyro drift biases, ˇtrue, scale factors, strue, and misalignments, ktrue Uandktrue L.T h e 15-component state error vector is /SOHx.t//DC1/STX ı#T.t//SOHˇT.t//SOH sT.t//SOH kT U.t//SOH kT L.t//ETXT(6.37) whereı#is the local vector of small attitude errors and the other components are the errors in the gyro biases, scale factors, and misalignments deﬁned as the difference between their true and estimated values by /SOHˇ/DC1ˇtrue/NULOˇ,/SOHs/DC1strue/NULOs,/SOHkU/DC1 ktrue U/NULOkU, and/SOHkL/DC1ktrue L/NULOkL. The gyro model is given by Eqs. ( 4.34) and ( 4.31b ) from Sect. 4.7.1 : !D.I3CStrue/!trueCˇtrueC/DC1v (6.38a) PˇtrueD/DC1u (6.38b) where the spectral densities of /DC1vand/DC1uare/ESC2 vI3and/ESC2 vI3, respectively. The matrix Strueis written as Strue/DC12 4strue 1ktrue U1ktrue U2 ktrue L1strue 2ktrue U3 ktrue L2ktrue L3strue 33 5 (6.39) with true vectors given by strue/DC1Œstrue 1strue 2strue 3/c141T,ktrue U/DC1Œktrue U1ktrue U2ktrue U3/c141T, and ktrue L/DC1Œktrue L1ktrue L2ktrue L3/c141T. The dynamics of strue,ktrue U, and ktrue Lare given by PstrueD/DC1s (6.40a) Pktrue UD/DC1U (6.40b) Pktrue LD/DC1L (6.40c) where the spectral densities of /DC1s,/DC1U, and/DC1Lare/ESC2 sI3,/ESC2 UI3, and/ESC2 LI3, respec- tively. The error-state vector obeys the linearized dynamic equation /SOHPx.t/DF.t//SOH x.t/CG.t/ w.t/ (6.41) whereF.t/ is the Jacobian of f.x;t/and w.t//DC1/STX /DC1T v.t//DC1T u.t//DC1T s.t//DC1T U.t//DC1T L.t//ETXT(6.42) The matrices F.t/ ,G.t/ , and the spectral density Q.t/ ofw.t/are now derived for the 15-state ﬁlter.248 6 Filtering for Attitude Estimation and Calibration If the error terms in Strueare small, which is almost always a valid assumption, then .I3CStrue//NUL1/EM.I3/NULStrue/, leading to !trueD.I3/NULStrue/.!/NULˇtrue/NUL/DC1v/ (6.43a) O!D.I3/NULOS/.!/NULOˇ/ (6.43b) Thenı!is given by ı!D/NUL/SOHS.!/NULOˇ/NUL/SOHˇ/NUL/DC1v//NUL.I3/NULOS/./SOHˇC/DC1v/ (6.44) where/SOHS/DC1Strue/NULOS. Ignoring second-order terms leads to ı!D/NULdiag.!/NULOˇ//SOHs/NULOU/SOHkU/NULOL/SOHkL/NUL.I3/NULOS/./SOHˇC/DC1v/ (6.45) with OUD2 64!2/NULOˇ2!3/NULOˇ30 00 ! 3/NULOˇ3 0003 75 (6.46a) OLD2 64000 !1/NULOˇ100 0!1/NULOˇ1!2/NULOˇ23 75 (6.46b) where diag is deﬁned in Eq. ( 2.8) and/SOHs,/SOHkU, and/SOHkLare implicitly deﬁned by Eq. (6.39). Hence, the matrices F.t/ ,G.t/ , andQ.t/ are given by F.t/D2 666664/NULŒO!.t//STX/c141/NUL.I 3/NULOS//NULdiag.!/NULOˇ//NULOU/NULOL 03/STX303/STX303/STX303/STX303/STX3 03/STX303/STX303/STX303/STX303/STX3 03/STX303/STX303/STX303/STX303/STX3 03/STX303/STX303/STX303/STX303/STX33 777775(6.47a) G.t/D2 666664/NUL.I 3/NULOS/03/STX303/STX303/STX303/STX3 03/STX3I303/STX303/STX303/STX3 03/STX303/STX3I303/STX303/STX3 03/STX303/STX303/STX3I303/STX3 03/STX303/STX303/STX303/STX3I33 777775(6.47b) Q.t/Dblkdiag/NUL/STX /ESC2 vI3/ESC2 uI3/ESC2 sI3/ESC2 UI3/ESC2 LI3/ETX/SOH (6.47c) where blkdiag denotes a block diagonal matrix of appropriate dimension.6.2 Attitude Estimation 249 Assume thatNvector observations are available at time tk. We concatenate them to form the3N-dimensional measurement vector ykD2 6664A.qtrue/r1 A.qtrue/r2 ::: A.qtrue/rN3 7775ˇˇˇˇˇˇˇˇˇ tkC2 6664/ETB1 /ETB2 ::: /ETBN3 7775ˇˇˇˇˇˇˇˇˇ tk/DC1hk.xtrue k/Cvk (6.48a) RDblkdiag/STX R1R2/SOH/SOH/SOHR3/ETX (6.48b) whereRiis the covariance of /ETBi. We often make the simplifying assumption that the measurement errors are isotropic so that RiD/ESC2 iI3. The errors of unit vector measurements are not isotropic, though, and the QUEST measurement model(QMM) from Eq. ( 5.107 ) should be used instead. But this produces a singular matrix to be inverted in the EKF. It turns out that the assumption of isotropic errors can be justiﬁed, as will be shown in the following section. We now derive the observation sensitivity matrix H k.Ox/NUL k/for this observation. The true attitude matrix, A.qtrue/, is related to the a priori attitude, A.Oq/NUL/, through A.qtrue/DA.ıq/A.Oq/NUL/ (6.49) The ﬁrst-order approximation of the error-attitude matrix, A.ıq/, is given by A.ıq//EMI3/NULŒı#/STX/c141 (6.50) For a single sensor the true and estimated body vectors are given by btrueDA.qtrue/r (6.51a) Ob/NULDA.Oq/NUL/r (6.51b) Substituting Eqs. ( 6.49) and ( 6.50) into Eq. ( 6.51) yields /SOHb/DC1btrue/NULOb/NULD/NULŒı#/STX/c141A.Oq/NUL/rDŒOb/NUL/STX/c141ı# (6.52) The sensitivity matrix for all measurement sets is therefore given by Hk.Ox/NUL k/D2 6666664h Ob /NUL 1/STXi 03/STX12h Ob/NUL 2/STXi 03/STX12 ::::::h Ob/NUL N/STXi 03/STX123 7777775ˇˇˇˇˇˇˇˇˇˇˇˇ tk(6.53)250 6 Filtering for Attitude Estimation and Calibration Table 6.1 Extended Kalman ﬁlter for gyro calibration Initialize Oq.t0/Dq0;Oˇ.t0/Dˇ0;Os.t0/Ds0 OkU.t0/DkU0;OkL.t0/DkL0;P . t0/DP0 Gain KkDP/NUL kHT k.Ox/NUL k/ŒHk.Ox/NUL k/P/NUL kHT k.Ox/NUL k/CRk/c141/NUL1 Hk.Ox/NUL k/D2 664ŒA.Oq/NUL/r1/STX/c14103/STX12 :::::: ŒA.Oq/NUL/rN/STX/c14103/STX123 775ˇˇˇˇˇˇˇˇ tk Update PC kDŒI/NULKkHk.Ox/NUL k//c141P/NUL k ıO#/NUL kD03 OxC kDOx/NUL kCKkŒyk/NULhk.Ox/NUL k//c141 Oxk/DC1h ıO#T kOˇT kOsT kOkT UkOkT LkiT hk.Ox/NUL k/D2 6664A.Oq/NUL/r1 A.Oq/NUL/r2 ::: A.Oq/NUL/rN3 7775ˇˇˇˇˇˇˇˇˇ tk Oq/ETXDOq/NUL kC1 2/EOT.Oq/NUL k/ıO#C k OqC kDq/ETX=kq/ETXk Propagation O!.t/DŒI3/NULOS.t//c141Œ!.t//NULOˇ.t//c141 POq.t/D1 2/EOT.Oq.t//O!.t/ PP.t/ DF.t/P.t/ CP.t/FT.t/CG.t/Q.t/GT.t/ The ﬁnal part in the EKF involves the quaternion and bias updates. The state update follows Eq. ( 6.25), which assumes that the state is reset before every measurement update and that the non-attitude part of the state is reset implicitly. Thus OxC kDOx/NUL kCKkŒyk/NULhk.Ox/NUL k//c141 (6.54) whereOxk/DC1h ıO#T kOˇT kOsT kOkT UkOkT LkiT andhk.Ox/NUL k/is the estimated observation, given by hk.Ox/NUL k/D2 6664Ob/NUL 1 Ob/NUL 2::: Ob/NUL N3 7775ˇˇˇˇˇˇˇˇˇ tk(6.55) The attitude estimation algorithm is summarized in Table 6.1. The ﬁlter is ﬁrst initialized with a known state (the bias initial condition is usually assumed6.2 Attitude Estimation 251 zero) and error covariance matrix. The ﬁrst three diagonal elements of the error covariance matrix correspond to attitude errors. Then, the Kalman gain is computed using the measurement-error covariance Rkand sensitivity matrix in Eq. ( 6.53). The state error covariance follows the standard EKF update, while the state update is computed using Eq. ( 6.54). The quaternion is reset following Eqs. ( 6.27) and ( 6.28). Finally, the estimated angular velocity is used to propagate the quaternion kinematicmodel and error covariance in the EKF. A discrete-time propagation, given by Eq. ( 12.131 ), can be used for the covari- ance matrix in order to reduce the computational load. The ﬁrst step is to set up thefollowing2n/STX2nmatrix, where nD15in the present case [ 40]: AD/DC4/NULFG Q G T 0n/STXnFT/NAK /SOHt (6.56) The matrix exponential is then calculated: BDeAD/DC4B11B12 0n/STXnB22/NAK D/DC4B11˚/NUL1 kQk 0n/STXn˚T k/NAK (6.57) The state transition and covariance matrices are then given as ˚kDBT 22 (6.58a) QkD˚kB12 (6.58b) Note that Eq. ( 6.56) is only valid for constant system and covariance matrices, but this is a good approximation for small /SOHt. Often adequate results are provided by an even simpler ﬁrst-order approximation: ˚k/EMInC/SOHtF.t/ (6.59a) Qk/EM/SOHtGQGT(6.59b) Then Eq. ( 3.17) gives the discrete-time quaternion propagation as Oq/NUL kC1DexpŒ./SOH/DC2=2/˝/c141OqC k/EMN/STX.O!C k/OqC k(6.60) with N/STX.O!C k//DC12 66664cos/DC21 2kO!C kk/SOHt/DC3 I3/NULh O C k/STXi O C k /NULO CT k cos/DC21 2kO!C kk/SOHt/DC33 77775(6.61)252 6 Filtering for Attitude Estimation and Calibration where O C k/DC1sin/DC21 2kO!C kk/SOHt/DC3 O!C k kO!C kk(6.62) Example 6.1. In this example, simulation results are presented for the aforemen- tioned gyro calibration algorithm. A 90-min simulation run is shown. Quaternion measurements are assumed to exist, sampled every second, and the covariance ofthe measurements is given by R kD36I3arcsec2. This assumes that errors in each axis are equivalent. Using one star tracker typically produces errors along the boresight axis that are an order of magnitude larger than the other axes. Using twostar trackers that are orthogonal produces errors that are more nearly isotropic. Also, two star trackers are typically employed for redundancy purposes. The spacecraft angular velocity is given by ! trueD0:1/STXŒsin.0:01t/ sin.0:0085t/ cos.0:0085t//c141T deg/s. This angular velocity is used to increase the observability of the calibration parameters. Missions typically perform calibration maneuvers to ensure proper observability. The other parameters used in the simulation are given by  Initial gyro bias: 0:1deg/h for each axis,  Gyro scale factors: s1D1;500 ppm,s2D1;000 ppm,s3D1;500 ppm,  Gyro misalignments: kU1D1;000 ppm,kU2D1;500 ppm,kU3D2;000 ppm, kL1D500ppm,kL2D1;000 ppm,kL3D1;500 ppm,  Gyro noise parameters: /ESCuDp 10/STX10/NUL10rad/s3=2,/ESCvDp 10/STX10/NUL7rad/s1=2, /ESCsD/ESCUD/ESCLD0,  Initial quaternion: qtrue 0Dp 2=2/STXŒ1 0 0 1/c141T. where ppm denotes parts per million. The gyros are also assumed to be sampled every second. The EKF attitude is initialized using the measurement quaternion and the initial covariance is given by .6=3;600/STX/EM=180/2I3rad2. All gyro calibration parameters are assumed to be initialized to zero. The initial covariances for theseparameters are: initial gyro bias covariance of .0:2=3;600/STX/EM=180/ 2I3(rad/s)2, initial scale factor covariance of .0:002=3/2I3rad2, initial upper misalignment covariance of .0:002=3/2I3rad2, and initial lower misalignment covariance of .0:002=3/2I3rad2. The EKF errors with their respective 3/ESCbounds for the attitude, gyro biases, scale factors and upper misalignments are shown in Fig. 6.1. Roll, pitch, and yaw denote the components of ı#. The attitude errors converge in about 15 min and good ﬁltering performance is obtained. The gyro biases are also well estimated with 3/ESCbounds of about 0.01 deg/h in each axis. The scale factors and misalignments take slightly longer to converge than the attitude and gyro biases, but they are also well estimated with 3/ESCbounds of about 25 /c157rad in each axis. The EKF estimates are then employed in a smoother to further reﬁne the estimates. The smoothedestimates and covariances of each parameter are nearly constant over the entire simulation run. Estimates with their respective 3/ESCbounds are shown in Table 6.2. Clearly, as expected, the smoother is able to provide more accurate results than theEKF.6.2 Attitude Estimation 253 0 15 30 45 60 75 90−20020 0 15 30 45 60 75 90−20020 0 15 30 45 60 75 90−20020 Time (Min)Roll ( mrad) Pitch ( mrad) Yaw ( mrad)0 15 30 45 60 75 90−0.0200.02 0 15 30 45 60 75 90−0.0200.02 0 15 30 45 60 75 90−0.0200.02 Time (Min)b1 (Deg/Hr) b2 (Deg/Hr) b3 (Deg/Hr) 0 15 30 45 60 75 90−60060 0 15 30 45 60 75 90−60060 0 15 30 45 60 75 90−60060 Time (Min)s1 (ppm) s2 (ppm) s3 (ppm)0 15 30 45 60 75 90−60060 0 15 30 45 60 75 90−60060 0 15 30 45 60 75 90−60060 Time (Min)kU1 (ppm) kU2 (ppm) kU3 (ppm)ab cd Fig. 6.1 Extended Kalman ﬁlter results. ( a) Attitude errors and 3/ESCbounds. ( b) Bias errors and 3/ESC bounds. ( c) Scale errors and 3/ESCbounds. ( d) Upper misalignment errors and 3/ESCbounds Table 6.2 Smoother results for gyro calibrationParameter Truth Estimate ˇ1(deg/h) 0.1 0:0981 ˙0:0065 ˇ2(deg/h) 0.1 0:1029 ˙0:0065 ˇ3(deg/h) 0.1 0:0999 ˙0:0065 s1(ppm) 1;500 1;497 ˙14:5800 s2(ppm) 1;000 997 ˙13:5651 s3(ppm) 1;500 1;488 ˙13:6671 kU1(ppm)1;000 991 ˙13:5936 kU2(ppm)1;500 1;501 ˙13:6984 kU3(ppm)2;000 1;999 ˙13:7233 kL1(ppm)500 499 ˙14:6252 kL2(ppm)1;000 994 ˙14:6197 kL3(ppm)1;500 1;497 ˙13:6126254 6 Filtering for Attitude Estimation and Calibration 6.2.3 Filtering and the QUEST Measurement Model The previous section asserted that using the QMM causes the matrix HPHTCRto be singular at all times, where His given by Eq. ( 6.53) and RDblkdiag/STX /NUL/ESC2 1ŒOb1/STX/c1412/NUL/ESC2 2ŒOb2/STX/c1412/SOH/SOH/SOH/NUL/ESC2 NŒObN/STX/c1412/ETX (6.63) Am a t r i xMis singular if and only if it has a null vector, i.e. a nonzero vector z such thatMzD0. Since the matrices HPHTandRboth contain the same cross product matrices it is easy to see that zD/STXObT 1ObT 2/SOH/SOH/SOHObT N/ETXT(6.64) is a null vector of HPHTCR. Note that other null vectors may exist, but all we need is one to prove that using the QMM leads to a matrix that cannot be invertedin the EKF gain equation. There are several ways to avoid this singularity. The ﬁrst is to note that we never really measure a unit vector. In the case of a star tracker, for example, the actualmeasurement vector is given by Eq. ( 4.3)a s h.x true/D/DC4u v/NAK D/DC4u0 v0/NAK Cf rst 3/DC4rst 1 rst 2/NAK (6.65) where rstDBA.qtrue/rtrue,Bis the orthogonal star tracker alignment matrix, rtrue is the star unit vector in the celestial coordinate frame, and the subscripts 1;2;3 are Cartesian indices. The attitude part of the sensitivity matrix for this measurement model is found by the chain rule to be H#D@h @rst@rst @.ı#/Df .Orst 3/2/DC4Orst 30/NULOrst 1 0Orst 3/NULOrst 2/NAK ŒOrst/STX/c141B (6.66) ThenRandHPHTCRare well-conditioned 2/STX2matrices. It is often desirable to compute a unit vector from the sensor measurements for input to the ﬁlter, in order to provide a universal ﬁlter interface from a variety of sensors. The nonsingular unit vector measurement covariance matrix of Eq. ( 5.126 ) could be used in place of the QMM, but this would produce an ill-conditioned matrixHPH TCR, which is not much of an improvement. Fortunately, Malcolm Shuster found a way out of this dilemma. Shuster’s analysis of this singularity issue leads to a remarkably simple solution [35]. Let/USbe a unit vector that is very close to Atruer, and letf/US;˛./US/;ˇ./US/g be a right-handed orthogonal triad. We can determine bby measuring only two components nearly perpendicular to Atruer: /DLE1D˛./US//SOHb (6.67a) /DLE2Dˇ./US//SOHb (6.67b)6.2 Attitude Estimation 255 The measurement vector is given in terms of the projection matrix U./US//DC1/STX ˛./US/ˇ./US//ETXT(6.68) by /DLE/DC1Œ/DLE1/DLE2/c141TDU./US/b (6.69) The projection matrix satisﬁes the identities U./US/UT./US/DI2 (6.70a) UT./US/U./US/DI3/NUL/US/UST(6.70b) Substituting the measurement model bDAtruerC/ETBinto Eq. ( 6.69) leads to /DLEDU./US/AtruerCe (6.71) where eDU./US//ETB.I f/ETBobeys the QMM, Ef/ETB/ETBTgD/ESC2ŒI3/NUL.Atruer/.Atruer/T/c141, then the projected error esatisﬁes EfegD0 (6.72a) E˚ eeT/TAB D/ESC2˚ I2/NULŒU./US/Atruer/c141ŒU./US/Atruer/c141T/TAB (6.72b) Since/USis very close to AtruerthenkU./US/Atruerk/FS1and we can neglect the second term in Eq. ( 6.72b ), yielding R/DLE/DC1E˚ eeT/TAB D/ESC2I2 (6.73) which is a nonsingular matrix. The vector/UShas been undeﬁned, except for being close to Atruer. This will now be speciﬁcally deﬁned in the Kalman ﬁlter setting. Substituting Eqs. ( 6.49) and ( 6.50) into Eq. ( 6.71) leads to /DLEDU./US/.I3/NULŒı#/STX/c141/Ob/NULCe (6.74a) DU./US/.Ob/NULCOb/NUL/STXı#/Ce (6.74b) If we choose/USDOb/NUL, the ﬁrst term in Eq. ( 6.74b ) vanishes because U.Ob/NUL/Ob/NULD0. DeﬁningU/NUL/DC1U.Ob/NUL/gives /DLE/DC1U/NULbDU/NULŒOb/NUL/STX/c141ı#Ce (6.75)256 6 Filtering for Attitude Estimation and Calibration Now deﬁne the following error vector: /SOHx/DC1Œı#T/SOH/CANT/c141T, where/SOH/CANis ann/STX1 vector of non-attitude error states, such as the error gyro biases. Then the linearized measurement equation becomes /DLEDH/SOH xCe (6.76) whereHis given by HD/STX W02/STXn/ETX (6.77) withW/DC1U/NULŒOb/NUL/STX/c141. The predicted innovations covariance is given by E/NULDHP/NULHTCR/DLEDWP/NUL ##WTC/ESC2I2 DU/NUL/DLE ŒOb/NUL/STX/c141P/NUL ##ŒOb/NUL/STX/c141TC/ESC2I3/DC1 .U/NUL/T(6.78) whereP/NUL ##is the upper-left 3/STX3corner ofP/NUL. Because/USis very close to Atruer, the inverse of this is, to a very good approximation, .E/NUL//NUL1DU/NUL/DLE ŒOb/NUL/STX/c141P/NUL ##ŒOb/NUL/STX/c141TC/ESC2I3/DC1/NUL1 .U/NUL/T(6.79) Note that this would be trivial if U/NULwere orthogonal, but it is not. The Kalman gain is given by KDP/NULHT.HP/NULHTCR/DLE//NUL1. If we deﬁne H/DC1/STX ŒOb/NUL/STX/c14103/STXn/ETX (6.80a) K/DC1P/NULHT.HP/NULHTC/ESC2I3//NUL1(6.80b) then we have HP/NULHTC/ESC2I3DŒOb/NUL/STX/c141P/NUL ##ŒOb/NUL/STX/c141TC/ESC2I3 (6.81a) KHDKH (6.81b) Equation ( 6.81) indicates that the QMM can be effectively replaced by /ESC2I3,i n the sense that it leads to the same ﬁlter that uses the projected measurements in Eq. (6.67)! Note that the projection matrix U/NULdoes not appear in HorK.W eh a v e recovered the usual Kalman ﬁlter equations for a unit vector measurement, but witha nonsingular isotropic measurement covariance matrix in place of the singular QMM expression. Shuster shows that all other equations in the original EKF remain unchanged. This analysis can easily be extended to multiple observations.6.2 Attitude Estimation 257 Table 6.3 Extended Kalman ﬁlter for attitude estimation Initialize Oq.t0/DOq0;Oˇ.t0/DOˇ0 P.t0/DP0 Gain KkDP/NUL kHT k.Ox/NUL k/ŒHk.Ox/NUL k/P/NUL kHT k.Ox/NUL k/CRk/c141/NUL1 Hk.Ox/NUL k/D2 664ŒA.Oq/NUL/r1/STX/c14103/STX3 :::::: ŒA.Oq/NUL/rN/STX/c14103/STX33 775ˇˇˇˇˇˇˇˇ tk Update PC kDŒI/NULKkHk.Ox/NUL k//c141P/NUL k /SOHOxC kDKkŒyk/NULhk.Ox/NUL k//c141 /SOHOxC k/DC1h ıO#CT k/SOHOˇCT kiT hk.Ox/NUL k/D2 6664A.Oq/NUL/r1 A.Oq/NUL/r2 ::: A.Oq/NUL/rN3 7775ˇˇˇˇˇˇˇˇˇ tk Oq/ETXDOq/NUL kC1 2/EOT.Oq/NUL k/ıO#C k OqC kDq/ETX=kq/ETXk OˇC kDOˇ/NUL kC/SOHOˇC k Propagation O!.t/D!.t//NULOˇ.t/ POq.t/D1 2/EOT.Oq.t//O!.t/ PP.t/ DF.t/P.t/ CP.t/FT.t/CG.t/Q.t/GT.t/ 6.2.4 Mission Mode Kalman Filter The EKF described in the Sect. 6.2.2 can be used for full gyro calibration, and improved estimates can be obtained using a smoother. As mentioned previously, the mission mode EKF estimates only attitude and gyro biases, assuming that thescale factors and misalignments have already been determined. The 6-state EKF attitude estimator is shown in Table 6.3. Note that in this formulation /SOHOxis used and only one update is performed at each time step, so that the measurement updatefollows Eq. ( 6.24) and an explicit update of the bias vector is performed. This formulation and the one in the next section are equivalent and both have been seen in the open literature. Thus we feel it is important to see how each approach isimplemented.258 6 Filtering for Attitude Estimation and Calibration The matrices F.t/ ,G.t/ , andQ.t/ are given by F.t/D/DC4/NULŒO!.t//STX/c141/NULI3 03/STX303/STX3/NAK (6.82a) G.t/D/DC4/NULI303/STX3 03/STX3I3/NAK (6.82b) Q.t/D/DC4/ESC2 vI303/STX3 03/STX3/ESC2 uI3/NAK (6.82c) Closed-form expressions for the discrete-time matrices are possible in this case. The discrete error-state transition matrix is given by ˚D/DC4˚11˚12 ˚21˚22/NAK (6.83a) ˚11DI3/NULŒO!/STX/c141sin.kO!k/SOHt/ kO!kCŒO!/STX/c1412f1/NULcos.kO!k/SOHt/g kO!k2(6.83b) ˚12DŒO!/STX/c141f1/NULcos.kO!k/SOHt/g kO!k2/NULI3/SOHt/NULŒO!/STX/c1412fkO!k/SOHt/NULsin.kO!k/SOHt/g kO!k3 (6.83c) ˚21D03/STX3 (6.83d) ˚22DI3 (6.83e) It is left as an exercise to derive these equations and to show that ˚11is an orthogonal matrix. The conversion from the spectral density Q.t/ to discrete-time covariance Qkis given by [ 8] QkDZ/SOHt 0˚.t/G.t/Q.t/GT.t/˚T.t/dt (6.84) It is assumed in the ensuing derivations for QkthatO!is constant throughout the sampling interval. Partition the matrix Qkinto3/STX3sub-matrices: QkD" Q11kQ12k QT 12kQ22k# (6.85) Performing the multiplication B.t//DC1˚.t/G.t/Q.t/GT.t/˚T.t/gives B.t/D/DC4/ESC2 v˚11˚T 11C/ESC2 u˚12˚T 12/ESC2 v˚11˚T 21C/ESC2 u˚12˚T 22 /ESC2 v˚21˚T 11C/ESC2 u˚22˚T 12/ESC2 v˚21˚T 21C/ESC2 u˚22˚T 22/NAK (6.86)6.2 Attitude Estimation 259 Using Eqs. ( 6.83d ) and ( 6.83e ) and the orthogonality of ˚11simpliﬁesB.t/ to B.t/D/DC4/ESC2 vI3C/ESC2 u˚12˚T 12/ESC2 u˚12 /ESC2 u˚T 12/ESC2 uI3/NAK (6.87) Therefore,Q22kis simply given by Q22kD./ESC2 u/SOHt/I3 (6.88) Integrating˚12gives Q12kD/ESC2 uZ/SOHt 0˚12dtD/ESC2 u/SUB ŒO!k/STX/c141kO!kk/SOHt/NULsin.kO!kk/SOHt/ kO!kk3/NUL1 2/SOHt2I3 /NULŒO!k/STX/c14121 2kO!kk2/SOHt2Ccos.kO!kk/SOHt//NUL1 kO!kk4) (6.89) If the sampling rate is below Nyquist’s limit (for example, with a safety factor of 10 we requirekO!k/SOHt </EM=10 for all time), then Q12k/EM/NUL1 2/ESC2 u/SOHt2I3. Performing the multiplication ˚12˚T 12yields ˚12˚T 12D/NULŒO!/STX/c14121/NUL2cos.kO!kt/Ccos2.kO!kt/ kO!k4 /NULŒO!/STX/c1412kO!k2t2/NUL2kO!ktsin.kO!kt/Csin2.kO!kt/ kO!k4 C2ŒO!/STX/c1412kO!kt2/NULtsin.kO!kt/ kO!k3Ct2I3 D/NULŒO!/STX/c14122/NUL2cos.kO!kt//NULkO!k2t2 kO!k4Ct2I3 (6.90) The integral of ˚12˚T 12dtis Z/SOHt 0˚12˚T 12dtD/NULŒO!/STX/c14122kO!k/SOHt/NUL2sin.kO!k/SOHt//NUL1 3kO!k3/SOHt3 kO!k5C1 3/SOHt3I3 (6.91) Therefore,Q11kis given by Q11kD./ESC2 v/SOHt/I3 C/ESC2 u( 1 3/SOHt3I3/NULŒO!k/STX/c14122kO!kk/SOHt/NUL2sin.kO!kk/SOHt//NUL1 3kO!kk3/SOHt3 kO!kk5) (6.92)260 6 Filtering for Attitude Estimation and Calibration If the sampling rate is below Nyquist’s limit, then Q11k/EM/NUL /ESC2 v/SOHtC1 3/ESC2 u/SOHt3/SOH I3. Then, the discrete process noise covariance is approximated by Qk/EM2 66664/DC2 /ESC2 v/SOHtC1 3/ESC2 u/SOHt3/DC3 I3/NUL/DC21 2/ESC2 u/SOHt2/DC3 I3 /NUL/DC21 2/ESC2 u/SOHt2/DC3 I3/NUL /ESC2 u/SOHt/SOH I33 77775(6.93) It should be noted that Eq. ( 6.93) is exact when F.t/ is given by F.t/D/DC40 3/STX3/NULI3 03/STX303/STX3/NAK (6.94) Equation ( 6.93) is often used because the sampling rate is often below Nyquist’s limit. These discrete-time forms make the EKF especially suitable for onboardimplementation. 6.2.5 Murrell’s Version The gain calculation in the ﬁlter shown in Table 6.1requires inverting a 3N/STX 3Nmatrix. Murrell’s variation of the ﬁlter can be used to avoid this expensive computation [ 27]. Even though the EKF involves nonlinear models, a linear update is still performed. Therefore, linear tools such as the principle of superpositionare applicable. Murrell’s ﬁlter uses this principle to process one 3/STX1vector observation at a time, delaying the reset until all Nobservations have been processed. In this case, all the terms of Eq. ( 6.20) must be included. A ﬂow diagram of Murrell’s approach is given in Fig. 6.2. The ﬁrst step involves propagating the quaternion, gyro bias, and error covariance to the current observation time. Then the attitude matrix is computed and the error state vector is initialized to zero. Next, theerror covariance and state quantities are updated using a single vector observation. This update is continued (replacing the propagated error covariance and state vector with the updated values) until all vector observations are processed. Finally, a resetmoves the updated values into the global state representation, and the global state and error covariance are propagated to the next observation time. Therefore, this approach reduces taking an inverse of a 3N/STX3Nmatrix to taking an inverse of a 3/STX3matrixNtimes, signiﬁcantly decreasing the computational load. Example 6.2. This example is a simulation of an EKF using a typical star tracker to determine the attitude of a spacecraft in a 90-min low-Earth orbit. The spacecraft rotates at one revolution per orbit about its /NULxbody axis, which is the i3vector of the inertial reference frame shown in Fig. 2.3. The star tracker’s boresight is assumed to be along the z(yaw) body axis pointed in the anti-nadir direction, and is initially6.2 Attitude Estimation 261 Propagate Compute Sensitivity Matrix Gain Update Covariance Pk+ = [I−KkHk]Pk− Residual Update State Yes i=i+1No i <N?Reset Next Observation TimeInitialize Dxˆ− k = 0, i = 1 Dxˆ− k = Dxˆk+ Dxˆk+ = Dxˆ− k + Kk[ek−HkDxˆ− k ]qˆ− k ,P−k ,bˆ k− qˆk+,Pk+, bˆ k+Pk− = Pk+A(qˆk−) Hk = [[A(qˆk−)ri×] 03×3]|tk Kk = Pk−HkT [HkPk−HkT + si2I3]−1 ek = (bi − A(qˆ−)ri)|tk Fig. 6.2 Computationally efﬁcient attitude estimation algorithm aligned with the i1vector of the inertial reference frame. The star tracker can sense up to 10 stars in a 6ı/STX6ıﬁeld of view. The catalog contains stars that can be sensed up to a magnitude of 6.0 (larger magnitudes indicate dimmer stars). The star tracker body observations are obtained by using the measurement model presented in Sect. 4.2with/ESCD.0:005=3/ı. We also assume that no Sun intrusions are present (although this is not truly realistic). Star images are taken at 1-s intervals.The goal of the EKF is to estimate the attitude and gyro biases by ﬁltering the star tracker measurements. The noise parameters for the gyro measurements are given by/ESC uDp 10/STX10/NUL10rad/s3=2and/ESCvDp 10/STX10/NUL7rad/s1=2. The initial bias for each axis is given by 0.1 deg/h. Also, the gyro measurements are sampled at the same rate as the star tracker measurements (i.e. at 1 Hz). We should note that in262 6 Filtering for Attitude Estimation and Calibration 0 15 30 45 60 75 900123456789101112 Time (Min)Available Stars 0 15 30 45 60 75 90−2−1012x 10−3 x 10−3 0 15 30 45 60 75 90−2−1012 0 15 30 45 60 75 90−0.02−0.0100.010.02 Time (Min)Roll (Deg) Pitch (Deg) Yaw (Deg)0 15 30 45 60 75 90−0.100.10.20.3 0 15 30 45 60 75 90−0.100.10.20.3 0 15 30 45 60 75 90−0.100.10.20.3 Time (Min)b1 (Deg/Hr) b2 (Deg/Hr) b3 (Deg/Hr)a bc Fig. 6.3 Mission mode extended Kalman ﬁlter results. ( a) Number of available stars. ( b) Attitude errors and3/ESCbounds. ( c) Gyro drift estimates practice the gyros are sampled at a much higher frequency, which is usually required for jitter control. The initial covariance for the attitude error is set to 0:12deg2, and the initial covariance for the gyro drift is set to 0:22(deg/h)2. Converting these quantities to radians and seconds gives the initial attitude and gyro drift covariances for each axis: Pa 0D3:0462/STX10/NUL6rad2andPb 0D9:4018/STX10/NUL13(rad/s)2,s o that the initial covariance matrix is given by P0DdiagŒPa 0Pa 0Pa 0Pb 0Pb 0Pb 0/c141. The initial attitude estimate for the EKF is given by the true quaternion, which is given by qtrue 0Dp 2=2/STXŒ 0101 /c141T. The initial gyro drift biases in the EKF are set to zero. Figure 6.3a shows a plot of the number of available stars. Note that at a few times only one star is available, so the static attitude determination methods of Chap. 5 cannot be employed at these times. However, this is not an issue with the EKFsince an update is still possible even with one star. Note that an EKF-based solution is possible unless there is never more than one star available and it is always the same star. Figure 6.3b shows a plot of the attitude errors and associated 3/ESCbounds.6.3 Farrenkopf’s Steady-State Analysis 263 Clearly, the computed 3/ESCbounds do indeed bound the attitude errors. Note that the yaw errors are much larger than the roll and pitch errors because the boresight of the star tracker is along the yaw axis. Figure 6.3c shows that the EKF is able to accurately estimate the gyro drift bias. The “drift” in this plot looks very steady, due to the fact that a high-grade three-axis gyro has been used in the simulation. This example clearly shows the power of the EKF, which has been successfullyapplied for attitude estimation of many spacecraft. The unscented Kalman ﬁlter provides a more robust approach to initial condition errors [ 11]. 6.3 Farrenkopf’s Steady-State Analysis In this section we consider the case of single-axis attitude estimation with an angle measurement and gyro outputs used in place of a dynamic model. The single anglecase is useful because Farrenkopf found a closed-form solution for its Kalman ﬁlter error-covariance [ 15]. We will use an alternative derivation that includes an additional source of gyro errors not included in Farrenkopf’s original analysis [ 26]. The true single-axis attitude angle /DC2 trueobeys the kinematic equation P/DC2trueD!true(6.95) where!trueis the true angular velocity. A rate-integrating gyro measures an angle /DC2RIG, which is the integral of P/DC2RIGD!D!trueCˇtrueC/DC1v (6.96) where!is the rate sensed by the gyro, which is corrupted by the gyro drift ˇtrueand a zero-mean Gaussian white-noise process /DC1vwith spectral density /ESC2 v. The drift rate is modeled by a random walk process, given by PˇtrueD/DC1u (6.97) where/DC1uis a zero-mean Gaussian white-noise process with spectral density given by/ESC2 u. Thus the three-component state xDŒ/DC2trueˇtrue/DC2RIG/c141Tobeys the discrete- time propagation equation x.tCıt/D2 4100 0100ıt13 5x.t/C2 41 013 5ı/DC2 trueC2 40 Nu Nv3 5 (6.98)264 6 Filtering for Attitude Estimation and Calibration In this equation ıtis the interval between gyro measurements and is notassumed to be inﬁnitesimal. The angular motion ı/DC2true, the integral of !trueoverıt, is also not inﬁnitesimal. The quantities NuandNvare deﬁned by NuDZtCıt t/DC1u.t0/dt0(6.99a) NvDZtCıt t/STX /DC1v.t0/C.tCıt/NULt0//DC1u.t0//ETX dt0(6.99b) Now we will use the gyro measurement in place of the unknown angular motionı/DC2true. This is what we mean by saying that we use the gyros as a replacement for a dynamic model. The gyro measurement at the end of the propagation interval is /DC2out.tCıt/D/DC2RIG.tCıt/CveD/STX 0ıt1/ETX x.t/Cı/DC2trueCNvCve(6.100) whereveis a zero-mean Gaussian measurement noise with variance /ESC2 e. We assume that/DC1u,/DC1v, andveare uncorrelated. Solving this equation for ı/DC2truein terms of /DC2out.tCıt/and substituting back into Eq. ( 6.98)g i v e s x.tCıt/D2 4100 0100ıt13 5x.t/C2 41 013 5˚ /DC2 out.tCıt//NUL/STX 0ıt1/ETX x.t//NULNv/NULve/TAB C2 40 Nu Nv3 5 D2 41/NULıt/NUL1 01 000 03 5x.t/C2 41 013 5/DC2 out.tCıt/C2 4/NULNv/NULve Nu /NULve3 5 (6.101) This is the discrete-time state propagation equation with the gyros used in dynamic model replacement mode. Because /DC1u,/DC1v, andvehave zero mean, the expectation Ox/DC1Efxgand the state error vector /SOHx/DC1x/NULOxobey Ox.tCıt/D˚.ıt/Ox.t/C2 41 013 5/DC2 out.tCıt/ (6.102a) /SOHx.tCıt/D˚.ıt//SOH x.t/C2 4/NULNv/NULve Nu /NULve3 5 (6.102b) where ˚.ıt/D2 41/NULıt/NUL1 01 000 03 5 (6.103)6.3 Farrenkopf’s Steady-State Analysis 265 The covariance P/DC1Ef/SOHx/SOHxTgpropagates according to P.tCıt/D˚.ıt/P.t/˚T.ıt/CQ.ıt/ (6.104) where Q.ıt/DE8 ˆ< ˆ:2 4/NULNv/NULve Nu /NULve3 52 4/NULNv/NULve Nu /NULve3 5T9 >= >; D2 666664/ESC 2 vıtC1 3/ESC2 uıt3C/ESC2 e/NUL1 2/ESC2 uıt2/ESC2 e /NUL1 2/ESC2 uıt2/ESC2 uıt 0 /ESC2 e 0/ESC2 e3 777775(6.105) The expectation calculations involved in Q.ıt/ are very similar to the computations in Sect. 4.7.1 . It is easy to show by mathematical induction that propagation by n steps gives P.tCnıt/D˚.nıt/P.t/˚ T.nıt/CQ.nıt/ (6.106) This equation has two remarkable properties. The ﬁrst is that it depends only on the total propagation time nıtand not onnandıtseparately. The second is that the noise term/ESCedoes not accumulate, so that the covariance only depends on the output noise of the last readout. Now assume that we have measurements from an angle sensor at an interval /SOHt that is some multiple of the gyro measurement time. It doesn’t matter what the angle sensor is, but we assume that its measurement variance is the scalar /ESC2 n. We want to ﬁnd a steady-state solution for the covariance, which means that we have the same covarianceP/NULbefore every angle sensor measurement and the same covariance PCafter every measurement update. These obey the Kalman ﬁlter propagation and update equations (see Table 12.2) P/NULD˚./SOHt/PC˚T./SOHt/CQ./SOHt/ (6.107a) PCDP/NUL/NULP/NULHT.HP/NULHTC/ESC2 n//NUL1HP/NUL(6.107b) The measurement sensitivity matrix is HDŒ100/c141 ,s oHP/NULHTis a scalar. Equa- tion ( 6.107 ) are equivalent to 12 coupled scalar equations for the 12 independent components of the symmetric covariance matrices P/NULandPC. Solving them is straightforward but difﬁcult, so we will just state the solution:266 6 Filtering for Attitude Estimation and Calibration P/NULD/ESC2 n2 666664/DLE2/NUL1/NUL/DLESu=/SOHt S2 e /NUL/DLESu=/SOHt/STX /DLE/NUL.1CS2 e//DLE/NUL1C1 2Su/ETX Su=/SOHt20 S2 e 0S2 e3 777775(6.108a) PCD/ESC2 n2 6666641/NUL/DLE /NUL2/NUL/DLE/NUL1Su=/SOHt /DLE/NUL2S2 e /NUL/DLE/NUL1Su=/SOHt/STX /DLE/NUL.1CS2 e//DLE/NUL1/NUL1 2Su/ETX Su=/SOHt2/DLE/NUL1S2 eSu=/SOHt /DLE/NUL2S2 e /DLE/NUL1S2 eSu./SOHt//NUL1S2 e.1/NUL/DLE/NUL2S2 e/3 777775 (6.108b) where S u/DC1/ESCu/SOHt3=2=/ESCn (6.109a) Sv/DC1/ESCv/SOHt1=2=/ESCn (6.109b) Se/DC1/ESCe=/ESCn (6.109c) and where/DLEobeys the quartic equation 0D/DLE4/NULSu/DLE3/NUL/STX 2.1CS2 e/CS2 v/NULS2 u=6/ETX /DLE2/NUL.1CS2 e/Su/DLEC.1CS2 e/2 D/STX /DLE2/NUL2./CRCSu=4//DLEC1CS2 e/ETX/STX /DLE2C2./CR/NULSu=4//DLEC1CS2 e/ETX (6.110) with /CR/DC1r 1CS2eC1 4S2vC1 48S2u (6.111) Equation ( 6.110 ) has four roots, but the only root giving a positive deﬁnite PCis the largest one, namely /DLED/CRC1 4SuC1 2r 2/CRS uCS2vC1 3S2u (6.112) We are not interested in the entire covariance matrix. The quantities of greatest interest are the standard deviation of the angle estimate, which is the square rootof the1/NUL1component of the covariance, and the standard deviation of the drift estimate, which is the square root of the 2/NUL2component. The standard deviations prior to the sensor update are6.3 Farrenkopf’s Steady-State Analysis 267 /ESC/NUL /DC2D/ESCnp /DLE2/NUL1 (6.113a) /ESC/NUL ˇDp 2/ESCn/ESCu/SOHt/NUL1=4q /CR/NUL.1CS2e//DLE/NUL1CSu=2 (6.113b) and after the update /ESCC /DC2D/ESCnp 1/NUL/DLE/NUL2 (6.114a) /ESCC ˇDp 2/ESCn/ESCu/SOHt/NUL1=4q /CR/NUL.1CS2e//DLE/NUL1 (6.114b) If/ESCeD0, the third columns and third rows of Q,P/NUL, andPCare all zero, reﬂecting the fact that the gyro measurements give perfect knowledge of /DC2RIG.I nt h i s case, the covariance propagation and update equations are equivalent to QP/NULDQ˚./SOHt/QPCQ˚T./SOHt/CQQ./SOHt/ (6.115a) QPCDQP/NUL/NULQP/NULQHT.QHQP/NULQHTC/ESC2 n//NUL1QHQP/NUL(6.115b) whereQP/NUL,QP/NUL,QPC,QQ, andQ˚are the upper-left 2/STX2blocks ofP/NUL,PC,Q, and ˚with/ESCeD0, respectively, and QHDŒ10/c141 . This is the model originally analyzed by Farrenkopf, and it is the basis of most of the Kalman ﬁlters used on spacecraft and presented in this text. It corresponds to the dynamical model of Eqs. ( 6.95) and ( 6.38) withStrueD0, namely P/DC2trueD!/NULˇtrue/NUL/DC1v (6.116a) PˇtrueD/DC1u (6.116b) This is the dynamical model that was used in Farrenkopf’s original paper, and it has been used by guidance and control engineers for many years [ 15]. It was the basis for the analysis in Sect. 4.7.1 and will be employed extensively in this chapter. It is useful to retain the dependence on gyro electronic noise /ESCefor covariance estimates, though. Figure 6.4shows the pre- and post-update angle standard deviations for angle sensor update times between 0.01 and 100 s for parameters characteristic of a ring laser gyro with very low drift: /ESCvD0:025 deg/h1=2D7:27/c157 rad/s1=2and/ESCuD 3:7/STX10/NUL3deg/h3=2D3/STX10/NUL4/c157rad/s3=2. The angle sensor is assumed to be a star tracker having measurement noise with standard deviation /ESCnD15/c157rad. The solid curves are for /ESCeD5/c157rad, and the dashed curves are for /ESCeD0. It is clear from the ﬁgure that gyro output white noise is only important for frequent star tracker updates, and that it causes the estimation accuracy to fall more slowly in that limit. In the limiting case of very frequent updates, the pre-update and post-update attitude error standard deviations both approach constant values if /ESCe¤0.I nt h i s case/DLE/EM/CR/EMp 1CS2eand268 6 Filtering for Attitude Estimation and Calibration 0.01 0.1 1 10 100110100 sq− sq+ Fig. 6.4 Steady-state attitude estimation standard deviations, solid curves for/ESCeD5/c157rad,dashed curves for/ESCeD0 /ESC/NUL /DC2!/ESCe;and/ESCC /DC2!/ESCe/ESCnp /ESC2eC/ESC2n(6.117) If/ESCeD0, the frequent-update case approaches the continuous-update limit, given by /ESC˙ /DC2!/ESCn.S2 vC2Su/1=4D/SOHt1=4/ESC1=2 n/NUL /ESC2 vC2/ESCn/ESCu/SOHt1=2/SOH1=4(6.118) The even simpler limiting form when the contribution of /ESCuto the attitude error is negligible is given by /ESC˙ /DC2!/SOHt1=4./ESCn/ESCv/1=2(6.119) which indicates a one-half power dependence on both /ESCnand/ESCv, and a one-fourth power dependence on the update time /SOHt. This shows why it is extremely difﬁcult to improve the attitude performance by simply increasing the update frequency. To lowest order in /ESCu, the standard deviation of the gyro drift bias approaches /ESC˙ ˇ!./ESCu/ESCv/1=2(6.120) in the frequent update limit, regardless of whether or not /ESCeis zero. The fact that the attitude covariance has a “ﬂoor” determined by /ESCereveals a shortcoming of using gyros in model replacement mode. Rotational inertia prevents the spacecraft from6.4 Magnetometer Calibration 269 executing motions on the order of /ESCeon very short time scales, and a ﬁlter incorpo- rating actual spacecraft dynamics would reﬂect this fact. The extra computational effort cannot be justiﬁed if Farrenkopf’s covariance estimates indicate that missionrequirements can be met without dynamic modeling. Farrenkopf’s equations bound the expected attitude and bias errors to provide an initial estimate of attitude performance. Using the noise parameters of Example 6.2 in Eq. ( 6.119 ) gives an approximate 3/ESCbound of6:96/c157 rad for the attitude error, which is very to close the actual solution of 7:18 /c157 rad. Even though the actual model is not a single-axis model, Farrenkopf’s analysis can provide good estimatesfor various gyro parameters and sampling intervals. Converting 6:96 /c157 rad to degrees gives 4/STX10 /NUL4deg, which closely matches the roll and pitch errors of the results shown in Fig. 6.3b. 6.4 Magnetometer Calibration A paramount issue to the attitude accuracy obtained using magnetometer measure- ments is the precision of the onboard calibration. The accuracy obtained using a three-axis magnetometer (TAM) depends on a number of factors, including: biases, scale factors, and non-orthogonality corrections. Scale factors and non-orthogonality corrections occur because the individual magnetometer axes are not orthonormal, typically due to thermal gradients within the magnetometer or to mechanical stress from the spacecraft [ 1]. Magnetometer calibration is often accomplished using batch methods, where an entire set of data must be stored to determine the unknown parameters. This process is often repeated many times during the lifetime of a spacecraft in order to ensure that the best possible precisionis obtained from magnetometer measurements. The magnetometer calibration problem is easy to solve if an accurate attitude estimate is known a priori. However, this is generally not the case. Fortunately,the norms of the body-measurement and geomagnetic-reference vectors provide an attitude-independent scalar observation. For the noise-free case, these norms are identical because the attitude matrix preserves the length of a vector. Thisprocess is also known as “scalar checking” [ 22]. Unfortunately, even for the simpler magnetometer-bias determination problem, the loss function to be minimized is quartic in nature. Gambhir proposed the most common technique to overcome thisdifﬁculty, a “centering” approximation to yield a quadratic loss function that can be minimized using simple linear least squares [ 17]. Alonso and Shuster expand upon Gambhir’s approach by using a second step that employs the centered estimate asan initial value to an iterative nonlinear least squares approach. Their algorithm, called “TWOSTEP” [ 2], has been shown to perform well when other algorithms fail due to divergence problems. The algorithm presented here is Alonso and Shuster’sextension of this approach to perform a complete calibration involving biases as well as scale factors and non-orthogonality corrections [ 1]. All of these approaches are based on batch processing. A realtime approach is shown in [ 9].270 6 Filtering for Attitude Estimation and Calibration 6.4.1 Measurement Model In this section the TAM measurement model and attitude-independent observation are summarized. More details on these concepts can be found in [ 1]. The magne- tometer measurements can be modeled as BkD.I3CDtrue//NUL1.OTAtrue kRkCbtrueC/SIk/; kD1;2;:::;N (6.121) where Bkis the measurement of the magnetic ﬁeld by the magnetometer at time tk,Rkis the corresponding value of the geomagnetic ﬁeld with respect to the Earth-Centered/Earth-Fixed (ECEF) system, Atrue kis the unknown attitude matrix of the magnetometer with respect to the Earth-ﬁxed coordinates, Dtrueis an unknown fully-populated matrix of scale factors (the diagonal elements) and non- orthogonality corrections (the off-diagonal elements), Ois an orthogonal matrix (see [ 1] for a discussion on the physical connotations of this matrix), btrueis the bias vector,/SIkis the measurement noise vector that is assumed to be a zero- mean Gaussian process with covariance ˙k, andNis the total number of available measurements. The matrix Dtruecan be assumed to be symmetric without loss of generality, because any skew-symmetric contribution is equivalent to a rotation that can be absorbed into O: DtrueD2 4Dtrue 11Dtrue 12Dtrue 13 Dtrue 12Dtrue 22Dtrue 23 Dtrue 13Dtrue 23Dtrue 333 5 (6.122) The goal of the full attitude-independent calibration problem is to estimate Dtrueand btrue, because an attitude-independent method cannot observe O. An attitude-independent approach is possible by computing yk/DC1kBkk2/NULkRkk2 D/NULBT kŒ2DtrueC.Dtrue/2/c141BkC2BT k.I3CDtrue/btrue/NULkbtruek2Cvk (6.123) where the effective noise is given by vk/DC12Œ.I3CDtrue/Bk/NULbtrue/c141T/SIk/NULk/SIkk2(6.124) The effective noise is approximately Gaussian with mean /SYNk/DC1Efvkgand variance /ESC2 k/DC1E˚ v2 k/TAB /NUL/SYN2 kgiven by /SYNkD/NULtr.˙k/ (6.125a) /ESC2 kD4Œ.I3CDtrue/Bk/NULbtrue/c141T˙kŒ.I3CDtrue/Bk/NULbtrue/c141C2/NUL tr˙2 k/SOH (6.125b) ˙kDE˚ /SIk/SIT k/TAB (6.125c)6.4 Magnetometer Calibration 271 Note that the measurement variance is a function of the unknown parameters. The attitude-independent measurement in Eq. ( 6.123 ) is highly nonlinear in the calibration parameters. We can deﬁne a modiﬁed state vector so that the nonlineardependence appears in only one term. To accomplish this task the following quantities are ﬁrst deﬁned: E true/DC12DtrueC.Dtrue/2D2 4Etrue 11Etrue 12Etrue 13 Etrue 12Etrue 22Etrue 23 Etrue 13Etrue 23Etrue 333 5 (6.126a) ctrue/DC1.I3CDtrue/btrue(6.126b) Sk/DC1h B2 1kB2 2kB2 3k2B1kB2k2B1kB3k2B2kB3kiT (6.126c) Etrue/DC1/STX Etrue 11Etrue 22Etrue 33Etrue 12Etrue 13Etrue 23/ETXT(6.126d) Note thatEtrueis also symmetric. The attitude-independent measurement can now be written as ykDLkx0true/NULkb.x0true/k2Cvk (6.127) where the row vector Lkand the modiﬁed state vector x0trueare deﬁned by Lk/DC1/STX 2BT k/NULST k/ETX (6.128a) x0true/DC1/STX .ctrue/T.Etrue/T/ETXT(6.128b) Now the only nonlinear dependence on x0trueis in the termkb.x0true/k2. Equation ( 6.127 ) can be solved by iteration. We start with an initial estimate Ox0 0, which can be zero, and compute Ox0 iDP0NX kD11 /ESC2 k/NUL ykCkb.Ox0 i/NUL1/k2/NUL/SYNk/SOH LT kforiD1;2;::: (6.129) whereNis the number of observations and P0D NX kD1/ESC/NUL2 kLTkLk!/NUL1 (6.130) The iteration is terminated when Ox0 i/NULOx0 i/NUL1is less than some chosen tolerance. This computation requires the conversion from Ox0back to the variables band D[1]. The conversion of the true and estimated quantities is identical. Since Eis symmetric its singular value decomposition is given by EDUSUT(6.131)272 6 Filtering for Attitude Estimation and Calibration whereUis orthogonal and Sis diagonal with elements s1,s2, ands3. To determine Dﬁrst compute the following elements of a diagonal matrix W: wjD/NUL1Cp 1Csj;jD1;2;3 (6.132) Then the matrix Dis given by DDUWUT(6.133) The vector bis simply given by bD.I3CD//NUL1c (6.134) 6.4.2 Centered Solution The centering approximation effectively removes the nonlinear dependence of kbk2 in Eq. ( 6.127 ), making it possible to develop a solution for the calibration parameters that does not require iteration [ 17]. We deﬁne center variables , indicated by an overbar, and centered variables , indicated by a breve, as follows: N/ESC2/DC1 NX kD1/ESC/NUL2 k!/NUL1 (6.135a) NL/DC1N/ESC2NX kD1/ESC/NUL2 kLk;MLk/DC1Lk/NULNL (6.135b) Ny/DC1N/ESC2NX kD1/ESC/NUL2 kyk;Myk/DC1yk/NULNy (6.135c) Nv/DC1N/ESC2NX kD1/ESC/NUL2 kvk;Mvk/DC1vk/NULNv (6.135d) N/SYN/DC1N/ESC2NX kD1/ESC/NUL2 k/SYNk;M/SYNk/DC1/SYNk/NULN/SYN (6.135e) The center variables and centered variables have the measurement models NyDNLx0true/NULkb.x0true/k2CNv (6.136a) MykDMLkx0trueCMvk (6.136b)6.4 Magnetometer Calibration 273 Note that Eq. ( 6.136b ) is now linear in x0true, so linear least squares can be employed. The centering process has introduced correlations among the noise terms Mvk,5but these are generally ignored in practice, giving the centered estimate, OMx0and its approximate covariance, MP0,a s[ 2] MP0D NX kD1/ESC/NUL2 kMLT kMLk!/NUL1 (6.137a) OMx0DMP0NX kD1/ESC/NUL2 k.Myk/NULM/SYNk/MLT k (6.137b) Since the centered solution is linear, a sequential formulation can be derived to provide realtime estimates. First, the sequential formulas for the averaged quantitiesare given by NL kC1D1 /ESC2 kC1CN/ESC2 k/NUL /ESC2 kC1NLkCN/ESC2 kLkC1/SOH (6.138a) NykC1D1 /ESC2 kC1CN/ESC2 k/NUL /ESC2 kC1NykCN/ESC2 kykC1/SOH (6.138b) N/SYNkC1D1 /ESC2 kC1CN/ESC2 k/NUL /ESC2 kC1N/SYNkCN/ESC2 k/SYNkC1/SOH (6.138c) where N/ESC2 kC1D/NUL N/ESC/NUL2 kC/ESC/NUL2 kC1/SOH/NUL1(6.139) Next, the following centered variables are deﬁned: MLkC1/DC1LkC1/NULNLkC1 (6.140a) MykC1/DC1ykC1/NULNykC1 (6.140b) M/SYNkC1/DC1/SYNkC1/NULN/SYNkC1 (6.140c) Finally, the sequential formulas for the centered estimate of OMx0and covarianceMP0 are given by KkC1/DC1MP0 kMLT kC1/DLE MLkC1MP0 kMLT kC1C/ESC2 kC1/DC1/NUL1 (6.141a) OMx0 kC1DOMx0 kCKkC1/DLE MykC1/NULM/SYNkC1/NULMLkC1OMx0 k/DC1 (6.141b) 5Note, in particular, thatPN kD1/ESC/NUL2 kMvkD0.274 6 Filtering for Attitude Estimation and Calibration MP0 kC1D.I9/NULKkC1MLkC1/MP0 k (6.141c) Note that only an inverse of a scalar quantity is required in this process, which can be initialized using a small batch of data. Also, there is an approach for determining /ESC2 kC1that uses the previous estimate in Eq. ( 6.125b ). 6.4.3 The TWOSTEP Algorithm The second step of the TWOSTEP algorithm uses a nonlinear maximum likelihood minimization to ﬁnd the optimal estimate of x0true. The ﬁrst step computes the centered solution to initialize the nonlinear least squares iteration process. The data-dependent part of the negative log-likelihood function to be minimized in the second step is: J.x 0true/D1 2NX kD1/DC41 /ESC2 k.yk/NULLkx0trueCkb.x0true/k2/NUL/SYNk/2Clog/ESC2 k/NAK (6.142) The partial derivative of h.x0//DC1Lkx0/NULkb.x0/k2with respect to x0is required for the nonlinear least squares iterations. The partial of Lkx0is simply given by LT k. The partial derivatives of kb.x0/k2are given by @kb.x0/k2 @cmD2Œ.I3CE//NUL1c/c141m (6.143a) @kb.x0/k2 @EmnD/NUL.2/NULımn/Œ.I3CE//NUL1c/c141mŒ.I3CE//NUL1c/c141n (6.143b) whereŒ.I3CE//NUL1c/c141mis themth element of .I3CE//NUL1c. As mentioned previously, the least squares solution process typically ignores the nonlinear dependence of /ESC2 k on the unknown parameters. Once estimatesOcandOEforctrueandEtrueare found, the estimates ObandODfor btrueandDtruecan be determined using Eqs. ( 6.133 ) and ( 6.134 ). Deﬁne Ox/DC1h ObTODTiT (6.144a) OD/DC1/STXOD11OD22OD33OD12OD13OD23/ETXT(6.144b) The covariance associated with Ox, denotedP, must be computed from P0,t h e covariance ofOx0, which is given by Eqs. ( 12.98 ) and ( 12.99 )a st h ei n v e r s eo ft h e Fisher information matrix. The conversion to Pis computed by PD@.Ob;OD/ @.Oc;OE/P0" @.Ob;OD/ @.Oc;OE/#T (6.145)6.4 Magnetometer Calibration 275 Note that in actuality the true variables should be used instead of the estimated ones in Eq. ( 6.145 ). However, since the true variables are unknown the estimated ones are used instead. The partials can be computed using @.Ob;OD/ @.Oc;OE/D" @.Oc;OE/ @.Ob;OD/#/NUL1 D/DC4I3CODMcD.Ob/ 06/STX3MED.OD//NAK/NUL1 (6.146a) McD.Ob/D2 64Ob100Ob2Ob30 0Ob20Ob10Ob3 00Ob30Ob1Ob23 75 (6.146b) MED.OD/D2I6C2 666666642OD 11002OD122OD130 02OD2202OD1202OD23 00 2OD3302OD132OD23 OD12OD120OD11COD22OD23OD13 OD130OD13OD23OD11COD33OD12 0OD23OD23OD13OD12OD22COD333 77777775 (6.146c) A strategy to handle the dependence of /ESC 2 kon the parameters is to ﬁrst assume btrue andDtrueare zero to compute /ESC2 kand employ the nonlinear least squares iteration process. Then use the estimates of btrueandDtrueto determine a new /ESC2 kand employ another nonlinear least squares iteration process. This reﬁnement strategy continuesuntil the estimates no longer change. In many cases this reﬁnement strategy needs only one iteration. Example 6.3. In this example, results of the TWOSTEP and centered formulations are shown using simulated data. The simulated spacecraft is modeled after the TRMM spacecraft. This is an Earth-pointing spacecraft (rotating about its y-axis) in low-Earth orbit with an inclination of 35ı[3]. The geomagnetic ﬁeld is simulated using a10th-order International Geomagnetic Reference Field (IGRF) model [ 20]. The magnetometer-body and geomagnetic-reference vectors for the simulated runseach have a magnitude of about 50 micro-Tesla ( /c157T). The measurement noise is assumed to be white and Gaussian, and the covariance is taken to be isotropic with a standard deviation of 0.05 /c157T. The measurements are sampled every 10 s over an 8-h span. The true values for the bias band elements of the Dmatrix are shown in Table 6.4. Large values for the biases are used to test the robustness of the centered and TWOSTEP algorithms. One thousand runs have been executed, which provide a Monte Carlo simulation. Shown in Table 6.4are the averaged batch solutions given by the TWOSTEP and centered algorithms, each with their computed 3/ESCbounds. Both the centered and TWOSTEP algorithms do a good job at estimating all parameters in the mean sense, but the centered algorithm has larger variations than the TWOSTEP algorithm.276 6 Filtering for Attitude Estimation and Calibration Table 6.4 Results using simulated magnetic ﬁeld dataParameter Truth Centered TWOSTEP b1 5/c157T4:9972 ˙0:3373 4:9983 ˙0:0445 b2 3/c157T3:0157 ˙0:2549 2:9841 ˙0:0525 b3 6/c157T5:9955 ˙0:5447 5:9972 ˙0:0464 D110:05 0:0500 ˙0:0035 0:0500 ˙0:0002 D220:10 0:1001 ˙0:0023 0:0994 ˙0:0020 D330:05 0:0500 ˙0:0094 0:0500 ˙0:0003 D120:05 0:0499 ˙0:0027 0:0499 ˙0:0010 D130:05 0:0499 ˙0:0054 0:0499 ˙0:0002 D230:05 0:0499 ˙0:0045 0:0499 ˙0:0010 0100 200 300 400 500 600 700 800 900 10002.533.544.555.566.57Bias Estimates ( mT) Bias Estimates ( mT) Run Number0100 200 300 400 500 600 700 800 900 10002.533.544.555.566.57 Run Numberab Fig. 6.5 (a)C e n t e r e da n d( b) TWOSTEP bias estimates This can also be seen in Fig. 6.5, which plots the bias estimates for each Monte Carlo run. Results using colored noise, which is more realistic, can be found in [ 1]. 6.4.4 Extended Kalman Filter Approach This section presents an EKF to determine the calibration parameters in real time [ 9]. An advantage of this formulation over the sequential centered approach is that it computes ObandODdirectly without a conversion from OcandOE. Since the parameters to be estimated are constant, the state dynamic model is POx.t/D0, where Oxis the state vector deﬁned by Eq. ( 6.144 ). The measurement model of Eq. ( 6.123 ) is written asykDhk.xtrue/Cvk, where using Eq. ( 6.126 )g i v e s hk.xtrue/D/NULST kEtrue.Dtrue/C2BT k.I3CDtrue/btrue/NULkbtruek2(6.147) Since no process noise appears in the state model, the updated quantities (state and covariance) are given by their respective propagated quantities. The EKF equations, which can be found in Chap. 12, then reduce to6.4 Magnetometer Calibration 277 OxkC1DOxkCKkŒykC1/NULhkC1.Oxk//c141 (6.148a) PkC1DŒI9/NULKkHkC1.Oxk//c141Pk (6.148b) KkDPkHT kC1.Oxk//STX HkC1.Oxk/PkHT kC1.Oxk/C/ESC2 kC1.Oxk//ETX/NUL1(6.148c) wherePis the covariance of the estimated parameters for btrueandDtrue. The state dependence of the measurement variance is shown through Eq. ( 6.125b ). The1/STX9 measurement sensitivity matrix H.x/is given by H.x//DC1@h.x/ @xD/STX 2BT.I3CD//NUL2bT/NULSTMED.OD/C2J/ETX (6.149) where Sis deﬁned by Eq. ( 6.126c ),MED.OD/by Eq. ( 6.146c ), and J/DC1/STX B1b1B2b2B3b3B1b2CB2b1B1b3CB3b1B2b3CB3b2/ETX (6.150) The sensitivity matrix H.Ox/in the EKF evaluates H.x/at its current estimate, and the notations hkC1.Oxk/,HkC1.Oxk/, and/ESC2 kC1.Oxk/denote an evaluation at the kC1 time-step measurement using BkC1and at thektime-step estimate using Oxk. 6.4.5 TRACE Spacecraft Results In this section, EKF results using real data from the Transition Region And Coronal Explorer (TRACE) spacecraft are shown. TRACE is in a Sun-synchronous low-Earth orbit. The data collected for the spacecraft is given during an inertial pointing mode. The errors associated with the geomagnetic ﬁeld model are typically spatially correlated and may be non-Gaussian in nature [ 6]. This violates the assumptions for all the estimators shown in this text. We still assume that the measurement noise is white and Gaussian, but the standard deviation is now increased to a value of 0.3 /c157T, which bounds the errors in a practical sense. The measurements are sampled every 3 s over a 6-h span. The EKF initializes every component of the state vector to zero at time tD0. The initial covariance matrix is diagonal, given by P 0Dblkdiag.ŒI30:0001I6/c141/./c157T/2(6.151) where blkdiag denotes a block diagonal matrix of appropriate dimension. Figure 6.6a shows EKF estimates for the bias vector. Figure 6.6bs h o w st h e 3/ESC bounds for the bias estimates. Note that the bias estimates with the larger 3/ESC bounds have greater variability, which is due to the relative observability between parameters (the second bias is the least observable parameter in this case). Similar results are obtained for the Dmatrix parameters.278 6 Filtering for Attitude Estimation and Calibration 0 1 2 3 4 5 6−1−0.8−0.6−0.4−0.200.20.4 Time (Hr)0 1 2 3 4 5 600.10.20.30.40.50.60.70.80.91 Time (Hr)b1b2b33s Bounds (mT)Bias Estimates ( mT)b1b2b3ab Fig. 6.6 TRACE bias estimates and 3/ESCbounds. ( a) EKF bias estimates. ( b)E K F3/ESCbounds 0 1 2 3 4 5 6−1−0.500.51 0 1 2 3 4 5 6−0.5−0.2500.250.5 Time (Hr)Uncalibrated ( mT) Calibrated ( mT)Fig. 6.7 Norm residual using real TRACE data An investigation of the residuals between the norm of the estimated vector, using the uncalibrated and calibrated body vectors, and the geomagnetic-reference vector is useful to check the consistency of the results. A plot of these residuals is shownin Fig. 6.7. A spectrum analysis shows the presence of sinusoidal variations with periods equivalent to the orbital period ( /EM90 min) and higher-order harmonics (see [ 6] for a model of this process). Clearly, the uncalibrated results have higher residuals than the calibrated results. This shows the power of using an onboard calibration algorithm that can be executed in real time. Problems 6.1. Derive the relations in Eq. ( 6.33). 6.2. Derive the measurement sensitivity matrix in Eq. ( 6.66). 6.3. Prove that Eq. ( 6.79) is a good approximation to Eq. ( 6.78)i f/USis very close toAtruer.Problems 279 Table 6.5 Orbital elements for GPS satellites GPS Orbital elements 1aD26;560 km,eD2:6221 /STX10/NUL3,M0D/NUL82:277 deg,iD55:037 deg ˝0D46:492 deg, P˝D/NUL4:4332 /STX10/NUL7deg/s,!D24:008 deg 2aD26;561 km,eD1:2955 /STX10/NUL2,M0D/NUL38:066 deg,iD53:808 deg ˝0D44:973 deg, P˝D/NUL4:5511 /STX10/NUL7deg/s,!D/NUL144:31 deg 3aD26;561 km,eD1:6708 /STX10/NUL2,M0D/NUL27:429 deg,iD53:692 deg ˝0D/NUL22:198 deg, P˝D/NUL4:8392 /STX10/NUL7deg/s,!D77:836 deg 4aD26;560 km,eD1:0645 /STX10/NUL2,M0D154:02 deg,iD53:751 deg ˝0D45:899 deg, P˝D/NUL4:5708 /STX10/NUL7deg/s,!D61:387 deg 5aD26;561 km,eD3:5214 /STX10/NUL3,M0D89:435 deg,iD54:277 deg ˝0D106:11 deg, P˝D/NUL4:6624 /STX10/NUL7deg/s,!D21:164 deg 6aD26;560 km,eD8:3880 /STX10/NUL3,M0D78:699 deg,iD54:067 deg ˝0D/NUL17:551 deg, P˝D/NUL4:7738 /STX10/NUL7deg/s,!D/NUL10:890 deg 6.4. The state transition matrix obeys the following relationships: ˚.t;t/D0 d dt˚.t;/FS/DF.t/˚.t;/FS/ Prove that the discrete error-state transition matrix in Eq. ( 6.83) obeys these relationships. 6.5. Prove that˚11deﬁned by Eq. ( 6.83b ) is an orthogonal matrix. 6.6. Reproduce the simulation results of Example 6.2using Murrell’s approach. 6.7. In this problem you will develop an EKF program for attitude estimation using GPS phase difference measurements discussed in Sect. 5.9. First, propagate six GPS satellites using the algorithm in Table 4.1with orbital elements given in Table 6.5 and a time of applicability given by taD61;440 s. Next, create the GPS receiver spacecraft orbit in GCI coordinates using the algorithm in Table 10.1 with the following orbital elements: aD6777:3 km,eD1:584/STX10/NUL4,M0D93:4312ı, iD34:9654ı,˝D346:4609ı, and!D266:6234ı. Convert this GCI-based orbit into ECEF coordinates using Eq. ( 2.67) with an epoch of January 5, 2014 at 17:03:47. Use an interval of 0.1 s with a total run time of 600 s for both the GPSsatellites and the receiver spacecraft. Then, create sightline vectors using Eq. ( 4.23). Assuming an initial quaternion of q true 0Dp 2=2/STXŒ 0101 /c141T, propagate the attitude using an angular velocity of !.t/D/EM=180/STXŒ0 0 0:1/c141Trad/s for all time. Create synthetic phase difference measurements using the following equation: zijDbT iA.qtrue/sjCvij280 6 Filtering for Attitude Estimation and Calibration wherevijis a zero-mean Gaussian noise process with standard deviation of 0:026 cm. The three baseline vectors are given by b1D/STX 10000/ETXTcm b2D/STX 01000/ETXTcm b3D/STX 1001000/ETXTcm Create synthetic gyro measurements using the model shown in Eq. ( 4.54) withSD 0,/ESCuDp 10/STX10/NUL10rad/s3=2, and/ESCvDp 10/STX10/NUL7rad/s1=2. Sample the gyro measurements using an interval of 0.1 s. The initial bias for each axis is given by 0.1 deg/h. The initial covariance for the attitude error is set to .1=3/2deg2, and the initial covariance for the gyro drift is set to 12(deg/h)2. Converting these quantities to (rad/s)2gives the following initial attitude and gyro drift covariances for each axis:Pa 0D0:3385/STX10/NUL4rad2andPb 0D0:2350/STX10/NUL10.rad/s/2, so that the initial covariance is given by P0Ddiag/STX Pa 0Pa 0Pa 0Pb 0Pb 0Pb 0/ETX Use the discrete-time covariance propagation in Eq. ( 12.132 ) with/BELkDI6, and˚k andQkgiven by Eqs. ( 6.83) and ( 6.93), respectively. The initial attitude condition in the EKF is given by the true quaternion. The initial gyro bias conditions in theEKF are set to zero. Plot the attitude estimate errors along with their respective 3/ESC bounds and gyro bias estimates obtained from the EKF simulation results. 6.8. Another linearization approach for the MEKF involves deﬁning the attitude errors in inertial space by using [ 16] q trueDOq˝ıq.ı#/ Show that the linearized F.t/ andG.t/ matrices for the mission mode Kalman ﬁlter are given by F.t/D/DC403/STX3/NULAT.Oq/ 03/STX303/STX3/NAK ;G . t /D/DC4/NULAT.Oq/03/STX3 03/STX3I3/NAK Derive the new Hk.Ox/NUL k/matrix and quaternion update equation for this approach. Redo Example 6.2using this new ﬁlter and compare the results to the standard MEKF given in Table. Note that Eq. ( 6.11) is used to compute the attitude errors for both ﬁlters. So the attitude portion of the error-covariance for the inertial-space MEKF must be rotated from inertial space to body space for this comparison. 6.9. Derive the discrete error-state transition matrix from the matrix F.t/ given in Problem 6.8. Also, derive the discrete-time covariance using Eq. ( 6.84) from your derived discrete error-state transition matrix and the matrix G.t/ in Problem 6.8.Problems 281 6.10. In this exercise you will use the MEKF to estimate the attitude from TAM and Sun sensors as well as gyro measurements. The ﬁrst step involves determining the position of the spacecraft. Assume the following orbital elements: aD 6777:2745 km,eD0:0001584 ,M0D93:4312ı,iD34:9654ı,˝D346:4609ı, and!D266:6234ı. The epoch is March 31, 2011 at 02:32:41. Determine the position and velocity of the spacecraft using Table 10.1 with a time interval of 10 s and a total run time of 8 h. Next, compute the reference magnetic ﬁeld using the dipole model in Eq. ( 11.5) and the reference Sun vector and Sun availability using the methods shown in Sect. 11.3. The true initial attitude is given by Eq. ( 2.79). The constant angular velocity vector is !DŒ0/NUL1:13156/STX10/NUL30/c141Trad/s. Simulate TAM sensor noise using a Gaussian white-noise process with a mean of zero and a standard deviation of 50 nT per axis. Here is assumed that one Sun sensoris used and its axes are aligned with the body axes of the spacecraft. The Sun sensor noise is also modeled by a Gaussian white-noise process with a mean of zero and a standard deviation of 0.05 ıper axis. Simulate gyro measurements using Eqs. ( 4.31) and ( 4.32) of Sect. 4.7.1 , with/ESCuDp 10/STX10/NUL10rad/s3=2, and /ESCvDp 10/STX10/NUL7rad/s1=2. The initial bias for each axis is given by 0.1 deg/h. The initial covariance for the attitude error is set to .1=3/2deg2per axis, and the initial covariance for the gyro drift is set to 12(deg/h)2per axis. Converting these quantities to radians and seconds gives the following initial attitude and gyro drift covariances for each axis: Pa 0D0:3385/STX10/NUL4rad2andPb 0D0:2350/STX10/NUL10.rad/s/2, so that the initial covariance is given by P0Ddiag/STX Pa 0Pa 0Pa 0Pb 0Pb 0Pb 0/ETX Use the discrete-time covariance propagation in Eq. ( 12.132 ) with/BELkDI6, and˚kandQkgiven by Eqs. ( 6.83) and ( 6.93), respectively. All sensors are sampled at 10-s intervals. Run the MEKF using the TAM, available Sun and gyro measurements. Set the initial attitude estimate to the true quaternion and set all initial bias estimates to zero. Plot the attitude errors along with their respective 3/ESC bounds, as well as the estimated gyro biases. 6.11. Perform the following quaternion multiplication in Eq. ( 6.33): 1 2/DC4ı! 0/NAK ˝/DC4ıq1W3 ıq4/NAK and show the exact nonlinear differential equations for ıPq1W3andıPq4. Next, consider the following error-MRP: ıpDıq1W3 1Cıq4 Take the time derivative of ıp, substitute in the quantities for ıq1W3,ıq4, and their respective derivatives, in terms of ıp, to develop the exact nonlinear differential282 6 Filtering for Attitude Estimation and Calibration equation forıPp. Next using the approximation ıp/EMı#=4, show that the ﬁrst-order equation forıP#is given by Eq. ( 6.35). 6.12. In this exercise you will develop an MEKF based on the MRPs. Here it is assumed that MRP measurements are given using the following discrete-time measurement model: pDvp˝ptrueD/NUL 1/NULkptruek2/SOH vpC/NUL 1/NULkvpk2/SOH ptrue/NUL2vp/STXptrue 1Ckptruek2kvpk2/NUL2vp/SOHptrue where vpis a zero-mean Gaussian white-noise process with covariance Rp. Assuming that the signal-to-noise ratio is large, show that this equation can be approximated by p/EMptrueCNRvp where NR/DC1/NUL 1/NULkptruek2/SOH I3C2Œptrue/STX/c141C2.ptrue/.ptrue/T Therefore, the covariance of p, denoted by R, is given by RDNRRpNRT.T h e multiplicative error-MRP is given by ıpDptrue˝Op/NUL1. The small angle approxi- mation is given by ıp/EMı#=4, where the kinematic equation for ı#is given by Eq. (6.35). The mission mode multiplicative MRP propagation equations are given in Table 6.3, replacing the quaternion kinematics with the MRP kinematics, given by Eq. ( 3.24). Derive the multiplicative MRP update equation using a state vector given by/SOHOxC k/DC1ŒıO#CT k/SOHOˇCT k/c141Tand the MRP measurement model shown above. Next, program the MEKF MRP equations to estimate the attitude and gyro biases from MRP measurements. The initial condition for the true MRP is given byptrue 0DŒ0:3 0:1/NUL0:5/c141Tand the true angular rate for all time is given by !true.t/DŒ/NUL0:2 0:2/NUL0:192/c141Tdeg/s. Generate synthetic MRP measurements using a covariance of RpD.20=3;600//STX./EM=180/I 3and take MRP samples at 5-s intervals. Simulate gyro measurements using Eqs. ( 4.31) and ( 4.32) of Sect. 4.7.1 , with/ESCuDp 10/STX10/NUL10rad/s3=2, and/ESCvDp 10/STX10/NUL7rad/s1=2. The initial bias is given byˇtrue 0DŒ/NUL12/NUL3/c141Tdeg/h. Sample the gyro measurements at 0.5-s intervals. Set the initial state estimate to zeros for both the MRPs and gyro biases.Set the initial covariance matrix to P 0DdiagŒPa 0Pa 0Pa 0Pb 0Pb 0Pb 0/c141 withPa 0D16/STX0:175 rad2andPb 0D0:005 (rad/s)2. Use the discrete-time covariance propagation in Eq. ( 12.132 ) with/BELkDI6, and˚kandQkgiven byReferences 283 Eqs. ( 6.83) and ( 6.93), respectively. Use a total simulation run time of 200 min. Plot the attitude errors along with their respective 3/ESCbounds, as well as the estimated gyro biases. 6.13. This problem has two parts: a) Derive Eq. ( 6.99b ). b) Derive the Qmatrix in Eq. ( 6.105 ). 6.14. Prove Eq. ( 6.106 ) by mathematical induction. 6.15. Show that Eqs. ( 6.108 ) and ( 6.110 ) satisfy Eqs. ( 6.107 ). 6.16. Derive the relations in Eqs. ( 6.113 ) and ( 6.114 ). 6.17. Show that the dynamic model of Eq. ( 6.116 ) leads to the covariance propaga- tion and update given by ( 6.115 ). 6.18. Derive the asymptotic limits in Eqs. ( 6.117 )–(6.120 ). 6.19. Redo the simulation shown in Example 6.3. Pick various truth values for the biases andDijcalibration parameters as well as various noise levels to assess the robustness of the centered and TWOSTEP algorithms. References Alonso, R., Shuster, M.D.: Complete linear attitude-independent magnetometer calibration. J. Astronaut. Sci. 50(4), 477–490 (2002) Alonso, R., Shuster, M.D.: TWOSTEP: A fast robust algorithm for attitude-independent magnetometer-bias determination. J. Astronaut. Sci. 50(4), 433–451 (2002) Andrews, S.F., Bilanow, S.: Recent ﬂight results of the TRMM Kalman ﬁlter. In: AIAA Guidance, Navigation and Control Conference. Monterey (2002). AIAA 2002-5047 Andrews, S.F., Morgenstern, W.M.: Design, implementation, testing, and ﬂight results of the TRMM Kalman ﬁlter. In: AIAA Guidance, Navigation and Control Conference. Boston(1998). AIAA 1998-4509 Carmi, A., Oshman, Y .: On the covariance singularity of quaternion estimators. In: AIAA Guidance, Navigation and Control Conference. Hilton Head (2007). AIAA 2007-6814 Crassidis, J.L., Andrews, S.F., Markley, F.L., Ha, K.: Contingency designs for attitude deter- mination of TRMM. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium, pp. 419–433. NASA-Goddard Space Flight Center, Greenbelt (1995) Crassidis, J.L., Cheng, Y ., Nebelecky, C.K., Fosbury, A.M.: Decentralized attitude estimation using a quaternion covariance intersection approach. J. Astronaut. Sci. 57(1/2), 113–128 (2009) Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press, Boca Raton (2012) Crassidis, J.L., Lai, K.L., Harman, R.R.: Real-time attitude-independent three-axis magne- tometer calibration. J. Guid. Contr. Dynam. 28(1), 115–120 (2005) Crassidis, J.L., Markley, F.L.: Attitude estimation using modiﬁed Rodrigues parameters. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium, pp. 71–83. NASA-Goddard Space Flight Center, Greenbelt (1996) Crassidis, J.L., Markley, F.L.: Unscented ﬁltering for spacecraft attitude estimation. J. Guid. Contr. Dynam. 26(4), 536–542 (2003)284 6 Filtering for Attitude Estimation and Calibration Crassidis, J.L., Markley, F.L., Cheng, Y .: Survey of nonlinear attitude estimation methods. J. Guid. Contr. Dynam. 30(1), 12–28 (2007) Farrell, J.L.: Attitude determination by Kalman ﬁltering. Contractor Report NASA-CR-598, NASA Goddard Space Flight Center, Washington, DC (1964) Farrell, J.L.: Attitude determination by Kalman ﬁltering. Automatica 6, 419–430 (1970) Farrenkopf, R.L.: Analytic steady-state accuracy solutions for two common spacecraft attitude estimators. J. Guid. Contr. 1(4), 282–284 (1978) Gai, E., Daly, K., Harrison, J., Lemos, L.: Star-sensor-based attiude/attitude rate estimator. J. Guid. Contr. Dynam. 8(5), 560–565 (1985) Gambhir, B.: Determination of magnetometer biases using Module RESIDG. Tech. Rep. 3000- 32700-01TN, Computer Sciences Corporation (1975) Idan, M.: Estimation of Rodrigues parameters from vector observations. IEEE Trans. Aero. Electron. Syst. 32(2), 578–586 (1996) Karlgaard, C.D., Schaub, H.: Nonsingular attitude ﬁltering using modiﬁed Rodrigues parame- ters. J. Astronaut. Sci. 57(4), 777–791 (2010) Langel, R.A.: The main ﬁeld. In: Jacobs, J.A. (ed.) Geomagnetism, pp. 249–512. Academic Press, Orlando (1987) Lefferts, E.J., Markley, F.L., Shuster, M.D.: Kalman ﬁltering for spacecraft attitude estimation. J. Guid. Contr. Dynam. 5(5), 417–429 (1982) Lerner, G.M.: Three-axis attitude determination. In: Wertz, J.R. (ed.) Spacecraft Attitude Determination and Control, chap. 12. Kluwer Academic, Dordrecht (1978) Markley, F.L.: Attitude error representations for Kalman ﬁltering. J. Guid. Contr. Dynam. 26(2), 311–317 (2003) Markley, F.L.: Attitude estimation or quaternion estimation? J. Astronaut. Sci. 52(1 & 2), 221–238 (2004) Markley, F.L.: Lessons learned. J. Astronaut. Sci. 57(1 & 2), 3–29 (2009) Markley, F.L., Reynolds, R.G.: Analytic steady-state accuracy of a spacecraft attitude estimator. J. Guid. Contr. Dynam. 23(6), 1065–1067 (2000) Murrell, J.W.: Precision attitude determination for multimission spacecraft. In: Proceedings of the AIAA Guidance, Navigation, and Control Conference, pp. 70–87. Palo Alto (1978) Pandiyan, R., Solaiappan, A., Malik, N.: A one step batch ﬁlter for estimating gyroscope calibration parameters using star vectors. In: AIAA/AAS Astrodynamics Specialist Conferenceand Exhibit. Providence (2004). AIAA 04-4858 Pauling, D.C., Jackson, D.B., Brown, C.D.: SPARS algorithms and simulation results. In: Proceedings of the Symposium on Spacecraft Attitude Estimation, vol. 1, pp. 293–317.Aerospace Corporation, El Segundo (1969) Pittelkau, M.E.: Kalman ﬁltering for spacecraft system alignment calibration. J. Guid. Contr. Dynam. 24(6) (2001) Pittelkau, M.E.: An analysis of the quaternion attitude determination ﬁlter. J. Astronaut. Sci. 51(1) (2003) Psiaki, M.L., Klatt, E.M., Kintner Jr., P.M., Powell, S.P.: Attitude estimation for a ﬂexible spacecraft in unstable spin. J. Guid. Contr. Dynam. 25(1), 88–95 (2002) Psiaki, M.L., Theiler, J., Bloch, J., Ryan, S., Dill, R.W., Warner, R.E.: ALEXIS spacecraft attitude reconstruction with thermal/ﬂexible motions due to launch damage. J. Guid. Contr.Dynam. 20(5), 1033–1041 (1997) Reynolds, R.G.: Asymptotically optimal attitude ﬁltering with guaranteed covergence. J. Guid. Contr. Dynam. 31(1), 114–122 (2008) Shuster, M.D.: Kalman ﬁltering of spacecraft attitude and the QUEST model. J. Astronaut. Sci.38(3), 377–393 (1990) Shuster, M.D.: Constraint in attitude estimation part I: Constrained estimation. J. Astronaut. Sci.51(1), 51–74 (2003) Shuster, M.D.: Constraint in attitude estimation part II: Unconstrained estimation. J. Astronaut. Sci.51(1), 75–101 (2003)References 285 Shuster, M.D., Pitone, D.S.: Batch estimation of spacecraft sensor alignments, II. Absolute alignment estimation. J. Astronaut. Sci. 39(4), 547–571 (1991) Toda, N.F., Heiss, J.L., Schlee, F.H.: SPARS: The system, algorithms, and test results. In: Proceedings of the Symposium on Spacecraft Attitude Estimation, vol. 1, pp. 361–370.Aerospace Corporation, El Segundo (1969) van Loan, C.F.: Computing integrals involving the matrix exponential. IEEE Trans. Automat. Contr. AC-23 (3), 396–404 (1978) Ward, D.K., Davis, G.T., O’Donnell Jr., J.R.: The Microwave Anisotropy Probe guidance, nav- igation and control hardware suite. In: AIAA Guidance, Navigation and Control Conference.Monterey (2002). AIAA 2002-4579 Zanetti, R., Majji, M., Bishop, R.H., Mortari, D.: Norm-constrained Kalman ﬁltering. J. Guid. Contr. Dynam. 32(5), 1458–1465 (2009)Chapter 7 Attitude Control 7.1 Introduction Spacecraft attitude control is essential to meet mission pointing requirements, such as required science modes and thruster pointing requirements for orbital maneuvers. Early spacecraft mission designs used passive spin stabilization to hold one axisrelatively ﬁxed by spinning the spacecraft around that axis, usually the axis of maximum moment of inertia. Spin stabilization was mostly used due to the limited control actuation and lack of sophisticated computer technology to implementcomplex control laws. Spin-stabilized spacecraft are very stable, but they have to be sensitively balanced; every component has to be designed and located with spacecraft balance in mind. This can be extremely difﬁcult to accomplish to therequired accuracy. In most cases the last few weights are added and adjusted only after actual ﬂight hardware is delivered and installed, and the spacecraft is experimentally spin tested. Allowances must also be made for everything onboardthat can move during ﬂight. In the modern era advancements in sensors, actuators, and computer processors allow for three-axis stabilized spacecraft designs, although spinners are still used tothis day for many missions. Attitude control law theory also has been extensively studied and advanced, allowing for guaranteed control stability even with nonlinear attitude dynamics. The control of spacecraft for large angle slewing maneuversposes a difﬁcult problem, however. These difﬁculties include the highly nonlinear characteristics of the governing equations, control rate, and saturation constraints and limits, and incomplete state knowledge due to sensor failure or omission.The control of spacecraft with large angle slews can be accomplished by either open- loop or closed-loop schemes. Open-loop schemes usually require a pre-determined pointing maneuver and are typically determined using optimal control techniques,which involve the solution of a two-point boundary value problem (e.g. the time optimal maneuver problem [ 37]). Open-loop schemes are sensitive to spacecraft F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _7, © Springer Science+Business Media New York 2014287288 7 Attitude Control parameter uncertainties and unexpected disturbances [ 47]. Closed-loop systems can account for parameter uncertainties and disturbances, and thus provide a more robust design methodology. For many years now, much effort has been devoted to the closed-loop design of large angle slews. In [ 50] a number of simple control schemes are derived using quaternion and angular velocity (rate) feedback. Asymptotic stability is shownby using a Lyapunov function analysis for all cases. Reference [ 45] expands upon these formulations by deriving simple control laws based on both a Gibbs vector parameterization and a modiﬁed Rodrigues parameterization, each with ratefeedback. Lyapunov functions are shown for all the controllers developed in [ 45] as well. Other full state feedback techniques have been developed that are based on variable-structure (sliding-mode) control, which uses a feedback linearizingtechnique and an additional term aimed at dealing with model uncertainty [ 41]. This type of control has been successfully applied for large angle maneuvers using a Gibbs vector parameterization [ 18], a quaternion parameterization [ 15,46], and a modiﬁed Rodrigues parameterization [ 13]. Another robust control scheme using a nonlinear H 1control methodology has been developed in [ 22]. This scheme involves the solution of Hamilton-Jacobi-Isaacs inequalities, which essentiallydetermines feedback gains for the full state feedback control problem so that the spacecraft is stabilized in the presence of uncertainties and disturbances. Another class of controllers involves adaptive techniques, which update the modelduring operation based on measured performances (e.g. see [ 41]). An adaptive scheme which estimates external torques by tracking a Lyapunov function has been developed by [ 35]. This method has been shown to be very robust in the presence of spacecraft modeling errors and disturbances. The aforementioned techniques all utilize full state knowledge (i.e. attitude and rate feedback). The problem of controlling a spacecraft without full state feedbackis more complex. The basic approaches used to solve this problem can be divided into methods which estimate the unmeasured states using a ﬁlter algorithm and methods which develop control laws directly from output feedback. Filteringmethods of Chap. 6, such as the extended Kalman ﬁlter, have been successfully applied on numerous spacecraft systems without the use of rate-integrating gyro measurements (e.g. see [ 9,11,14]). An advantage of these methods is that the attitude may be estimated by using only one set of vector attitude observations (such as magnetometer observations). However, these methods are usually much less accurate than methods that use gyro measurements. A more direct technique hasbeen developed in [ 25], which solves the attitude problem without rate knowledge. This method is based on a passivity approach, which replaces the rate feedback by a nonlinear ﬁlter of the quaternion. A model-based ﬁlter reconstructing the angularvelocity is not needed in this case. This chapter presents the fundamental concepts for modern spacecraft control designs. First, attitude control laws are developed using both external torquesand reaction wheels for both regulation and tracking cases. An example from a real mission, the Wilkinson Microwave Anisotropy Probe (WMAP), is shown for attitude tracking. Next, attitude thruster control is discussed using pulse-width7.2 Attitude Control: Regulation Case 289 pulse-frequency modulation. This is followed by attitude control using magnetic torquers for both detumbling and momentum dumping. Then, the effects of noise on the control systems are discussed and mitigation approaches are shown. Finally,an actual attitude control system design, based on the SAMPEX spacecraft, is shown. This spacecraft design is useful to show the combined effects of using ﬁlters shown in Chap. 6with linear controllers to meet mission designs. 7.2 Attitude Control: Regulation Case Regulation control is deﬁned as bringing the attitude to some ﬁxed location (usually the identity quaternion) and the angular velocity to zero. The quaternion attitude kinematics and Euler’s rotational equation of motion are given in Chap. 3(removing superscripts here for brevity): PqD1 2/EOT.q/!D1 2˝.!/q (7.1a) JP!D/NULŒ!/STX/c141J!CL (7.1b) The goal is to drive the actual quaternion to some commanded and constant quaternion denoted by qc. This requires that the angular velocity approach zero. The error quaternion is given by ıq/DC1/DC4ıq1W3 ıq4/NAK Dq˝q/NUL1 c (7.2) where ıq1W3D/EOTT.qc/q (7.3a) ıq4DqTqc (7.3b) Taking the time derivative of Eq. ( 7.2)g i v e s ıPqDPq˝q/NUL1 c (7.4) Substituting Eq. ( 7.1a) into Eq. ( 7.4) and using Eq. ( 7.2) leads to ıPqD1 2˝.!/ıq (7.5) Using the deﬁnition of ˝.!/, the differential equations for ıq1W3andıq4are speciﬁcally given by290 7 Attitude Control ıPq1W3D1 2Œıq1W3/STX/c141!C1 2ıq4! (7.6a) ıPq4D/NUL1 2ıqT 1W3! (7.6b) The goal of the controller is to drive !to zero andıqto the identity quaternion IqDŒ0001/c141T. Several feedback controllers are presented in [ 50]. The ﬁrst is given by LD/NULkpıq1W3/NULkd! (7.7) wherekpandkdare positive scalar gains. Substituting Eq. ( 7.7) into Eq. ( 7.1b)g i v e s the closed-loop system governed by Eq. ( 7.5) and P!D/NULJ/NUL1/NUL Œ!/STX/c141J!Ckpıq1W3Ckd!/SOH (7.8) The only equilibrium point is ŒıqT 1W3!T/c141TD0. Stability is proven using Lyapunov’s direct method. Reference [ 50]u s e sa difference between the actual and command quaternions in the deﬁnition of the candidate Lyapunov function. Here, a multiplicative approach is employed, whichleads to the same result as in [ 50] but is more intuitive in terms of the quaternion error kinematics. Deﬁne the following candidate Lyapunov function: VD1 4!TJ!C1 2kpıqT 1W3ıq1W3C1 2kp.1/NULıq4/2/NAK0 (7.9) Note thatVD0when!D0andıqDIq, which is the equilibrium point. The time derivative of Vis given by PVD1 2!TJP!CkpıqT 1W3ıPq1W3/NULkp.1/NULıq4/ıPq4 (7.10) Substituting Eqs. ( 7.6) and ( 7.8) into Eq. ( 7.10)g i v e s PVD/NUL1 2/NUL !Tıq1W3/SOH/STX kpCkpıq4/NULkp.1Cıq4//ETX /NUL1 2kd!T! D/NUL1 2kd!T!/DC40 (7.11) Thus, the closed-loop system is stable since PV/DC40. Asymptotic stability can be proven using LaSalle’s theorem (see Sect. 12.2.2 ). The equality in Eq. ( 7.11) is given when !D0, whereıq1W3can be anything. We must check that the system cannot remain in a state where PVD0while ıq1W3¤0. Equation ( 7.11) guarantees that lim t!1!D0. The closed-loop dynamics in Eq. ( 7.8) shows that this asymptotic condition can only be achieved7.2 Attitude Control: Regulation Case 291 if limt!1ıq1W3D0also. Thus, this control law asymptotically reorients the spacecraft to the desired attitude from an arbitrary initial orientation. Note that ıq4 can be˙1, but this does not matter since both signs produce the same attitude. However, the control law in Eq. ( 7.7) does not guarantee that the shortest path is provided to the ﬁnal orientation. This becomes an issue when the fourth component of the initial error quaternion is negative. Reference [ 50] shows two other control laws that overcome this issue. One of them is a slight modiﬁcation of Eq. ( 7.7), given by LD/NULkpsign.ıq4/ıq1W3/NULkd! (7.12) Note that ifıq4<0 then a positive feedback term is introduced, which provides the shorter path to reach the desired equilibrium point. Thus Eq. ( 7.12) is always preferred over Eq. ( 7.7) unlessıq4D0exactly, which is not a concern for practical applications. The control law in Eq. ( 7.7) is linear in the state. Nonlinear control laws can also be used. Consider the following control law: LD/NULkpıq1W3/NULkd.1˙ıqT 1W3ıq1W3/! (7.13) This law also produces a globally asymptotic stable response, which can be proven using Lyapunov’s direct method (which is left as an exercise for the reader). When the minus sign is used then by the quaternion unity constraint we have 1/NULıqT 1W3ıq1W3Dıq2 The shortest distance control law can be achieved by using LD/NULkpsign.ıq4/ıq1W3/NULkd.1˙ıqT 1W3ıq1W3/! (7.14) The aforementioned control laws can also be used with reaction wheels. For the reaction-wheel-only case Eq. ( 3.147 ) expresses Euler’s rotational equation as JP!D/NULŒ!/STX/c141.J!Ch//NULPh (7.15) whereJnow includes the transverse inertia of the wheels, h/DC1Hw Bis the wheel angular momentum, and Phis the wheel torque. Note that the total angular momentum,J!Ch, is conserved as discussed in Sect. 3.3.5.1 . An equivalent but more useful form of Eq. ( 7.15) for control purposes is given by JP!D/NULŒ!/STX/c141J!CNL (7.16a) PhD/NULŒ!/STX/c141h/NULNL (7.16b) whereNLis an effective wheel torque input. Adding Eqs. ( 7.16a ) and ( 7.16b )s h o w s that these two equations are consistent with Eq. ( 7.15). Now deﬁne the following control laws for the wheel torques:292 7 Attitude Control 0 50 100 150 200 250 300−0.200.20.40.60.8 0 50 100 150 200 250 300−0.200.20.40.60.8 0 50 100 150 200 250 300−0.2−0.100.10.2 0 50 100 150 200 250 30000.40.81.2δq1 δq2 δq3 δq4 Time (Sec)0 50 100 150 200 250 300–40−20020 0 50 100 150 200 250 300−40−20020 0 50 100 150 200 250 300−10−505L1 (Nm) L2 (Nm) L3 (Nm) Time (Sec)a b Fig. 7.1 (a) Quaternion errors and ( b) control torques NLD/NULkpsign.ıq4/ıq1W3/NULkd! (7.17a) NLD/NULkpsign.ıq4/ıq1W3/NULkd.1˙ıqT 1W3ıq1W3/! (7.17b) Using the candidate Lyapunov function in Eq. ( 7.9) proves that these control laws provide asymptotic stability with reaction wheels. Example 7.1. In this example the control law in Eq. ( 7.12) is used to perform a reorientation maneuver with large initial errors. The inertia matrix of the spacecraft is given by JD2 410000 0 0 0 9000 00 0 120003 5kg-m 2 The initial quaternion is given by q.t0/DŒ0:6853 0:6953 0:1531 0:1531/c141Tand the initial angular velocity is given by !.t0/DŒ0:5300 0:5300 0:0530/c141Tdeg/s. The desired quaternion is the identity quaternion. The control gains are set tok pD50andkdD500. A plot of the quaternion errors is shown in Fig. 7.1a. The fourth error-quaternion component approaches 1 while the other three components approach zero. The control torques are shown in Fig. 7.1b. Note the large control torques at the beginning of the maneuver, which are due to the large initial errors. From these plots it is clear that the control law provides a reorientation maneuver to the desired attitude. Example 7.2. In this example the control law in Eq. ( 7.17a ) is used to perform a reorientation maneuver using reaction wheels. The inertia matrix of the spacecraft is given by7.2 Attitude Control: Regulation Case 293 0 2 4 6 8 10 12 14 16 18 20−0.400.40.8 0 2 4 6 8 10 12 14 16 18 20−0.04−0.0200.02 0 2 4 6 8 10 12 14 16 18 20−0.100.10.2 0 2 4 6 8 10 12 14 16 18 200.60.811.2 Time (Min)0 2 4 6 8 10 12 14 16 18 20060120180240 0 2 4 6 8 10 12 14 16 18 20−120−80−40040 0 2 4 6 8 10 12 14 16 18 2004080120h1 (Nms) h2 (Nms) h3 (Nms) Time (Min)δq1 δq2 δq3 δq4ab Fig. 7.2 (a) Quaternion errors and ( b) wheel momenta JD2 46400/NUL76:4/NUL25:6 /NUL76:4 4730/NUL40 /NUL25:6/NUL40 81603 5kg-m2 The initial quaternion is given by q.t0/Dp 2 = 2Œ 1001 /c141Tand the initial angular velocity is given by !.t0/DŒ0:01 0:01 0:01/c141Trad/s. The desired quaternion is the identity quaternion. The initial wheel momentum is set to h.t0/D0.T h eg a i n s are set tokpD10andkdD150. A plot of the quaternion errors is shown in Fig.7.2a. The fourth error-quaternion component approaches 1 while the other three components approach zero. The wheel momenta are shown in Fig. 7.2b. Note that wheel momenta do not decrease to zero once the desired attitude is achieved. This is due to the conservation of momentum in the spacecraft. For this case,since h.t 0/D0then the norm of the momentum is kJ!.t0/kD112:4586 Nms. The angular velocity of the spacecraft still achieves its desired zero value at the end of the maneuver and the momentum of the spacecraft is reoriented to performthis maneuver. As before, from these plots it is clear that the control law provides a reorientation maneuver to the desired attitude. We next convert the momenta from this example to two speciﬁc implementations of the four-wheel conﬁgurations discussed in Sect. 4.8.3 , using the pseudoinverses of the distribution matrices: W 4D1p 22 41/NUL10 0 1111001/NUL13 5; W ND2 41001=p 3 0101=p 3 0011=p 33 5 Plots of the converted momenta are shown in Fig. 7.3. Clearly, the different conﬁgurations produce different momenta for each wheel. The Euclidean norm of the wheel momenta for the pyramid conﬁguration at the ﬁnal time is 96.8044 Nms,294 7 Attitude Control 0 2 4 6 8 10 12 14 16 18 20−200−150−100−50050100150 1 2 3 4Wheel Momenta (Nms) Time (Min)0 2 4 6 8 10 12 14 16 18 20−150−100−50050100150200 1 2 3 4Wheel Momenta (Nms) Time (Min)ab Fig. 7.3 Comparison between wheel conﬁgurations. ( a) Pyramid conﬁguration. ( b)N A S As t a n - dard conﬁguration while the norm of the wheel momenta for the NASA standard conﬁguration at the ﬁnal time is 111.8695 Nms. 7.3 Attitude Control: Tracking Case The previous section described approaches to maneuver a spacecraft to a ﬁxed attitude while driving the angular velocity to zero. This has applications to inertially pointing spacecraft like the Hubble Space Telescope. This section discusses variousforms of attitude tracking that are used to control the spacecraft to follow a desired time-varying trajectory. Note that tracking also encompasses regulation by simply setting the desired attitude to a constant and the desired angular velocity to zero.Optimal control methods that minimize a user-deﬁned cost function are based on solving two-point boundary value problems [ 21]. They provide the control trajectory over the desired time interval and cannot be executed in real time. They are veryuseful for analysis purposes but less useful for real spacecraft mission designs, e.g. time-optimal control to provide rapid re-pointing of the spacecraft [ 37]. Feedback methods are more suitable for actual attitude tracking control applica- tions because they can be executed in real time. Feedback-based attitude tracking control is a widely studied topic. Most controllers are model based, e.g. they typically require knowledge of the inertia matrix. No one controller can work forevery spacecraft mission objective in terms of pointing and jitter requirements. Some are more sensitive to noise effects and/or modeling errors, while others are sensitive to external torque disturbances, such as torques induced by solar radiationpressure. So called “robust” controllers have been developed to mitigate these sensitivities. Here, the use of variable-structure (sliding-mode) control is shown as7.3 Attitude Control: Tracking Case 295 an introduction to spacecraft tracking. Sliding-mode control is robust to arbitrary model parameter inaccuracies, but comes at the price of possibly high control activity [ 41]. Section 12.2.3 presents a brief overview of sliding-mode control. The sliding-mode controller developed in [ 15] is shown here for both the case of external torques and internal reaction wheels. The dynamic equation is given by Eq. (7.1b) for the external torque case and by Eq. ( 7.16) for the reaction wheel case. First we must select the sliding surface. An obvious choice is to use a form that is similar to the right side of Eq. ( 7.7). Here the difference between the actual angular velocity and the commanded angular velocity, denoted by !c, is used so that the sliding surface vector is given by sD.!/NUL!c/Ckıq1W3 (7.18) wherekis some positive scalar constant. Note that here the commanded quaternion qcmay be time varying, but it must be consistent with the commanded angular velocity, i.e. qcmust be derived from the quaternion kinematics driven by !c. IfsD0then the actual attitude and angular velocity will track the commanded inputs. Reference [ 15] shows that Eq. ( 7.18) can actually be derived from optimal control theory. Taking the time derivative of Eq. ( 7.18)g i v e s PsD.P!/NULP!c/CkıPq1W3 (7.19) Evaluating Eq. ( 6.32) with!/DC1!trueand!c/DC1O!gives an expression for ıPq1W3: ıPq1W3D1 2ıq4.!/NUL!c/C1 2ıq1W3/STX.!C!c/ (7.20) Substituting Eqs. ( 7.1b) and ( 7.20) into Eq. ( 7.19)g i v e s PsD/NULJ/NUL1Œ!/STX/c141J!CJ/NUL1Le/NULP!cCk 2Œıq4.!/NUL!c/Cıq1W3/STX.!C!c//c141(7.21) Note that Lis replaced with Lebecause the equivalent control law must ﬁrst be derived, as explained in Sect. 12.2.3 . As also explained in that section the time derivative of the Lyapunov function in Eq. ( 12.66 ) requires thatPsD0. Using this condition gives the following equivalent control law: LeDJ/SUBk 2Œıq4.!c/NUL!//NULıq1W3/STX.!C!c//c141CP!c/ESC CŒ!/STX/c141J! (7.22) As explained in Sect. 12.2.3 , a discontinuous term is added across the sliding surface to account for model uncertainties. In order to reduce the resulting chattering phe- nomenon, a saturation function is used instead of the signum function. The resultingcontrol law will provide the sliding-mode attitude tracking law, however it is not296 7 Attitude Control guaranteed to reorient the spacecraft in the shortest distance. Reference [ 15] proves that the following sliding-mode control law reorients the spacecraft in the shortest distance: sD.!/NUL!c/Cksign.ıq4/ıq1W3 (7.23a) LDJ/SUBk 2Œjıq4j.!c/NUL!//NULsign.ıq4/ıq1W3/STX.!C!c//c141CP!c/NULGNs/ESC CŒ!/STX/c141J! (7.23b) whereGis a positive deﬁnite matrix and the ith component ofNsis given by NsiDsat.si;/SIi/; iD1;2;3 (7.24) where/SIiis a positive quantity and siis theith component of the sliding vector given by Eq. ( 7.23a ). The saturation function is deﬁned by sat.si;/SIi//DC18 ˆˆ< ˆˆ:1 fors i>/SIi si=/SIiforjsij/DC4/SIi /NUL1 forsi</NUL/SIi(7.25) Note thatNsdrives the system to the sliding surface. If reaction wheels are used to control the spacecraft, then as in Sect. 7.2the same control law is used with NL replacing L. The robustness of the sliding-mode controller is now shown. We ﬁrst deﬁne the following bounded modeling errors for the inertia matrix: J/NUL1DOJ/NUL1CıJ/NUL1(7.26) whereOJis the nominal inertia matrix. Next, neglecting the gyroscopic term in Euler’s rotational equation and adding an external disturbance input yields P!DJ/NUL1LCJ/NUL1d (7.27) where ddenotes a bounded disturbance input. Under these conditions the time- derivative of the sliding manifold can be approximated by PsDıJ/NUL1OJ/SUBk 2Œjıq4j.!c/NUL!//NULsign.ıq4/ıq1W3/STX.!C!c//c141CP!c/NULGNs/ESC /NULJ/NUL1OJGNsCJ/NUL1d (7.28) where it is assumed that the higher-order perturbations in the inertia matrix are small. We also assume that the thickness of the boundary layer /SIand the gainGare sufﬁciently large to keep the time derivative of the associated Lyapunov function7.3 Attitude Control: Tracking Case 297 negative deﬁnite in the presence of modeling errors and external disturbances. Then the dynamics of the sliding manifold can be approximated by Ps/EM/NUL1 /SIJ/NUL1OJGsCJ/NUL1d (7.29) Therefore, swill satisfy the inequality ksk<k/SI.OJG//NUL1k/STXk dkmax (7.30) if the time derivative of the sliding manifold is small after all transients have decayed. Equation ( 7.30) is valid using either external torques or reaction wheels in the control system. Example 7.3. In this example the sliding-mode controller is used to control the attitude of the WMAP spacecraft using quaternion and angular velocity obser- vations. The WMAP mission created a full-sky map of the cosmic microwave background and measured its anisotropy with 0.3ıangular resolution in order to answer fundamental cosmological questions such as the age of the universe, the value of the Hubble constant, and the existence and nature of dark matter. WMAP is in a Lissajous orbit [ 23] about the Earth-Sun L 2Lagrange point with an approximately 180-day period (see Sect. 10.5). Because of its distance, 1.5 million km from Earth, this orbit affords great protection from the Earth’s microwave emission, magnetic ﬁelds, and other disturbances, with the dominantdisturbance torque being solar radiation pressure. It also provides for a very stable thermal environment and near 100 % observing efﬁciency, since the Sun, Earth, and Moon are always behind the instrument’s ﬁeld of view. In this orbit WMAPsees a Sun/Earth angle between 2 ıand 10ı. The instrument scans an annulus in the hemisphere away from the Sun, so the universe is scanned twice as the Earth revolves once around the Sun. Reference [ 27] presents an overview of the WMAP attitude control system. The spacecraft instruments are shown in Fig. 7.4. The spacecraft orbit and attitude speciﬁcations are shown in Fig. 7.5. To provide the scan pattern, the spacecraft spins about the z-axis at 0.464 rpm, and the z-axis cones about the Sun- line at 1 rev/h. A 22:5ı˙0:25ıangle between the z-axis and the Sun direction must be maintained to provide a constant power input, and to provide constanttemperatures for alignment stability and science quality. The spacecraft’s attitude is deﬁned by a 3/NUL1/NUL3Euler angle rotation relative to a rotating, Sun-referenced frame. The three commanded Euler angles are /RS c,/DC2c, and c, and the desired states for the observing mode are P/RScD1rev hD0:001745rad s /DC2cD22:5ıD0:3927 rad P cD0:464 rpmD0:04859rad s298 7 Attitude Control Passive RadiatorOmni Antennaz y x1.5 m Primary Reflector Thermal Straps Diffraction ShieldingComposite Truss Structure Upper MLI Shield (20 Layers) Solar Panel with 20 Layers of MLI on Back Side (1 of 6) Lower MLI Shield (6 Layers) Analog Electronics Unit (AEU) Reaction Wheel (1 of 3) FPA is 1 m long Solar Panels are 1 m widePropulsion TankStar Tracker Omni Antenna Medium Gain Patch Antenna (Mounted on Sun Side)Gyro Thruster (1 of 6) Launch Vehicle Interface RingDigital Electronics Unit (DEU) Power Distribution Unit (PDU)0.52 m Secondary Reflector with Diffraction Shielding Fig. 7.4 WMAP spacecraft The desired Euler angles for /RScand care determined by integrating the Euler rates. The scan pattern can be simulated by ﬁrst multiplying the transpose of the 3/NUL1/NUL3 attitude matrix, shown in Table 9.1, by the vector Œcos/DC2c0sin/DC2c/c141T, which gives the following components: a1Dcos/RSccos/DC2ccos c/NULsin/RSccos2/DC2csin cCsin/RScsin2/DC2c a2Dsin/RSccos/DC2ccos cCcos/RSccos2/DC2csin c/NULcos/RScsin2/DC2c a3Dcos/DC2csin/DC2c.sin cC1/7.3 Attitude Control: Tracking Case 299 Anti-Sun (0° in ecliptic plane) 22.5° Shaded region scanned in 1 hr Lissajous orbit about L2 Earth SUN1.5 x 108 km30km/sSpin plane ( ^ to spin axis)L22.5x105 km 1.5 x 106 km [ Not to Scale ]Plane ^ solar vector (+90° in ecliptic plane)Spin Axis Spin Rate (0.464 rpm) A-side line of sight (22.5° from spin plane) (−90° in ecliptic plane)Spin Axis Precession (1 rev / hr)B-side line of sight (22.5° from spin plane) Fig. 7.5 WMAP mission speciﬁcations Thexandycoordinates are given by xDa1 1Ca3;yDa2 1Ca3 Figure 7.6shows the scan pattern for one complete precession (1 h), displayed in ecliptic coordinates in which the ecliptic equator runs horizontally across the map. The bold circle shows the path for a single spin (2.2 min). The commanded quaternion is determined using qc1Dsin/DC2/DC2c 2/DC3 cos/DC2/RSc/NUL c 2/DC3 qc2Dsin/DC2/DC2c 2/DC3 sin/DC2/RSc/NUL c 2/DC3 qc3Dcos/DC2/DC2c 2/DC3 sin/DC2/RScC c 2/DC3300 7 Attitude Control Anti-Sun Vector+48° +93° −48° −93°North Ecliptic Pole South Ecliptic PoleFig. 7.6 WMAP mission scan pattern qc4Dcos/DC2/DC2c 2/DC3 cos/DC2/RScC c 2/DC3 The kinematic equation that transforms the commanded Euler rates to the com- manded body rates is given by Eq. ( 3.41) withP/DC2cD0: !cD2 4P/RScsin/DC2csin c P/RScsin/DC2ccos c P c3 5rad s Its derivative, which is required for the sliding-mode controller, is given by P!cDP/RScP c2 4sin/DC2ccos c /NULsin/DC2csin c 03 5rad s2 The initial quaternion for the simulation test is given by q.t0/DŒ0 0 sin.˚=2/ cos.˚=2//c141T˝qc.t0/ The initial angular velocity is set to !.t0/D0. Three reaction wheels are used to control the spacecraft. The initial wheel momentum is set to h.t0/D0. The true inertia matrix of the spacecraft is given by JD2 4399/NUL2:81/NUL1:31 /NUL2:81 377 2:54 /NUL1:31 2:54 3773 5kg-m27.3 Attitude Control: Tracking Case 301 The nominal (assumed) inertia matrix used in the controller is given by OJD2 4380/NUL2:81/NUL1:31 /NUL2:81 360 2:54 /NUL1:31 2:54 3403 5kg-m2 The following external disturbance is also added: dD2 40:005 sin.0:05t/ 0:003 0:005 cos.0:05t/3 5Nm The simulation uses the following parameters: ˚D60ı,kD0:015 ,GD0:15I3, and/SID0:01. A plot of the angle errors is given in Fig. 7.7a. Convergence occurs in about 20 min. The slight oscillations are due to the disturbance. A plot of the angular velocity errors is shown in Fig. 7.7b, which clearly shows that the desired angular velocity proﬁle is achieved. The wheel momenta are shown in Fig. 7.7c. Note that the total angular momentum for the spacecraft is zero because !.t0/D0 and h.t0/D0. Therefore any increase in J!causes an equal negative value forh. Figure 7.7d presents plots of the upper bound given by Eq. ( 7.30) and the actual norm of the sliding vector. This shows the effectiveness of using Eq. ( 7.30)t o accurately bound the sliding manifold errors. 7.3.1 Alternative Formulation We now describe another tracking control law that we will use when we considerthe effects of noise [ 30]. First, deﬁne the following angular velocity difference: ı!D!/NULıA! c (7.31) whereıADAAT c. The time derivative of ıAis given by ıPADPAAT cCAPAT cD/NULŒ!/STX/c141ıACıAŒ!c/STX/c141 D/NULŒ!/STX/c141ıACıAŒıAT.!/NULı!//STX/c141D/NULŒı!/STX/c141ıA (7.32) where Eq. ( 2.63) has been used. The corresponding error quaternion kinematics equation is given by Eq. ( 7.5). Taking the time derivative of Eq. ( 7.31) and left multiplying by the inertia matrix gives JıP!DJP!/NULJıPA!c/NULJıAP!c (7.33)302 7 Attitude Control 0 10 20 30 40 50 60−2−1012 0 10 20 30 40 50 60−4−2024 0 10 20 30 40 50 60−60−30030Roll (Deg) Pitch (Deg) Yaw (Deg) Time (Min)0 10 20 30 40 50 60−0.02−0.0100.010.02 0 10 20 30 40 50 60−0.02−0.0100.010.02 0 10 20 30 40 50 60−0.200.20.4dw3 (Deg/Sec) dw2 (Deg/Sec) dw1 (Deg/Sec) Time (Min) 0 2 4 6 8 10 12 14 16 18 20−0.4−0.200.20.4 0 2 4 6 8 10 12 14 16 18 20−0.4−0.200.2 0 2 4 6 8 10 12 14 16 18 20−20−19−18−17−16h1 (Nms) h2 (Nms) h3 (Nms) Time (Min)0 10 20 30 40 50 6000.511.522.53x 10−6Slide Norm and Bound Time (Min)ab cd Fig. 7.7 WMAP simulation results. ( a) Angle errors. ( b) Angular velocity errors. ( c) Wheel momenta. ( d) Slide norm and upper bound Substituting Eqs. ( 7.1b) and ( 7.3.1 ) into Eq. ( 7.33), and after some simple algebraic manipulations leads to the following dynamic equation: JıP!D˙.ı!;!c;ı A/ı!/NULŒ.ıA!c//STX/c141JıA!c/NULJıAP!cCL (7.34) where˙.ı!;!c;ı A/ is the skew-symmetric matrix ˙.ı!;!c;ı A//DC1Œ.Jı!//STX/c141CŒ.JıA!c//STX/c141/NULŒ.ıA!c//STX/c141J/NULJŒ.ıA!c//STX/c141(7.35) As with the sliding-mode control approach, !ccan be any possible commanded trajectory. A stabilizing control law is given by LDŒ.ıA!c//STX/c141JıA!cCJıAP!c/NULkpıq1W3/NULkdı! (7.36) The stability proof for this control law is left as an exercise for the reader. Note that when!cD0then Eq. ( 7.36) is identical to Eq. ( 7.7).7.4 Attitude Thruster Control 303 7.4 Attitude Thruster Control Previous sections have presented a theoretical framework for the use of external torques to control the attitude. External-torque control is rarely used for ﬁne-pointing but is needed to dump momentum in order to prevent saturation of control wheels, and is often used for initial attitude acquisition after launch and for safehold modes to cope with reaction wheel failures. The only external means of applyingfull three-axis external torques is by the use of thrusters. Magnetic torquers can also generate torques, but not in all three axes simultaneously. Magnetic torquers are often used for low-Earth orbits while thrusters are used for high-Earth orbits orinterplanetary missions where magnetic ﬁelds are weak and unpredictable. Use of thrusters in autonomous safehold modes is dangerous, however, because thrusters can impart a large amount of angular momentum to the system, which magneticcontrol torques can remove only with great difﬁculty (if at all) after the thruster propellant has been expended. The most common attitude control method by thrusters uses pulse-width pulse- frequency (PWPF) modulation. The PWPF modulator translates the continuous commanded control torque signal to an on/off signal. The pulse width is achieved by modulating the width of the activated reaction pulse proportionally to the level of thetorque command input, while the pulse frequency modulates the distance between the pulses. Usually the width is very short and the frequency is set to a level that is much faster than the spacecraft rigid-body dynamics. Figure 7.8shows the main components of a PWPF modulator, which includes a Schmidt trigger, a lag ﬁlter, and a feedback loop. The Schmidt trigger is an on/off relay with a deadband and hysteresis. When a positive input to the Schmidt triggeris greater than U on, the trigger output is Um. When the input falls below Uoff,t h e trigger output is 0. This response is also reﬂected for negative inputs, i.e. when a negative input to the Schmidt trigger is less than /NULUon, the trigger output is /NULUm, and when the input is above /NULUoffthe trigger output is 0. The variable Kpis a gain used to amplify or reduce the commanded input. The ﬁlter is a simple ﬁrst-order ﬁlter with time constant /FSmand ﬁlter gain Km. The hysteresis effect for positive inputs is as follows. The output of the ﬁlter increases until it reaches the Uonvalue and the signal is set to the prescribe Um Schmidt Trigger Fig. 7.8 Pulse-width pulse-frequency modulated system304 7 Attitude Control Fig. 7.9 Behavior of a pulse-width pulse-frequency modulator with ﬁlter value. Because of the negative feedback loop, the signal then begins to decrease until it reaches the Uoffvalue and the signal is set to 0. The width of the hysteresis is given byh/DC1Uon/NULUoff. The behavior of this process is shown in Fig. 7.9. The PWPF modulator is a popular choice for attitude control thrusters because of its good fuel efﬁciency characteristics. If the spacecraft can be considered to be a rigid body then static behavior can be used to analyze the characteristics of the PWPF modulator. Reference [ 1] uses a describing function approach to analyze the case when ﬂexible dynamics are present. In the static case the input, e.t/,i s considered to be a constant here set to simply e, and the PWPF has nearly a linear duty cycle. Then f.t/ is given by f.t/Df.0/CŒKme/NULf.0//c141.1/NULe/NULt=/FSm/ (7.37) Note that as time approaches inﬁnity, f.t/ approachesKme.L e teDr/NULu, where rDKprcis a constant input into the summer in Fig. 7.8anduis the constant output. The on-time, otherwise known as the pulse width, is denoted by Ton. This can be found by setting f.0/DUonandf.T on/DUoffin Eq. ( 7.37) and solving for Ton, which yields TonD/NUL/FSmln/DC2 1/NULh Uon/NULKm.r/NULu//DC3 (7.38) IfTonis small so that the ﬁrst-order approximation e/NULTon=/FSm/EM1/NULTon=/FSmis good, then Eq. ( 7.38) can be approximated by [ 39] Ton/EM/FSmh Uon/NULKm.r/NULu/(7.39)7.4 Attitude Thruster Control 305 The output is zero when the thruster is off, so the off-time can be found by setting eDr,f.0/DUoff, andf.T off/DUonin Eq. ( 7.37) and solving for Toff, yielding ToffD/NUL/FSmln/DC2 1/NULh Kmr/NULUoff/DC3 (7.40) The ﬁrst-order approximation for the exponential gives ToffD/FSmh Kmr/NULUoff(7.41) The output frequency, denoted by f, is calculated using fD1 TonCToff(7.42) The duty cycle, denoted by DC, can be used to determine how well the modulator output follows its input. This quantity is given by DCDTon TonCToff(7.43) The internal deadband is deﬁned as the magnitude of the signal required to activate the Schmidt trigger. Assuming zero dynamics in the ﬁlter and KpD1, from Fig. 7.8, this occurs when Kmr/NAKUon. Thus, the internal deadband, denoted by rDB, is given by rDBDUon Km(7.44) Equation ( 7.44) indicates that increasing Kmcan reduce the size of deadband. In order to ensure that Uonis the upper bound of the deadband, Km>1 should be chosen. The minimum pulse width, denoted by /SOH, is found by substituting Eq. ( 7.44) forrin Eq. ( 7.38) and setting uDUm, which yields /SOHD/NUL/FSmln/DC2 1/NULh KmUm/DC3 (7.45) The saturation level, denoted by rsat, is obtained when the thrusters are on all the time. This is determined by equating the maximum value of the ﬁlter output,K m.rsat/NULUm/, to the Schmidt trigger off condition, Uoff. Solving forrsatgives rsatDUmCUoff Km(7.46)306 7 Attitude Control Table 7.1 Recommended ranges for PWPF parameters Parameter Static analysis Dynamic analysis Recommended Km 2<Km<7 N/A 2<Km<7 /FSm 0:1</FSm<1 0:1</FS m<0:5 0:1</FS m<0:5 Uon Uon>0:3 N/A Uon>0:3 Uoff Uoff<0:8U on N/A Uoff<0:8U on Kp N/A Kp/NAK20 K p/NAK20 0 50 100 150 200 250 300−0.200.20.40.60.8 0 50 100 150 200 250 300−0.200.20.40.60.8 0 50 100 150 200 250 300−0.2−0.100.10.2 0 50 100 150 200 250 30000.40.81.2δq1 δq2 δq3 δq4 Time (Sec)0 50 100 150 200 250 300−25025 0 50 100 150 200 250 300−25025 0 50 100 150 200 250 300−25025L1 (Nm) L2 (Nm) L3 (Nm) Time (Sec)ab Fig. 7.10 (a) Quaternion errors and ( b) control torques using PWPF thrusters Equation ( 7.46) gives the maximum value for the pseudo-linear region. Reference [4] provides recommended parameter values based on static and dynamic tests, w h i c ha r es h o w ni nT a b l e 7.1. Although these values may not be suitable for every application, they provide a good starting point for the design of a PWPF thruster. Example 7.4. In this example a PWPF controller and the control law in Eq. ( 7.12) are used for the spacecraft with parameters described in Example 7.1. Three PWPF thrusters are used with each rc.t/given byLi,iD1;2;3 ,i nE q .( 7.12). The output of each PWPF thruster is the corresponding torque input to the spacecraft. The initial quaternion is again given by qDŒ0:6853 0:6953 0:1531 0:1531/c141Tand the initial angular velocity is again given by !DŒ0:5300 0:5300 0:0530/c141Tdeg/s. The desired quaternion is the identity quaternion. The gains are kpD50and kdD500. The PWPF parameters are KmD5,/FSmD0:5,UonD10, UoffD6,KpD275, andUmD20. A plot of the quaternion errors is shown in Fig. 7.10a. The fourth error-quaternion component approaches 1 while the other three components approach zero. The control torques, shown in Fig. 7.10b, are large at the beginning of the maneuver and have signs equivalent to the ones shownin Fig. 7.1b. From these plots it is clear that the PWPF thrusters also provide a reorientation maneuver to the desired attitude. Fewer thruster ﬁrings are required at the end of the maneuver. Gains and the PWPF parameters are often scheduled7.5 Magnetic Torque Attitude Control 307 in practice at various phases of the maneuver to provide the desired steady-state performance. Reference [ 24] provides a study on optimal tuning of the PWPF parameters. 7.5 Magnetic Torque Attitude Control Attitude control using magnetic torquers was ﬁrst proposed in the early 1960s [ 48]. One of the main uses of magnetic torquers is to dump excess momentum induced by external disturbances. This is typically required to insure that wheels do not saturate. Recall that wheels only redistribute a spacecraft’s angular momentumsince they are internal body mechanisms. When disturbances are present excess momentum can build up in the spacecraft. The secular (orbit-averaged) component of external disturbance torques would lead to saturation of the momentum capacityof the reaction wheels, so either mass expulsion or magnetic control torques are needed to dump excess wheel angular momentum. Magnetic control torques have several advantages for near-Earth missions, including smoothness of application,essentially unlimited mission life (due to the absence of expendables), and absence of catastrophic failure modes [ 43]. It is important to note that magnetic torquers need not compensate for the entire disturbance torque in such an application, but onlyfor its secular component [ 8]. Other uses include detumbling, initial acquisition, precession control, nutation damping, and momentum control. Magnetic torquers use the Earth’s magnetic ﬁeld to produce a torque. As described in Sect. 11.1 in Chap. 11, the Earth’s magnetic ﬁeld magnitude decreases as the inverse cube of the distance from the center of the Earth. Thus the magnetic torque will be several orders of magnitude smaller at high-Earth orbits,such as geosynchronous orbits, than at low-Earth orbits. Magnetic control torques are typically on the order of 10 /NUL5to 10/NUL4Nm for low-Earth orbits, depending on a number of factors such as orbit inclination. Another issue is that the torques areconstrained to lie in a two-dimensional plane orthogonal to the magnetic ﬁeld, so only two out of three axes can be controlled at a given time instant. However, full three-axis control is available provided that the spacecraft’s orbital plane does notcoincide with the geomagnetic equatorial plane and does not contain the magnetic poles [ 7]. Reference [ 38] provides a good example, which is summarized here. Suppose that one magnetic torquer is aligned with the spin axis of the spacecraft. Activating this torquer will cause the spin axis to precess about the direction of the magnetic ﬁeld when the magnetic ﬁeld has a component that is perpendicular to the spinaxis. If the spacecraft orbit is in the magnetic equatorial plane then the spin axis can only be precessed about the direction of the North magnetic pole. In this case three-axis attitude control is not possible. However, if the orbit plane is offset fromthe magnetic equatorial plane, then the direction of the magnetic ﬁeld will change308 7 Attitude Control Fig. 7.11 Magnetic torquer control during the orbit and magnetic attitude control is possible. The magnetic equatorial plane is only 11ıfrom the Earth’s equator.1Thus for equatorial orbits the axis pointing in the direction of motion has the most control authority. For polar orbits the axis orthogonal to the direction of motion and to the Earth-pointing direction has the most control authority. A survey of magnetic spacecraft attitude control can be found in [ 40]. Figure 7.11 depicts the magnetic control scheme for the aforementioned spin-axis control. The torque generated by the magnetic torquers is given by LDm/STXB (7.47) where mis the commanded magnetic dipole moment generated by the torquers and Bis the local geomagnetic ﬁeld expressed in body-frame coordinates. This is related to the magnetic ﬁeld vector, R, expressed in reference-frame coordinates through the attitude matrix: BDAR. The vector Rdepends on the spacecraft’s orbital position. The magnetic moment is given in units of Am2and the magnetic ﬂux density of the geomagnetic ﬁeld is given in units of 1Wb=m2D1Tesla (T)D104Gauss (G). 7.5.1 Detumbling In this section a magnetic control law is developed that can be used to detumble a spacecraft (i.e. null its angular velocity vector). Detailed theory behind this control law can be found in [ 6]. The control is effected by commanding a magnetic dipole moment: mDk kBk!/STXb (7.48) 1See Sect. 11.1.7.5 Magnetic Torque Attitude Control 309 where bDB=kBk,!is the angular velocity and kis a positive scalar gain. This gives a control torque LDk kBk.!/STXb//STXBDk.!/STXb//STXbD/NULk.I3/NULbbT/! (7.49) The control torque is clearly perpendicular to b. To prove the stability of this control law consider the following candidate Lyapunov function: VD1 2!TJ! (7.50) Using Eq. ( 7.1b) with Eq. ( 7.49),PVcan be shown to be given by PVD/NULk!T.I3/NULbbT/! (7.51) Since the eigenvalues of .I3/NULbbT/are always 0, 1, and 1, then PVis only negative semi-deﬁnite. Stated another way, when !is parallel to bthenPVD0. This is not a concern in practice, though [ 6]. If no angular velocity information is available, we use Eq. ( 3.14) for the magnetic ﬁeld vector, which in the notation of this section is PBDAPR/NUL!/STXB (7.52) We assume, as is the case for the initial stages of detumbling, that PR/FSPB, so a good approximation to Eq. ( 7.48) is given by mD/NULk kBkPB (7.53) where Bis the ﬁeld sensed by onboard magnetometers. This is an alternative version of the well-known B-dot control shown in [ 43]. As stated in [ 6] global asymptotic stability cannot be proven using Eq. ( 7.53). But, the absolute angular velocity can be reduced down to a value of the same order of magnitude as the orbit rate (around 10/NUL3rad/s) as in the case when the standard B-dot command law is used. Note that in practical application, PBwould be computed by a ﬁnite difference approach, which introduces more noise in the control signal. A ﬁlter could be employed to reduce the noise levels, but B-dot control is often implemented as a bang-bang control law.Assume that we have ntorquers, and that the ith torquer can produce a maximum dipole of˙m max iin a direction speciﬁed by the unit vector ui. Then the bang-bang B-dot detumbling control commands are miD/NULmmax isign.ui/SOHPB/foriD1;:::;n (7.54)310 7 Attitude Control 0 20 40 60 80 100 120 140 160 180−0.6−0.300.30.6 0 20 40 60 80 100 120 140 160 180−0.300.30.60.9 0 20 40 60 80 100 120 140 160 180−0.300.30.6w1 (Deg/Sec) w2 (Deg/Sec) w3 (Deg/Sec) Time (Min)0 20 40 60 80 100 120 140 160 180−0.08−0.0400.040.08 0 20 40 60 80 100 120 140 160 180−0.2−0.100.1 0 20 40 60 80 100 120 140 160 180−0.12−0.08−0.0400.04 Time (Min)L1 (Nm) L2 (Nm) L3 (Nm)ab Fig. 7.12 Detumbling simulation results. ( a) Angular velocities. ( b) Control torques To avoid feedback from the torquers to the magnetometers, the computation of PBis inhibited for some period after any michanges sign. Reference [ 6] provides a gain expression based on analyzing the closed-loop dynamics of the component of !perpendicular to the Earth’s magnetic ﬁeld: kD4/EM Torb.1Csin/CANm/Jmin (7.55) whereTorbis the orbital period in seconds, /CANmis the inclination of the spacecraft orbit relative to the geomagnetic equatorial plane and Jminis the minimum principal moment of inertia. Note that kis always positive. Constant positive values can also be used to achieve design speciﬁcations if desired. Example 7.5. In this example the control law in Eq. ( 7.49) is used to null the angular velocity of a rotating spacecraft. The gain is given by Eq. ( 7.55). The inertia of the spacecraft is given in Example 7.2. Note that the minimum principal moment of inertia is given by 4726.01952 kg-m2. The GCI inertial position and velocity of the spacecraft are given by r0DŒ1029:7743 6699:3469 3:7896/c141Tkm and v0D Œ/NUL6:2119 0:9524 4:3946/c141Tkm/s. The epoch time is May 10, 2011 at 4:56:36.9191 a.m. This information is required to generate the reference magnetic ﬁeld. The initial quaternion is given by q.t0/Dp 2 = 2Œ 1001 /c141Tand the initial angular velocity is given by!.t0/DŒ0:01 0:01 0:01/c141Trad/s. A plot of the angular velocity trajectories is shown in Fig. 7.12a and the associated magnetic control torques are shown in Fig. 7.12b. Clearly, the control law is able to detumble the spacecraft.7.5 Magnetic Torque Attitude Control 311 7.5.2 Momentum Dumping As stated previously the most common use of magnetic torquers for low-Earth orbiting spacecraft is momentum dumping. Excess momentum is usually built up in the spacecraft through external disturbances, which are non-conservative. A periodic disturbance torque along one spacecraft axis results in a cyclic variation in theangular velocity along that axis, while a constant (secular) disturbance results in a linear increase in angular velocity, where the wheel is accelerated at a constant rate in order to transfer the excess momentum from the external disturbance to the wheel[26]. Eventually saturation of the wheels will occur due to the excess momentum, which can only be dumped through external torques. A common approach to design a magnetic torquer control law for momentum dumping is to command a magnetic dipole moment [ 8]: mDk kBkh/STXb (7.56) which is just like the detumbling control of Eq. ( 7.48) with the angular velocity vector replaced by the wheel angular momentum. The resulting torque is given by LD/NULk.I3/NULbbT/h (7.57) As with the detumbling case a torque cannot be exerted when his parallel to b,b u t as before, this is not a concern for practical applications. Example 7.6. In this example the control law in Eq. ( 7.57) is used to reduce the wheel momentum for the simulation shown in Example 7.2. All the parameters, such as the inertia matrix, the initial quaternion, the initial angular velocity, the initial wheel momentum, and control gains are identical to the ones shown in Example 7.2. The initial position, velocity and epoch are the same as the ones shown in Example 7.5. The goal is to reduce the overall momentum by about half in less than 3 h. To accomplish this goal the gain kin Eq. ( 7.57) is set to 0.0001. The momentum dumping control law is not turned on until the 30-min mark. This allows the spacecraft to ﬁrst complete its reorientation maneuver. A plot of the quaternion errors is shown in Fig. 7.13. As before, the fourth error- quaternion component approaches 1 while the other three components approachzero. The wheel momenta are shown in Fig. 7.13. Note that the wheel momenta begin to approach zero after the momentum dumping control law is executed. The commanded dipoles are shown in Fig. 7.13. The spacecraft momentum is shown in Fig. 7.13. At the end of 3 h we clearly see that the momentum is reduced by the desired goal. The magnitude of control torques, not shown here, is around 10 /NUL3Nm. This is about an order of magnitude higher than a typical magnetic control torquefor momentum dumping. In practice the gain kwould be set to a much lower level because reducing momentum by half over the short time period shown in this312 7 Attitude Control 0 30 60 90 120 150 180−0.400.40.8 0 30 60 90 120 150 180−0.04−0.0200.02 0 30 60 90 120 150 180−0.100.10.2 0 30 60 90 120 150 1800.60.811.2 Time (Min)0 30 60 90 120 150 180060120180240 0 30 60 90 120 150 180−120−80−40040 0 30 60 90 120 150 18004080120 Time (Min) Time (Min)0 30 60 90 120 150 18060708090100110120Total Momentum (Nms)h1 (Nms) h2 (Nms) h3 (Nms)δq1 δq2 δq3 δq4ab c d 0 30 60 90 120 150 180−400−2000200m1 (A−m2) 0 30 60 90 120 150 180−400−2000200m2 (A−m2) 0 30 60 90 120 150 180−400−2000200400m3 (A−m2) Time (Min) Fig. 7.13 Momentum dumping simulation results. ( a) Quaternion errors. ( b) Wheel momenta. ( c) Commanded dipoles. ( d) Spacecraft momentum example is typically not required. The magnetic control law is usually continuously active to dump excess momentum due to external disturbances during the mission mode. 7.6 Effects of Noise None of the control simulations presented in the previous sections of this chapter incorporates measurement noise, which is always present in practice for any attitude sensor. In most cases the ﬁltering methods in Chap. 6are employed to ﬁlter noisy measurements and the estimates are used in the feedback controllers. For linear systems replacing the “true” values with the Kalman ﬁlter estimates in the control law turns out to actually be the optimal approach, as is proven by the Separation Theorem [12], also known as the Certainty Equivalence Principle [5,16,42] (see Sect. 12.3.9 ). This theorem states that the solution of the overall optimal7.6 Effects of Noise 313 control problem with incomplete state knowledge is given by the solution of two separate sub-problems: (1) the estimation problem solved using the Kalman ﬁlter to provide optimal state estimates, and (2) the control problem using the optimalstate estimates, which is derived from the standard optimal control results. Another way to show this separation of the overall control design involves the eigenvalue separation property [ 2], which states that the eigenvalues of the overall closed-loop system are given by the eigenvalues of the control system together with those of the state estimator system. Unfortunately, no such theorem is available for general nonlinear systems. Still, the combined Kalman ﬁlter and feedback control approachworks well for most attitude control systems. The quaternion is the parameterization of choice for both estimation and control because it avoids singularity issues. As explained previously, the mapping ofquaternions to rotations is globally two-to-one because qand/NULqrepresent the same attitude. Neglecting this property in the control law can induce a phenomenon called unwinding , which may produce a control law that does not guarantee that the shortest path is provided to the ﬁnal orientation, as described in Sect. 7.2. To overcome this path issue a discontinuous set of quaternions is used through the signum function, as also shown in previous sections of this chapter. The problemwith the signum function is that it is not robust when noise is present, meaning that noise can destroy any global attractivity property [ 33]. Reference [ 30] provides an excellent example of the noise and unwinding issues. We consider an attitude regulation problem whose goal is to drive the attitude error to zero, which means to drive the error quaternion to ˙I q, using the angular velocity as the input. The error quaternion kinematics are given by ıPq1W3D1 2Œıq1W3/STX/c141!C1 2ıq4! (7.58a) ıPq4D/NUL1 2ıqT 1W3! (7.58b) Consider the control law given by !D/NULıq1W3and the following candidate Lyapunov function: V1.ıq/D2.1/NULıq4/D.1/NULıq4/2Ckıq1W3k2(7.59) ClearlyV1.ıq//NAK0with equality if and only if ıqDIq, andV1.ıq/achieves its maximum when ıqD/NULIq. The time derivative of V1.ıq/with!D/NULıq1W3is PV1.ıq/D/NULkıq1W3k2(7.60) which is almost always negative. However, there are two equilibrium points: a stable one atıqDIqand an unstable one at ıqD/NULIq. This leads to the classic unwinding issue, which is depicted in Fig. 7.14a. Ifıq4is initially negative, the controller increases the attitude error before driving it to zero.314 7 Attitude Control Noise-Induced Chatteringsign( ) Hysteresis Regionab Fig. 7.14 Noise chattering and hysteretic regulation. ( a) Quaternion attitude control. ( b)H y s - teretic regulation Now consider the control law !D/NULıq4ıq1W3and the following candidate Lyapunov function: V2.ıq/D1/NULıq2 4Dkıq1W3k2(7.61) In this caseV2.ıq/D0if and only ifıqD˙ Iq, and its maximum value is achieved whenıq4D0, which corresponds to a 180ırotation. Taking the time derivative of V2.ıq/with!D/NULıq4ıq1W3leads to PV2.ıq/D/NULıq2 4kıq1W3k2(7.62) which is always negative except at the two stable equilibrium points ıqD˙ Iq. Also note that V2.ıq/DV2./NULıq/and!.ıq/D!./NULıq/. This clearly solves the unwinding problem, but !D0whenıq4D0so convergence takes longer to achieve as initial conditions are closer and closer to 180ırotations. In an attempt to overcome the convergence and unwinding issues, the control law !D/NULsign.ıq4/ıq1W3is chosen with the following candidate Lyapunov function: V3.ıq/D( 2.1/NULıq4/D.1/NULıq4/2Ckıq1W3k2ıq4/NAK0 2.1Cıq4/D.1Cıq4/2Ckıq1W3k2ıq4<0(7.63) Taking the time derivative of V3.ıq/with!D/NULsign.ıq4/ıq1W3leads to PV3.ıq/D/NULkıq1W3k2(7.64) which is always negative except at the two stable equilibrium points ıqD˙ Iq. Thus this control law achieves global asymptotic stability, but it is not robust to measurement noise. Reference [ 29] shows that for an arbitrarily small noise signal, with initial conditions close to 180ırotations, this control law keeps the state near the discontinuity for all time. This is the noise-induced chattering problem depicted in Fig. 7.14a.7.6 Effects of Noise 315 To solve the unwinding and noise-induced chattering problems [ 30] develops a hybrid controller, which incorporates hysteresis-based switching using a single binary logic variable for each quaternion error state. The strategy is depicted inFig.7.14b, whereı2.0;1/ denotes the hysteresis half-width. Deﬁne the following function: sign.s/D( sign.s/jsj>0 f/NUL1;1gsD0(7.65) WhensD0the value of sign.s/isC1ifsapproaches zero from the positive side and/NUL1ifsapproaches from the negative side. Now consider the following control law:!D/NULhıq1W3, whereh2f/NUL1;1gand the dynamics of hare given by PhD0when.ıq;h/2fhıq4/NAK/NULıg (7.66a) hCDsign.ıq4/when.ıq;h/2fhıq4/DC4/NULıg (7.66b) wherehCdenotes the value of the logic variable after being updated. This function represents a hysteretic regulation in the control law. It is a hybrid approach generalizing the control laws !D/NULıq1W3and!D/NUL sign.ıq4/ıq1W3, whereı in Eq. ( 7.66) manages a tradeoff between robustness to measurement noise and hysteresis-induced inefﬁciency. The control law !D/NULsign.ıq4/ıq1W3is recovered whenıD0. Settingıto value greater than or equal to 1 gives a simple control law with the full unwinding effect. Reference [ 30] applies the aforementioned hybrid approach to the control law given in Eq. ( 7.36). The hybrid control law is given by LDŒ.ıA!c//STX/c141JıA!cCJıAP!c/NULkphıq1W3/NULkdı! (7.67) whereı2.0;1/ and the dynamics of hare given by Eq. ( 7.66). Example 7.7. This example reproduces the example results of [ 30]. It involves a regulation case that takes any initial quaternion and angular velocity to the identity quaternion and zero angular velocity, respectively. Let pDŒ1 23/c141T=kŒ1 23/c141k. The inertia matrix is given by JD10/STXdiag.Œp1p2p3/c141/and the control gains are given bykpDkdD1. The hysteresis half-width is chosen to be ıD0:4. Synthetic quaternion measurements are generated using qDqtrueCmv kqtrueCmvk where vis a zero-mean Gaussian white-noise process with covariance given by the identity matrix and mis drawn from a uniform distribution on the interval Œ0;0:2/c141 . These noise parameters produce a 1/ESCattitude measurement error of about 6.5ıin each axis, which is not realistic for any spacecraft attitude sensor; however,316 7 Attitude Control 0 5 10 15−1−0.8−0.6−0.4−0.200.20.40.60.81 Hybrid Discontinuoushq4 Time (Sec)0 10 20 30 40 50 60 70020406080100120140160180 Hybrid Discontinuousq (Deg) Time(Sec) 0 10 20 30 40 50 60 7000.050.10.150.20.250.30.350.40.450.5 Hybrid Discontinuous ωωω(rad/sec) Time (Sec)0 10 20 30 40 50 60 7000.511.522.533.5 Hybrid Discontinuoust 0LT L dt Time (Sec)ab cd Fig. 7.15 Noise sensitivity results. ( a) Scalar component quaternion errors. ( b) Rotation angle errors. ( c) Norm of angular velocity errors. ( d) Control effort this noise level more distinctly shows the effectiveness of the hybrid control law. No noise is added to the true velocity vector. Finally, the initial condition for his given byh.0/D1. In the ﬁrst simulation the initial quaternion and angular velocity are given by qtrue.0/DŒpT0/c141Tand!true.0/D0, respectively. Plots of hq4, the rotation angle error/DC2D2cos/NUL1jq4j, norm of the angular velocity, and control effort are shown in Fig. 7.15. SettingıD0gives the discontinuous controller case. The unwinding controller case is not shown because its results are identical to the hybrid controller results because hdoes not change in the hybrid case. Figure 7.15as h o w st h e sensitivity to noise for the discontinuous controller case where the chattering behavior is clearly visible. This behavior causes a lag in the response, which in turn requires more control effort as shown by Fig. 7.15d. The hybrid controller is clearly more robust to measurement noise and requires less control effort than the discontinuous controller.7.6 Effects of Noise 317 0 5 10 15−1−0.8−0.6−0.4−0.200.20.40.60.81 Hybrid Discontinuous Unwinding Time (Sec)0 10 20 30 40 50 60 70020406080100120140160180 Hybrid Discontinuous Unwinding Time (Sec) 0 10 20 30 40 50 60 7000.10.20.30.40.50.6 Hybrid Discontinuous Unwinding Time (Sec)0 10 20 30 40 50 60 7000.511.522.533.5 Hybrid Discontinuous Unwindingt 0 Time (Sec)hq4 q (Deg) ωωω(rad/sec) LT L dtab cd Fig. 7.16 Effects of unwinding. ( a) Scalar component quaternion errors. ( b) Rotation angle errors. (c) Norm of angular velocity errors. ( d) Control effort The second simulation shows how control laws that exhibit unwinding can resist a “beneﬁcial” angular velocity. All parameters are identical to the ﬁrst simulationexcept that the initial quaternion is given by q true.0/DŒp 1/NUL0:22pT/NUL0:2/c141T and the initial angular velocity is !true.0/D0:5p. Figure 7.16 shows the results for the hybrid, discontinuous, and unwinding controller cases. The unwindingcontroller case is given by setting ı>1 . The initial velocity is speciﬁcally chosen so that it is in the direction that decreases the angle between the initial quaternion and commanded quaternion. The discontinuous controller immediatelypulls the quaternion toward /NULI q(note thathimmediately jumps to /NUL1and stays there). The hybrid controller initially pulls the quaternion toward CIq, but after the initial angular velocity pushes the attitude past the hysteresis width, its valueofhswitches and then pulls the quaternion toward /NULI q. The unwinding-inducing controller always pulls the quaternion toward Iq. Figure 7.16d shows that the unwinding-inducing controller requires the most control effort, as expected, whilethe discontinuous and hybrid controller give comparable control efforts.318 7 Attitude Control Example 7.8. In this example a more realistic scenario is presented using the WMAP spacecraft. The tracking control law is given by Eq. ( 7.36) with control gains given by kpD5andkdD3. Noise is added to the true angular velocity by using a zero-mean Gaussian white-noise process with standard deviation given byp /SOHtp 10/STX10/NUL7rad/s, where the sampling interval is given by /SOHtD0:1s. Realistic noise is also added to the true quaternion using a multiplicative approach. It is assumed that the noise is isotropic, which is a valid assumption when multiple startrackers pointed sufﬁciently apart are used on the spacecraft. The standard deviation for all components of the 3/STX1attitude noise vector, denoted by v q, is given by .0:5=3//STX10/NUL3deg. The “noise” quaternion is given by qnoiseDŒvT q1/c141T=kŒvT q1/c141k. The measured quaternion is generated using qDqtrue˝qnoise. The hysteresis half- width is chosen to be ıD0:4for the hybrid controller and ıD3for the unwinding controller. The initial condition for his given byh.0/D1for all controllers. Results for the scalar component quaternion errors, the rotation error angles, the norm of the velocity errors and the torque norm are shown in Fig. 7.17, which indicate that the hybrid controller provides the best performance. This example shows that underrealistic noise errors the hybrid controller can provide superior results over standard control approaches to handle noise chattering effects. 7.7 SAMPEX Control Design This section presents the attitude determination and control design for a real space- craft called the Solar, Anomalous and Magnetospheric Particle Explorer (SAMPEX) which was the ﬁrst of the NASA Small Explorer (SMEX) missions. It was launched on July 3, 1992 into an 82ıinclination orbit with an apogee of 670 km and a perigee of 520 km, with a planned mission life of 3 years. Its scientiﬁc instruments included the Heavy Ion Large Telescope (HILT), the Low Energy Ion Composition Analyzer (LEICA), the Mass Spectrometer Telescope (MAST), and the Proton/ElectronTelescope (PET). Over its lifetime, SAMPEX provided the ﬁrst continuous record of high sensitivity measurements of energetic ions and relativistic electrons over almost two solar cycles. New insights were given into the acceleration, transportand loss processes in the Earth’s magnetosphere, driven by high speed streams or coronal mass ejections in the solar wind. SAMPEX also discovered doubly charged anomalous cosmic rays of interstellar origin, limiting the time scale foracceleration of these ions in the outer heliosphere to a few years. One of the signiﬁcant achievements of SAMPEX was to conﬁrm the existence of the trapped component of the anomalous cosmic rays. During its ﬁrst year it conﬁrmed that theserays are singly charged and located in a narrow belt of trapped cosmic rays within the inner of the two Van Allen radiation belts. This discovery provided proof of a third radiation belt. Furthermore, SAMPEX also successfully addressed importantscientiﬁc objectives concerning solar energetic particles because it was launched7.7 SAMPEX Control Design 319 0 1 2 3 4 5 6 7 8 9 10−1−0.8−0.6−0.4−0.200.20.40.60.81 Hybrid Discontinuous Unwinding Time (Min)0 1 2 3 4 5 6 7 8 9 10020406080100120140160180 Hybrid Discontinuous Unwinding Time (Min) 0 1 2 3 4 5 6 7 8 9 1000.050.10.150.20.250.30.350.4 Hybrid Discontinuous Unwinding δδδωωω(rad/sec) Time (Min)0 10 20 30 40 50 6001020304050607080 Hybrid Discontinuous Unwinding Time (Min)t 0LT L dt q (Deg)a b cdhdq4 Fig. 7.17 Hybrid, discontinuous and unwinding results for WMAP. ( a) Scalar component quater- nion errors. ( b) Rotation angle errors. ( c) Norm of angular velocity errors. ( d) Control effort when the Sun had just passed the peak of its 11-year solar cycle and begun to move toward solar minimum. Figure 7.18 is a schematic of SAMPEX, showing the science instruments and deﬁnitions of the body axes. The attitude control system (ACS) consists of one reaction wheel, three magnetic torquer bars, one two-axis ﬁne Sun sensor, ﬁvecoarse Sun sensors, and one three-axis magnetometer (TAM). The spin axis of the reaction wheel and the boresight of the ﬁne Sun sensor are along the body y-axis, or pitch axis, j/DC1Œ 010 /c141 T.2Attitude determination is performed using the TRIAD algorithm of Sect. 5.1with data from the Sun sensor and TAM. The three-axis attitude requirement is 2ı. During its lifetime SAMPEX had three primary science modes and included a number of submodes [ 44]. All science modes have a Sun angle constraint to maintain the body y-axis to within˙5ıof the Sun line in order to keep the solar arrays pointed towards the Sun. The primary science modes include the following: 2This has no relation to the orbit plane because SAMPEX is not Earth-pointing.320 7 Attitude Control Fig. 7.18 SAMPEX schematic  Vertical Pointing. This mode tends to maximize zenith pointing over the poles.  Orbit Rate Rotation (ORR). This mode provides a smooth scan of the celestial sphere while maintaining the Sun angle constraint.  Special Pointing. This mode orients the instrument boresights perpendicular to the ﬁeld lines of the Earth’s magnetic ﬁeld in regions of low ﬁeld strength and parallel to the ﬁeld lines in regions of high ﬁeld strength, which allows better characterization of heavy ions trapped by the ﬁeld. The submodes include the following:  Coast. This submode turns off the magnetic torquers and holds the wheel speed at its most recent value. This submode is used to drift through mathematical singularities in the attitude determination when the magnetic ﬁeld and Sun vectors are co-aligned within 5ıduring Sun availability and within 40ıduring eclipse. The angle between these vectors can be found by taking the inverse cosine of the dot product of the inertial magnetic and Sun vectors.  Eclipse. This submode is enabled when the Sun presence ﬂag returns a value of false. It turns off the magnetic torquers and determines the Sun vector from the assumption that the reaction wheel angular momentum keeps the spacecraft y-axis inertially ﬁxed. This assumption is reasonable for short periods of time (<1 h). The body Sun vector is assumed to be given by bsunDjand attitude determination is performed normally using the TAM vector and assumed Sun body-vector. Note that the eclipse duration can be up to 45 min per orbit in shadow seasons. Two other modes are also used. The ﬁrst is a magnetometer calibration mode that senses the unwanted component of the signal on the TAM produced by the7.7 SAMPEX Control Design 321 torquer bars and then estimates the coupling matrix values to compensate for the contamination. The other is a Sunpoint-only mode that is a digital implementation of the spacecraft’s analog safehold mode. SAMPEX’s science mission was terminated on June 30, 2004, after it had exceeded its 3 year mission life goal by a factor of almost 4, but the spacecraft continued to be operated as a testbed. On August 18, 2007 the reaction wheel beganto fail after more than 15 years of continuous operation. The spacecraft was then successfully placed into a spin stabilized mode described in [ 44] until it reentered the Earth’s atmosphere on November 13, 2012. 7.7.1 Attitude Determination As previously mentioned SAMPEX uses a TAM and a Sun sensor in the ACShardware. The Sun sensor has a ﬁeld of view of ˙64 ıand outputs 8 bits of Gray code data for each axis with a resolution of 0.5ı, which dominates the sensor noise. This is converted to binary and the two binary counts, NaandNb, are converted to the Sun’s image plane coordinates through [ 19] xDsxNa/NULbx (7.68a) zDszNb/NULbz (7.68b) where.sx;sz/are scale factors in units of cm/count and ( bx;bz/are biases in units of cm. For the SAMPEX Sun sensor these parameters are given by sxDszD 0:002754 andbxDbzD/NUL0:350625 . The body Sun vector is computed using [ 10] bsunD1p x2Cz2Ch22 4/NULnxp h2/NUL.n2/NUL1/.x2Cz2/ /NULnz3 5 (7.69) wherenis the refraction index of the glass and his the glass thickness in cm. For SAMPEXnD1:4553 andhD0:448 . To simulate the Sun sensor from the inertial Sun vector rsun, this vector is ﬁrst converted to body coordinates using the attitude matrix: bsun/DC1Œbsun1bsun2bsun3/c141TDArsun. Then the components xandzare computed using zD˙hbsun3q n2/NULb2sun1/NULb2sun3(7.70a) xDzbsun1 bsun3(7.70b)322 7 Attitude Control where the sign of zis easily determined by the known body motion. A Sun sensor measures an azimuth /RS, and a coelevation /DC2, which are computed by /RSDatan2.x;z/ (7.71a) /DC2Dtan/NUL1" np x2Cz2 p h2/NUL.n2/NUL1/.x2Cz2/# (7.71b) Measurements are obtained by adding zero-mean Gaussian white-noise to /RSand /DC2with standard deviations /ESC/RSand/ESC/DC2, respectively. For SAMPEX the standard deviation of both of the variables is given by 0.01ı. Next, the 0.5ıresolution is simulated using the MATLAB “round” command, i.e. round( meas=res//ETXres, wheremeas is the measurement including noise and resis the resolution. Note that/ESC/RS,/ESC/DC2, andresmust all be converted to radians. To produce the simulated body vector measurements, ﬁrst the tangent of the angles for the rotations around the /NULx andzaxes, denoted by ˛andˇ, are computed using tan˛Dtan/DC2sin/RS (7.72a) tanˇDtan/DC2cos/RS (7.72b) where/RSand/DC2here are the measured values, including noise and the 0.5ıresolution. The measured unit vector is then given by bsunD˙1p 1Ctan2˛Ctan2ˇ2 4tan˛ 1 tanˇ3 5 (7.73) where the sign is easily determined from the true body vector. A triaxial search coil magnetometer is used on SAMPEX, which outputs 12 bit words for each axis. Its resolution is 31.25 nT and its range is ˙64;000 nT. The TAM body vector is denoted by bmagand the respective inertial vector is denoted by rmag, which is computed using a 10th-order geomagnetic ﬁeld model. TAM measurements are computed by ﬁrst converting the inertial vector into body coordinates and then adding zero-mean Gaussian white-noise. For the SAMPEX TAM the covariancematrix of this noise is assumed to be isotropic with standard deviation given by 30 nT per axis. The SAMPEX algorithm contains a procedure to calibrate the torque- rod/magnetometer coupling matrix, denoted by C. It turns off all torquer bars and obtains an uncontaminated measurement, denoted by b u mag. Then it sequentially turns on each torquer bar with a 10 Am2excitation and obtains a contaminated measurement, denoted by bc mag. The relationship of these vectors is given by bc magDbu magCCm (7.74)7.7 SAMPEX Control Design 323 where mis the dipole moment of the torquer rods computed from the torque magnetic assembly current feedback. The matrix components of Ccan be computed using a simple least-squares procedure with multiple observations of bu magandbc mag. Once the TRIAD solution produces an attitude matrix, the spacecraft angular velocity is computed by ﬁrst using a ﬁrst-order ﬁnite difference to estimate the derivative of the attitude matrix: PA/EMAkC1/NULAk /SOHt(7.75) where/SOHtD0:5s is the sampling interval. Then the cross product matrix of the angular velocity is determined using the average values from the two possiblesolutions of the off-diagonal elements: /NULŒ! kC1/STX/c141D1 2/STXPAAT/NUL.PAAT/T/ETX D1 2/SOHt.AkC1AT k/NULAkAT kC1/ (7.76) The total spacecraft angular momentum is given by HDJ!CHwj (7.77) whereJis the inertia matrix and Hwis the momentum of the wheel. For SAMPEX the inertia matrix is given by JD2 414:1005/NUL0:1898/NUL0:9897 /NUL0:1898 19:2526/NUL0:4881 /NUL0:9897/NUL0:4881 12:06683 5kg-m2(7.78) The wheel momentum is computed using the measured angular velocity of the wheel, denoted by !w, withHwDJw!w, where the inertia of the wheel is given byJwD4:1488/STX10/NUL3kg-m2. The computed values of Hare very noisy due to the 0.5ıresolution in the Sun sensor. A simple Kalman ﬁlter is used to provide ﬁltered estimates of these computed values. The angular momentum dynamics is given by PHD/NUL!/STXHCLmag (7.79) where Lmagis the magnetic control torque in body coordinates. Using a ﬁrst-order ﬁnite difference to approximate PHand a ﬁrst-order ﬁnite difference to approximate PAin/NULŒ!/STX/c141DPAAT/EM.AkC1AT k/NULI3/=/SOHt leads to the following discrete-time prediction equation [ 31]: H/NUL kC1DAkC1AT kHC kC/SOHtLmagk(7.80)324 7 Attitude Control The update equation for the Kalman ﬁlter is given by HC kD.1/NULK/H/NUL kCKHderivedk (7.81) where Hderivedkis given by Eq. ( 7.77) using computed values for the spacecraft and wheel angular velocities, and respective known inertia quantities. A Kalman gain of KD0:01 is chosen, which provides good ﬁltered estimates without excessive lag in the control signal. 7.7.2 Magnetic Torque Control Law The magnetic torquers are used to control the magnitude and direction of thesystem angular momentum when SAMPEX is in sunlight. The commanded angular momentum magnitude, denoted by H c, is 0.81349 Nms.3The desired direction is both along the body y-axis to damp spacecraft nutation and along the Sun line to keep the solar arrays Sun-pointing. An undesired component of the spacecraft angular momentum, denoted by /SOHH, can be computed as /SOHHD.H/NULHcj/C.H/NULHcbsun/D2H/NULHc.jCbsun/ (7.82) The magnetic torquers are commanded to have dipole moment given by mDkmag/SOHH/STXbmag (7.83) wherekmagis a constant gain, given by 7:376/STX10/NUL13for SAMPEX. The control torque is computed using Eq. ( 7.47): LmagDm/STXbmag (7.84) The measured values of bmagandbsunare used to compute the control torque. As previously mentioned, magnetic control is turned off during eclipse because con- trolling the angular momentum is undesirable when Sun sensor data are unavailable.Angular momentum conservation keeps the solar arrays pointing toward the Sun when it is behind the Earth. 7.7.3 Science Modes Reaction wheel control is used to align the instrument boresights, which are along the spacecraft z-axis, with a target vector denoted by u. This section shows details of the three science modes of SAMPEX, each of which has a different target 3This is equal to 0.6 ft-lb-s and has been erroneously given as 0.6 Nms in the literature.7.7 SAMPEX Control Design 325 bsun (1 axis) uramvbody u × bsun (2 axis)u (3 axis)Fig. 7.19 Flatley coordinate system vector. All science modes have a rotation about the body y-axis, so the target vector is always in the body x-zplane. All three science modes also employ a velocity avoidance constraint. This constraint was added due to orbital debris and micrometeoroid ﬂuxes that were 50–100 times higher than the ﬂux tables used in the original SAMPEX proposal. The SAMPEX HILT sensor includes a ﬂow-throughisobutane proportional counter that is susceptible to penetration by debris and other ﬂuxes [ 20]. Keeping the HILT sensor pointed away from the velocity vector, which the direction of maximum ﬂux, compensates for the higher than expected ﬂuxes. Since all three science modes use the velocity avoidance algorithm, it is discussed ﬁrst. The RAM angle is deﬁned as the angle between the HILT boresight and the velocity vector. An optimal RAM angle is 90 ısince it does not degrade any of the science modes while providing an estimated 89 % chance of survival for the HILT sensor over a 3 year mission period. This RAM angle was actually later reduced to 80ıand the HILT sensor still functioned properly for nearly 20 years! The velocity avoidance algorithm can be easily developed by using a new coordinate system, dubbed the “Flatley Coordinate System,” and shown in Fig. 7.19. The body Sun vector is its ﬁrst axis, the target vector is its third axis, and their crossproduct is its second axis. The angle 'is the angle between the target vector and the unit velocity vector expressed in body coordinates, denoted by v body; and/DC2is the angle between the target vector and the RAM vector, uram, which is the target vector corrected for velocity avoidance. Note that both uanduramare perpendicular to the Sun vector. If u/SOHvbody/DC4cos'min, where'minis the minimum RAM angle, then the velocity avoidance algorithm is not necessary. The attitude matrix that rotates vectors from the body frame to the Flatley frame is given by AF BD2 4bT sun wT uT3 5 (7.85)326 7 Attitude Control where w/DC1u/STXbsun=ku/STXbsunk. The velocity vector in Flatley coordinates, denoted byfDŒf1f2f3/c141T, can be determined using fDAF Bvbody. The vector uramin Flatley coordinates is simply uramDŒ0sin/DC2cos/DC2/c141T. The desired constraint to determine uramis given by uram/SOHfDf2sin/DC2Cf3cos/DC2Dcos'min (7.86) Squaring both sides of Eq. ( 7.86), and using the relations cos2/DC2D1/NULsin2/DC2and f3cos/DC2Dcos'min/NULf2sin/DC2leads to the following quadratic equation for sin /DC2: .f2 2Cf2 3/sin2/DC2/NUL2f2cos'minsin/DC2Ccos2'min/NULf2 3D0 (7.87) The solution for sin /DC2is given by sin/DC2Df2cos'min˙jf3jq f2 2Cf2 3/NULcos2'min f2 2Cf2 3(7.88) Iff2/NAK0then sin/DC2<0 and the negative sign is chosen in the radical, otherwise the positive sign is chosen since if f2<0 then sin/DC2>0 is true. The vector uramcan now be computed using simple sine and cosine relationships from Fig. 7.19: uramD.u/STXbsun/sin/DC2Cucos/DC2 (7.89) Note that if/DC2D0then uramDuas expected and that if /DC2D0then Eq. ( 7.86) shows thatf3Dcos'min. In practice the measured values for bsunare used. The attitude matrix is required to compute the velocity vector in body coordinates. Finally, the velocity vector in inertial coordinates is computed using an onboardorbit propagator, which is updated from ground observations. For all three modes the pitch error angle, which is used in the control system, is given by eDatan2./NULu ram1;uram3/ (7.90) where uram1anduram3are the ﬁrst and third components of uram, respectively. Note that in some cases the velocity avoidance algorithm is turned off. For these cases we simply set sin /DC2D0and cos/DC2D1in Eq. ( 7.89), so uramDu. Equation ( 7.90) can still be used in the control law. 7.7.3.1 Vertical Pointing Mode The vertical pointing mode minimizes the angle between the spacecraft z-axis and the zenith vector within the Sun pointing constraint [ 19]. This mode has the undesirable property of pointing directly into the velocity vector twice per orbit7.7 SAMPEX Control Design 327 when the Sun is in the orbit plane, but the velocity avoidance algorithm overcomes this problem. The target vector in inertial coordinates is given by urefDrsun/STX.r/STXrsun/ krsun/STX.r/STXrsun/k(7.91) where rsunis the Sun unit vector in inertial coordinates and ris the spacecraft position vector in inertial coordinates. The body target vector is found by using uDAurefwhereAis the computed attitude matrix from the TRIAD algorithm. This mode clearly has the spacecraft z-axis as close to zenith as possible while remaining perpendicular to the Sun. 7.7.3.2 Orbit Rate Rotation Mode In the ORR mode the spacecraft z-axis rotates at one revolution per orbit in a plane perpendicular to the Sun vector, which provides a smooth scan of the celestial sphere, while maintaining the y-axis Sun pointing requirement. At the same time, thez-axis is desired to point as close to North as possible at the northernmost point in the orbit, South as possible at the southernmost point, and parallel to the equator at the equatorial crossings [ 19]. To develop the target vector we ﬁrst deﬁne the North pole vector in inertial coordinates: pDŒ0 0 1/c141Tand also compute the unit orbit normal vector: nDr/STXv kr/STXvk(7.92) where ris the inertial position vector and vis the inertial velocity vector. We now compute the orbit angle as seen from the northernmost point in the orbit using the following vectors: aDp/STXn kp/STXnk(7.93a) cDn/STXa (7.93b) Note that ais the vector in the direction of the ascending node and the vector cis in the direction of the northernmost point in the orbit. The sine and cosine of the orbit angle, deﬁned by ˛, can be computed from sin˛D/NULr/SOHa krk(7.94a) cos˛Dr/SOHc krk(7.94b)328 7 Attitude Control The two vectors wDc/STXrsun=kc/STXrsunkandrsun/STXwprovide an orthonormal basis for the plane perpendicular to the Sun. Note that wis a vector that points perpendicular to the Sun and lies in the equatorial plane. Thus when the spacecraft is near the equator, it is desired to have the target vector point along w, which corresponds to orbit angles of ˛D/EM=2 and˛D3/EM=2 . The vector rsun/STXwis also perpendicular to the Sun and points as close as possible to the northernmost point given the Sun constraint. Thus when the spacecraft is near the poles it is desired to have thetarget vector point along r sun/STXw, which corresponds to orbit angles of ˛D0 and˛D/EM. Since it is desired to rotate the body y-axis about the positive Sun line, the orientation of the orbit normal relative to the Sun line must be considered in thetarget vector. If the Sun passes through the orbit plane when the spacecraft is near the equator, this will cause a 180 ıﬂip, which we would like to prevent. The following target vector, expressed in inertial coordinates, has all these properties: urefD.rsun/STXw/cos˛CTswsin˛ (7.95) whereTsis the target sign variable, which has initial value of sign .rsun/SOHn/.I ft h e Sun passes through the orbit plane, the next time the spacecraft comes within 0.5ıof the northernmost or southernmost point of the orbit, whichever comes ﬁrst, then thevariableT swill change sign, which will keep the spacecraft rotating about the Sun line without causing a ﬂip. The body target vector is again found by using uDAuref whereAis the computed attitude matrix from the TRIAD algorithm. Reference [ 20] shows the following limiting cases for the ORR mode. When the Sun is perpendicular to the orbit plane, the ORR mode reduces to a zenith pointing mode, as shown in Fig. 7.20a. Since the target vector is given by Eq. ( 7.95) the rotation about the z-axis along the orbital path is zenith pointing, as shown in Fig.7.20b. For the case when the Sun is parallel to the orbit plane, the ORR mode becomes a zenith pointing mode over the poles and points in the r/STXpdirection at the equator. Figure 7.21a shows that wDc/STXrsun, and since the target vector is given by Eq. ( 7.95) the orientation of the z-axis can be determined throughout the orbital path, as shown in Fig. 7.21. 7.7.3.3 Special Pointing Mode After the discovery of a third radiation belt it was desired to change the pointing algorithm to orient the instrument boresights perpendicular to the magnetic ﬁeld linewhile passing through a region in the South Atlantic containing a high concentration of trapped particles. Figure 7.22 served as the “requirements document” from Dan Baker, a project scientist, and Glenn Mason, the SAMPEX Principal Investigator,which led to the SAMPEX special pointing mode. Details of this mode, documented in [28], are repeated here. In order to satisfy these revised science requirements, the pointing mode was modiﬁed using the magnetic ﬁeld strength kr magkas a delimiter to point the spacecraft perpendicular to the magnetic ﬁeld vector whenever the ﬁeld strength is determined to be less than some speciﬁed value, which was set to 3/STX7.7 SAMPEX Control Design 329 Orbital PathEarthr w Target Sign wrsun (Sun out of page) n (Orbit normal out of page) rsun (Sun out of page) n (Orbit normal out of page) Earth Orbital Pathrsun w uorra b Fig. 7.20 Sun is perpendicular to the orbit plane. ( a) Orbit rate rotation mode geometry. ( b)O r b i t rate rotation mode target pointing vector along the orbital path 104nT. This pointing uses magnetometer data to determine the ﬁeld direction in the spacecraft reference frame. Since the magnetometer data was judged to provide agood pointing reference, the speciﬁcation was changed in the high-ﬁeld regions to point as close to the magnetic ﬁeld vector as possible, consistent with the constraint that they-axis be pointed at the Sun. At northern latitudes, the desired orientation is anti-parallel to the ﬁeld, and in the South the orientation is parallel to the ﬁeld. In both cases, then, the spacecraft points away from the Earth in the polar regions. In the low-ﬁeld region the target vector is to be perpendicular to both the Sun vector and the magnetic ﬁeld vector. This requirement is obviously satisﬁed by choosing the target vector in the direction of the cross product b sun/STXbmag. The negative of this vector clearly satisﬁes the same requirement. One and onlyone of these two vectors is more than 90 ıfrom the velocity vector, and we choose this one to satisfy the velocity avoidance requirement. Since the magnetic control keeps the Sun vector within a few degrees of the y-axis vector j, the cross product bsun/STXbmagcan be well approximated by j/STXbmag, so the target vector is computed from the components of bmagas330 7 Attitude Control Orbital PathEarthr rsun• Target Sign w (into page) Earth Orbital Pathuorr ••n rsunw ( out of page)a brsun w Fig. 7.21 Sun is parallel to the orbit plane. ( a) Orbit rate rotation mode geometry. ( b)O r b i tr a t e rotation mode target pointing vector along the orbital path uD˙1q b2mag1Cb2mag32 4bmag3 0 /NULbmag13 5 (7.96) The upper sign is chosen if v/SOH.rsun/STXrmag//DC40and the lower sign is chosen ifv/SOH.rsun/STXrmag/>0 , where vis the spacecraft velocity vector in inertial coordinates computed from the onboard ephemeris. Note that binary decisions are based on velocity and magnetic ﬁeld vectors computed in the inertial frame fromthe ephemeris, in order to prevent toggling arising from noisy measurements; but that the TAM-sensed magnetic ﬁeld vector in the body frame is used to compute the actual pointing vector.7.7 SAMPEX Control Design 331 Fig. 7.22 Requirements speciﬁcation for SAMPEX special pointing mode The angle error in Eq. ( 7.90) is generally small, but it is on the order of 90ı during transitions between parallel pointing and perpendicular pointing. In these cases, the wheel is commanded in the direction that requires the smallest rotation to null the angle error. Due to changing geometry however, some time during a passage through a low ﬁeld region, a 180ıpitch maneuver is generally required to satisfy the avoidance requirement. The special pointing algorithm assures that any 180ıturns will be executed in a direction away from the velocity vector. Thus a computed pitch error angle magnitude greater than 2.5 rad is taken to signify a large reorientation maneuver. The sign of the x-axis component of the spacecraft velocity vector vin the body frame is then used to determine the direction of this maneuver, such that the instrument boresights are rotated away from the velocity vector rather than toward it.332 7 Attitude Control In the high-ﬁeld region, krmag1k>3/STX104nT, the target vector is to be perpendicular to the bodyy-axis and as close as possible to parallel or antiparallel to the magnetic ﬁeld vector bmag. Thus the target vector is given by uD˙1q b2mag1Cb2mag32 4bmag1 0 bmag33 5 (7.97) where the positive sign is used when SAMPEX is in the southern hemisphere and the negative sign in the northern hemisphere, as determined from the onboardephemeris. In the high-ﬁeld region the existing onboard velocity avoidance algo- rithm is still used. During coast mode the reaction wheel speed angular momentum is commanded to the ﬁxed value of the commanded momentum, H c, rather than to its instantaneous value at entry to coast mode as in the ORR mode. Since the total system angular momentum is maintained at Hcby magnetic torquer commands, this has the effect of halting spacecraft attitude motion in coast mode. This change was necessitated by the observation that coast mode could be entered during one of the rapid 90ıor 180ı maneuvers of the spacecraft, and holding the spacecraft y-axis rate constant at a high value could result in several rotations during coast mode. This undesirable behavior was actually seen in some simulations, but is avoided by the ﬁnal pointing law. 7.7.4 Reaction Wheel Control Law The single reaction wheel is used to drive down the angle error shown in Eq. ( 7.90). A proportional-integral-derivative (PID) control law [ 17] is used to command the wheel torque, denoted by Lw. The derivative signal is computed using a simple ﬁnite-difference approach: Pe/EMek/NULek/NUL1 /SOHt/DC1ederk (7.98) The integral portion, denoted by eint, is computed by simply using eintkDeintk/NUL1Cek/SOHt (7.99) The torque control law is then given by Lw kDkpekCkdederkCkieintk (7.100) wherekp,kdandkiare the proportional, derivative and integral gains, respectively, given as follows for the various modes:7.7 SAMPEX Control Design 333  All Modes: kpD!2 nJ22,kdD2/DLE!nJ22, andkiD.kpkd/=.10J22/.  Vertical and ORR Modes: /DLEDp 2=2and!nD0:02.  Special Pointing Mode: /DLEDp 2=2and!nD0:01. An integral limit is also imposed for all modes, which is set to 3/STX10/NUL3=ki.N o t e that unlike the magnetic control system no ﬁlter is used to ﬁlter noisy measurements in the wheel control law. This is because the measurement errors do not signiﬁcantly affect the overall wheel control performance to meet the desired speciﬁcations. Thisis an important point to make about the design phase of any spacecraft control system. Start with the simplest design for analysis purposes and then add one component, such as a Kalman ﬁlter, at a time to see how the performance improves.Once the desired speciﬁcations are met within some desired conﬁdence and safety factor then it is usually best to not add any more components. A system that is over-designed may lead to unknown errors that may subsequently cause catastrophicfailures. The SAMPEX design shows how simplicity often can lead to a successful control design that far exceeds initial lifetime performance speciﬁcations. 7.7.5 Simulations This section provides simulation results for all three modes. The epoch is September 16, 2011 at midnight. The simulation runtime is 5 h with a sampling interval of 5 sfor all sensors and actuators. The position and velocity vectors from the onboard ephemeris are given by r.t 0/D2 43335:973299 2571:763319 /NUL5370:9317393 5km;v.t0/D2 43:530941 4:9772684:5669403 5km/s (7.101) For these conditions the orbital altitude varies from an apogee of 450 km to a perigee of 390 km, which is far lower than the initial orbit insertion because of atmosphericdrag that decayed the orbit over the lifetime of the mission. But this orbit is still sufﬁcient to perform the required science modes. The onboard orbit propagator includes the effects of drag and higher-order gravity terms. Here only the effectsofJ 2are simulated because drag has an insigniﬁcant effect on the orbit over 5 h. The dynamic model is given by [ 36] RrD/NUL/SYN krk3CaJ2 (7.102) where aJ2is given by Eq. ( 10.103a ) withJ2from Table 10.2,/SYND3:98601/STX 105km3/s2, andR˚D6378:1363 km. A plot of SAMPEX longitude and latitude for this simulation is given in Fig. 7.23. The inclination of 82ıis clearly seen in this plot. A 10th-order IGRF model is used to generate the reference magnetic ﬁeld using334 7 Attitude Control 0 30 60 90 120 150 180 −150 −120 −90 −60 −30 0−90−80−70−60−50−40−30−20−100102030405060708090 Longitude (Deg)Latitude (Deg) Fig. 7.23 SAMPEX ground track the inertial position of the satellite. The inertial Sun vector is calculated simply from the epoch. All measurements are produced using the noise and resolution parameters discussed previously. The rotation dynamic models are given by PqD1 2/EOT.q/! (7.103a) PHD/NUL!/STXHCLmag (7.103b) PHwDLw(7.103c) where!DJ/NUL1.H/NULHwj/. For all simulations the initial quaternion is given by the identity quaternion, and the system and wheel momenta are set to zero. For theﬁrst 2 h the wheel is turned off in order to reorient the spacecraft so that the y-axis is pointed towards the Sun using magnetic torquers only. As previously mentioned the onboard attitude determination algorithm used the TRIAD algorithm, which ignores some part of the measurement. In order to provide more accurate attitude estimates Davenport’s qmethod is applied here (see Sect. 5.3). Using this approach allows us to increase the Kalman gain to 0.04 instead7.7 SAMPEX Control Design 335 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−20020406080100Sun Angle Error (Deg) Time (Hr)0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−200−150−100−50050100150200Pointing Angle Error (Deg) Time (Hr) 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−0.200.20.40.60.811.2Wheel Momentum (Nms) Time (Hr)0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51x 10−3 x 10−3 x 10−30 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51Lmag1 (Nm) Lmag2 (Nm) Lmag3 (Nm) Time (Hr)b a d c Fig. 7.24 SAMPEX vertical pointing mode. ( a) Sun angle error. ( b) Pointing angle error. ( c) Wheel momentum. ( d) Magnetic control torques of 0.01, which actually gives better ﬁltered estimates than the TRIAD method using a lower Kalman gain. Simulation results for the vertical pointing mode are shown in Fig. 7.24. The Sun error angle is shown in Fig. 7.24a. After 2 h the Sun error angle is about 10ı. Figure 7.24b shows the pointing error. Note that since the wheel is turned off for the ﬁrst 2 h there are large ﬂuctuations in the error angle. The wheel momentum is shown in Fig. 7.24c. After 2 h the wheel is turned on and drives the error angle to near zero. The magnetic control torques are shown in Fig. 7.24d. Note the large control torques at the beginning of the simulation run, which are required to reorient the y-axis along the Sun line. After that period only minimal control torques are required. Simulation results for the orbit rate rotation mode are shown inFig.7.25. Results are very similar to the vertical pointing mode results. Simulation results for the special pointing mode are shown in Fig. 7.26. Note that unlike the other two modes, the error angle is not always maintained at zero. The ﬂuctuationsare due to achieving the “best possible” angle given the constraints of the geometry from the orbit position and spacecraft orientation requirements, particularly the Sun336 7 Attitude Control 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−20020406080100Sun Angle Error (Deg) Time (Hr)0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−200−150−100−50050100150200Pointing Angle Error (Deg) Time (Hr) 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−0.200.20.40.60.811.2Wheel Momentum (Nms) Time (Hr)0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51 Time (Hr)Lmag1 (Nm) Lmag2 (Nm) Lmag3 (Nm)x 10−3 x 10−3 x 10−3b a d c Fig. 7.25 SAMPEX orbit rate rotation mode. ( a) Sun angle error. ( b) Pointing angle error. ( c) Wheel momentum. ( d) Magnetic control torques line pointing requirement. Still, the desired pointing is achieved enough to satisfy the special pointing mode requirements. It is important to note that although the control laws and ﬁlter developed for SAMPEX were very simple, they were proven to be extremely effective. Extended Kalman ﬁlters are widely used for onboard attitude estimators, even though ﬁlterstability cannot be guaranteed. Many, if not most, modern-day attitude controllers are very simple PID controllers. For example, the actual WMAP spacecraft uses a simple PID controller that is not asymptotically stable from a theoretical point ofview [ 3]. This leads to a “bias” in the control error signal, which was overcome by using a simple feed-forward term. Still the attitude control design meets the desired mission objectives because attitude knowledge accuracy is more important thanpointing accuracy for the WMAP spacecraft. The SAMPEX and WMAP attitude control designs epitomize the notion of “keep it simple” if sufﬁcient conﬁdence can be obtained that the controllers will meet mission objectives. Future spacecraftcontrol designs will most likely gravitate more towards Lyapunov-based controllers as conﬁdence grows in their ability to achieve desired mission objectives. AlthoughProblems 337 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−20020406080100Sun Angle Error (Deg) Time (Hr)0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−200−150−100−50050100150200Pointing Angle Error (Deg) Time (Hr) 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−0.200.20.40.60.811.2Wheel Momentum (Nms) Time (Hr)0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51 0 0.5 1 1.5 2 2.5 3 3.5 4 4.5 5−1−0.500.51 Time (Hr)Lmag1 (Nm) Lmag2 (Nm) Lmag3 (Nm)x 10−3 x 10−3 x 10−3b a d c Fig. 7.26 SAMPEX special pointing mode. ( a) Sun angle error. ( b) Pointing angle error. ( c) Wheel momentum. ( d) Magnetic control torques more complicated than simple PID controllers, these more advanced control laws may require fewer contingency mode analyses than simpler controllers, which may in fact reduce the time to design the actual spacecraft control system. Problems 7.1. Consider the following modiﬁed version of the control law given in Eq. (7.7)[49]: LD/NULkpJıq1W3/NULkdJ!CŒ!/STX/c141J! The error-quaternion given in Eq. ( 7.2) is represented by ıq/DC1/DC4ıq1W3 ıq4/NAK D/DC4/SOHesin.ı#=2/ cos.ı#=2//NAK338 7 Attitude Control where/SOHeis the axis of rotation and ı#is the angle. Substitute the control law into Eq. ( 7.1) and derive a second-order differential equation that is a function of ı#,kpandkdonly. (Hint: the expression shown in Problem 3.3may be helpful). Next, using a small angle approximation ﬁnd a linear form of this equation that leads to the classic form given in Sect. 12.2.1.1 ofıR#2C2/DLE!nıP#C!2 nı#D0. Determine the relationships of kpandkdto!nand/DLE. Assuming that !nD0:1 rad/s and/DLEDp 2=2determine the associated kpandkdvalues. Using these kpand kdvalues in the above modiﬁed control law perform a simulation study using the inertia matrix and initial conditions described in Example 7.1. 7.2. Consider the following modiﬁed version of the control law given in Eq. ( 7.7): LD/NULkpsign.ıq4/Jıq1W3/NULkdJ!CŒ!/STX/c141J! Substitute the control law into Eq. ( 7.1) and show that the closed-loop differential equation forıq4is given by ıRq4C/DC4ıq4ıPq4 .1/NULıq2 4/Ckd/NAK ıPq4C1 2kpjıq4jıq4D1 2kpsign.ıq4/ How does this differential equation change if the control law in Example 7.1is used instead, i.e. without sign .ıq4/? Numerically integrate the differential equation for ıq4for a total time of 30 min using both control laws; one with sign .ıq4/and one without it. Run two different initial conditions for both control laws: (1) ıq4.t0/D 0:5andıPq4.t0/D0, and (2)ıq4.t0/D/NUL0:5andıPq4.t0/D0. Use the following control gains for both control laws: kpD0:01 andkdD2. Compare the trajectories ofıq4over time in all cases and discuss how using sign .ıq4/produces the shortest distance. Also discuss the case using the following initial conditions: ıq4.t0/D0:5 andıPq4.t0/D/NUL1. 7.3. Redo the simulation shown in Example 7.1. Next, using the same gains from this example, implement the controller shown in Eq. ( 7.14). Try both the plus and minus signs in the control law. Compute the function in Eq. ( 7.9) for each of the three controllers and plot them over time. Also plot the rotation angle of error, ı#, for each of the three controllers. Discuss the differences seen in the responses. 7.4. Prove that the control law in Eq. ( 7.13) produces a globally asymptotic stable response for the closed-loop system. 7.5. Another attitude regulation control law involves using the attitude matrix directly [ 34]: LD/NULkps/NULKd! wherekpis a positive scalar, Kdis a diagonal matrix with positive elements andProblems 339 sD3X iD1riŒ.ıA ei//STX/c141ei where e1DŒ 100 /c141T,e2DŒ 010 /c141T,e3DŒ 001 /c141T, andr1,r2, andr3are positive scalars. The attitude error, ıA, is given by ıADAAT c, whereAcis a constant attitude matrix. Prove that this control law produces an asymptotically stable closed- loop system by using the following candidate Lyapunov function: VD1 2!TJ!Ckptr.R/NULRıA/ whereRis a diagonal matrix with elements given by r1,r2, andr3. First show that tr.R/NULRıA//NAK0. Note that the equality is given only when ıADI3. Next, consider the following gains: kp/DC1˛ trR Kd/DC1ˇ2 6666641 1Cj!1j00 01 1Cj!2j0 001 1Cj!3j3 777775 where˛andˇare positive scalars. Show that kL.t/k 1/DC4˛Cˇ. Begin by using the following relation: kL.t/k1DkkpsCKd!k1 /DC4kpksk1CkKd!k1 Perform a simulation using the inertia matrix and initial conditions given in Example 7.1with this control law. Choose the following gains: ˛D50,ˇD500, andRDI3. 7.6. Prove the relation given in Eq. ( 7.20). Next, show that the time derivative of ıq4isıPq4D1 2.!c/NUL!/Tıq1W3. 7.7. Prove that the control law in Eq. ( 7.36) produces a globally asymptotic stable response for the closed-loop tracking system. 7.8. In this exercise you will design a controller that tracks an LVLH attitude. Consider the following orbital elements: aD26;559 km,eD0:704482 ,M0D 12:9979ı,iD63:1706ı,˝D206:346ı, and!D281:646ı. Note that this is a highly eccentric orbit. Compute the initial position and velocity using Table 10.1, and then propagate the orbit for an 18-h period in 10-s intervals. Next, compute the340 7 Attitude Control desired LVLH attitude using Eq. ( 2.79) and angular rate using Eq. ( 3.175 ). Also ﬁnd an analytical expression for the derivative of Eq. ( 3.175 ). Assume that the actual initial attitude is given by the identity matrix and the actual initial angular rate isgiven by zero. The inertia matrix is given by JD2 410000 0 0 0 9000 00 0 120003 5kg-m 2 Finally, using the control law given by Eq. ( 7.36) pick values of kpandkdso that the actual attitude and angular rate converges to the desired attitude and angular rate in about 10 min. Show plots of the orbit, the ﬁrst three components of the error quaternion and the angular velocity errors using Eq. ( 7.31). 7.9. Consider the case of tracking a desired quaternion with kinematics given by PqcD1 2/EOT.qc/!c where!cis the desired angular velocity vector. The error quaternion is given by ıqDq˝q/NUL1 c. Let us assume that the closed-loop kinematic equation is desired to have the following prescribed linear form [ 32]: ıRq1W3CL2ıPq1W3CL1ıq1W3D0 whereL1andL2are3/STX3gain matrices. Determine the control law that will yield this closed-loop linear form. Next, assuming that both L1andL2are each given by a scalar times identity matrix, with L1D`1I3,L2D`2I3, show that your derived control law reduces down to LDŒ!/STX/c141J!CJ/SUB ıAP!c/NULŒ!/STX/c141ıA!c/NUL`2ı!/NUL2/DC44`1/NUL.ı!Tı!/ 4ıq4/NAK ıq1W3/ESC with ıADA.q/AT.qc/ ı!D!/NULıA!c This control law is clearly singular when ıq4D0. Do the same issues arise in the control law that uses general 3/STX3L1andL2gain matrices? 7.10. Redo the simulation shown in Example 7.4. Pick different values for the PWPF parameters to see how they affect the overall performance. 7.11. Redo the simulation shown in Example 7.6. Pick different values for kto see how they affect the overall performance.References 341 7.12. Redo the simulation shown in Example 7.7. Pick different values for the various parameters in the control law as well as different noise levels to see how they affect the overall performance. References Agrawal, B.N., McClelland, R.S., Song, G.: Attitude control of ﬂexible spacecraft using pulse- width pulse-frequency modulated thrusters. Space Tech. 17(1), 15–34 (1997) Anderson, B.D.O., Moore, J.B.: Optimal Control: Linear Quadratic Methods. Prentice Hall, Englewood Cliffs (1990) Andrews, S.F., Campbell, C.E., Ericsson-Jackson, A.J., Markley, F.L., O’Donnell Jr., J.R.: MAP attitude control system design and analysis. In: Proceedings of the Flight Mechan-ics/Estimation Theory Symposium, pp. 445–456. NASA-Goddard Space Flight Center,Greenbelt (1997) Arantes, G., Martins-Filho, L.S., Santana, A.C.: Optimal on-off attitude control for the Brazilian Multimission Platform satellite. Math. Probl. Eng. 2009 (1) (2009) Åström, K.J.: Introduction to Stochastic Control Theory. Academic Press, New York (1970)6. Avanzini, G., Giulietti, F.: Magnetic detumbling of a rigid spacecraft. J. Guid. Contr. Dynam. 35(4), 1326–1334 (2012) Bhat, S.P., Dham, A.S.: Controllability of spacecraft attitude under magnetic actuation. In: Proceedings of the 42nd IEEE Conference on Decision and Control, pp. 2383–2388. Maui(2003) Camillo, P.J., Markley, F.L.: Orbit-averaged behavior of magnetic control laws for momentum unloading. J. Guid. Contr. 3(6), 563–568 (1980) Challa, M.S., Natanson, G.A., Baker, D.E., Deutschmann, J.K.: Advantages of estimating rate corrections during dynamic propagation of spacecraft rates-applications to real-time attitudedetermination of SAMPEX. In: Proceedings of the Flight Mechanics/Estimation TheorySymposium, pp. 481–495. NASA-Goddard Space Flight Center, Greenbelt (1994) Chen, L.C., Lerner, G.M.: Three-axis attitude determination. In: Wertz, J.R. (ed.) Sun Sensor Models, chap. 7. Kluwer Academic, Dordrecht (1978) Chu, D., Harvie, E.: Accuracy of the ERBS deﬁnitive attitude determination system in the presence of propagation noise. In: Proceedings of the Flight Mechanics/Estimation TheorySymposium, pp. 97–114. NASA-Goddard Space Flight Center, Greenbelt (1990) Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press, Boca Raton (2012) Crassidis, J.L., Markley, F.L.: Sliding mode control using modiﬁed Rodrigues parameters. J. Guid. Contr. Dynam. 19(6), 1381–1383 (1996) Crassidis, J.L., Markley, F.L.: Predictive ﬁltering for attitude estimation without rate sensors. J. Guid. Contr. Dynam. 20(3), 522–527 (1997) Crassidis, J.L., Vadali, S.R., Markley, F.L.: Optimal variable-structure control tracking of spacecraft maneuvers. J. Guid. Contr. Dynam. 23(3), 564–566 (2000) Davis, M.: Linear Estimation and Stochastic Control. Chapman and Hall, London (1977)17. Dorf, R.C., Bishop, R.H.: Modern Control Systems. Addison Wesley Longman, Menlo Park (1998) Dwyer, T.A.W., Sira-Ramirez, H.: Variable structure control of spacecraft reorientation maneuvers. J. Guid. Contr. Dynam. 11(3), 262–270 (1988) Flatley, T.W., Forden, J.K., Henretty, D.A., Lightsey, E.G., Markley, F.L.: On-board atti- tude determination and control algorithms for SAMPEX. In: Proceedings of the FlightMechanics/Estimation Theory Symposium, pp. 379–398. NASA-Goddard Space Flight Center,Greenbelt (1990)342 7 Attitude Control Frakes, J.P., Henretty, D.A., Flatley, T.W., Markley, F.L., Forden, J.K., Lightsey, E.G.: SAMPEX science pointing modes with velocity avoidance. In: Proceedings of the 2ndAAS/AIAA Spaceﬂight Mechanics Meeting, pp. 949–966. Colorado Springs (1992) Junkins, J.L., Turner, J.D.: Optimal Spacecraft Rotational Maneuvers. Elsevier, New York (1986) Kang, W.: Nonlinear H 1control and its application to rigid spacecraft. IEEE Trans. Automat. Contr. 40(7), 1281–1285 (1995) Koon, W.S., Lo, M.W., Marsden, J.E., Ross, S.D.: Dynamical Systems, The Three-Body Problem and Space Mission Design. Marsden Books, Pasadena (2011) Krøvel, T.D.: Optimal tuning of PWPF modulator for attitude control. Master’s thesis, Norwegian University of Science and Technology, Department of Engineering Cybernetics,Trondheim (2005) Lizarralde, F., Wen, J.T.Y .: Attitude control without angular velocity measurement: A passivity approach. IEEE Trans. Automat. Contr. 41(3), 468–472 (1996) Lovera, M.: Optimal magnetic momentum control for inertially pointing spacecraft. Eur. J. Contr. 7(1), 30–39 (2001) Markley, F.L., Andrews, S.F., O’Donnell Jr., J.R., Ward, D.K.: Attitude control system of the Wilkinson Microwave Anisotropy Probe. J. Guid. Contr. Dynam. 28(3), 385–397 (2005) Markley, F.L., Flatley, T.W., Leoutsakos, T.: SAMPEX special pointing mode. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium, pp. 201–215. NASA-Goddard SpaceFlight Center, Greenbelt (1995) Mayhew, C.G., Sanfelice, R.G., Teel, A.R.: Robust global asymptotic attitude stabilization of a rigid body by quaternion-based hybrid feedback. In: Joint 48th IEEE Conference on Decision and Control and 28th Chinese Control Conference, pp. 2522–2527. Shanghai (2009) Mayhew, C.G., Sanfelice, R.G., Teel, A.R.: Quaternion-based hybrid control for robust global attitude tracking. IEEE Trans. Automat. Contr. AC-56 (11), 2555–2565 (2011) McCullough, J.D., Flatley, T.W., Henretty, D.A., Markley, F.L., San, J.K.: Testing of the on- board attitude determination and control algorithms for SAMPEX. In: Proceedings of theFlight Mechanics/Estimation Theory Symposium, pp. 55–68. NASA-Goddard Space FlightCenter, Greenbelt (1992) Paielli, R.A., Bach, R.E.: Attitude control with realization of linear error dynamics. J. Guid. Contr. Dynam. 16(1), 182–189 (1993) Sanfelice, R.G., Messina, M.J., Tuna, S.E., Teel, A.R.: Robust hybrid controllers for continuous-time systems with applications to obstacle avoidance and regulation to discon-nected set of points. In: American Control Conference, pp. 3352–3357. Minneapolis (2006) Sanyal, A., Fosbury, A., Chaturvedi, N., Bernstein, D.S.: Inertia-free spacecraft attitude tracking with disturbance rejection and almost global stabilization. J. Guid. Contr. Dynam.32(4), 1167–1178 (2009) Schaub, H., Akella, M.R., Junkins, J.L.: Adaptive control of nonlinear attitude motions realizing linear closed loop dynamics. J. Guid. Contr. Dynam. 24(1), 95–100 (2001) Schaub, H., Junkins, J.L.: Analytical Mechanics of Aerospace Systems, 2nd edn. American Institute of Aeronautics and Astronautics, New York (2009) Scrivener, S.L., Thompson, R.C.: Survey of time-optimal attitude maneuvers. J. Guid. Contr. Dynam. 17(2), 225–233 (1994) Shuster, M.D., Dellinger, W.F.: Spacecraft attitude determination and control. In: V .L. Pisacane (ed.) Fundamentals of Space Systems, 2nd edn., chap. 5. Oxford University Press, New York(2005) Sidi, M.J.: Spacecraft Dynamics and Control: A Practical Engineering Approach. Cambridge University Press, New York (2006) Silani, E., Lovera, M.: Magnetic spacecraft attitude control: A survey and some new results. Contr. Eng. Pract. 13(3), 357–371 (2005) Slotine, J.J.E., Li, W.: Applied Nonlinear Control. Prentice Hall, Englewood Cliffs (1991)42. Stengel, R.F.: Optimal Control and Estimation. Dover Publications, New York (1994)References 343 Stickler, A.C., Alfriend, K.T.: Elementary magnetic attitude control system. J. Spacecraft Rockets 13(5), 282–287 (1976) Tsai, D.C., Markley, F.L., Watson, T.P.: SAMPEX spin stabilized mode. In: SpaceOps Conference. Heidelberg, Germany (2008). AIAA 2008–3435 Tsiotras, P.: Stabilization and optimality results for the attitude control problem. J. Guid. Contr. Dynam. 19(4), 772–779 (1996) Vadali, S.R.: Variable structure control of spacecraft large angle maneuvers. J. Guid. Contr. Dynam. 9(2), 235–239 (1986) Vadali, S.R., Junkins, J.L.: Optimal open-loop and stable feedback control of rigid spacecraft maneuvers. J. Astronaut. Sci. 32(2), 105–122 (1984) White, J.S., Shigemoto, F.H., Bourquin, K.: Satellite attitude control utilizing the Earth’s magnetic ﬁeld. Tech. Rep. NASA-TN-D-1068, A-474, NASA Ames Research Center, MoffettField (1961) Wie, B.: Space Vehicle Dynamics and Control, 2nd edn. American Institute of Aeronautics and Astronautics, Reston (2008) Wie, B., Barba, P.M.: Quaternion feedback for spacecraft large angle maneuvers. J. Guid. Contr. Dynam. 8(3), 360–365 (1985)Chapter 8 Quaternion Identities The purpose of this chapter is to present a collection of vector and quaternion identities that are useful for control and estimation computations. Many of themused throughout this text. Several appear in Chap. 2but are repeated here for convenience. 8.1 Cross Product Identities The3/STX3skew-symmetric cross-product matrix is deﬁned as Œu/STX/c141/DC12 40/NULu3u2 u30/NULu1 /NULu2u103 5 (8.1) givingŒu/STX/c141vDu/STXv. SinceŒu/STX/c141uD0,Œu/STX/c141must be singular. The eigenvalues ofŒu/STX/c141are given by /NAK1D0and/NAK2;3D˙ikuk. Some useful identities for the cross-product matrix include [ 6]: Œu/STX/c141TD/NULŒu/STX/c141 (8.2a) adj.Œu/STX/c141/DuuT(8.2b) Œu/STX/c141vD/NULŒv/STX/c141u (8.2c) Œu/STX/c141Œv/STX/c141D/NUL/NUL uTv/SOH I3CvuT(8.2d) Œu/STX/c141Œv/STX/c141wDu/STX.v/STXw/D/NUL uTw/SOH v/NUL/NUL uTv/SOH w (8.2e) Œu/STX/c1413D/NULk uk2Œu/STX/c141 (8.2f) Œu/STX/c141Œv/STX/c141/NULŒv/STX/c141Œu/STX/c141DvuT/NULuvTDŒ.u/STXv//STX/c141 (8.2g) F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _8, © Springer Science+Business Media New York 2014345346 8 Quaternion Identities .I3/NULŒu/STX/c141/.I3CŒu/STX/c141//NUL1D1 1Ckuk2˚ .1/NULkuk2/I3C2uuT/NUL2Œu/STX/c141/TAB (8.2h) ku/STXvk2I3Dkuk2vvTCkvk2uuT/NUL/NUL uTv/SOH/NUL uvTCvuT/SOH C.u/STXv/.u/STXv/T (8.2i) whereInis ann/STXnidentity matrix. Some useful identities involving the cross- product matrix and an arbitrary 3/STX3matrixMare: tr.M/Œ u/STX/c141DMŒu/STX/c141CŒu/STX/c141MTCŒ.MTu//STX/c141 (8.3a) MŒu/STX/c141MTDŒfadj.MT/ug/STX/c141 (8.3b) Œf.Mu//STX.Mv/g/STX/c141DMŒ.u/STXv//STX/c141MT(8.3c) .Mu//STX.Mv/Dadj.MT/.u/STXv/ (8.3d) Œu/STX/c141Œtr.M/I3/NULM/c141Œu/STX/c141TD.uTMu/I3/NULuuTMT/NULMTuuTCkuk2MT(8.3e) where tr denotes the trace operator and adj denotes the adjoint matrix. If we write Min terms of its columns MD/STX u1u2u3/ETX (8.4) then det.M/DuT 1.u2/STXu3/ (8.5) where det denotes the determinant. Also, if Ais an orthogonal matrix with determinant 1, then from we have Eq. ( 8.3b) AŒu/STX/c141ATDŒ.Au//STX/c141 (8.6) These cross product relations are useful in proving many of the quaternion identities shown in this chapter. 8.2 Basic Quaternion Identities The quaternion has a vector part, q1W3, and a scalar part, q4: q/DC12 664q1 q2 q3 q43 775/DC1/DC4q1W3 q4/NAK (8.7)8.2 Basic Quaternion Identities 347 We deﬁne two 4/STX4matrices analogous to the 3/STX3cross-product matrix: Œq˝/c141/DC1/DC4q4I3/NULŒq1W3/STX/c141q1W3 /NULqT 1W3q4/NAK D/STX /TAB.q/q/ETX (8.8a) Œqˇ/c141/DC1/DC4q4I3CŒq1W3/STX/c141q1W3 /NULqT 1W3q4/NAK D/STX /EOT.q/q/ETX (8.8b) with/TAB.q/and/EOT.q/being the4/STX3matrices /TAB.q//DC1/DC4q4I3/NULŒq1W3/STX/c141 /NULqT 1W3/NAK (8.9a) /EOT.q//DC1/DC4q4I3CŒq1W3/STX/c141 /NULqT 1W3/NAK (8.9b) These matrices provide two alternative products of two quaternions qandNq: q˝NqDŒq˝/c141Nq (8.10a) qˇNqDŒqˇ/c141Nq (8.10b) The ﬁrst of these, denoted by ˝, has proved to be more useful in attitude analysis. It follows from these deﬁnitions that q˝NqDNqˇq (8.11) Quaternion multiplication is associative, q˝.Nq˝NNq/D.q˝Nq/˝NNqand distributive, q˝.NqCNNq/Dq˝NqCq˝NNq. Quaternion multiplication is notcommutative in general, q˝Nq¤Nq˝q, paralleling the situation for matrix multiplication. In those cases for which q˝NqDNq˝q, the quaternions qandNqare said to commute. Analogous equations hold for the product qˇNq. The identity quaternion Iq/DC1/DC403 1/NAK (8.12) obeys Iq˝qDq˝IqDIqˇqDqˇIqDq, as required of the identity. The conjugate quaternion q/ETXis obtained, in analogy with the complex conjugate, by changing the sign of the three-vector part: q/ETX/DC1/DC4/NULq1W3 q4/NAK DTq (8.13) where T/DC1/DC4/NULI303/STX1 01/STX31/NAK (8.14)348 8 Quaternion Identities Note thatT2D1,s oT/NUL1DT. The conjugate of the product of two quaternions Nq andqis the product of the conjugates in the opposite order: .Nq˝q//ETXDq/ETX˝Nq/ETX(8.15) The product of a quaternion with its conjugate is equal to the square of its norm times the identity quaternion q˝q/ETXDq/ETX˝qDqˇq/ETXDq/ETXˇqDkqk2Iq (8.16) These relations and the associativity of quaternion multiplication can be used to show that kNq˝qkDkNqˇqkDkNqkkqk (8.17) The inverse of any quaternion having nonzero norm is deﬁned by q/NUL1/DC1q/ETX=kqk2(8.18) so that q˝q/NUL1Dq/NUL1˝qDqˇq/NUL1Dq/NUL1ˇqDIq, as required by the deﬁnition of an inverse. The inverse of the product of two quaternions is the product of the inverses in the opposite order .Nq˝q//NUL1Dq/NUL1˝Nq/NUL1. Some useful identities are given by Œq/ETX˝/c141DŒq˝/c141TDTŒqˇ/c141T (8.19a) Œq/ETXˇ/c141DŒqˇ/c141TDTŒq˝/c141T (8.19b) Œq˝/c141ŒNqˇ/c141DŒNqˇ/c141Œq˝/c141 (8.19c) Œq˝/c141Œq/ETX˝/c141DŒq˝/c141Œq˝/c141TDkqk2I4 (8.19d) Œqˇ/c141Œq/ETXˇ/c141DŒqˇ/c141Œqˇ/c141TDkqk2I4 (8.19e) Œq˝/c141/NUL1Dkqk/NUL2Œq/ETX˝/c141DŒq/NUL1˝/c141 (8.19f) Œqˇ/c141/NUL1Dkqk/NUL2Œq/ETXˇ/c141DŒq/NUL1ˇ/c141 (8.19g) ŒIq˝/c141DŒIqˇ/c141DI4 (8.19h) Œq˝/c141IqDŒqˇ/c141IqDq (8.19i) Œ.q˝Nq/˝/c141DŒq˝/c141ŒNq˝/c141Dkqk/NUL2Œq˝/c141Œ.Nq˝q/˝/c141Œq˝/c141T DkNqk/NUL2ŒNq˝/c141TŒ.Nq˝q/˝/c141ŒNq˝/c141 (8.19j) Œ.q˝Nq/ˇ/c141DŒNqˇ/c141Œqˇ/c141Dkqk/NUL2Œqˇ/c141TŒ.Nq˝q/ˇ/c141Œqˇ/c141 DkNqk/NUL2ŒNqˇ/c141Œ.Nq˝q/ˇ/c141ŒNqˇ/c141T(8.19k)8.3 The Matrices /EOT.q/,/TAB.q/,˝.!/ ,a n d/NUL.!/ 349 8.3 The Matrices /EOT.q/,/TAB.q/,˝.!/ ,a n d/NUL.!/ The matrices /EOT.q/and/TAB.q/satisfy the identities /EOTT.q//EOT.q/D/TABT.q//TAB.q/Dkqk2I3 (8.20a) /EOT.q//EOTT.q/D/TAB.q//TABT.q/Dkqk2I4/NULqqT(8.20b) /EOTT.q/qD/TABT.q/qD03 (8.20c) /EOTT.q/NqD/NUL/EOTT.Nq/q (8.20d) /TABT.q/NqD/NUL/TABT.Nq/q (8.20e) /EOTT.q//TAB.Nq/D/EOTT.Nq//TAB.q/ (8.20f) /TABT.q//EOT.Nq/D/TABT.Nq//EOT.q/ (8.20g) /TAB.q//TABT.Nq/CqNqTDŒq˝/c141ŒNq/ETX˝/c141DŒ.q˝Nq/ETX/˝/c141 (8.20h) /EOT.q//EOTT.Nq/CqNqTDŒqˇ/c141ŒNq/ETXˇ/c141DŒ.Nq/ETX˝q/ˇ/c141 (8.20i) We will overload the quaternion product notation to allow us to multiply a three- component vector !and a quaternion, using the deﬁnitions !˝q/DC1/DC4! 0/NAK ˝qDŒ!˝/c141qDqˇ!DŒqˇ/c141!D/EOT.q/! (8.21a) !ˇq/DC1/DC4! 0/NAK ˇqDŒ!ˇ/c141qDq˝!DŒq˝/c141!D/TAB.q/! (8.21b) We also use the alternate notation ˝.!//DC1Œ!˝/c141D/DC4/NULŒ!/STX/c141! /NUL!T0/NAK (8.22a) /NUL.!//DC1Œ!ˇ/c141D/DC4Œ!/STX/c141! /NUL!T0/NAK (8.22b) Note that the matrices ˝.!/and/NUL.!/are both skew-symmetric with eigenvalues /NAK1;3Dik!kand/NAK2;4D/NULik!k. Some useful identities valid for any 3/STX1vectors b,r, and!are given by [ 6] ˝.b//NUL.r/D/NUL.r/˝.b/ (8.23a) ˝.!/qD/EOT.q/! (8.23b) /NUL.!/qD/TAB.q/! (8.23c)350 8 Quaternion Identities Œq˝/c141/NUL.!/D/NUL.!/Œq˝/c141 (8.23d) Œqˇ/c141˝.!/D˝.!/Œqˇ/c141 (8.23e) ˝.!//EOT.q/D/NUL/EOT.q/Œ!/STX/c141/NULq!T(8.23f) /NUL.!//TAB.q/D/TAB.q/Œ!/STX/c141/NULq!T(8.23g) ˝2.!/D/NUL2.!/D/NULk!k2I4 (8.23h) detŒ˝.!//c141DdetŒ/NUL.!//c141Dk!k4(8.23i) /EOTT.q/˝.!//EOT.q/D/NULk qk2Œ!/STX/c141 (8.23j) /TABT.q//NUL.!//TAB.q/Dkqk2Œ!/STX/c141 (8.23k) ˝.b/STXr/D1 2Œ˝.r/˝.b//NUL˝.b/˝.r//c141 (8.23l) /NUL.b/STXr/D1 2Œ/NUL.b//NUL.r//NUL/NUL.r//NUL.b//c141 (8.23m) 8.4 Identities Involving the Attitude Matrix The four-component quaternion representation of attitude is related to the Euler axis/angle representation by q kqkD1q q2 4Ckq1W3k2/DC4q1W3 q4/NAK D/DC4esin.#=2/ cos.#=2//NAK (8.24) where eis a unit vector corresponding to the axis of rotation and #is the angle of rotation. Then the attitude matrix is given by A.q//DC1kqk/NUL2/EOTT.q//TAB.q/Dkqk/NUL2n .q4I3/NULŒq1W3/STX/c141/2Cq1W3qT 1W3o Dkqk/NUL2˚/NUL q2 4/NULkq1W3k2/SOH I3C2q1W3qT 1W3/NUL2q4Œq1W3/STX/c141/TAB(8.25) which agrees with the Euler axis/angle representation of Eq. ( 2.108 ). The rotation group has only three degrees of freedom, so a quaternion has more components than it needs. In fact, it is clear from Eq. ( 8.25) that the attitude matrix does not depend on the quaternion norm in any way.1For this reason, the attitude quaternion is usually deﬁned with unit norm, kqkD1. This is analogous to 1Some authors deﬁne the attitude matrix without the factor of kqk/NUL2even if the quaternion is not normalized, with the result that the attitude matrix is not guaranteed to be orthogonal.8.4 Identities Involving the Attitude Matrix 351 requiring that ebe a unit vector in the Euler axis/angle parameterization, and is the convention adopted in Chap. 2in this book. For greater generality, however, the identities in this chapter will not assume that the quaternion obeys the normconstraint. If the attitude quaternions are normalized, all the quaternion norms in the following identities have the value unity and can be safely ignored. Now Eqs. ( 8.20a )/NUL(8.20c ) can be used to show that A /NUL1.q/DAT.q/DA.q/ETX/ (8.26) and that serial rotations are easily accomplished by multiplying quaternions, A.Nq/A.q/DA.Nq˝q/DA.qˇNq/ (8.27) regardless of whether or not the quaternions are normalized. The order of multi- plication of the quaternions using the ˝product is the same as that of the attitude matrix, which is a major advantage of this multiplication convention. Quaternion multiplication can be used in place of matrix multiplication to transform a three-component vector [ 6]: q˝!˝q/NUL1Dkqk/NUL2q˝/DC4! 0/NAK ˝q/ETXD/DC4A.q/! 0/NAK (8.28a) q/NUL1˝!˝qDkqk/NUL2q/ETX˝/DC4! 0/NAK ˝qD/DC4AT.q/! 0/NAK (8.28b) Some useful identities are [ 6] Œq˝/c141Œq/NUL1ˇ/c141DŒq/NUL1ˇ/c141Œq˝/c141D/DC4A.q/03/STX1 01/STX31/NAK (8.29a) Œq˝/c141˝.!/Œq/NUL1˝/c141D˝.A.q/!/ (8.29b) Œq/NUL1˝/c141˝.!/Œq˝/c141D˝/NUL AT.q/!/SOH (8.29c) Œq/NUL1ˇ/c141/NUL.!/Œqˇ/c141D/NUL.A.q/!/ (8.29d) Œqˇ/c141/NUL.!/Œq/NUL1ˇ/c141D/NUL/NUL AT.q/!/SOH (8.29e) Œq/NUL1˝/c141/EOT.q/D/DC4AT.q/ 01/STX3/NAK (8.29f) Œq/NUL1ˇ/c141/TAB.q/D/DC4A.q/ 01/STX3/NAK (8.29g) Identities involving Œ.q˝Nq/ETX/˝/c141are given by Œ.q˝Nq/ETX/˝/c141D/EOT.q/A.q˝Nq/ETX//EOTT.Nq/CqNqT(8.30a) Œ.q˝Nq/ETX/˝/c141/EOT.Nq/DkNqk2/EOT.q/A.q˝Nq/ETX/ (8.30b)352 8 Quaternion Identities /EOTT.q/Œ.q˝Nq/ETX/˝/c141Dkqk2A.q˝Nq/ETX//EOTT.Nq/ (8.30c) /EOTT.q/Œ.q˝Nq/ETX/˝/c141/EOT.Nq/Dkqk2kNqk2A.q˝Nq/ETX/ (8.30d) Identities involving Œ.Nq/ETX˝q/ˇ/c141are given by Œ.Nq/ETX˝q/ˇ/c141D/TAB.q/A.q/ETX˝Nq//TABT.Nq/CqNqT(8.31a) Œ.Nq/ETX˝q/ˇ/c141/TAB.Nq/DkNqk2/TAB.q/A.q/ETX˝Nq/ (8.31b) /TABT.q/Œ.Nq/ETX˝q/ˇ/c141Dkqk2A.q/ETX˝Nq//TABT.Nq/ (8.31c) /TABT.q/Œ.Nq/ETX˝q/ˇ/c141/TAB.Nq/Dkqk2kNqk2A.q/ETX˝Nq/ (8.31d) Equations ( 8.19j )o r( 8.19k ) can be used to exchange Nq/ETX˝qandq˝Nq/ETXif needed. We now derive some useful identities for attitude determination. If bandrare any two three-component vectors, then kqk2bTA.q/rDbT/EOTT.q//TAB.q/rDŒ˝.b/q/c141T/NUL.r/qD/NULqT˝.b//NUL.r/q(8.32) where /NUL˝.b//NUL.r/D/DC4BCBT/NULtr.B/I3.b/STXr/ .b/STXr/Ttr.B//NAK /DC1K (8.33) with B/DC1brT(8.34) This was shown in Sect. 5.3to lead to Davenport’s qmethod [ 7]. Equations ( 8.23a ) and ( 8.23h ) can be used to show that KD/NUL˝.b//NUL.r/D1 2/STX/NUL kbk2Ckrk2/SOH I4/NULCTC/ETX(8.35) where C/DC1/NUL.r//NUL˝.b/D/DC4Œ.bCr//STX/c141/NUL.b/NULr/ .b/NULr/T0/NAK (8.36) This has been used to develop a square-root attitude determination algorithm [ 5]. Equations ( 8.23b ) and ( 8.23c ) lead to an identity closely related to Eq. ( 8.35) that is used in a measurement model that is linear in the quaternion [ 1]: /TAB.q/r/NUL/EOT.q/bDCq (8.37)8.4 Identities Involving the Attitude Matrix 353 Also, if bDA.q/r, then 2/EOT. q/Œb/STX/c141/EOTT.q/D2/TAB.q/Œr/STX/c141/TABT.q/Dkqk2C (8.38) Other identities are given by /EOT.q/A.q/D/TAB.q/ (8.39a) ˝.A.q/!/qD/NUL.!/q (8.39b) /EOTT.q//NUL.!//EOT.q/Dkqk2ŒA.q/!/STX/c141 (8.39c) /TABT.q/˝.!//TAB.q/D/NULk qk2ŒAT.q/!/STX/c141 (8.39d) /EOT./NUL.!/q/D/NUL.!//EOT.q/D˚ /TAB.q/Œ!/STX/c141/NULq!T/TAB AT.q/ (8.39e) /TAB.˝.!/q/D˝.!//TAB.q/D/NUL˚ /EOT.q/Œ!/STX/c141Cq!T/TAB A.q/ (8.39f) /EOT.˝.!/q/D/NUL/NUL AT.q/!/SOH /EOT.q/D/EOT.q/Œ!/STX/c141/NULq!T(8.39g) /TAB./NUL.!/q/D˝.A.q/!//TAB.q/D/NUL/TAB.q/Œ!/STX/c141/NULq!T(8.39h) /STX/NUL /EOTT.q/Kq/SOH /STX/ETX Dkqk2/STX A.q/BT/NULBAT.q//ETX (8.39i) /EOTT.q/KqDkqk2Œb/STX/c141A.q/r (8.39j) /TABT.q/KqD/NULk qk2Œr/STX/c141AT.q/b (8.39k) withKandBgiven by Eqs. ( 8.33) and ( 8.34), respectively. All the identities in this section except Eq. ( 8.38) are valid for any 3/STX1vectors b,r, and!. We now use Eqs. ( 8.25) and ( 8.23c ) to derive the measurement sensitivity matrix used in the additive extended Kalman ﬁlter [ 3]. Our goal is to ﬁnd an expression for H/DC1@ @qŒA.q/r/c141D@ @q/STX kqk/NUL2/EOTT.q//NUL.r/q/ETX (8.40) It is important to include the factor of kqk/NUL2when evaluating the partial derivatives because the components of qare varied independently during this process, violating the norm constraint. Evaluating the partials in Eq. ( 8.40)g i v e s HDkqk/NUL2/DC4@ @q/EOTT.q//NAK /NUL.r/qCkqk/NUL2/EOTT.q//NUL.r//NUL2kqk/NUL4/EOTT.q//NUL.r/qqT (8.41) Note in the ﬁrst term that /NUL.r/q/DC1Nqis an unnormalized quaternion that is assumed constant during the differentiation, so we can use Eq. ( 8.20d ) to get /DC4@ @q/EOTT.q//NAK /NUL.r/qD@ @q/STX /EOTT.q/Nq/ETX D/NUL@ @q/STX /EOTT.Nq/q/ETX D/NUL/EOTT.Nq/D/EOTT.q//NUL.r/ (8.42)354 8 Quaternion Identities where the last equality results from Eq. ( 8.39e ). Collecting terms and using Eq. (8.20b ) yields HD2kqk/NUL4/EOTT.q//NUL.r//NUL kqk2I4/NULqqT/SOH D2kqk/NUL4/EOTT.q//NUL.r//EOT.q//EOTT.q/ (8.43) Then applying Eq. ( 8.39c ) gives the ﬁnal result HD2kqk/NUL2ŒA.q/r/STX/c141/EOTT.q/ (8.44) Note thatkqkD1in most applications and that the sensitivity matrix in the multiplicative ﬁlter is ŒA.q/r/STX/c141[3]. 8.5 Error Quaternions A common quantity used in estimation and control is the error quaternion between two quaternions, denoted by ıq/DC1/DC4ıq1W3 ıq4/NAK Dq˝Nq/NUL1DkNqk/NUL2q˝Nq/ETX(8.45) whereNqis the estimated quaternion in estimation theory or the desired quaternion in control theory. The rules of quaternion multiplication show that kıqkDk qk=kNqk, and thatıq1W3andıq4are given by ıq1W3DkNqk/NUL2/EOTT.Nq/qD/NULkNqk/NUL2/EOTT.q/Nq (8.46a) ıq4DkNqk/NUL2NqTq (8.46b) Ifıqis normalized and is close to the identity quaternion, then ıq1W3/EM˛=2and ıq4/EM1, where˛is a vector of small angle rotations. As qapproachesNq, thenıq1W3 and˛both approach zero. A “space-referenced error quaternion,” ıqI, is deﬁned by ıqI/DC1/DC4ıq1W3I ıq4/NAK DNq/NUL1˝qDNq/NUL1˝ıq˝Nq (8.47a) ıqDNq˝ıqI˝Nq/NUL1(8.47b) Quaternion multiplication shows that ıq4IDıq4and thatıq1W3Iis given by ıq1W3IDkNqk/NUL2/TABT.Nq/qD/NULkNqk/NUL2/TABT.q/Nq (8.48)8.6 Quaternion Kinematics 355 The meaning of the space-referenced error quaternion is clearly shown by2 ıq1W3DA.q/ıq1W3IDA.Nq/ıq1W3I (8.49a) ıq1W3IDAT.q/ıq1W3DAT.Nq/ıq1W3 (8.49b) Identities involving the error quaternion are given by [ 2] /EOTT.Nq//EOT.q/DkNqk2fıq4I3CŒıq1W3/STX/c141g (8.50a) /STX /EOTT.Nq//EOT.q//ETX/NUL1DkNqk/NUL2I3CA.ıq/ 2ıq4(8.50b) /STX /EOTT.Nq//EOT.q//ETX/NUL1ıq1W3DkNqk/NUL2ıq1W3 ıq4(8.50c) /TABT.Nq//TAB.q/DkNqk2fıq4I3/NULŒıq1W3I/STX/c141g (8.50d) /STX /TABT.Nq//TAB.q//ETX/NUL1DkNqk/NUL2I3CAT.ıqI/ 2ıq4(8.50e) /STX /TABT.Nq//TAB.q//ETX/NUL1ıq1W3IDkNqk/NUL2ıq1W3I ıq4(8.50f) A.ıq/DA.q/AT.Nq/D/STX /EOTT.Nq//EOT.q//ETX/NUL1/EOTT.q//EOT.Nq/(8.50g) AT.ıqI/DAT.q/A.Nq/D/STX /TABT.Nq//TAB.q//ETX/NUL1/TABT.q//TAB.Nq/(8.50h) Note that the inverses of /EOTT.Nq//EOT.q/and/TABT.Nq//TAB.q/are singular for 180ıerrors. Equation ( 8.50) can used to develop a control law that produces linear error dynamics [ 2,4]. Also note that both Eqs. ( 8.50c ) and ( 8.50f ) are related to the Rodrigues parameters or Gibbs vector. 8.6 Quaternion Kinematics The quaternion kinematic equation is given by PqD1 2!˝qD1 2˝.!/qD1 2/EOT.q/! (8.51) Note that qTPqD0, so this equation preserves the quaternion norm. A major advantage of using normalized quaternions is that the kinematic equation is linear in the quaternion and is also free of singularities. Differentiating Eq. ( 8.51) and using Eq. (8.23h )g i v e s 2These equations are true even though A.q/¤A.Nq/becauseA.ıq/ıq1W3Dıq1W3.356 8 Quaternion Identities RqD1 2/EOT.q/P!C1 2˝.!/PqD1 2/EOT.q/P!/NUL1 4k!k2q (8.52) Substituting a dynamics equation for P!relates the quaternion to a torque input. The inverse kinematic equation is given by multiplying Eq. ( 8.51)b y/EOTT.q/and applying Eq. ( 8.20a ), yielding !D2kqk/NUL2/EOTT.q/Pq (8.53) If we deﬁne the “space-referenced angular velocity,” !I,b y /DC4!I 0/NAK Dq/NUL1˝!˝qD/DC4AT.q/! 0/NAK (8.54) then the following relationships can be derived: q/ETX˝!D!I˝q/ETX(8.55a) /NUL.!/q/ETXD/TAB.q/ETX/!D˝.!I/q/ETXD/EOT.q/ETX/!I (8.55b) !˝qDq˝!I (8.55c) ˝.!/qD/EOT.q/!D/NUL.!I/qD/TAB.q/!I (8.55d) The deﬁnition of the attitude matrix in Eq. ( 8.25) can be used to show that the quaternion kinematic equation in Eq. ( 8.51) can also be written as PqD1 2/TAB.q/!ID1 2/NUL.!I/q (8.56a) !ID2kqk/NUL2/TABT.q/Pq (8.56b) The derivative of the matrix /EOT.q/is given by [ 6] d dt/EOT.q/D1 2/NUL.!I//EOT.q/D1 2/EOT.q/Œ!/STX/c141/NUL1 2q!T D1 2˝.!//EOT.q/C/EOT.q/Œ!/STX/c141 (8.57) The derivative of the matrix /TAB.q/is given by d dt/TAB.q/D1 2˝.!//TAB.q/D/NUL1 2/TAB.q/Œ!I/STX/c141/NUL1 2q!T I D1 2/NUL.!I//TAB.q//NUL/TAB.q/Œ!I/STX/c141 (8.58)8.6 Quaternion Kinematics 357 The identity of the various forms of the right sides of Eqs. ( 8.57) and ( 8.58) is proven by Eqs. ( 8.54), (8.39g ), (8.23f ), (8.39h ), and ( 8.23g ). Derivatives of the matrices Œq˝/c141andŒqˇ/c141are given by [ 6] d dtŒq˝/c141D1 2˝.!/Œq˝/c141D1 2Œq˝/c141˝.!I/ (8.59a) d dtŒqˇ/c141D1 2Œqˇ/c141/NUL.!/D1 2/NUL.!I/Œqˇ/c141 (8.59b) where the identities in Eqs. ( 8.29c ) and ( 8.29e ) have been used in Eq. ( 8.59). Taking the time derivative of Eq. ( 8.45) gives the kinematical relationship for the error quaternion ıq: d dtıqDPq˝Nq/NUL1Cq˝dNq/NUL1 dtD1 2!˝q˝Nq/NUL1Cq˝dNq/NUL1 dt D1 2!˝ıqCq˝dNq/NUL1 dt(8.60) We now need to determine an expression for the derivative of Nq/NUL1. The esti- mated/desired quaternion kinematic model follows PNqD1 2N!˝Nq (8.61) Taking the time derivative of IqDNq˝Nq/NUL1gives 0DPNq˝Nq/NUL1CNq˝dNq/NUL1 dtD1 2N!˝Nq˝Nq/NUL1CNq˝dNq/NUL1 dtD1 2N!CNq˝dNq/NUL1 dt (8.62) yielding dNq/NUL1 dtD/NUL1 2Nq/NUL1˝N! (8.63) and thus d dtıqD1 2/NUL !˝ıq/NULq˝Nq/NUL1˝N!/SOH D1 2.!˝ıq/NULıq˝N!/ (8.64) We now deﬁne the following error angular velocity: ı!/DC1!/NULN!. Substituting !DN!Cı!into Eq. ( 8.64) leads to d dtıqD1 2.N!˝ıq/NULıq˝N!/C1 2ı!˝ıq (8.65)358 8 Quaternion Identities Evaluating the quaternion products gives d dtıq1W3D/NULN!/STXıq1W3C1 2.ıq4ı!/NULı!/STXıq1W3/ (8.66a) d dtıq4D/NUL1 2ı!Tıq1W3 (8.66b) Equation ( 8.66a ) can also be derived by differentiating Eq. ( 8.46a ), leading to d dtıq1W3D1 2kNqk2/STX /EOTT.Nq//EOT.q/!/NUL/EOTT.q//EOT.Nq/N!/ETX (8.67) Equation ( 8.50a ) can used to prove that Eq. ( 8.66a ) is equivalent to Eq. ( 8.67). We deﬁne the “space-referenced error angular velocity,” ı!I,b y ı!I/DC1!I/NULN!IDAT.q/!/NULAT.Nq/N! (8.68) Note thatı!I¤ATı!for eitherA.q/orA.Nq/,3but that Eq. ( 8.49b )g i v e s ıqT 1W3Iı!ID/STX AT.q/ıq1W3/ETXTAT.q/!/NUL/STX AT.Nq/ıq1W3/ETXTAT.Nq/N!DıqT 1W3ı! (8.69) Following the derivation of Eq. ( 8.65), we can evaluate the derivative of ıqIas d dtıqID1 2.ıqI˝!I/NULN!I˝ıqI/ D1 2.ıqI˝N!I/NULN!I˝ıqI/C1 2ıqI˝ı!I (8.70) which has the vector and scalar parts d dtıq1W3IDN!I/STXıq1W3IC1 2.ıq4ı!ICı!I/STXıq1W3I/ (8.71a) d dtıq4D/NUL1 2ı!T Iıq1W3I (8.71b) Equation ( 8.71a ) can also be derived by differentiating Eq. ( 8.48), leading to d dtıq1W3ID1 2kNqk2/STX /TABT.Nq//TAB.q/!I/NUL/TABT.q//TAB.Nq/N!I/ETX (8.72) Equation ( 8.50d ) can used to prove that Eq. ( 8.71a ) is equivalent to Eq. ( 8.72). 3An orthogonal transformation would preserve the norm, giving kı!IkDkı!k, and it is not difﬁcult to show that kı!Ik2Dkı!k2C2!TŒI3/NULA.ı!//c141N!.References 359 Some kinematic identities involving/STX /EOTT.Nq//EOT.q//ETX/NUL1are given by 2/STX /EOTT.Nq//EOT.q//ETX/NUL1/EOTT.q/PNqDA.ıq/N! (8.73a) 2/STX /EOTT.Nq//EOT.q//ETX/NUL1/EOTT.q/RNqDA.ıq/PN!CkN!k2 2ıq4ıq1W3 (8.73b) 2/STX /EOTT.Nq//EOT.q//ETX/NUL1/EOTT.PNq/˝.!/qD/DC2 Œ!/STX/c141Cıq1W3!T ıq4/DC3 A.ıq/N! (8.73c) References Choukroun, D., Bar-Itzhack, I.Y ., Oshman, Y .: Novel quaternion Kalman ﬁlter. IEEE Trans. Aerospace Electron. Syst. 42(1), 174–190 (2006) Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press, Boca Raton (2012) Lefferts, E.J., Markley, F.L., Shuster, M.D.: Kalman ﬁltering for spacecraft attitude estimation. J. Guid. Contr. Dynam. 5(5), 417–429 (1982) Paielli, R.A., Bach, R.E.: Attitude control with realization of linear error dynamics. J. Guid. Contr. Dynam. 16(1), 182–189 (1993) Pittelkau, M.E.: Square root quaternion estimation. In: AIAA/AAS Astrodynamics Specialist Conference and Exhibit. Monterey, CA (2002). AIAA 2002-4914 Shuster, M.D.: A survey of attitude representations. J. Astronaut. Sci. 41(4), 439–517 (1993) Shuster, M.D., Oh, S.D.: Attitude determination from vector observations. J. Guid. Contr. 4(1), 70–77 (1981)Chapter 9 Euler Angles This chapter presents explicit expressions for the attitude matrices and kinematic matrices for all the 12 Euler and Tait-Bryan angle attitude representations. We ﬁrstpresent the attitude matrices for the symmetric and asymmetric sets. Then the kinematic matrices B./DC2; / , deﬁned by Eq. ( 3.39), and their inverses are shown for all the symmetric and asymmetric sets. These matrices are used in the kinematicrelations: 2 4P/RS P/DC2 P 3 5DB./DC2; /! (9.1) where!/DC1Œ! 1!2!3/c141Tis the angular velocity vector, and !DB/NUL1./DC2; /2 4P/RS P/DC2 P 3 5 (9.2) The abbreviated notation c /DC1cos and s/DC1sin is employed in Tables 9.1,9.2, 9.3,9.4. Table 9.5gives equations for converting the symmetric and asymmetric Euler angle sets directly to quaternions, without the need to compute the attitude matrix as an intermediate step. F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _9, © Springer Science+Business Media New York 2014361362 9 Euler Angles Table 9.1 Attitude matrix: six symmetric sets Axes Attitude matrix 1/NUL2/NUL12 4c/DC2 s/RSs/DC2 /NULc/RSs/DC2 s/DC2s c/RSc /NULs/RSc/DC2s s/RSc Cc/RSc/DC2s s/DC2c /NULc/RSs /NULs/RSc/DC2c /NULs/RSs Cc/RSc/DC2c 3 5 1/NUL3/NUL12 4c/DC2 c/RSs/DC2 s/RSs/DC2 /NULs/DC2c /NULs/RSs Cc/RSc/DC2c c/RSs Cs/RSc/DC2c s/DC2s /NULs/RSc /NULc/RSc/DC2s c/RSc /NULs/RSc/DC2s 3 5 2/NUL1/NUL22 4c/RSc /NULs/RSc/DC2s s/DC2s /NULs/RSc /NULc/RSc/DC2s s/RSs/DC2 c/DC2 c/RSs/DC2 c/RSs Cs/RSc/DC2c /NULs/DC2c /NULs/RSs Cc/RSc/DC2c 3 5 2/NUL3/NUL22 4/NULs/RSs Cc/RSc/DC2c s/DC2c /NULc/RSs /NULs/RSc/DC2c /NULc/RSs/DC2 c/DC2 s/RSs/DC2 s/RSc Cc/RSc/DC2s s/DC2s c/RSc /NULs/RSc/DC2s 3 5 3/NUL1/NUL32 4c/RSc /NULs/RSc/DC2s s/RSc Cc/RSc/DC2s s/DC2s /NULc/RSs /NULs/RSc/DC2c /NULs/RSs Cc/RSc/DC2c s/DC2c s/RSs/DC2 /NULc/RSs/DC2 c/DC23 5 3/NUL2/NUL32 4/NULs/RSs Cc/RSc/DC2c c/RSs Cs/RSc/DC2c /NULs/DC2c /NULs/RSc /NULc/RSc/DC2s c/RSc /NULs/RSc/DC2s s/DC2s c/RSs/DC2 s/RSs/DC2 c/DC23 5 Table 9.2 Attitude matrix: six asymmetric sets Axes Attitude matrix 1/NUL2/NUL32 4c/DC2c c/RSs Cs/RSs/DC2c s/RSs /NULc/RSs/DC2c /NULc/DC2s c/RSc /NULs/RSs/DC2s s/RSc Cc/RSs/DC2s s/DC2 /NULs/RSc/DC2 c/RSc/DC23 5 1/NUL3/NUL22 4c/DC2c s/RSs Cc/RSs/DC2c /NULc/RSs Cs/RSs/DC2c /NULs/DC2 c/RSc/DC2 s/RSc/DC2 c/DC2s /NULs/RSc Cc/RSs/DC2s c/RSc Cs/RSs/DC2s 3 5 2/NUL1/NUL32 4c/RSc Cs/RSs/DC2s c/DC2s /NULs/RSc Cc/RSs/DC2s /NULc/RSs Cs/RSs/DC2c c/DC2c s/RSs Cc/RSs/DC2c s/RSc/DC2 /NULs/DC2 c/RSc/DC23 5 2/NUL3/NUL12 4c/RSc/DC2 s/DC2 /NULs/RSc/DC2 s/RSs /NULc/RSs/DC2c c/DC2c c/RSs Cs/RSs/DC2c s/RSc Cc/RSs/DC2s /NULc/DC2s c/RSc /NULs/RSs/DC2s 3 5 3/NUL1/NUL22 4c/RSc /NULs/RSs/DC2s s/RSc Cc/RSs/DC2s /NULc/DC2s /NULs/RSc/DC2 c/RSc/DC2 s/DC2 c/RSs Cs/RSs/DC2c s/RSs /NULc/RSs/DC2c c/DC2c 3 5 3/NUL2/NUL12 4c/RSc/DC2 s/RSc/DC2 /NULs/DC2 /NULs/RSc Cc/RSs/DC2s c/RSc Cs/RSs/DC2s c/DC2s s/RSs Cc/RSs/DC2c /NULc/RSs Cs/RSs/DC2c c/DC2c 3 59 Euler Angles 363 Table 9.3 The matrixB./DC2; / Axes Symmetric sets Axes Asymmetric sets 1/NUL2/NUL11 s/DC22 40 s c 0 s/DC2c /NULs/DC2s s/DC2/NULc/DC2s /NULc/DC2c 3 5 1/NUL2/NUL31 c/DC22 4c /NULs 0 c/DC2s c/DC2c 0 /NULs/DC2c s/DC2s c/DC23 5 1/NUL3/NUL11 s/DC22 40/NULc s 0s/DC2s s/DC2c s/DC2c/DC2c /NULc/DC2s 3 5 1/NUL3/NUL21 c/DC22 4c 0 s /NULc/DC2s 0 c/DC2c s/DC2c c/DC2s/DC2s 3 5 2/NUL1/NUL21 s/DC22 4s 0 /NULc s/DC2c 0 s/DC2s /NULc/DC2s s/DC2c/DC2c 3 5 2/NUL1/NUL31 c/DC22 4s c 0 c/DC2c /NULc/DC2s 0 s/DC2s s/DC2c c/DC23 5 2/NUL3/NUL21 s/DC22 4c 0 s /NULs/DC2s 0 s/DC2c /NULc/DC2c s/DC2/NULc/DC2s 3 5 2/NUL3/NUL11 c/DC22 40 c /NULs 0 c/DC2s c/DC2c c/DC2/NULs/DC2c s/DC2s 3 5 3/NUL1/NUL31 s/DC22 4s c 0 s/DC2c /NULs/DC2s 0 /NULc/DC2s /NULc/DC2c s/DC23 5 3/NUL1/NUL21 c/DC22 4/NULs 0 c c/DC2c 0 c/DC2s s/DC2s c/DC2/NULs/DC2c 3 5 3/NUL2/NUL31 s/DC22 4/NULc s 0 s/DC2s s/DC2c 0 c/DC2c /NULc/DC2s s/DC23 5 3/NUL2/NUL11 c/DC22 40 s c 0c/DC2c /NULc/DC2s c/DC2s/DC2s s/DC2c 3 5 Table 9.4 The matrixB/NUL1./DC2; / Axes Symmetric sets Axes Asymmetric sets 1/NUL2/NUL12 4c/DC20 1 s/DC2s c 0 s/DC2c /NULs 03 5 1/NUL2/NUL32 4c/DC2c s 0 /NULc/DC2s c 0 s/DC20 13 5 1/NUL3/NUL12 4c/DC20 1 /NULs/DC2c s 0 s/DC2s c 03 5 1/NUL3/NUL22 4c/DC2c /NULs 0 /NULs/DC20 1 c/DC2s c 03 5 2/NUL1/NUL22 4s/DC2s c 0 c/DC20 1 /NULs/DC2c s 03 5 2/NUL1/NUL32 4c/DC2s c 0 c/DC2c /NULs 0 /NULs/DC20 13 5 2/NUL3/NUL22 4s/DC2c /NULs 0 c/DC20 1 s/DC2s c 03 5 2/NUL3/NUL12 4s/DC20 1 c/DC2c s 0 /NULc/DC2s c 03 5 3/NUL1/NUL32 4s/DC2s c 0 s/DC2c /NULs 0 c/DC20 13 5 3/NUL1/NUL22 4/NULc/DC2s c 0 s/DC20 1 c/DC2c s 03 5 3/NUL2/NUL32 4/NULs/DC2c s 0 s/DC2s c 0 c/DC20 13 5 3/NUL2/NUL12 4/NULs/DC20 1 c/DC2s c 0 c/DC2c /NULs 03 5364 9 Euler Angles Table 9.5 Euler angle to quaternion conversions Axes Quaternion Axes Quaternion 1/NUL2/NUL12 664Nc/DC2Ns./RSC / Ns/DC2Nc./RS/NUL / Ns/DC2Ns./RS/NUL / Nc/DC2Nc./RSC /3 7751/NUL2/NUL32 664Ns/RSNc/DC2Nc CNc/RSNs/DC2Ns Nc/RSNs/DC2Nc /NULNs/RSNc/DC2Ns Nc/RSNc/DC2Ns CNs/RSNs/DC2Nc Nc/RSNc/DC2Nc /NULNs/RSNs/DC2Ns 3 775 1/NUL3/NUL12 664Nc/DC2Ns./RSC / Ns/DC2Ns. /NUL/RS/ Ns/DC2Nc. /NUL/RS/ Nc/DC2Nc./RSC /3 7751/NUL3/NUL22 664Ns/RSNc/DC2Nc /NULNc/RSNs/DC2Ns Nc/RSNc/DC2Ns /NULNs/RSNs/DC2Nc Nc/RSNs/DC2Nc CNs/RSNc/DC2Ns Nc/RSNc/DC2Nc CNs/RSNs/DC2Ns 3 775 2/NUL1/NUL22 664Ns/DC2Nc. /NUL/RS/ Nc/DC2Ns./RSC / Ns/DC2Ns. /NUL/RS/ Nc/DC2Nc./RSC /3 7752/NUL1/NUL32 664Nc/RSNs/DC2Nc CNs/RSNc/DC2Ns Ns/RSNc/DC2Nc /NULNc/RSNs/DC2Ns Nc/RSNc/DC2Ns /NULNs/RSNs/DC2Nc Nc/RSNc/DC2Nc CNs/RSNs/DC2Ns 3 775 2/NUL3/NUL22 664Ns/DC2Ns./RS/NUL / Nc/DC2Ns./RSC / Ns/DC2Nc./RS/NUL / Nc/DC2Nc./RSC /3 7752/NUL3/NUL12 664Nc/RSNc/DC2Ns CNs/RSNs/DC2Nc Ns/RSNc/DC2Nc CNc/RSNs/DC2Ns Nc/RSNs/DC2Nc /NULNs/RSNc/DC2Ns Nc/RSNc/DC2Nc /NULNs/RSNs/DC2Ns 3 775 3/NUL1/NUL32 664Ns/DC2Nc./RS/NUL / Ns/DC2Ns./RS/NUL / Nc/DC2Ns./RSC / Nc/DC2Nc./RSC /3 7753/NUL1/NUL22 664Nc/RSNs/DC2Nc /NULNs/RSNc/DC2Ns Nc/RSNc/DC2Ns CNs/RSNs/DC2Nc Nc/RSNs/DC2Ns CNs/RSNc/DC2Nc Nc/RSNc/DC2Nc /NULNs/RSNs/DC2Ns 3 775 3/NUL2/NUL32 664Ns/DC2Ns. /NUL/RS/ Ns/DC2Nc. /NUL/RS/ Nc/DC2Ns./RSC / Nc/DC2Nc./RSC /3 7753/NUL2/NUL12 664Nc/RSNc/DC2Ns /NULNs/RSNs/DC2Nc Nc/RSNs/DC2Nc CNs/RSNc/DC2Ns Ns/RSNc/DC2Nc /NULNc/RSNs/DC2Ns Nc/RSNc/DC2Nc CNs/RSNs/DC2Ns 3 775 where Nc./SOH//DC1cos./SOH=2/andNs./SOH//DC1sin./SOH=2/Chapter 10 Orbital Dynamics The study of bodies in orbit has attracted the world’s greatest mathematicians in the past, and remains a ﬂourishing subject area in the present. In fact many usefulmathematical concepts, such as Bessel functions and nonlinear least squares, can be directly traced back to the study of orbital motion. Here the basic equations and concepts of orbital dynamics are introduced. More details can be found in thereferences herein. In the seventeenth century, Johannes Kepler propounded his three laws of planetary motion deﬁning the shape of planetary orbits, the velocity at which planetstravel around the Sun, and the time required for a planet to complete an orbit. They state that The orbit of each planet is an ellipse, with the Sun at a focus. The line joining the planet to the Sun sweeps out equal areas in equal times. The square of the period of a planet is proportional to the cube of its mean distance from the Sun. Since ellipses are a basic element in the study of orbital motion, we begin this chapter with a review of the geometry of ellipses. In this chapter all position, r, and velocity, v, vectors are expressed in inertial coordinates, unless a different frame is explicitly indicated. Thus, the subscript Iis removed from these vectors for brevity. 10.1 Geometry of Ellipses This section provides a review of elliptical geometry, which will later be used todescribe the motion of a spacecraft in orbit. Figure 10.1 shows a basic ellipse using a two-center bipolar coordinate system, centered at .x 0;y0/. The variable ais known as the semimajor axis and the variable bis the semiminor axis. By deﬁnition the two-center bipolar coordinate equation is given by F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _10, © Springer Science+Business Media New York 2014365366 10 Orbital Dynamics Fig. 10.1 Two-center bipolar ellipse coordinate system r1Cr2D2a (10.1) Assuming that x0Dy0D0, the ﬁrst focus F1is at./NULc;0/ and the second focus F2 is at.c;0/ . We wish to describe a point given by both r1andr2using the coordinates xandy. It is easy to show that r1Dp .xCc/2Cy2andr2Dp .x/NULc/2Cy2. Substituting these quantities into Eq. ( 10.1)g i v e s p x2Cy2Cc2C2cxCp x2Cy2Cc2/NUL2cxD2a (10.2) Squaring both sides of Eq. ( 10.2)g i v e s 2.x2Cy2Cc2/C2p .x2Cy2Cc2/2/NUL4c2x2D4a2(10.3) Rearranging terms and squaring again leads to .x2Cy2Cc2/2/NUL4c2x2DŒ2a2/NUL.x2Cy2Cc2//c1412 D4a4/NUL4a2.x2Cy2Cc2/C.x2Cy2Cc2/2 (10.4) Grouping terms and dividing by 4a2.a2/NULc2/then leads to x2 a2Cy2 a2/NULc2D1 (10.5) The points on the ellipse at xD0haveyD˙b,s or1Dr2Dp c2Cb2Daat these points. Substituting a2/NULc2Db2into Eq. ( 10.5) gives the basic equation for an ellipse: x2 a2Cy2 b2D1 (10.6)10.1 Geometry of Ellipses 367 Fig. 10.2 Focal deﬁnition of ellipse Fig. 10.3 Relationships in focal deﬁnition of ellipse Another way to describe an ellipse is to use the focal deﬁnition, which states that an ellipse is the locus of points the ratio of whose distances from a ﬁxed line, the directrix, to a ﬁxed point, the focus, is a constant e, called the eccentricity. This deﬁnition is depicted in Fig. 10.2, where the vertical line through D1is the directrix associated with F1and the vertical line through D2is the directrix associated with F2. The eccentricity is eDr1=g1Dr2=g2, whereg1andg2are the distances from the comparative directrices to the desired point on the ellipse.Addingr 1Deg1andr2Deg2gives r1Cr2De.g1Cg2/ (10.7) Comparing Eqs. ( 10.1) and ( 10.7)g i v e saDeg, wheregis the distance shown in Fig.10.3. Referring to Fig. 10.3 the following relationships can be seen: rpDa/NULcDegp (10.8a) gDaCgp (10.8b)368 10 Orbital Dynamics whererpis the radial distance to the periapsis , the orbital point closest to the focus, andgpis the distance from the directrix to the periapsis. Also, raDaCcis the radial distance to the apoapsis , the orbital point farthest from the focus. For Earth- orbiting space objects the closest and farthest points are called perigee and apogee, respectively. Substituting Eq. ( 10.8b )i n t oaDegand using Eq. ( 10.8a )g i v e s aDaeCegpDaeCa/NULc (10.9) Solving Eq. ( 10.9)f o regives the well-known result: eDc a(10.10) SubstitutingcDp a2/NULb2into this yields eDr 1/NULb2 a2(10.11) which clearly shows that the eccentricity of a circle, for which aDb, is zero as expected. Substituting Eq. ( 10.10 )i n t ogDa=eyields gDa2 c(10.12) Another form for the eccentricity is given by eDa/NULc g/NULaDp b2Cc2 g(10.13) SubstitutingcDeaintorpDa/NULcandraDaCcgives rpDa.1/NULe/ (10.14a) raDa.1Ce/ (10.14b) Equations ( 10.6) and ( 10.10 )g i v eyDbp 1/NULe2whenxDc. This distance is known as the semilatus rectum , a combination of the Latin words “semi,” meaning half, “latus,” meaning side, and “rectum,” meaning straight. It is shown as pin Fig.10.4,s ow eh a v e pDa.1/NULe2/ (10.15) It is often more convenient to represent an ellipse in polar coordinate form rather than the Cartesian form of Eq. ( 10.6). Referring to Fig. 10.5 thexandycomponents are related to the polar coordinates rand/ETBby xDcCrcos/ETB (10.16a) yDrsin/ETB (10.16b)10.1 Geometry of Ellipses 369 Fig. 10.4 Semilatus rectum deﬁnition Fig. 10.5 Polar coordinate deﬁnition of an ellipse where/ETBis known as the true anomaly , which is deﬁned as a positive rotation from the periapsis direction. Substituting Eq. ( 10.16 ) into Eq. ( 10.6) and multiplying both sides byb2gives .b2=a2/.c2C2cr cos/ETBCr2cos2/ETB/Cr2sin2/ETBDb2(10.17) Substituting sin2/ETBD1/NULcos2/ETB,u s i n gb2Da2.1/NULe2/from Eq. ( 10.11 ) andcDea from Eq. ( 10.10 ), and collecting terms leads to 0Dr2/NULe2r2cos2/ETBC2a.1/NULe2/ercos/ETB/NULa2.1/NULe2/2 Dr2/NULŒa.1/NULe2//NULercos/ETB/c1412(10.18) soris given by rD˙Œa.1/NULe2//NULercos/ETB/c141 (10.19) The plus sign must be used because ris positive. This leads to rDa.1/NULe2/ 1Cecos/ETB(10.20) Using Eq. ( 10.15 ) expresses this in terms of the semilatus rectum rDp 1Cecos/ETB(10.21) Note that when eD0thenrDp, which represents a circle.370 10 Orbital Dynamics 10.2 Keplerian Motion Kepler’s three laws of motion, stated at the beginning of this chapter, can be proven mathematically from Newton’s universal law of gravitation. Newton stated that anytwo bodies with mass Mandmattract each other by force that acts along the line rjoining them with magnitude directly proportional to the product of their masses and inversely proportional to the square of the distance rDkrkbetween them. Mathematically, this statement is given by F gD/NULGMmr r3(10.22) whereGis the universal gravitation constant [3,4]. Consider the two bodies in Fig. 10.6, where Rcdenotes the vector to the center of mass. Applying Newton’s law for each body we obtain MRRMD/NULGMm kRM/NULRmk3.RM/NULRm/ (10.23a) mRRmD/NULGMm kRM/NULRmk3.Rm/NULRM/ (10.23b) Adding Eqs. ( 10.23a ) and ( 10.23b )g i v e s MRRMCmRRmD0 (10.24) The center of mass is given by RcDMRMCmRm MCm(10.25) so Eq. ( 10.24 )g i v e sRRcD0at all time. This states that the center of mass moves in a straight line at constant velocity. We are also interested in determining the relativeposition, rDR m/NULRM, of the smaller mass (e.g. a satellite) with respect to the large mass (e.g. the Earth). Subtracting Eq. ( 10.23a ) from Eq. ( 10.23b ) leads to RrD/NUL/SYN r3r (10.26) Fig. 10.6 Relative motion of two bodies10.2 Keplerian Motion 371 where/SYNDG.MCm/is the gravitational parameter . The approximation /SYN/EMGM is obviously a good one for most orbiting bodies since M/GSm. Perturbations due to conservative forces, such as the gravity differential force due to the Earth’soblateness, and non-conservative forces, such as drag and solar radiation pressure, are often added to the right hand side of Eq. ( 10.26 ). These perturbations will be discussed in Sect. 10.3. Equation ( 10.26 ) can be used to show that the energy and angular momentum of orbital motion are conserved. The speciﬁc kinetic energy , i.e. the kinetic energy per unit mass, is given by T/DC11 2v2(10.27) The time derivatives of T,u s i n gE q .( 10.26 ), is PTDd dt/DC2Pr/SOHPr 2/DC3 DPr/SOHRrD/NUL/SYNPr/SOHr r3(10.28) Thespeciﬁc potential energy is deﬁned by V/DC1/NUL/SYN r(10.29) The time derivative of Vis PVD/NUL/SYNd dt.r/SOHr//NUL1=2D/SYNPr/SOHr r3(10.30) Adding Eqs. ( 10.28 ) and ( 10.30 ) proves that the speciﬁc energy EDTCV (10.31) has time derivative zero, i.e. that it is conserved. Thespeciﬁc angular momentum is given by h/DC1r/STXvDr/STXPr (10.32) Its time derivative is PhDPr/STXPrCr/STXRrD/NUL/SYN r3r/STXrD0 (10.33) showing that the angular momentum is conserved. Since randvare both perpen- dicular to the constant vector h, the position and velocity vectors must remain in a ﬁxed plane, called the orbital plane , perpendicular to h. We now use Eq. ( 10.26 ) to prove Kepler’s three laws. Figure 10.7 depicts the area swept out by a line joining the primary mass and its satellite. This area is half the area of a parallelogram formed by randdr:372 10 Orbital Dynamics Fig. 10.7 Area sweep of primary mass and satellite dAD1 2kr/STXdrkD1 2kr/STXdr dtdtk D1 2kr/STXPrkdtD1 2hdt(10.34) Since his constant then Eq. ( 10.34 ) indicates that the line sweeps out equal areas in equal times, which proves Kepler’s second law. Since his constant, then d dt.Pr/STXh/DRr/STXhD/NUL/SYN r3r/STXhD/NUL/SYN r3r/STX.r/STXPr/D/NUL/SYN r3/STX .r/SOHPr/r/NULr2Pr/ETX (10.35) where Eq. ( 8.2e), the “bac/NULcab” rule, has been used. Combining this with Eq. (10.30 )g i v e s d dt/DLE Pr/STXh/NUL/SYN rr/DC1 D0 (10.36) Integrating this equation gives Pr/STXh/NUL/SYN rrD/SYNe (10.37) where the integration constant /SYNeis commonly referred to as the Laplace vector . ClearlyPr/STXhis in the orbit plane, so emust also be in this plane. Forming the dot product of ( 10.37 ) with rgives /SYNr/SOHeDr/SOH.Pr/STXh//NUL/SYNrD.r/STXPr//SOHh/NUL/SYNrDh2/NUL/SYNr (10.38) where we have used Eq. ( 2.56a ). Let be the angle between rand e, so that Eq. (10.38 ) becomesh2D/SYNrC/SYNre cos ,o r rDh2=/SYN 1Cecos (10.39) This is just Eq. ( 10.21 ) for an ellipse in polar coordinates, where h2=/SYNis the semilatus rectum, /DC1/ETBis the true anomaly shown in Fig. 10.5, andeis the eccentricity, proving Kepler’s ﬁrst law. It also requires the vector e, which is known as the eccentricity vector , to point along the periapsis direction because /ETBis the angle between rande. The magnitude of the eccentricity vector is the eccentricity10.2 Keplerian Motion 373 of the elliptical orbit, so eis not a unit vector as its symbol might mislead one into thinking. The equation p/DC1h2=/SYNgives the following useful expression for h: hDp/SYNp (10.40) Note that Eq. ( 10.39 ) is actually more general than just for ellipses. It is a polar equation of a conic section, where the value of edictates the type of orbit. If eD0 then the orbit is circular with aDr;i fe<1 then the orbit is elliptical with a>0 ; ifeD1then the orbit is parabolic with inﬁnite semimajor axis; and if e>1 then the orbit is hyperbolic with a<0 . Elliptic orbits are the most common type because they are used for planets and planetary satellites. Parabolic orbits are rarely found, but orbits of some comets approximate a parabola. These orbits are a borderline casebetween an open and closed orbit. The orbit of an interplanetary probe sent from the Earth must be a hyperbolic orbit if the probe is to escape the Earth’s gravitational ﬁeld with ﬁnite speed. Parabolic and hyperbolic orbits are one-way trips to inﬁnitythat will never retrace the same path again. Equation ( 10.34 ) can be written as dtD.2=h/dA . Integrating this equation over an entire orbit and noting that the area of an ellipse is given by /EMab yields /SUBD2/EMab h(10.41) where/SUBis the orbital period. Substituting Eq. ( 10.40 ) andbDpap, which follows from Eqs. ( 10.11 ) and ( 10.15 ), yields /SUBD2/EMp/SYNa3=2D2/EM n(10.42) wherenis the mean motion , deﬁned by n/DC1r/SYN a3(10.43) This proves Kepler’s third law. For a circular 300 km low-Earth orbit, Eq. ( 10.42 ) gives a period of about 90 min. A geosynchronous orbit with a period of one sidereal day (approximately 23 h 56 min and 4 s), matching the Earth’s sidereal rotation period, requires an altitude of 35,786 km. Communications satellites are oftenplaced in geostationary orbits , equatorial circular geosynchronous orbits, because they appear to be stationary with respect to the ground. Having proven Kepler’s three laws from Newton’s gravitational law, we now investigate energy further. Since energy is conserved, it can be computed at any convenient point in the orbit. Here, we choose the periapsis point with v pDh=rp. Using Eqs. ( 10.14a ), (10.40 ), and ( 10.15 )g i v e s EDh2 2r2p/NUL/SYN rpD/SYNa.1/NULe2/ 2a2.1/NULe/2/NUL/SYN a.1/NULe/D/SYNa.1Ce//NUL2a/SYN 2a2.1/NULe/D/NUL/SYN 2a (10.44)374 10 Orbital Dynamics Substituting this expression into Eq. ( 10.31 ), substituting the deﬁnitions of Tand V, and rearranging gives v2D/SYN/DC22 r/NUL1 a/DC3 (10.45) Equation ( 10.45 ) is known as the vis viva equation from the Latin for living force. The escape velocity at a distance rfrom a center of force is the minimum velocity needed to escape its gravitational pull. This is the velocity needed to achieve aparabolic orbit, and is obtained by setting aD1 in Eq. ( 10.45 ): v escDr 2/SYN r(10.46) The escape velocity for a body on the Earth’s surface, with rbeing the radius of the Earth, is 11.06 km/s. The escape velocity for a body on the Moon’s surface, with rand/SYNbeing the radius and gravitational parameter of the Moon, respectively, is 1.68 km/s, which is almost 10 times less than for the Earth. 10.2.1 Classical Orbital Elements Equation ( 10.26 ) requires the initial position, r.t0/, and velocity,Pr.t0/, with respect to some inertial coordinate system. Unfortunately r.t0/andPr.t0/do not provide the most convenient characterization of the orbit. The six classical Keplerian orbital elements give a more satisfying physical characterization of the orbit than theCartesian position and velocity vectors. The dimensional elements are given by aDsemimajor axis (size of the orbit) eDeccentricity (shape of the orbit) M 0Dinitial mean anomaly (related to the spacecraft’s initial position in the orbit) The orientation elements are given by iDinclination (angle between orbit plane and reference plane) ˝Dright ascension of the ascending node (angle between vernal equinox direction and the line of nodes) !Dargument of periapsis or perigee (angle between the ascending node direction and periapsis or perigee direction) Figure 10.8 shows the orientation elements and the unit vectors that deﬁne the perifocal coordinate system . The vector iepoints along the periapsis direction, the vector ippoints along the semilatus rectum direction, and the vector ihpoints along the momentum direction, which is the orbit normal. Note that the perifocal system is speciﬁc to a particular orbit, and that ieandipare in the orbital plane. The line of nodes vector is given by the intersection of the reference plane (e.g. the Earth’s equatorial plane) and the orbital plane.10.2 Keplerian Motion 375 Reference PlaneOrbital Plane Periapsis Line of Nodes Fig. 10.8 Coordinate system geometry and orbital elements The transformation from GCI to perifocal coordinates is given by ieDA11i1CA12i2CA13i3 (10.47a) ipDA21i1CA22i2CA23i3; (10.47b) ihDA31i1CA32i2CA33i3 (10.47c) whereAijare elements of a rotation matrix. The transformation is accomplished using a 3/NUL1/NUL3 Euler rotation, with rotation matrix elements given by A11Dcos˝cos!/NULsin˝sin!cosi (10.48a) A12Dsin˝cos!Ccos˝sin!cosi (10.48b) A13Dsin!sini (10.48c) A21D/NUL cos˝sin!/NULsin˝cos!cosi (10.48d) A22D/NUL sin˝sin!Ccos˝cos!cosi (10.48e) A23Dcos!sini (10.48f) A31Dsin˝sini (10.48g) A32D/NUL cos˝sini (10.48h) A33Dcosi (10.48i) The inverse relationships are given in Sect. 10.2.3 .376 10 Orbital Dynamics 10.2.2 Kepler’s Equation We wish to determine the location of an object in orbit at any instant of time, which means ﬁnding the true anomaly as a function of time. Kepler’s second law states that equal times give equal areas, so the true anomaly will be a linear function of time only in a circular orbit. Referring back to Fig. 10.5, the position and velocity vectors are given by rDrcos/ETBieCrsin/ETBip (10.49a) PrD.Prcos/ETB/NULrP/ETBsin/ETB/ieC.Prsin/ETBCrP/ETBcos/ETB/ip (10.49b) Performing the cross product hDr/STXPrand noting that ie/STXipDihyields hDŒrcos/ETB.Prsin/ETBCrP/ETBcos/ETB//NULrsin/ETB.Prcos/ETB/NULrP/ETBsin/ETB//c141ihDr2P/ETBih (10.50) ThushDr2P/ETB, which shows that r2P/ETBmust be a constant. This equation can be written as hdtDr2d/ETB (10.51) Substituting Eqs. ( 10.39 ) and ( 10.40 ) into Eq. ( 10.51 )g i v e s r/SYN p3dtDd/ETB .1Cecos/ETB/2(10.52) This equation needs to be integrated to determine the true anomaly difference to go from some initial time t0to another time t1: r/SYN p3.t1/NULt0/DZ/ETB1 /ETB0d/ETB .1Cecos/ETB/2(10.53) The right hand side of Eq. ( 10.53 ) involves ﬁnding a solution to a nonstandard elliptic integral. Unfortunately, no closed-form solution exists. Kepler essentially performed a change of variables to convert the integral equation to an algebraicequation. Kepler projected the object’s position vertically onto a circle circumscribed around the ellipse, as shown in Fig. 10.9. Note that the origin in this ﬁgure is at the focus, rather than at the center of the ellipse, as had been assumed in Sect. 10.1. The remainder of this chapter will assume that the origin is at the focus. The angle Eis known as the eccentric anomaly . It is clear from the ﬁgure that xDacosE/NULcDa.cosE/NULe/ (10.54) Then acosEDcCxDaeCa.1/NULe 2/ 1Cecos/ETBcos/ETBDa.eCcos/ETB/ 1Cecos/ETB(10.55)10.2 Keplerian Motion 377 Fig. 10.9 Kepler’s geometry Solving this equation for cos /ETBgives cos/ETBDcosE/NULe 1/NULecosE(10.56) and then substituting this into rDx=cos/ETBgives rDa.1/NULecosE/ (10.57) It follows from Eq. ( 10.56 ) that sin2/ETBD1/NULcos2/ETBD.1/NULecosE/2/NUL.cosE/NULe/2 .1/NULecosE/2D.1/NULe2/sin2E .1/NULecosE/2(10.58) Figure 10.9 also shows that sin /ETBhas the same sign as sin E,s o sin/ETBDp 1/NULe2sinE 1/NULecosE(10.59) Combining Eqs. ( 10.57 ) and ( 10.59 )g i v e s yDrsin/ETBDap 1/NULe2sinE (10.60) We now use Eqs. ( 10.54 ), (10.57 ), and ( 10.60 ) to ﬁnd a relationship between the eccentric anomaly and true anomaly. Trigonometric half-angle identities for any angle/DC2give tan/DC2 2Dsin./DC2=2/ cos./DC2=2/D2sin./DC2=2/ cos./DC2=2/ 2cos2./DC2=2/Dsin/DC2 1Ccos/DC2(10.61)378 10 Orbital Dynamics Thus, we ﬁnd from Eqs. ( 10.56 ) and ( 10.59 ) that tan/ETB 2Dp 1/NULe2sinE .1/NULecosE/C.cosE/NULe/Dr 1Ce 1/NULesinE 1CcosE(10.62) and using Eq. ( 10.61 ) on the right side gives the desired result tan/ETB 2Dr 1Ce 1/NULetanE 2(10.63) Equation ( 10.63 ) allows us to compute /ETBgiveneandE, but we still need to ﬁnd the time dependence of E. A computation similar to Eq. ( 10.50 )g i v e s hDr/STXPrD.xieCyip//STX.PxieCPyip/D.xPy/NULyPx/ih (10.64) ThushDxPy/NULyPx. Substituting Eqs. ( 10.54 ) and ( 10.60 ), along with their time derivatives, into hleads to hDa2.cosE/NULe/p 1/NULe2cosEdE dtCa2p 1/NULe2sin2EdE dt Da2p 1/NULe2.1/NULecosE/dE dt(10.65) SubstitutinghDp/SYNpDp /SYNa.1/NULe2/into this gives r/SYN a3DnD.1/NULecosE/dE dtDd dt.E/NULesinE/ (10.66) wherenis the mean motion, deﬁned by Eq. ( 10.43 ). Integrating both sides of Eq. (10.66 ) easily leads to n.t1/NULt0/D.E/NULesinE/jE1 E0(10.67) Note that if we set E0D0andE1D2/EM, then we get Kepler’s third law! The mean anomaly at a general time tis given by M.t/DM0Cn.t/NULt0/ (10.68) whereM0DE0/NULesinE0is mean anomaly at time t0. Then Eq. ( 10.67 ) can written as M.t/DE.t//NULesinE.t/ (10.69)10.2 Keplerian Motion 379 which is known as Kepler’s equation .G i v e nM0and some time past t0, our goal is to determine E.t/ using Eqs. ( 10.68 ) and ( 10.69 ). Unfortunately, Kepler’s equation has no closed-form solution. Kepler’s equations has intrigued mathematicians forcenturies and spawned a multitude of mathematical techniques [ 7]. Kepler’s equa- tion is well suited for Newton-Raphson’s iteration. Deﬁne the following function: f.E//DC1M/NUL.E/NULesinE/ (10.70) which is zero if the correct Eis found. A series expansion of Eq. ( 10.69 )g i v e s the following approximation for E, which is accurate up to third-order in the eccentricity [ 4]: EDMCesinM 1/NULecosM/NUL1 2/DC2esinM 1/NULecosM/DC33 C/SOH/SOH/SOH (10.71) Begin Newton’s iteration by starting with some initial guess of E, denoted byOE, which can be given by Mfor smalleor by Eq. ( 10.71 ). Then compute the Newton correction /SOHED/NULf.OE/ f0.OE/DM/NUL.OE/NULesinOE/ 1/NULecosOE(10.72) Next update the current estimate using OE OEC/SOHE (10.73) where denotes replacement. Continue iterating until /SOHE is below some prede- ﬁned threshold. 10.2.3 Orbit Propagation The classical solution is the following: given the classical orbital elements at an epoch timet0, compute the position and velocity vectors at any time t. The classical solution involving Eis summarized in Table 10.1. Note that the position in perifocal coordinates is given by Œx; y; 0/c141 . Therefore, only the elements A11,A21,A12,A22, A13, andA23from Eq. ( 10.48 ) are needed to convert from perifocal coordinates to GCI coordinates, since rD2 4A11A12A13 A21A22A23 A31A32A333 5T24x y 03 5 (10.74a) PrD2 4A 11A12A13 A21A22A23 A31A32A333 5T24Px Py 03 5 (10.74b)380 10 Orbital Dynamics Table 10.1 Classical orbital solution fa;e;i;˝;!;M 0;.t/NULt0/g)fr.t/;Pr.t/g Mean Anomaly nDp /SYN=a3 MDM0Cn.t/NULt0/ Kepler’s Equation MDE/NULesinE Solve forE Computerr Da.1/NULecosE/ Computex;y x Da.cosE/NULe/ yDap 1/NULe2sinE Compute Px;Py PxD/NUL.na2=r/sinE PyD.na2=r/p 1/NULe2cosE Position rD2 4A11A21 A12A22 A13A233 5/DC4x y/NAK Velocity PrD2 4A11A21 A12A22 A13A233 5" Px Py# Note that these rotation matrix elements are time-invariant, which means that they only need to be computed once and then stored. First, the mean motion, n, and mean anomaly, M, are computed. Then, Kepler’s equation is solved for E. Next, the variablesx,y,Px,Py, andrare computed. Finally, the position and velocity vectors at timetare determined. Another form of the classical solution is possible by substituting xDrcos/ETBand yDrsin/ETBinto Eq. ( 10.74a ), which gives rDr2 4cos˝cos/DC2/NULsin˝sin/DC2cosi sin˝cos/DC2Ccos˝sin/DC2cosi sin/DC2sini3 5 (10.75) where/DC2D!C/ETB. The time derivative of Eq. ( 10.75 ) can be shown to be PrD/NULr/SYN p2 4.sin/DC2Cesin!/cos˝C.cos/DC2Cecos!/sin˝cosi .sin/DC2Cesin!/sin˝/NUL.cos/DC2Cecos!/cos˝cosi /NUL.cos/DC2Cecos!/sini3 5 (10.76) For this solution once Ehas been determined using Kepler’s equation, then /ETBis determined using Eq. ( 10.63 ). The parameters rcan be given by either Eq. ( 10.21 ) or Eq. ( 10.57 ). Also, the constant pis computed using Eq. ( 10.15 ).10.2 Keplerian Motion 381 The inverse problem involves determining the orbital elements from the space- craft position r.t/and velocity v.t/vectors at some time t. First, the following quantities are computed: rDkr.t/k;vDkv.t/k (10.77a) hDr.t//STXv.t/; hDkhk (10.77b) 1 aD2 r/NULv2 /SYN(10.77c) eDv.t//STXh /SYN/NULr.t/ r;eDkek (10.77d) Equation ( 10.77c ), derived directly from the vis viva equation, is used to deter- minea. The perifocal coordinates vectors can now be computed, so that ihDh=hDA31i1CA32i2CA33i3 (10.78a) ieDe=eDA11i1CA12i2CA13i3 (10.78b) ipDih/STXieDA21i1CA22i2CA23i3 (10.78c) which can be used to extract any desired Aij. The inclination, i, right ascension of the ascending node, ˝, argument of periapsis, !, are computed by iDcos/NUL1A33;0/DC4i</EM (10.79a) ˝Datan2.A31;/NULA32/; 0/DC4˝<2/EM (10.79b) !Datan2.A13;A23/; 0/DC4!<2/EM (10.79c) Referring to Table 10.1 and Eq. ( 10.57 ), we see that r.t//SOHv.t/DxPxCyPyD.na3=r/Œ/NUL.cosE/NULe/sinEC.1/NULe2/sinEcosE/c141 D.na3=r/e.1/NULecosE/sinEDna2esinE.t/ (10.80) where many time arguments of E.t/ have been omitted to save space. Solving Eq. (10.57 )f o recosE.t/ gives ecosE.t/D1/NULr a(10.81) Equations ( 10.80 ) and ( 10.81 ) then give the eccentric anomaly at time tas E.t/Datan2/DC2r.t//SOHv.t/ na2;1/NULr a/DC3 ;0/DC4E.t/<2/EM (10.82)382 10 Orbital Dynamics The mean anomaly at time tis determined by Kepler’s equation M.t/DE.t//NULesinE.t/ (10.83) and the mean anomaly at the epoch time t0is given by M0DM.t//NULn.t/NULt0/ (10.84) Note that the Kepler elements a,e,i,˝,!, andM0are independent of the time tat which r.t/andv.t/are determined. Note also that quadrants are important, which is why the atan2 function is used in Eqs. ( 10.78 ) and ( 10.82 ). 10.3 Disturbing Forces1 A spacecraft is affected by many disturbing accelerations, or perturbations. Four important disturbance sources are gravity due to a non-spherical Earth,2denoted byagrav; forces due to bodies other than the central body, denoted by athird; aerodynamic drag, denoted by aaero; and solar radiation pressure (SRP), denoted byaSRP. The modiﬁcation of Eq. ( 10.26 ) include these disturbances is RrD/NUL/SYN r3rCaperturbD/NUL/SYN r3rCagravCathirdCaaeroCaSRP (10.85) Note that gravity and third-body disturbances are conservative, meaning that they can be computed as gradients of potential functions, while drag and SRP are not. The most straightforward way to compute perturbed orbital motion is to integrate Eq. (10.85 ) numerically. This is known as the method of special perturbations, and can be the most accurate method, but also the most computationally expensive. The method of general perturbations, which is actually less general, was developed to speed the computation [ 10]. We provide a brief discussion of general perturbation theory in Sect. 10.4.1 . 10.3.1 Non-Spherical Gravity The Earth is not a perfect sphere, and mass is distributed nonuniformly throughout the Earth. Since gravity depends directly on mass, the gravity ﬁeld will reﬂect this nonuniformity. The most common approach to model non-spherical gravity uses a 1The authors would like to thank Christopher K. Nebelecky for the contributions in this section. 2The generalization to any other central body is straightforward; we choose the Earth for speciﬁcity.10.3 Disturbing Forces 383 spherical harmonic expansion, which we will now develop. We consider a body such as the Earth to be built up of a large number, N, of points with mass milocated at points riThese give rise to a gravitational potential at a point rof U.r/DNX iD1Gmi kr/NULrik(10.86) whereGis Newton’s universal gravitational constant. In the Earth-Centered/Earth- Fixed (ECEF) frame rDr2 4cos/NAK0cos/RS cos/NAK0sin/RS sin/NAK03 5 and riDri2 4cos/NAK0 icos/RSi cos/NAK0 isin/RSi sin/NAK0 i3 5 (10.87) where/NAK0is the geocentric latitude3and/RSis the longitude, so kr/NULrik/NUL1D.r2Cr2 i/NUL2r/SOHri//NUL1=2 D1 r/SUB 1C/DLEri r/DC12 /NUL2ri r/STX cos/NAK0cos/NAK0 icos./RS/NUL/RSi/Csin/NAK0sin/NAK0 i/ETX/ESC/NUL1=2 (10.88) We separate the dependence on rfrom that on riby means of the identity [ 2] /SUB 1C/DLEri r/DC12 /NUL2ri r/STX cos/NAK0cos/NAK0 icos./RS/NUL/RSi/Csin/NAK0sin/NAK0 i/ETX/ESC/NUL1=2 D1X nD0/DLEri r/DC1nnX mD0.2/NULı0m/.n/NULm/Š .nCm/ŠPm n.sin/NAK0/Pm n.sin/NAK0 i/cos.m./RS/NUL/RSi// (10.89) whereı0mis the Kronecker delta and Pm n, the associated Legendre function of degreenand orderm, is deﬁned in terms of the Legendre polynomials4 Pn.x/D1 2nnŠdn dxn.x2/NUL1/n(10.90) by5 Pm n.x/D.1/NULx2/m=2dm dxmPn.x/ (10.91) 3We use/NAK0for latitude to avoid confusion with the geodetic latitude of Sect. 2.6.3 . 4Equation ( 10.90 ) is the well-known Rodrigues equation for the Legendre polynomials. 5We follow Vallado’s notation [ 21]. Montenbruck and Gill [ 14] and Abramowitz and Stegun [ 1] denote these functions by Pnmand deﬁnePm nD./NUL1/mPnm.384 10 Orbital Dynamics The associated Legendre functions for degrees 0to4are [21] P0 0.sin/NAK0/D1P2 3.sin/NAK0/D15cos2/NAK0sin/NAK0 P0 1.sin/NAK0/Dsin/NAK0P3 3.sin/NAK0/D15cos3/NAK0 P1 1.sin/NAK0/Dcos/NAK0P0 4.sin/NAK0/D1 8.35sin4/NAK0/NUL30sin2/NAK0C3/ P0 2.sin/NAK0/D1 2.3sin2/NAK0/NUL1/ P1 4.sin/NAK0/D5 2cos/NAK0.7sin3/NAK0/NUL3sin/NAK0/ P1 2.sin/NAK0/D3sin/NAK0cos/NAK0P2 4.sin/NAK0/D15 2cos2/NAK0.7sin2/NAK0/NUL1/ P2 2.sin/NAK0/D3cos2/NAK0P3 4.sin/NAK0/D105cos3/NAK0sin/NAK0 P0 3.sin/NAK0/D1 2.5sin3/NAK0/NUL3sin/NAK0/P4 4.sin/NAK0/D105cos4/NAK0 P1 3.sin/NAK0/D3 2cos/NAK0.5sin2/NAK0/NUL1/ (10.92) Equations ( 10.90 ) and ( 10.91 ) are not useful for computation. The customary procedure is to compute P0 0,P0 1, andP1 1from their explicit expressions and then to ﬁnd the associated Legendre functions of higher degree recursively by P0 n.sin/NAK0/D1 n/STX .2n/NUL1/sin/NAK0P0 n/NUL1.sin/NAK0//NUL.n/NUL1/P0 n/NUL2.sin/NAK0//ETX (10.93a) Pm n.sin/NAK0/Dsin/NAK0Pm n/NUL1.sin/NAK0/C.nCm/NUL1/cos/NAK0Pm/NUL1 n/NUL1.sin/NAK0/; for0<m<n (10.93b) Pn n.sin/NAK0/D.2n/NUL1/cos/NAK0Pn/NUL1 n/NUL1.sin/NAK0/ (10.93c) or some equivalent recursion relations. Putting Eqs. ( 10.86 ), (10.88 ), and ( 10.89 ) together, and noting that P0 0.x/D1, gives the spherical harmonics expansion for the gravity potential U.r/D/SYN r( 1C1X nD1/DC2R r/DC3nnX mD0Pm n.sin/NAK0/ŒCm ncos.m/RS/CSm nsin.m/RS//c141) (10.94) where/SYN/DC1GM, withMDPN iD1mibeing the total mass of all the particles in the central body and, for n/NAK1and0/DC4m/DC4n, Cm nD2/NULı0m M.n/NULm/Š .nCm/ŠNX iD1mi/DLEri R/DC1n Pm n.sin/NAK0 i/cos.m/RSi/ (10.95a) Sm nD2/NULı0m M.n/NULm/Š .nCm/ŠNX iD1mi/DLEri R/DC1n Pm n.sin/NAK0 i/sin.m/RSi/ (10.95b)10.3 Disturbing Forces 385 Fig. 10.10 Types of spherical harmonics. ( a) Zonal. ( b) Tesseral. ( c) Sectoral The parameter Rcharacterizes the size of the mass distribution; for Earth gravity modeling,MDM˚andRDR˚. Note that Eq. ( 10.95 ) is not used to compute Cm nandSm n; they are found by ﬁtting gravity measurement data, including tracking of satellite orbits. The spherical harmonics fall into three classes: zonal harmonics for mD0, tesseral harmonics for 0<m<n , and sectoral harmonics for mDn. These are illustrated in Fig. 10.10 . Note that Eq. ( 10.95 )i m p l i e st h a t S0 nD0, so there are only 2nC1nonzero terms in the spherical harmonics expansion for any degree n. We can eliminate some other coefﬁcients by choosing our coordinate system wisely. Equations ( 10.95 ) and (10.87 ) say that 2 4C1 1 S1 1 C0 13 5D1 MRNX iD1miri (10.96) ThusC0 1,C1 1, andS1 1will all vanish by Eq. ( 3.55) if we place the origin of our coordinate system at the central body’s center of mass, as is done for ECEF coor- dinates. Furthermore, Eqs. ( 10.95 ), (10.87 ), and ( 3.69) say thatC1 2D/NULJ13=MR2 andS1 2D/NULJ23=MR2, whereJis the central body’s moment of inertia tensor. Thus these coefﬁcients also vanish if we choose the zaxis of our coordinate frame to be a principal axis of inertia of the central body. The acceleration due to gravity is determined by taking the gradient of the potential function in Eq. ( 10.94 ). The leading term /SYN=r in the potential function gives the ﬁrst term on the right side of Eq. ( 10.85 ), so we denote the potential with this term omitted by U0. We also set the origin of the coordinate frame at the Earth’s center of mass so that the nD1terms in Eq. ( 10.94 ) vanish by Eq. ( 10.96 ). The geopotential U0is expressed in terms of radial distance, geocentric latitude, and longitude, so we apply the chain rule to obtain acceleration due to the non-spherical Earth as agravD rU0.r/D@U0 @rrrC@U0 @/NAK0r/NAK0C@U0 @/RSr/RS (10.97)386 10 Orbital Dynamics The partials of the geopotential are given by @U0 @rD/NUL/SYN r21X nD2/DC2R˚ r/DC3n .nC1/nX mD0Pm n.sin/NAK0/.Sm nsinm/RSCCm ncosm/RS/ (10.98a) @U0 @/NAK0D/SYN r1X nD2/DC2R˚ r/DC3nnX mD0ŒPmC1 n.sin/NAK0//NUL.mtan/NAK0/Pm n.sin/NAK0//c141 /STX.Sm nsinm/RSCCm ncosm/RS/(10.98b) @U0 @/RSD/SYN r1X nD2/DC2R˚ r/DC3nnX mD0mPm n.sin/NAK0/.Sm ncosm/RS/NULCm nsinm/RS/ (10.98c) The gradients of the radius, latitude, and longitude are given by rrDr r(10.99a) r/NAK0D1p x2Cy2/DLE /NULzr r2Crz/DC1 (10.99b) r/RSD1 x2Cy2.xry/NULyrx/ (10.99c) where rxD2 41 003 5; ryD2 40 103 5; rzD2 40 013 5 (10.100) The Cartesian coordinates of the acceleration are then given by a gravxD 1 r@U0 @r/NULz r2p x2Cy2@U0 @/NAK0! x/NUL/DC21 x2Cy2@U0 @/RS/DC3 y (10.101a) agravyD 1 r@U0 @r/NULz r2p x2Cy2@U0 @/NAK0! yC/DC21 x2Cy2@U0 @/RS/DC3 x (10.101b) agravzD/DC21 r@U0 @r/DC3 zCp x2Cy2 r2@U0 @/NAK0(10.101c) As an example we consider a 6th-order spherical harmonic geopotential model including only the zonal harmonics. Zonal harmonics are especially simple because they are symmetrical about the polar axis, i.e. there is no dependence on thelongitude or on the Greenwich hour angle. A speciﬁc notation, J n/DC1/NULC0 n,i su s e d10.3 Disturbing Forces 387 Table 10.2 Zonal coefﬁcientsiJi /STX10 21:08262668355 /NUL3 3 /NUL2:53265648533 /NUL6 4 /NUL1:61962159137 /NUL6 5 /NUL2:27296082869 /NUL7 65:40681239107 /NUL7 for these coefﬁcients. Values for the zonal coefﬁcients of the Earth can be found in Table 10.2 [21]. By far the strongest perturbation due to the Earth’s shape arises fromJ2, withJ3being more than 400 times smaller. The perturbing acceleration is given by agravD6X iD2aJi (10.102) where the individual terms are [ 17] aJ2D/NUL3 2J2/DLE/SYN r2/DC1/DC2R˚ r/DC322 6664/DLE 1/NUL5/NULz r/SOH2/DC1 x r/DLE 1/NUL5/NULz r/SOH2/DC1 y r/DLE 3/NUL5/NULz r/SOH2/DC1 z r3 7775(10.103a) aJ3D/NUL1 2J3/DLE/SYN r2/DC1/DC2R˚ r/DC332 66645/DLE 7/NUL z r/SOH3/NUL3/NULz r/SOH/DC1 x r 5/DLE 7/NULz r/SOH3/NUL3/NULz r/SOH/DC1 y r 3/DLE 10/NULz r/SOH2/NUL35 3/NULz r/SOH4/NUL1/DC13 7775(10.103b) a J4D/NUL5 8J4/DLE/SYN r2/DC1/DC2R˚ r/DC342 6664/DLE 3/NUL42/NULz r/SOH2C63/NULz r/SOH4/DC1 x r/DLE 3/NUL42/NULz r/SOH2C63/NULz r/SOH4/DC1 y r /NUL/DLE 15/NUL70/NULz r/SOH2C63/NULz r/SOH4/DC1 z r3 7775(10.103c) aJ5D/NUL1 8J5/DLE/SYN r2/DC1/DC2R˚ r/DC352 66643/DLE 35/NUL z r/SOH /NUL210/NULz r/SOH3C231/NULz r/SOH5/DC1 x r 3/DLE 35/NULz r/SOH /NUL210/NULz r/SOH3C231/NULz r/SOH5/DC1 y r/DLE 15/NUL315/NULz r/SOH2C945/NULz r/SOH4/NUL693/NULz r/SOH6/DC13 7775 (10.103d) a J6D1 16J6/DLE/SYN r2/DC1/DC2R˚ r/DC362 6664/DLE 35/NUL945/NUL z r/SOH2C3465/NULz r/SOH4/NUL3003/NULz r/SOH6/DC1 x r/DLE 35/NUL945/NULz r/SOH2C3465/NULz r/SOH4/NUL3003/NULz r/SOH6/DC1 y r/DLE 2205/NULz r/SOH2/NUL4851/NULz r/SOH4C3003/NULz r/SOH6/NUL315/DC1 z r3 7775 (10.103e)388 10 Orbital Dynamics The gravitational parameter /SYNand mean equatorial Earth radius, R˚are given by /SYND3:986004418/STX1014m3 s2(10.104a) R˚D6:378 137/STX106m (10.104b) 10.3.2 Third-Body Forces The term third-body is usually applied to any body other than the two bodies producing two-body Keplerian motion. Consider the motion of a body with mass m2at position r2about a body with mass m1at position r1, under the inﬂuence of n/NUL2other bodies with masses miat positions ri Rr1D/NULGm2 kr1/NULr2k3.r1/NULr2//NULNX iD3Gmi kr1/NULrik3.r1/NULri/ (10.105a) Rr2D/NULGm1 kr1/NULr2k3.r2/NULr1//NULNX iD3Gmi kr2/NULrik3.r2/NULri/ (10.105b) As in the two-body case, subtracting Eq. ( 10.105a )f r o mE q . ( 10.105b ) gives, with r/DC1r2/NULr1,r/DC1krk,/SYN/DC1G.m1Cm2/, and/SYNi/DC1Gmifori/NAK3, RrD/NUL/SYN r3r/NULNX iD3/SYNi/DC2r1/NULriCr kr1/NULriCrk3/NULr1/NULri kr1/NULrik3/DC3 (10.106) The terms in the sum can be treated as small perturbations if all the other bodies are much farther away from m1than ism2, i.e. ifkr1/NULrik/FSrfor alli/NAK3. That is why the gravitational force of the Sun can be treated as a perturbation whenanalyzing the motion of a spacecraft about the Earth. Let us now expand the ﬁrst term in the parentheses of Eq. ( 10.106 )i np o w e r so f r=kr 1/NULrikand retain only the ﬁrst-order term. With kr1/NULriCrk/NUL3D/STX kr1/NULrik2C2r/SOH.r1/NULri/Cr2/ETX/NUL3=2 /EMkr1/NULrik/NUL3/STX 1/NUL3r/SOH.r1/NULri/=kr1/NULrik2/ETX (10.107) this gives RrD/NUL/SYN r3r/NULNX iD3/SYNir/NUL3.ui/SOHr/ui kr1/NULrik3(10.108)10.3 Disturbing Forces 389 where ui/DC1.r1/NULri/=kr1/NULrik. However, it is often better to use Eq. ( 10.106 ) than this approximation. For instance, higher order terms in the expansion for the perturbation of the Moon on a spacecraft in geosynchronous orbit are not negligible, becauser=kr1/NULrik/EM1=9in that case. 10.3.3 Atmospheric Drag For objects in low-Earth orbit, atmospheric drag represents a signiﬁcant perturbing force. The drag force that a spacecraft experiences is given by FaeroD/NUL1 2/SUBCDSkvrelkvrel (10.109) where/SUBis the local atmospheric density, which is discussed in Sect. 11.2,CDis a dimensionless drag coefﬁcient, Sis the spacecraft area projected along the direction of motion, and vrelis the relative velocity of the spacecraft with respect to the atmosphere. As discussed in Sect. 3.3.6.3 , the relative velocity, vrel, is different from the GCI velocity of the spacecraft because the atmosphere is not stationary in the GCI frame. The equations accounting for atmospheric motion can be found in that section. The drag coefﬁcient, CD, is a dimensionless parameter that quantiﬁes how a spacecraft interacts with the surrounding medium to retard its motion. The drag coefﬁcient is a function of the shape of the spacecraft, its orientation with respecttov rel, its surface properties, and the composition of the atmosphere. Often, drag coefﬁcients are determined via experimental and/or ﬁnite element analysis. Experiments are in their own right situation-dependent as they consider only asingle composition for the surrounding medium. Vallado [ 23] points out that the drag coefﬁcient for several common shapes can increase signiﬁcantly simply by changing the orbital altitude. This is because the composition of the atmospherechanges with altitude and the surface materials of the spacecraft will, in general, interact with the different compositions differently. The projected area of a spherical spacecraft is unchanging, but Sdepends on the spacecraft attitude for all other shapes. It is typical to model the geometry of non-spherical spacecraft as a collection of Nﬂat plates of area S iand outward normal unit vector ni Bexpressed in the spacecraft body-ﬁxed coordinate system. The inclination of the ith plate to the relative velocity is given by cos/DC2i aeroD/NUL ATni B/SOHT/DC2vrel kvrelk/DC3 (10.110) whereAis the attitude matrix that rotates the GCI frame to the spacecraft body-ﬁxed frame. The drag force in this model is FaeroD/NUL1 2/SUBCDkvrelkvrelNX0 iD1Sicos/DC2i aero (10.111)390 10 Orbital Dynamics where the prime on the sum indicates that only plates with cos /DC2i aero>0are included in the summation. Note that this algorithm does not account for potential self- shielding that would exist on concave spacecraft. It is typical to group the drag coefﬁcient, projected frontal area, and mass into a single term called the ballistic coefﬁcient, B: BDm CDS(10.112) The ballistic coefﬁcient describes the relative magnitude of the effect of drag to inertial forces and gravity. A spacecraft with a low ballistic coefﬁcient will be more susceptible to effects caused by drag than a spacecraft with a high ballisticcoefﬁcient. Most orbit determination algorithms can also reﬁne an initial estimate of the ballistic coefﬁcient. Note that some texts deﬁne the ballistic coefﬁcient as the inverse of that in Eq. ( 10.112 ). 10.3.4 Solar Radiation Pressure Solar radiation pressure (SRP) is another non-conservative force acting on space- craft. It is dominated by drag for spacecraft in low-Earth orbit, but SRP willgenerally outweigh drag in higher altitude orbits ( /NAK800 km). Like drag, SRP can be characterized using either a simple or high ﬁdelity model depending upon the level of accuracy needed as well as a priori knowledge of the spacecraft. The mechanismby which SRP affects the orbit of a spacecraft is through momentum exchange between the spacecraft and photons incident on the spacecraft. Because of this, SRP is a fundamentally different perturbation from that of drag. Whereas drag actsthroughout the entire orbit, SRP only contributes as times when the spacecraft is not in the shadow of the Earth or another body. The simplest of SRP models assumes that the force on the spacecraft due to solar radiation can be characterized as [ 21] F SRPD/NULPˇcSRPSesatˇ (10.113) wherePˇis the pressure of solar radiation, Sis the Sun-facing area of the spacecraft, and esatˇis a unit vector directed from the spacecraft to the center of the Sun, expressed in inertial coordinates. Section 11.3 presents methods for computing the Sun position, solar pressure, and conditions for shadowing. The constantcSRPdeﬁnes how the incident radiation interacts with the spacecraft. A value ofcSRPD0:0implies that the spacecraft is transparent, so not affected by any incoming radiation. When cSRPD2:0, the spacecraft acts like a mirror with all incident radiation perfectly reﬂected directly back to the Sun. While cSRPcan vary for a single spacecraft depending on its attitude, for most practical problems a value ofcSRPbetween 1.0 and 2.0 is sufﬁcient for preliminary simulations.10.3 Disturbing Forces 391 More sophisticated methods can be used to obtain more accurate estimates of SRP if detailed knowledge of the spacecraft is available. These methods decompose the SRP into contributions due to specular reﬂection, diffuse reﬂection,absorption, and emission. Suppose that spacecraft’s surface can be modeled as a collection of Nﬂat plates of area S i, outward normal ni Bin the body coordinate frame, specular reﬂection coefﬁcient Ri spec, diffuse reﬂection coefﬁcient Ri diff, and absorption coefﬁcient Ri abs. The coefﬁcients sum to unity; Ri specCRi diffCRi absD1. Diffuse reﬂection is assumed to be Lambertian, which means that the intensity ofthe reﬂected light in any direction is proportional to the cosine of the angle between the reﬂection direction and the normal. The inclination of the ith plate to the spacecraft-to-Sun vector is given by cos/DC2 i SRPD/NUL ni I/SOHTesatˇD/NUL ATni B/SOHTesatˇ (10.114) whereAis the attitude matrix that rotates the GCI frame to the spacecraft body-ﬁxed frame. The force due to SRP can then be expressed as [ 21] FSRPD/NULPˇNX0 iD1Sicos/DC2i SRP/DC4 2/DC2Ri diff 3CRi speccos/DC2i SRP/DC3 ni IC.1/NULRi spec/esatˇ/NAK (10.115) where the prime on the sum indicates that only plates with cos /DC2i SRP>0are included in the summation. Equation ( 10.115 ) provides a good approximation for the SRP acting on a spacecraft of basic geometry, but it has several limitations. First, it should be mentioned that the Sun is not the only source of radiation, although it is by far the largest for Earth-orbiting spacecraft. Reﬂected light from the Earth or the Moon,called albedo , can be signiﬁcant if very precise dynamical modeling is required; and models incorporating this effect have been developed [ 5]. Secondly, the force due to thermal radiation emitted from the spacecraft has been ignored. A spacecraft is usually in a long-term energy balance, so all the absorbed radiation is emitted as thermal radiation, although not necessarily at the same time or from the same surface as its absorption. A simple way to modelthermal radiation is to consider a portion of the absorbed radiation to be diffusely reﬂected, by increasing R i diffand decreasing Ri abs. However, this assumes that the energy is re-radiated from the same surface and at the same time as its absorption.A more accurate computation requires knowledge of the absolute temperature T i and emissivity /SIi(a dimensionless constant between 0 and 1) of each surface. Then the thermal radiation ﬂux from the surface is given by the Stefan-Boltzmann law Fi thermalD/SIi/ESCT4 i (10.116) where/ESCD5:67/STX10/NUL8Wm/NUL2K/NUL4is the Stefan-Boltzmann constant. If the thermal radiation from every surface is Lambertian, it gives rise to a net force FthermalD/NUL2 3NX iD1Fi thermalSiniI(10.117)392 10 Orbital Dynamics The reason that thermal radiation is usually negligible is that it is emitted with roughly equal ﬂux in all directions, so that the net radiation force is generally small. A careful treatment of thermal radiation has been used to explain the anomalousacceleration of the Pioneer 10 and 11 spacecraft, though [ 18,20]. This analysis had to account for onboard nuclear energy sources on these spacecraft, which resulted in more radiation energy being emitted than absorbed. Finally, Eq. ( 10.115 ) does not explicitly account for potential self-shadowing of concave spacecraft. If the conﬁguration of the spacecraft is known a priori, self- shadowing can be taken into account by replacing S iwith the area of the ﬂat plate that is visible to the Sun after accounting for self-shadowing. Modeling the effects of reﬂected radiation or thermal radiation from one surface striking another surface is an additional complication. Another drawback to Eq. ( 10.115 ) is that it is only valid for a collection of ﬂat surfaces with uniquely deﬁned outward normals. Most real spacecraft have some curved surfaces, and accurately approximating these surfaces by a collection of ﬂat plates causes the size of the model to grow, increasing thecomputational burden. 10.4 Perturbation Methods Perturbation methods ﬁnd solutions to complex problems by relating them to solutions of simpler problems. In our case, the solution of Eq. ( 10.85 ) is close to the solution of the Kepler problem with all but the ﬁrst term on the right side absent.We will only give a very brief discussion of one of these methods; much fuller treatments can be found in many books [ 4,8,16,22]. 10.4.1 Variation of Parameters In the variation of parameters (VOP) method, constant parameters that characterize the unperturbed motion of a system are treated as slowly-varying parameters ina representation of the perturbed motion. The six Kepler orbit elements are well suited for the application of the VOP method to perturbed orbital motion. Consider that we have a solution of Eq. ( 10.85 ) that gives a spacecraft’s position and velocity as functions of time. Then at any particular time t, we can compute a set of six Kepler elements using Eqs. ( 10.77 )–(10.84 ). These are called osculating elements , and the Keplerian orbit with these elements is the osculating orbit , after the Latin word “osculum,” meaning kiss, because the osculating orbit is tangent to, or kisses, the perturbed orbit at time t. The osculating Keplerian elements a.t/,e.t/,i.t/,˝.t/ ,!.t/, andM 0.t/that represent the perturbed orbit are functions of time, and obey a set of nonlin- ear coupled differential equations. These equations for the case of conservative perturbations, i.e. those derivable from a potential function, were developed by10.4 Perturbation Methods 393 Lagrange; and Gauss found the equivalent equations in terms of the perturbing acceleration aperturb . Exact integration of these equations has no real advantage over direct integration of Eq. ( 10.85 ), but they are very useful as a starting point for approximations. Their widespread application to the dynamics of Earth-orbiting spacecraft began with the work of Brouwer [ 6] and Kozai [ 12], who analyzed the effect of the zonal gravity harmonics on the osculating elements. Hoots hassummarized the history of these developments [ 10]. The variations of the osculating elements can be separated into periodic terms and secular terms. The orbit elements obtained after removing the periodic terms(in some analytic model and to some degree of approximation) are called mean elements . The mean elements are smoother functions of time than the osculating elements, and they obey simpler differential equations. The basic idea of theVOP method is to propagate the mean elements and then add the periodic terms analytically. Care must be taken, because different analytic methods result in somewhat different mean elements. 10.4.2 Two Line Elements The U.S. Space Surveillance System has been tracking and maintaining a catalogof man-made Earth-orbiting satellites since the dawn of the space age; by 2004 the catalog contained more than 10,000 objects [ 10]. The catalog is in the form of North American Air Defense Command (NORAD) two line element (TLE)sets, which provide the basic parameters to predict the position and velocity of a spacecraft. Tables 10.3 and10.4 describe the information in the TLE set. 6The orbital elements in Line 2 are mean values obtained by removing periodic variationsin a particular way. Accurate orbit predictions are obtained only if the prediction model computes these periodic variations in exactly the same way that they were removed in computing the elements. Using any other prediction model, even onethat is theoretically more accurate, will produce inferior predictions. The model currently used for this purpose is the simpliﬁed general perturbations model SGP4, which includes low-order zonal gravity terms and an approximate aerodynamic dragmodel [ 10,22]. An example for a TLE from the Tropical Rainfall Measuring Mission (TRMM) spacecraft is given by TRMM 1 25063U 97074A 11130.2059828 .00013273 00000-0 18660-3 0 6592 2 25063 034.9640 081.2155 0001042 240.3761 119.6798 15.55777853 76795 4 The title line contains the spacecraft name. The other two lines are described in Tables 10.3 and10.4. Note that there is an assumed decimal point in the B/ETXvalue, so the value in the example is by 1:8660/STX10/NUL4.T h et e r mB/ETXis given by [ 21] 6The format is also described in http://en.wikipedia.org/wiki/Two-line_element_set .394 10 Orbital Dynamics Table 10.3 Line 1 TLE information Field Columns Content Example 10 1 /NUL01 Line number 1 20 3 /NUL07 Satellite number 25063 30 8 /NUL08 Classiﬁcation (U=Unclassiﬁed) U 41 0 /NUL11 International Designator (Last two digits of launch year) 97 51 2 /NUL14 International Designator (Launch number of the year) 074 61 5 /NUL17 International Designator (Piece of the launch) A 71 9 /NUL20 Epoch Year (Last two digits of year) 11 82 1 /NUL32 Epoch (Day of the year and fractional portion of the day) 130.20598286 93 4 /NUL43 First Time Derivative of the Mean Motion divided by two .00013273 10 45 /NUL52 Second Time Derivative of Mean Motion divided by six 00000 /NUL0 11 54 /NUL61B/ETXdrag term (decimal point assumed) 18660 /NUL3 12 63 /NUL63 The number 0 (Originally “Ephemeris type”) 0 13 65 /NUL68 Element number 659 14 69 /NUL69 Checksum (Modulo 10) 2 Table 10.4 Line 2 TLE information Field Columns Content Example 10 1 /NUL01 Line number 2 20 3 /NUL07 Satellite number 25063 30 9 /NUL16 Inclination (Deg) 34.9640 41 8 /NUL25 Right Ascension (Deg) 81.2155 52 7 /NUL33 Eccentricity (decimal point assumed) 0001042 63 5 /NUL42 Argument of Perigee (Deg) 240.3761 74 4 /NUL51 Mean Anomaly (Deg) 119.6798 85 3 /NUL63 Mean Motion (Revs per Day) 15.55777853 96 4 /NUL68 Revolution number at epoch (Revs) 76795 10 69 /NUL69 Checksum (Modulo 10) 4 B/ETXD1 2CDS m/SUB0R˚ (10.118) whereCDis the drag coefﬁcient, Sis the cross-sectional area, mis the mass,/SUB0is the atmospheric density at perigee (assumed to be 2:461/STX10/NUL5kg/m2/ER), andR˚ is the Earth radius (ER), typically given by 6378.135 km. The ballistic coefﬁcient, B, deﬁned by Eq. ( 10.112 ), is related to B/ETXby BDR˚/SUB0 2B/ETX(10.119) UsingR˚D6378:135 km the constant conversion is given by BD1 12:741621B/ETXkg m2(10.120)10.4 Perturbation Methods 395 10.4.3 A Useful Approximation, Secular J2Effects Only We noted in Sect. 10.3.1 that theJ2zonal term gave by far the largest perturbation due to non-spherical gravitational ﬁeld of the Earth. In many cases, a simple Keplerian propagation including only secular J2perturbations is adequate for the orbital accuracy required. This is the case, for example, when the output is usedfor graphical visualization. In such instances, we can tolerate errors of order J 2,b u t want to avoid errors of order J2.t/NULt0/. Analysis shows that the mean elements Na,Ne, andNiare constant, and the other mean elements have the following secular variation to ﬁrst order in J2[16]: N!.t/DN!.t0/C3 2J2/DC2R˚ Na/DC32 .1/NULNe2//NUL2/DC2 2/NUL5 2sin2Ni/DC3 Nn.t/NULt0/ (10.121a) N˝.t/DN˝.t0//NUL3 2J2/DC2R˚ Na/DC32 .1/NULNe2//NUL2/NUL cosNi/SOH Nn.t/NULt0/ (10.121b) NM0.t/DNM0.t0/C3 2J2/DC2R˚ Na/DC32 .1/NULNe2//NUL3=2/DC2 1/NUL3 2sin2Ni/DC3 Nn.t/NULt0/(10.121c) where the overbars indicate mean elements, and NnDp /SYN=Na3. We can combine the last of these equations with Eq. ( 10.68 ) to get NM.t/DNM0.t0/COn.t/NULt0/ (10.122) where OnDNn" 1C3 2J2/DC2R˚ Na/DC32 .1/NULNe2//NUL3=2/DC2 1/NUL3 2sin2Ni/DC3# Dr/SYN Oa3(10.123) with OaDNa" 1/NULJ2/DC2R˚ Na/DC32 .1/NULNe2//NUL3=2/DC2 1/NUL3 2sin2Ni/DC3# (10.124) If we can tolerate errors of order J2, we only need to add the ﬁrst-order corrections of Eqs. ( 10.121 ) and ( 10.122 ), and can otherwise propagate the orbit as if it were an unperturbed orbit. It is unnecessary to compute the periodic corrections for manyorbit and attitude analyses, so we can treat the propagated mean elements as if they were osculating elements. The initial values of the mean elements can be obtained from a TLE set, or they can simply be postulated for a mission design study. We often want to initialize an orbit propagation with position and velocity vectors at some epoch time. In order to use the simple Keplerian propagator incorporating secular J 2effects, we ﬁrst convert the position and velocity to396 10 Orbital Dynamics osculating orbital elements. In principle, we should then remove the periodic variations to obtain mean elements. Since we are willing to tolerate errors of order J2, however, this osculating-to-mean conversion is unnecessary for ﬁve of the six Keplerian orbit elements. We must compute the mean value of the semimajor axis, however, because Eq. ( 10.122 ) shows that an error of order J2in the semimajor axis will lead to an error of the same order of magnitude in the mean motion and thus topropagation errors growing like J 2On.t/NULt0/, which we are not willing to tolerate [ 13]. The mean-to-osculating transformation of the semimajor axis is given by [ 16] a.t/DNaCJ2R2 ˚ Na(/DC2Na r/DC33/STX 1/NUL3sin2Nisin2.N!C/ETB//ETX /NUL.1/NULNe2//NUL3=2/DC2 1/NUL3 2sin2Ni/DC3) (10.125) After propagating the orbit to times of interest, we apply the inverse, mean-to- osculating, transformation of the semimajor axis. This is not strictly necessary,because ignoring it leads to tolerable errors of order J 2, but it ensures that the output position and velocity agree with the input position and velocity at the epoch time. Since we convert back to the osculating semimajor axis, we are free to usethe quantityOaof Eq. ( 10.124 ) as our mean semimajor axis on the right side of Eqs. ( 10.121a ) and ( 10.121b ), because that introduces differences only of order J 2 Combining Eqs. ( 10.124 ) and ( 10.125 ) and using Eq. ( 10.20 ) to expressr.t/in terms of the mean elements and the true anomaly /ETB.t/ gives a.t/DOaC J2R2 ˚ Oa! g.t/ (10.126) where g.t//DC1/DC21CNecos/ETB.t/ 1/NULNe2/DC33/STX 1/NUL3sin2Nisin2.N!.t/C/ETB.t///ETX (10.127) We use the exact inverse of this equation OaD1 2/DC4 a.t0/Cq a2.t0//NUL4J2R2 ˚g.t0//NAK (10.128) to initializeOaat the epoch time, so that the output position and velocity agree with the input to computer precision. Thus the steps in this orbit propagator are C o n v e r t r.t0/andv.t0/to osculating Keplerian orbit elements U s e E q . ( 10.128 ) to computeOa  TreatOaand the other ﬁve osculating elements as mean elements  Compute the mean motion OnDp /SYN=Oa3  Use Eqs. ( 10.121a ), (10.121b ), and ( 10.122 ) to propagate to time t10.4 Perturbation Methods 397 U s e E q . ( 10.126 ) to compute a.t/  Convert the Keplerian orbit elements to r.t/andv.t/ This orbit propagator was used in Goddard Space Flight Center’s Mission Planning Graphics Tool (MPGT), and also to drive a wall display at the Smithsonian Air and Space Museum. 10.4.4 Sun-Synchronous Orbits The right ascension of the ascending node in a Sun-synchronous orbit increases at a rate of 1 revolution per year, or 1:991/STX10/NUL7rad/s, so that the orbit plane has a nearly ﬁxed orientation relative to the Sun. SubstitutingPN˝D1:991/STX10/NUL7rad/s and the numerical values for J2,/SYN, andR˚into Eq. ( 10.121b ) shows that the inclination of a Sun-synchronous orbit must obey the relationship cosNiD/NUL0:09892.1/NULNe2/2/DC2Na R˚/DC37=2 D/NUL.1/NULNe2/2/DLE/SUB 3:975 h/DC17=3 (10.129) where/SUBis the orbit period. Because the cosine is negative, the inclination will be greater than95:68ı, which means that these are retrograde orbits. Sun-synchronous orbits are labeled by the mean local time of the ascending node, i.e. the mean local time at the sub-satellite point when the spacecraft crosses the equator from South to North. These orbits have many useful applications, particularly for observing the Earth’s surface, because the lighting conditions at anylatitude change only seasonally, so very slowly from orbit to orbit. The inclination of circular Sun-synchronous orbits varies from 95:68 ıforaDR˚to99:48ıfor aDR˚C1;000 km, and these high-inclination orbits are well-suited to observing high-latitude regions of the Earth. The AT r a i n , or Afternoon Train, of Earth-observation satellites provides a good example of the use of such orbits. The spacecraft in this constellation arein 1:30 p.m. Sun-synchronous orbits with iD98:14 ıandaD7;078 km.7They are spaced a few minutes apart from each other so their collective observations may be used to build high-deﬁnition three-dimensional images of the Earth’s atmosphereand surface. There are currently ﬁve active satellites in the A Train: the Global Change Observing Mission (GCOM-W1, also known as SHIZUKU), the lead spacecraft in the constellation, launched by JAXA on May 18, 2012: Aqua, 4 minbehind GCOM-W1, launched by NASA on May 4, 2002; CloudSat, a cooperative effort between NASA and the Canadian Space Agency, 2 min and 30 s behind Aqua; the Cloud-Aerosol Lidar and Infrared Pathﬁnder Satellite Observations (CALIPSO)spacecraft, a joint effort of CNES and NASA, launched with Cloudsat on April 28, 7The lack of precise agreement with Eq. ( 10.129 ) is due to higher-order zonal perturbations.398 10 Orbital Dynamics 2006 and following it by no more than 15 s; and Aura, a multi-national satellite, 15 min behind Aqua but crossing the equator 8 min behind it due to a different ascending node, launched by NASA on July 15, 2004. Several solar observing scientiﬁc spacecraft have employed dawn/dusk Sun- synchronous orbits, with ascending nodes at 6 a.m. or 6 p.m., to afford a nearly continuous view of the Sun. The near-absence of eclipses in dawn/dusk orbits isalso useful for providing photoelectric power and for minimizing thermal transients on sensitive scientiﬁc instruments that occur at eclipse entry and exit. The eclipse analysis of Sect. 11.3 of Chap. 11shows that eclipses cannot be completely avoided unlessajsin."Ci/j>R ˚, where"D23:44ıis the obliquity of the ecliptic. This condition is satisﬁed only if ais between1:218R ˚and1:522R ˚. A spacecraft in a lower or higher 6 a.m. orbit will suffer eclipses around the northernmost point ofits orbit for several weeks near the winter solstice, and a spacecraft i na6p . m . orbit outside this altitude range will be eclipsed near the southernmost point of its orbit around the time of the summer solstice. The Canadian RADARSAT-2spacecraft, launched on December 14, 2007, is an example of a 6 p.m. Sun- synchronous orbit. Its altitude is 798 km, so it has an 11-week eclipse period around the summer solstice, with the longest eclipse duration being 18 min [ 15]. 10.5 Lagrange Points After Newton solved the equations of motion of two bodies under their gravitational attraction, the famous two-body problem , attention turned to the three-body prob- lem. This led to a great deal of deep mathematics that is beyond the scope of this book [ 4,8,16]. We will only consider the circular restricted three-body problem (CR3BP). Restricted means that the mass of the third body (generally a spacecraft or an asteroid) is so small compared to the masses of the other two bodies (usually the Sun and the Earth,8the Earth and the Moon, or the Sun and Jupiter) that ignoring its inﬂuence on their motion is an excellent approximation. Circular means that the two other bodies, called the primaries , move in circular orbits around each other. We will assume that the ﬁrst primary, with mass m1, is at least as heavy as the second, with mass m2. The motion of the third body is most naturally described in a co-rotating coordinate system, in which the primaries appear to be at rest. The origin of this frame is at the center of mass of the two primaries, its xaxis is in the direction from m1tom2, itszaxis is along the direction of the orbital angular velocity of the two primaries, and its yaxis completes the right-handed orthogonal triad. Figure 10.11 illustrates the frame and axis deﬁnitions. Our analysis will follow that of Danby [ 8], and will employ kinematic equations in a rotating frame developed in Sect. 3.1.3 .W eu s eE q .( 3.15) for the position vector 8In discussing the Sun/Earth Lagrange points, “Earth” means the system of the Earth and the Moon, the Sun is the ﬁrst body, and the mass and location of the second body are the summed Earth/Moonmass and the location of the Earth/Moon center of mass.10.5 Lagrange Points 399 y xL2 L1 L3 L5L4 Ox1 x2m1 m2a2 a1 ac Fig. 10.11 The ﬁve Lagrange points of the spacecraft with respect to the center of mass of the two primaries, letting F denote the inertial frame and Gdenote the co-rotating frame, which differ only by a rotation about the zaxis. Because !is in the positive zdirection, it has the same representation in both frames, so we can omit its frame-specifying subscript.The angular velocity is also constant, so the P!term vanishes, giving Rr GDAGFRrF/NUL!/STX.!/STXrG//NUL2!/STXPrG (10.130) The acceleration in the inertial frame is due to the gravitational attraction of the two primaries, RrFD/NUL/SYN1.r/NULr1/F kr/NULr1k3/NUL/SYN2.r/NULr2/F kr/NULr2k3(10.131) where/SYNiDGMi, so the spacecraft dynamics is governed by the equation RrGD/NUL/SYN1.r/NULr1/G kr/NULr1k3/NUL/SYN2.r/NULr2/G kr/NULr2k3/NUL!/STX.!/STXrG//NUL2!/STXPrG (10.132) All vectors have now been expressed in the co-rotating frame, so we will omit the subscriptGfor the remainder of the discussion. We want to prove the existence of ﬁve Lagrange points ,o rlibration points , which are points of static equilibrium where RrandPrare zero. Thus we are looking for solutions of 0D/NUL/SYN1 kr/NULr1k32 4x/NULx1 y z3 5/NUL/SYN2 kr/NULr2k32 4x/NULx2 y z3 5C/SYN1C/SYN2 a32 4x y 03 5(10.133)400 10 Orbital Dynamics We have used the relation !2D./SYN1C/SYN2/=a3, which follows from Eq. ( 10.43 ) with abeing the radius of the orbit of the two primaries. The zcomponent of Eq. ( 10.133 ) requires zD0, so any equilibrium point must lie in the x/NULyplane. Theycomponent requires either yD0or 0D/NUL/SYN1 kr/NULr1k3/NUL/SYN2 kr/NULr2k3C/SYN1C/SYN2 a3(10.134) Ify¤0, substituting this into the xcomponent of Eq. ( 10.133 ) leads to the requirement 0D/SYN1x1 kr/NULr1k3C/SYN2x2 kr/NULr2k3(10.135) The deﬁnition of the center of mass means that /SYN1x1D/NUL/SYN2x2,s oi tf o l l o w sf r o m Eq. (10.135 ) thatkr/NULr1kDk r/NULr2k. Substituting this into Eq. ( 10.134 ) then gives kr/NULr1kDk r/NULr2kDa. This deﬁnes the two Lagrange points L4andL5at the vertices of two equilateral triangles in the orbital plane of the two primaries, whose other vertices are the locations of the primaries. These are illustrated forthe case that m 1D3m2in Fig. 10.11 . The ﬁgure shows that the resultant of the acceleration vectors a1due to the attraction of m1anda2due to the attraction of m2 provides the centripetal acceleration acD!/STX.!/STXr/needed for equilibrium at L4. There is no simple expression for the location of the collinear Lagrange points, the points with yDzD0. Assume that m2/DC4m1and let ˇ/DC1m2 m1Cm2;so thatx1D/NULˇa andx2D.1/NULˇ/a (10.136) We also letxD/CANa, so that Eq. ( 10.132 ) for a body at rest on the xaxis gives R/CAN !2D/NUL.1/NULˇ//CANCˇ j/CANCˇj3/NULˇ/CANCˇ/NUL1 j/CANCˇ/NUL1j3C/CAN (10.137) The right side of this equation is plotted in Fig. 10.12 forj/CANj/DC41:5for the case that m1D3m2. The function will have this general shape for any mass ratios. We notice two things. First, it is easy to see that there are three collinear Lagrange points: L1 betweenm1andm2,L2on the side of m2away fromm1, andL3on the side of m1away fromm2.9The second point is that the acceleration in the vicinity of a collinear Lagrange point is always away from the Lagrange point, meaning that the collinear Lagrange points are unstable. If m2/FSm1, the usual case, it is not too difﬁcult to show that L2andL1are atx/EMx2˙.ˇ=3/1=3a, respectively, and that L3is atx/EM/NUL.1C5ˇ=12/a . The Sun/Earth L1andL2points are about 0.01 AU, or about1:5/STX106km, from the Earth, because ˇ/EM3/STX10/NUL6for that system. 9This labeling convention is not universally followed.References 401 L3 m1O m2 xy L1 L2 Fig. 10.12 x-axis force, and collinear Lagrange points A complete analysis of the stability of the Lagrange points requires consideration of the Coriolis acceleration, the last term in Eq. ( 10.132 ). We will only state the result obtained by linearizing this equation in the vicinity of L4andL5, Danby shows that these points are stable if m1=m2>. 2 5C3p 69/=2D24:96 . Stable points atL4orL5are called Trojan points , after the Trojan asteroids at the Sun- JupiterL4andL5points. The Earth/Moon Trojan points are stable, but solar gravity leads to large motions about these points [ 11,19]. Although the collinear Lagrange points are unstable, relatively small control forces can keep spacecraft in orbits around these points, and a variety of uses have been found for spacecraft in such orbits [ 9]. The International Sun-Earth Explorer 3 (ISEE-3), the Solar and Heliospheric Observatory (SOHO), the Advanced Com-position Explorer (ACE), and WIND spacecraft have all been stationed near the Sun/EarthL 1point to observe the Sun and the solar wind. Radio emissions from the Sun would complicate communication with a spacecraft exactly at L1. The Sun/Earth L2point is useful for stationing an instrument that needs to be shielded from thermal energy emitted by both the Sun and the Earth, which are both on the same side of the spacecraft. Spacecraft are almost never placed exactly at L2, however, since they would not be able to use Solar power at that point. The WMAP, Herschel, and Planck spacecraft have all been placed in orbits around L2, and the James Webb Space Telescope (JWST) is planned to be placed there. An orbit aboutthe Earth/Moon L 2point has been proposed as the location for a data relay satellite to communicate with human or robotic explorers on the back side of the Moon.402 10 Orbital Dynamics References Abramowitz, M., Stegun, I.A.: Handbook of Mathematical Functions with Formulas, Graphs and Mathematical Tables. Applied Mathematics Series - 55. National Bureau of Standards,Washington, DC (1964) Arfken, G.B., Weber, H.J., Harris, F.E.: Mathematical Methods for Physicists: A Comprehen- sive Guide, 7th edn. Academic Press, Waltham (2013) Bate, R.R., Mueller, D.D., White, J.E.: Fundamentals of Astrodynamics. Dover Publications, New York (1971) Battin, R.H.: An Introduction to the Mathematics and Methods of Astrodynamics. American Institute of Aeronautics and Astronautics, New York (1987) Borderies, N., Longaretti, P.: A new treatment of the albedo radiation pressure in the case of a uniform albedo and of a spherical satellite. Celestial Mech. Dyn. Astron. 49(1), 69–98 (1990) Brouwer, D.: Solution of the problem of artiﬁcial satellite theory without drag. Astron. J.64(1274), 378–397 (1959) Colwell, P.: Solving Kepler’s Equation over Three Centuries. Willmann-Bell, Richmond (1993)8. Danby, J.M.A.: Fundamentals of Celestial Mechanics, 2nd edn., 3rd Printing. Willman-Bell, Richmond (1992) Farquhar, R.W.: Fifty Years on the Space Frontier: Halo Orbits, Comets, Asteroids, and More. Outskirts Press, Parker (2011) Hoots, F.R., Schumacher Jr., P.W., Glover, R.A.: History of analytical orbit modeling in the U.S. space surveillance system. J. Guid. Contr. Dynam. 27(2), 174–185 (2004) Kolenkiewicz, R., Carpenter, L.: Stable periodic orbits about the Sun perturbed Earth-Moon triangular points. AIAA J. 6(7), 1301–1304 (1968) Kozai, Y .: The motion of a close Earth satellite. Astron. J. 64(1274), 367–377 (1959) Markley, F.L., Jeletic, J.F.: Fast orbit propagator for graphical display. J. Guid. Contr. Dynam. 14(2), 473–475 (1991) Montenbruck, O., Gill, E.: Satellite Orbits: Models, Methods, and Applications. Springer, Berlin/Heidelberg/New York (2000) Morena, L.C., James, K.V ., Beck, J.: An introduction to the RADARSAT-2 mission. Can. J. Rem. Sens. 30(3), 221–234 (2004) Roy, A.E.: Orbital Motion, 4th edn. IOP Publishing, Bristol (2005)17. Schaub, H., Junkins, J.L.: Analytical Mechanics of Aerospace Systems, 2nd edn. American Institute of Aeronautics and Astronautics, New York (2009) Scheffer, L.K.: Conventional forces can explain the anomalous acceleration of Pioneer 10. Phys. Rev. D67(8), 8402-1–8402-11 (2003) Tapley, B.D., Lewallen, J.M.: Solar inﬂuence on satellite motion near the stable Earth-Moon libration points. AIAA J. 2(4), 728–732 (1964) Turyshev, S.G., Toth, V .T., Kinsella, G., Lee, S.-C., Lok, S.M., Ellis, J.: Support for the thermal origin of the Pioneer anomaly. Phys. Rev. Lett. 108(24), 241101 (2012) Vallado, D.A.: Fundamentals of Astrodynamics and Applications, 3rd edn. Microcosm Press, Hawthorne and Springer, New York (2007) Vallado, D.A., Crawford, P., Hujsak, R., Kelso, T.S.: Revisiting Spacetrack Report #3: Rev 2. In: AIAA/AAS Astrodynamics Specialist Conference. Keystone (2006) Vallado, D.A., Finkleman, D.: A critical assessment of satellite drag and atmospheric density modelling. In: AIAA/AAS Astrodynamics Specialist Conference. Honolulu (2008)Chapter 11 Environment Models The analysis of spacecraft attitude and trajectory motion depends on several environmental models, as does the analysis of sensor measurements. This chapterpresents models of the Earth’s magnetic ﬁeld and atmosphere and of the motion of the Sun and its planets as seen from the Earth. 11.1 Magnetic Field Models In a region with no appreciable electric currents, a magnetic ﬁeld can be computed as the negative gradient of a magnetic scalar potential arising from a collectionof magnetic poles, each providing a 1=r contribution. This is similar to the gravitational potential contributed by a collection of point masses, so magnetic ﬁeld models use the same mathematical apparatus as gravity ﬁeld models. Followingthe same path as in Sect. 10.3.1 leads to a spherical harmonics expansion for the magnetic potential. There is one signiﬁcant difference between the magnetic and gravitational potentials. Gravitational forces are always attractive, while magneticforces can be attractive or repulsive, represented by North and South magnetic poles with pole strengths of opposite signs. In fact, isolated poles are never found in nature: poles always appear in pairs, North and South poles of equal and oppositemagnitude, comprising a magnetic dipole. 1As a result, the ﬁrst term on the right side of the magnetic analog of Eq. ( 10.94 ) is absent, leading to V.r/Da1X nD1/DLEa r/DC1nC1nX mD0NPm n.sin/NAK0/Œgm n.t/cos.m/RS/Chm n.t/sin.m/RS//c141 (11.1) 1Some physical theories predict the occurrence of isolated magnetic monopoles, but none has of yet been detected. F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _11, © Springer Science+Business Media New York 2014403404 11 Environment Models This equation is presented in the form used for the International Geomagnetic Reference Field (IGRF) [ 4]. The parameter aD6371:2 km is the magnetic spherical reference radius, and the coefﬁcients gm n.t/andhm n.t/are conventionally given in units of nanotesla (nT). The bars over the associated Legendre functions indicate that they are the Schmidt semi- (or quasi-) normalized functions, deﬁned as [ 20] NPm nDs .2/NULı0m/.n/NULm/Š .nCm/ŠPm n (11.2) The IGRF is produced and maintained under the auspices of the International Association of Geomagnetism and Aeronomy (IAGA). It represents the internalpart of the Earth’s magnetic ﬁeld, which is almost entirely generated in the Earth’s core and is slowly varying on time scales of years to decades [ 12]. In addition to the internal ﬁeld, magnetic ﬁelds with time scales ranging mostly from seconds tohours are generated by electric currents in the ionosphere and magnetosphere. These ﬁelds, which are not included in the IGRF, are as small as 20 nT during magnetically quiet periods, but can be as large as 1,000 nT or greater during a magnetic storm. Because of the time variation of the Earth’s ﬁeld, the IGRF provides coefﬁcients g m n.Ti/andhm n.Ti/at 5-year intervals. The eleventh generation IGRF has coefﬁ- cients of degrees n/DC410for1900/DC4Ti<2000 andn/DC413for2000/DC4Ti/DC42010 . The coefﬁcients for times between TiandTiC1are found by linear interpolation. This IGRF also includes a predictive model for linear extrapolation to years after 2010, comprising secular variations Pgm n.2010/ andPhm n.2010/ (in nT/year) only for degreesn/DC48. When one of the 5-year constituent models is considered deﬁnitive, it is called a Deﬁnitive Geomagnetic Reference Field (DGRF), and its coefﬁcients are frozen. The eleventh generation IGRF is considered deﬁnitive forthe years 1945–2005. The RMS errors in the more recent models are estimated to be about 10 nT. 11.1.1 Dipole Model Keeping only the nD1terms in Eq. ( 11.1) gives the dipole approximation V.r/Da3 r2/STXNP0 1.sin/NAK0/g0 1CNP1 1.sin/NAK0/.g1 1cos/RSCh1 1sin/RS//ETX Da3 r2/NUL g0 1sin/NAK0Cg1 1cos/NAK0cos/RSCh1 1cos/NAK0sin/RS/SOH Dm/SOHr r3(11.3) where mDa32 4g1 1 h11 g0 13 5Dm2 4sin/DC2mcos˛m sin/DC2msin˛m cos/DC2m3 5 (11.4)11.1 Magnetic Field Models 405 is the magnetic dipole in the ECEF frame. The coefﬁcients from the 2005 DGRF: g0 1D/NUL29554:63 nT,g1 1D/NUL1669:05 nT, andh1 1D5077:99 nT give the dipole magnitude2mDa3/STX30;034 nTD7:77/STX1022Am2as well as the orientation /DC2mD169:7ıand˛mD108:2ı. Note that the Earth’s North magnetic pole is near the South geographic pole, where it must be because opposite poles attract. The magnetic ﬁeld is given by B.r/D/NUL rV.r/D3.m/SOHr/r/NULr2m r5(11.5) The magnetic ﬁeld strength falls off with distance as 1=r3, and it is twice as great at the magnetic poles, rkm, as at the magnetic equator, r?m. The Earth’s magnetic ﬁeld is often used as a reference for attitude determination or control, so it is of interest to know how the direction of the ambient magnetic ﬁeld varies as a spacecraft moves around its orbit. The time derivative of the magnetic ﬁeld at the location of the spacecraft can be separated into components parallel andperpendicular to the ﬁeld by PBDkBk /NUL2h .B/SOHPB/BC.B/STXPB//STXBi DkBk/NUL2.B/SOHPB/BC˝/STXB (11.6) where˝/DC1kBk/NUL2.B/STXPB/is the rotation rate of the magnetic ﬁeld. The ﬁrst term on the right side of Eq. ( 11.6) gives the rate of change of the magnitude of the magnetic ﬁeld, which is of less interest for attitude estimation and control. For a spacecraft in a circular orbit, ris constant and the spacecraft velocity in the GCI frame is PrD!o/STXr, where!ois the orbital angular velocity, so PBD3.m/SOHr/.!o/STXr/C3Œm/SOH.!o/STXr//c141r r5(11.7) The derivation of Eq. ( 11.7) assumes that the magnetic dipole is constant in GCI, which is not exactly true due to the rotation of the Earth. The orbital angular velocityof a near-Earth spacecraft is about 15 times greater than the rotation rate of the Earth, though, so ignoring the motion of the dipole in the GCI frame is a reasonable approximation. Then, after a signiﬁcant amount of vector algebra, we ﬁnd that ˝D3Œ.m/SOHr/ 2Cm2r2/c141!oC.m/SOH!o/Œ2.m/SOHr/r/NULr2m/c141 3.m/SOHr/2Cm2r2(11.8) The derivation of Eq. ( 11.8) makes use of the fact that r/SOH!oD0, because!ois along the orbit normal. This result has two interesting limits. If the orbit plane is 2An extra factor of 4/EM=/SYN0D107is needed to convert to Am2.406 11 Environment Models the magnetic equatorial plane, then m!oD˙!omandm/SOHrD0,s o˝D0as expected. In the more interesting case that the orbit plane contains the magnetic pole directions, m/SOH!oD0, and ˝D3/DC4.m/SOHr/2Cm2r2 3.m/SOHr/2Cm2r2/NAK !o;formin the orbit plane (11.9) This has the maximum and minimum magnitudes ˝D3!oat the magnetic equator and˝D3!o=2at the magnetic poles. 11.2 Atmospheric Density Modeling the local atmospheric density, /SUB, is quite difﬁcult, and many decades of work have resulted in many different models. Vallado [ 18] provides an excellent description of the development of atmospheric models, including many of thecommon assumptions built into them. This section is devoted to the development of atmospheric modeling including the numerous existing models with their beneﬁts and shortcomings. 11.2.1 Exponentially Decaying Model Atmosphere The simplest of all the models is a fully static, exponentially decaying model. Thismodel [ 19] assumes the atmospheric density decays exponentially with increasing height. This model is fully static in the sense that the densities are independent of time. Also, the exponential model assumes an axially symmetric atmosphere aboutthe polar axis. The exponential model is given by /SUBD/SUB 0exp/DC2 /NULh/NULh0 H/DC3 (11.10) where/SUB0andh0are reference density and height, respectively, his the height above the ellipsoid, and His the scale height, which is the fractional change in density with height. Table 11.1 gives values of h0,/SUB0, andHfor various ranges of h[19]. The exponential atmosphere is a good choice for preliminary simulations because it yields decent results and is computationally efﬁcient. However, this model is notusually sufﬁcient for high ﬁdelity simulations.11.2 Atmospheric Density 407 Table 11.1 Exponential atmospheric modelh(km)h0(km)/SUB0(kg/m3)H(km) 0–25 0 1.225 8.44 25–30 25 3.899 /STX10/NUL26.49 30–35 30 1.774 /STX10/NUL26.75 35–40 35 8.279 /STX10/NUL37.07 40–45 40 3.972 /STX10/NUL37.47 45–50 45 1.995 /STX10/NUL37.83 50–55 50 1.057 /STX10/NUL37.95 55–60 55 5.821 /STX10/NUL47.73 60–65 60 3.206 /STX10/NUL47.29 65–70 65 1.718 /STX10/NUL46.81 70–75 70 8.770 /STX10/NUL56.33 75–80 75 4.178 /STX10/NUL56.00 80–85 80 1.905 /STX10/NUL55.70 85–90 85 8.337 /STX10/NUL65.41 90–95 90 3.396 /STX10/NUL65.38 95–100 95 1.343 /STX10/NUL65.74 100–110 100 5.297 /STX10/NUL76.15 110–120 110 9.661 /STX10/NUL88.06 120–130 120 2.438 /STX10/NUL811.6 130–140 130 8.484 /STX10/NUL916.1 140–150 140 3.845 /STX10/NUL920.6 150–160 150 2.070 /STX10/NUL924.6 160–180 160 1.224 /STX10/NUL926.3 180–200 180 5.464 /STX10/NUL1033.2 200–250 200 2.789 /STX10/NUL1038.5 250–300 250 7.248 /STX10/NUL1146.9 300–350 300 2.418 /STX10/NUL1152.5 350–400 350 9.158 /STX10/NUL1256.4 400–450 400 3.725 /STX10/NUL1259.4 450–500 450 1.585 /STX10/NUL1262.2 500–600 500 6.967 /STX10/NUL1365.8 600–700 600 1.454 /STX10/NUL1379.0 700–800 700 3.614 /STX10/NUL14109.0 800–900 800 1.170 /STX10/NUL14164.0 900–1,000 900 5.245 /STX10/NUL15225.0 >1,000 1,000 3.019 /STX10/NUL15268.0 11.2.2 Harris-Priester Model Atmosphere The Harris-Priester atmosphere [ 6] was one of the ﬁrst attempts to model density in terms of atmospheric temperature. Harris and Priester noted that the atmosphereis mainly governed by the laws of thermodynamics and equilibrium in diffusion, conduction and the absorption of thermal energy from the Sun. Density for the Harris-Priester atmosphere is determined by simultaneous integration of the heatconduction and diffusion equations for each of the molecular constituents in the408 11 Environment Models atmosphere, yielding the number density for each constituent. Using the ideal gas law, the density can then be calculated. The Harris-Priester model has resulted in several lookup tables where one can determine the density as a function ofthe local time and altitude for a prescribed solar-ﬂux value. These tables are convenient for determining the density variation within single day and may be useful in short term simulations. While the Harris-Priester model accounts for many ofthe phenomena affecting the atmosphere, it lacks the ability to model seasonal, latitudinal, and geomagnetic variations with the accuracy needed for high ﬁdelity long term simulations. 11.2.3 Jacchia and GOST Model Atmospheres Throughout the late 1960s and 1970s, Jacchia produced a series of models [ 7–9] and updates that explicitly handle each of the observed atmospheric phenomena. The basis for each of the Jacchia models is essentially the same as the Harris-Priester model with one major exception. Whereas the Harris-Priester model determines thetemperature by integrating the heat conduction equation, Jacchia uses an empirically derived temperature proﬁle to integrate the diffusion equation for each constituent. Another difference between the Harris-Priester and Jacchia models is that theHarris-Priester model accounts for all of the solar phenomena within the integration of the conduction equation whereas Jacchia takes a different approach and adds temperature and/or density corrections to account for each of the phenomena.A particular advantage to Jacchia’s models is that he and his colleagues used real spacecraft data to curve ﬁt certain phenomena. This allows Jacchia’s models to accurately represent actual atmospheric conditions even though all the phenomenaare not precisely modeled. One shortcoming of Jacchia’s models are that there is no standard set of lookup tables, meaning that the entire temperature/density proﬁle must be determined via numeric integration for each instant, limiting the models’use in real-time applications. Jacchia’s models must be numerically integrated because of the empirical temperature formula that he used. By proposing an alternative temperature function,Roberts [ 15] was able to analytically integrate the barometric and diffusion equa- tions [ 17]. The resulting density proﬁle proved to be a very good approximation to Jacchia’s densities for all altitudes. The Jacchia-Roberts atmosphere producesvery good results and has been implemented in NASA’s Goddard Trajectory Determination System (GTDS) [ 13]. One last model atmosphere of interest is the Russian GOST atmosphere [ 21]. The GOST model is a purely empirical model constructed using data from the Cosmos spacecraft [ 17]. The main advantage to the GOST model is that it is extremely computationally efﬁcient. In contrast the other models described, exceptthe static model, the GOST model determines the density directly rather than com- puting ﬁrst the temperature proﬁle of the atmosphere. Five multiplicative correction factors then account for variations in the solar ﬂux, diurnal effect, semiannual11.2 Atmospheric Density 409 changes, and geomagnetic activity. Because the GOST model is empirically derived, it requires numerous extensive lookup tables to determine the proper coefﬁcients corresponding to the current atmospheric conditions. The GOST model has beenshown to provide good agreement with other semi-analytic models such as Jacchia 1977 [ 1] and NRLMSIS-00 [ 22]. 11.2.4 Jacchia-Bowman 2008 (JB2008) Model Atmosphere Because Jacchia’s models treat each of the known phenomena individually, they provide a good base that can be reﬁned given new experimental data and advancesin research. Such is the case with the Jacchia-Bowman model atmospheres [ 2,3]. Bowman uses new spacecraft drag data and new solar indices in order to develop corrections to Jacchia’s 1970 model [ 7]. Bowman has incorporated new solar indices apart from the standard F 10:7index in order to determine the exospheric temperature [ 2], ﬁtted new semiannual and seasonal-latitudinal corrections, added high altitude corrections, and provided a new means to account for geomagneticactivity. The Jacchia-Bowman model atmosphere uses Jacchia’s original tempera- ture function, which means that numeric integration is required in order to determine the density distribution. While the model is slow, Bowman’s corrections result in asubstantial reduction in density error over other atmospheric models [ 2]. Because of the high quality of results produced by the Jacchia-Bowman model, it is the standard model used by the Joint Space Operations Center (JSpOC) whentracking objects. The most current version of the Jacchia-Bowman model, JB2008, can be found at the website http://sol.spacenvironment.net/~JB2008/ . Along with Fortran source code, the website also offers many relevant publications relating tothe JB2008 model and its previous versions, histories of solar ﬂux data and magnetic storm indices. In this section the JB2008 model is described in detail. 11.2.4.1 Temperature Proﬁle Jacchia’s models, from which the JB2008 model is constructed, begin by deter- mining the temperature proﬁle of the atmosphere at a speciﬁc time and location. This temperature proﬁle is subsequently used to integrate the diffusion equationsin order to determine the local density. Deﬁning the temperature proﬁles begins by determining the exospheric temperature. The exospheric temperature is inﬂuenced by many factors including solar activity, local time and geomagnetic activity.The effect of solar activity on the exospheric temperature can be represented by the uncorrected exospheric temperature, T c[2] TcD392:4C3:227NFSC0:298/SOHF 10C2:259/SOHS 10C0:312/SOHM 10C0:178/SOHY 10 (11.11)410 11 Environment Models with NFSDWTNF10C.1/NULWT/NS10 (11.12a) WTDmin0 @ NF10 240!1=4 ;11 A (11.12b) andTcexpressed in degrees Kelvin. The /SOHvalues are given by /SOHXDX/NULNXwhere Xis the current value of the solar index and NXis the 81-day centered average value of the index, centered at the desired time. F10,S10,M10, andY10are indices which are used to describe solar activity, as described in detail in [ 2]. These indices are typically tabulated as daily values. However, care must be taken when reading valuesfrom a lookup table. Each index has its own associated time lag for implementation. Values forF 10andS10have a time lag of 1 day, M10has a 2 day time lag and Y10has a 5 day time lag. To clarify this point, suppose we want to determine the exospherictemperature on 11-February-2011. The values F 10,S10, and their centered averages would correspond to those tabulated for 10-February-2011. The M10andNM10values would come from the tabulated values for 9-February-2011, and the values for Y10 would be read from 6-February-2011. Once the uncorrected exospheric temperature is determined, correction factors corresponding to diurnal and geomagnetic effects are added in. The diurnal vari-ation accounts for the day-to-night variation in density of the atmosphere. Using spacecraft drag data to derive the atmospheric density has shown that the maximum density occurs around 14h00 local solar time while a minimum in density occursaround 04h00 local solar time [ 10]. Accounting for the diurnal variation, the local atmospheric temperature is given by T `DTcf1CRŒsinm./DC2/C.cosm/DC1/NULsinm/DC2/jcosn./FS=2/j/c141g (11.13) with /DC2D1 2j/NAKCıˇj (11.14a) /DC1D1 2j/NAK/NULıˇj (11.14b) /FSDHCˇCpsin.HC/CR/ (11.14c) HD/RS/NUL/RSˇ (11.14d) where/NAKis the geodetic latitude, /RSis the longitude, ıˇis the declination of the Sun, and/RSˇis the right ascension (longitude) of the Sun. The constants R,m,nˇ,p, and/CRare derived so that the model given by Eq. ( 11.13 ) best ﬁt spacecraft drag data;11.2 Atmospheric Density 411 RD0:31 ˇ DC37ı mD2:5 p DC6ı nD3:0 /CR DC43ı In addition to modeling of the diurnal bulge, Bowman has introduced an additional diurnal correction [ 3]. The temperature correction can be determined by ﬁrst deﬁning FD0:1.F10/NUL100/ (11.15a) TDLST 24(11.15b) yDcos/NAK (11.15c) whereLST is the local spacecraft time give by LSTD.HC/EM/180ı /EM24 360which is then modulated so that 0<L S T/DC424. The temperature corrections were determined by curve-ﬁtting data over certain altitude intervals. With hbeing the altitude in the ECEF frame given by Eq. ( 2.77), the results of these ﬁts are given by 120/DC4h/DC4200km HD.h/NUL120/=80 ADC17CC18yTCC19yT2CC20yT3CC21yFCC22yFTCC23yFT2 BDC1CC2FCC3FTCC4FT2CC5FT3CC6FT4CC7FT5 CC8yTCC9yT2CC10yT3CC11yT4CC12yT5CC13yCC14Fy CC15FyTCC16FyT2 /SOHTcD.3A/NULB/H2C.B/NUL2A/H3(11.16) 200<h/DC4240km HD4=5 /SOHTcDC1HCC2FHCC3FHT CC4FHT2CC5FHT3CC6FHT4CC7FHT5 CC8yHT CC9yHT2CC10yHT3CC11yHT4CC12yHT5CC13yH CC14FyH CC15FyHT CC16FyHT2CC17CC18yTCC19yT2CC20yT3 CC21FyCC22FyT CC23FyT2(11.17)412 11 Environment Models 240<h/DC4300km HD.h/NUL200/=50; NhD3; hpD.h/NUL240/=6 ADC1HCC2FHCC3FHT CC4FHT2CC5FHT3CC6FHT4 CC7FHT5CC8yHT CC9yHT2CC10yHT3CC11yHT4CC12yHT5 CC13yHCC14FyH CC15FyHT CC16FyHT2CC17CC18yT CC19yT2CC20yT3CC21FyCC22FyT CC23FyT2 BDC1CC2FCC3FTCC4FT2CC5FT3CC6FT4CC7FT5CC8yTCC9yT2 CC10yT3CC11yT4CC12yT5CC13yCC14FyCC15FyT CC16FyT2 XDB1CB2FCB3FTCB4FT2CB5FT3CB6FT4CB7FT5CB8yT CB9yT2CB10yT3CB11yT4CB12yT5CB13yNhCB14yNhTCB15yNhT2 CB16yNhT3CB17yNhT4CB18yNhT5CB19y YDB13yCB14yTCB15yT2CB16yT3CB17yT4CB18yT5 CD3X/NULY/NUL3A/NUL2B DDX/NUL.ACBCC/ /SOHTcDACBhpCCh2 pCDh4 p (11.18) 300<h/DC4600km HDh=100 /SOHTcDB1CB2FCB3FTCB4FT2CB5FT3CB6FT4CB7FT5 CB8yTCB9yT2CB10yT3B11yT4CB12yT5CB13yH CB14yHTCB15yHT2CB16yHT3CB17yHT4 CB18yHT5CB19y (11.19) 600<h/DC4800km HD6; hpD.h/NUL600/=100 ADB1CB2FCB3FTCB4FT2CB5FT3CB6FT4CB7FT5 CB8yTCB9yT2CB10yT3CB11yT4CB12yT5CB13yH CB14yHTCB15yHT2CB16yHT3CB17yHT4CB18yHT5CB19y BDB13yCB14yTCB15yT2CB16yT4CB17yT4CB18yT5 CD/NUL.3C4B/=4 DD.ACB/=4 /SOHTcDACBhpCCh2 pCDh3 p (11.20)11.2 Atmospheric Density 413 Table 11.2 Diurnal temperature correction factorsiBi Ci 1 /NUL0:457512297 /STX101/NUL0:155986211 /STX102 2 /NUL0:512114909 /STX101/NUL0:512114909 /STX101 3 /NUL0:693003609 /STX102/NUL0:693003609 /STX102 4 0:203716701 /STX1030:203716701 /STX103 5 0:703316291 /STX1030:703316291 /STX103 6 /NUL0:194349234 /STX104/NUL0:194349234 /STX104 7 0:110651308 /STX1040:110651308 /STX104 8 /NUL0:174378996 /STX103/NUL0:220835117 /STX103 9 0:188594601 /STX1040:143256989 /STX104 10 /NUL0:709371517 /STX104/NUL0:318481844 /STX104 11 0:922454523 /STX1040:328981513 /STX104 12 /NUL0:384508073 /STX104/NUL0:135332119 /STX104 13 /NUL0:645841789 /STX1010:199956489 /STX102 14 0:409703319 /STX102/NUL0:127093998 /STX102 15 /NUL0:482006560 /STX1030:212825156 /STX102 16 0:181870931 /STX104/NUL0:275555432 /STX101 17 /NUL0:237389204 /STX1040:110234982 /STX102 18 0:996703815 /STX1030:148881951 /STX103 19 0:361416936 /STX102/NUL0:751640284 /STX103 20 0:637876542 /STX103 21 0:127093998 /STX102 22 /NUL0:212825156 /STX102 23 0:275555432 /STX101 h<120 km or800km<h /SOHTcD0 (11.21) The coefﬁcients BiandCican be found in Table 11.2. During calculation of the diurnal temperature variation, Eq. ( 11.13 ), it was speciﬁcally assumed that this temperature occurs during times of no geomagnetic activity [ 8]. There are several means to account for the effect of geomagnetic activity on the density. The ﬁrst method, proposed by Jacchia et al. [ 10] uses an empirically derived temperature correction based on the 3-h geomagnetic planetary index Kp. The empirical formulation was later updated to incorporate a latitudinal dependence. This method was found to work well for altitudes greater than 200 km, but fails toaccurately match data below this height. To overcome this shortcoming a hybrid formula that includes both a temperature and density correction can be applied for altitudes lower than 200 km. A new method proposed by Bowman uses theDST (Disturbance Storm Time) index in order to calculate a temperature correction, /SOHT DST [2].414 11 Environment Models GivenT`, the diurnal correction factor /SOHTcand the geomagnetic correction factor /SOHTDST, the local exospheric temperature, T1is calculated as T1DT`C/SOHTcC/SOHT DST (11.22) The atmospheric temperature proﬁle is assumed to have a constant temperature T0D183K at an altitude of h0D90km. The temperature gradient at h0is also assumed equal to zero. From there the temperature rises rapidly to an inﬂection temperature, Txat a height of hxD125 km. Above 125 km the temperature continues to increase in an asymptotic form towards the exospheric temperature T1. The inﬂection temperature has been empirically deﬁned as TxDaCbT1CcexpŒdT1/c141 (11.23) with the constant coefﬁcients aD371:6678; bD0:02385 cD/NUL392:8292;dD/NUL0:0021357 Belowhxthe temperature proﬁle is given by a 4th-order polynomial T.h/DTxC4X nD1cn.h/NULhx/n;9 0 < h < h xkm (11.24) where the coefﬁcients, cnare determined using the following boundary conditions T.h0/D183 (11.25a) dT dhˇˇˇˇ h0D0 (11.25b) Gx/DC1dT dhˇˇˇˇ hxD1:90Tx/NULT0 hx/NULh0(11.25c) d2T dh2ˇˇˇˇ hxD0 (11.25d) Forh>hxthe temperature proﬁle is asymptotic and the temperature is given by T.h/DTxC2.T1/NULTx/ /EMtan/NUL1/DC2Gx/EM.h/NULhx/ 2.T1/NULTx//STX 1C4:5/STX10/NUL6.h/NULhx/2:5/ETX/DC3 hx<h (11.26) whereGxis as given in Eq. ( 11.25c ).11.2 Atmospheric Density 415 11.2.4.2 Barometric Equation For altitudes between 90 and 105 km, the atmospheric density is computed by integrating the barometric equation. The differential form of the barometric equation is dln./SUB/Ddln NM T! /NULNMg R/ETXTdh (11.27) whereR/ETXD8:31432 J/(K-mol) is the ideal gas constant, gis the local acceleration due to gravity given by gD9:80665/DC2 1Ch Re/DC3/NUL2 (11.28) whereReD6356:766 km andNMis the mean molecular mass of the atmosphere. For90<h/DC4105km,NMis approximated by means of a 6th-order polynomial NM.h/D6X nD0cn.h/NUL90/n; 90<h<105 km (11.29) where the coefﬁcients are given by c0D28:15204; c 1D/NUL8:5586/STX10/NUL2;c2D1:2840/STX10/NUL4 c3D/NUL1:0056/STX10/NUL5;c4D/NUL1:0210/STX10/NUL5;c5D1:5044/STX10/NUL6 c6D9:9826/STX10/NUL8 After integrating the barometric equation, the resulting density is given by /SUBuncorr.h/D/SUB0 NM.h/ NM0!/DC2T0 T.h//DC3 exp/DC4 /NULF.h/ R/ETX/NAK (11.30) where F.h//DC1Zh h0NM./CAN/g./CAN/ T./CAN/d/CAN (11.31) The density at h0is/SUB0D3:46/STX10/NUL6kg/m3. Note thatT0D183 K and NM0/DC1NM.h0/. The subscript “uncorr” has been added to the density in Eq. ( 11.30 ) because this density does not include correction factors for the observed semiannual,Eq. ( 11.39 ), and seasonal-latitudinal, Eq. ( 11.42 ), variations derived from drag data.416 11 Environment Models These correction factors must be applied to determine the density. The integral given in Eq. ( 11.31 ) must be computed numerically. A constant step, 6-point quadrature rule was applied Zb af.x/dx/EMb/NULa 288Œ19f.x0/C75f.x1/C50f.x2/C50f.x3/C75f.x/4C19f.x5//c141 (11.32) where the range from h0tohwas broken into intervals with b/NULaD10m. The JB2008 Fortran code employed a 5-point quadrature rule, also with b/NULaD10m, for the90<h/DC4105km regime. 11.2.4.3 Diffusion Equation For altitudes between 90 and 105 km, integration of the barometric equation is sufﬁcient to determine the atmospheric density (save for some additional correction factors which will be discussed later). However, altitudes within this range arenot typical of spacecraft except during launch and end of life because the drag at this height is high enough such that a spacecraft without thrusting will spiral back to Earth. Above 105 km the atmosphere is assumed to be in diffuse equilibrium.Here the density is computed by determining the number density of each of the individual atmospheric constituents. The atmosphere is assumed to be composed of six components: nitrogen, argon, helium, hydrogen, and atomic and molecularoxygen (O and O 2). The number density for each component is determined by integrating the diffusion equation dni niD/NULMig R/ETXTdh/NULdT T.1/NUL˛i/ (11.33) whereni,Mi, and˛iare the number density (number of atoms per unit volume), molecular weight, and thermal diffusion coefﬁcient of component i. Before inte- grating the diffusion equation, we need to know the number density at the boundary, 105 km. Given the density, /SUB.105/ , the number densities for ﬁve of the components, excluding hydrogen, are determined as niDqiNA/SUB.105/ NMSL;i DN2;Ar;He (11.34a) nOD2NA/SUB.105//DC21 NM.105//NUL1 NMSL/DC3 (11.34b) nO2DNA/SUB.105//DC21CqO2 NMSL/NUL1 NM.105//DC3 (11.34c) whereqiis the volumetric fraction of each component in the mixture, NAis Avogadro’s constant, given by 6:02214129/STX1023mol/NUL1, andNMSLD28:960 is the mean molecular mass of the atmosphere at sea level. The number density11.2 Atmospheric Density 417 Table 11.3 Atmospheric composition at hD90kmSpecies (i)qi Mi˛i Nitrogen (N 2) 0.78110 28.0134 0 Oxygen (O 2) 0.20955 31.9988 0 Oxygen (O) /NUL 15.9994 0 Argon (Ar) 0.0093432 39.948 0 Helium (He) 0.0000061471 4.0026 /NUL0.38 Hydrogen (H) /NUL 1.00797 0 of hydrogen is not calculated in Eq. ( 11.34 ) because hydrogen does not have any impact on the density at altitudes below 500 km. Because of this, altitudes above 105 km must be broken into two distinct regimes, one with 105 < h < 500 km and one with 500km/DC4h. Also note that the density in Eq. ( 11.34 ) is the corrected density at 105 km which includes the semiannual and seasonal-latitudinal correction factors alluded to before. 105<h<500 km The volumetric fraction, molecular weight, and thermal diffusion coefﬁcient of each component can be found in Table 11.3. Integrating Eq. ( 11.33 ) results in ln.ni.h//Dln.ni.105///NUL.1C˛i/ln/DC2T.h/ T.105//DC3 /NULMiG.h/ R/ETX(11.35) where G.h//DC1Zh 105g./CAN/ T./CAN/d/CAN (11.36) is again computed numerically by the 6-point quadrature and b/NULaD10m. Once the number densities are calculated, the uncorrected density is determined as /SUBuncorr.h/D1 NAX iMini.h/ (11.37) A discussion of the correction factors which need to be applied to determine the ﬁnal density will be discussed later. 500km<h Above 500 km hydrogen begins to have an impact on the density calculation. To determine the density at any point above 500 km we begin by integrating the barometric equation for all components, except hydrogen, up to an altitude of 500 km. Next we determine the number density of hydrogen at this altitudeaccording to [ 8] log 10.nH.500//D79:13/NUL39:40 log10.T500/C5:5log10.T500/2(11.38)418 11 Environment Models whereT500is the temperature at hD500km. Now the diffusion equations can be integrated for each component, including hydrogen, up to the desired altitude. The uncorrected density is then determined by Eq. ( 11.37 ). 11.2.4.4 Density Correction Factors The density calculated to this point only includes correction factors accounting for diurnal variations and geomagnetic activity. These are not the only phenom-ena affecting the density that must be accounted for. The JB2008 atmospheric model includes corrections that account for the observed semiannual variation and seasonal-latitudinal variation of the lower atmosphere. Bowman has also proposeda correction for high altitudes, h/NAK1;000 k[3]. 11.2.4.5 Semiannual Variation The semiannual variation describes how the density ﬂuctuates throughout the year. Analysis has shown that the period of this variation is about 6 months with density maxima occurring in April and October and density minima occurring in January and July. The semiannual density correction factor has the form /SOHlog 10/SUBSADf.h/g.t/ (11.39) wheref.h/ andg.t/ are calculated via NFSMJDNF10/NUL0:7NS10/NUL0:04NM10 (11.40a) NhDh=1;000 (11.40b) f.h/DB1CB2NFSMJCB3NFSMJNhCB4NFSMJNh2CB5NF2 SMJNh (11.40c) and NFSMDNF10/NUL0:75NS10/NUL0:37NM10 (11.41a) !D2/EMDOY/NUL1 365(11.41b) g.t/DC1CC2sin.!/CC3cos.!/CC4sin.2!/CC5cos.2!/ CNFSMŒC6CC7sin.!/CC8cos.!/CC9sin.2!/CC10cos.2!//c141 (11.41c) whereDOY is the current day of the year DOY2Œ0;367/ . The coefﬁcients Biand Cican be found in Table 11.4.11.2 Atmospheric Density 419 Table 11.4 Semiannual variation correction factorsiBi Ci 1 2:689 /STX10/NUL1/NUL3:633 /STX10/NUL1 2 /NUL1:176 /STX10/NUL28:506 /STX10/NUL2 3 2:782 /STX10/NUL22:401 /STX10/NUL1 4 /NUL2:782 /STX10/NUL2/NUL1:897 /STX10/NUL1 5 3:470 /STX10/NUL4/NUL2:554 /STX10/NUL1 6 /NUL1:790 /STX10/NUL2 7 5:650 /STX10/NUL4 8 /NUL6:407 /STX10/NUL4 9 /NUL3:418 /STX10/NUL3 10 /NUL1:252 /STX10/NUL3 11.2.4.6 Seasonal-Latitudinal Variation In calculation of the temperature proﬁle, we have assumed the temperature to be a constant 183 K at hD90km over the entire globe. In reality however, the temperature at this height varies seasonally and over different latitudes. The seasonal-latitudinal correction factor attempts to account for the variation in density arising from our assumption. The correction factor is given by SD0:2.h/NUL90/expŒ/NUL0:045.h/NUL90//c141 (11.42a) ˚DJD/NUL2400000:5/NUL36204 365:2422(11.42b) PDsin.2/EM˚C1:72/ (11.42c) /SOHlog10/SUBSLDsign./NAK/SP sin2./NAK/ (11.42d) whereJDis the current Julian Date. The seasonal-latitudinal correction is only applicable to altitudes lower than 200 km. The semiannual variation and seasonal latitudinal variation are multiplicative correction factors to density. Thus thecorrected density is given by log 10/SUBcorrDlog10/SUBuncorrC/SOHlog10/SUBSAC/SOHlog10/SUBSL (11.43) 11.2.4.7 High Altitude Density Correction The last correction factor accounts for variations observed at high altitudes. The high altitude correction factor was developed by Bowman after analysis of 25 spacecraftwith orbital altitudes between 1,500 and 4,000 km. The high altitude correction factor follows as h<1;000 km F HAD1 (11.44)420 11 Environment Models 1;000/DC4h<1;500 km HD.h/NUL1;000/=500 F1;500DD1CD2NF10C1;500D3C1;500D4NF10 @F1;500 @hDD3CD4NF10 FHAD1C/DC2 3F1;500/NUL500@F1;500 @h/NUL3/DC3 H2C/DC2 500@F1;500 @h/NUL2F1;500C2/DC3 H3 (11.45) 1;500/DC4hkm FHADD1CD2NF10CD3hCD4hNF10 (11.46) where the coefﬁcients are given by D1D2:2/STX10/NUL1,D2D/NUL2:0/STX10/NUL3 D3D1:15/STX10/NUL3,D4D/NUL2:11/STX10/NUL6 Once the high altitude correction factor, and corrected density have been determined, the ﬁnal atmospheric density is given by /SUBDFHA/SUBcorr (11.47) 11.3 Sun Position, Radiation Pressure, and Eclipse Conditions In order determine solar radiation pressure forces or torques acting on a spacecraft or to process Sun sensor data, we must ﬁrst determine where the Sun is relative to the spacecraft and whether the spacecraft is shadowed by the Earth or the Moon. The position of the Sun with respect to the Earth can be determined as follows [ 17]. First, the mean longitude, /RSˇ, and mean anomaly of the Sun, Mˇ, are determined in degrees as /RSˇD280:460ıC36;000:771T UT1 (11.48a) MˇD357:5277233ıC35999:05034T UT1 (11.48b) where TUT1DJD.Y;M;D;h;m;s/ /NUL2;451;545 36;525(11.49)11.3 Sun Position, Radiation Pressure, and Eclipse Conditions 421 withJDcomputed as in Sect. 2.6.3 .B o t h/RSˇandMˇare reduced to the range 0ı to360ıand the longitude of the ecliptic is determined in degrees as /RSeclipticD/RSˇC1:914666471ısin.Mˇ/C0:019994643 sin.2M ˇ/ (11.50) The obliquity of the ecliptic is given by "D23:439291ı/NUL0:0130042T UT1 (11.51) The unit vector in the direction from the Earth to the Sun is then e˚ˇD2 4cos./RSecliptic/ cos."/sin./RSecliptic/ sin."/sin./RSecliptic/3 5 (11.52) We omit subscripts to indicate the coordinate frame because all vectors in this section are expressed in the GCI frame. The distance, in AU, between the Earth and the Sun can be found by r˚ˇD1:000140612/NUL0:016708617 cos.Mˇ//NUL0:000139589 cos.2M ˇ/(11.53) and the position vector from the Earth to the Sun is r˚ˇDr˚ˇe˚ˇ.A f t e r converting the spacecraft position vector rto AU, the position vector from the spacecraft to the Sun, expressed in the GCI frame is given rsatˇDr˚ˇ/NULr (11.54) The distance rsatˇ, between the spacecraft and Sun (in AU) and the unit vector esatˇ are then given by rsatˇDkrsatˇk (11.55a) esatˇDrsatˇ rsatˇ(11.55b) The pressure of solar radiation at the position of the spacecraft is then PˇDFˇ cr2 satˇ(11.56) where Fˇ, known as the solar constant , is the ﬂux density of solar radiation at a distance of 1 AU from the Sun, and cD299;792;458 m/s is the speed of light. The solar constant varies over the 11-year solar cycle from 1,361 W/m2at solar minimum to 1,363 W/m2at solar maximum and is subject to rapid ﬂuctuations as large as 5 W/m2at times of high or low solar activity.3These ﬂuctuations are very difﬁcult to predict, although daily data does exist [ 5]. 3These recent measurements [ 11] are about 5 W/m2lower than previous measurements [ 5].422 11 Environment Models Given the position vector of the spacecraft and the position vector of the Sun, it can now be determined whether or not the spacecraft is in the shadow of the Earth. There are two main approaches to shadowing. The ﬁrst assumes that theshadow created by the Earth is a cylindrical projection of the Earth’s diameter along the direction of the Sun to the Earth. In the cylindrical approximation, which is generally adequate for spacecraft in lower altitude orbits, the spacecraft is in theEarth’s shadow if and only if r/SOHe ˚ˇ</NULq r2/NULR2 ˚ (11.57) where ris the spacecraft position vector and R˚is the equatorial radius of the Earth, which is approximated as a sphere. For a spacecraft in a geosynchronous orbit withradius 42,164 km, Eq. ( 11.57 ) gives an eclipse time of 69.6 min for the longest eclipse, which occurs at the equinoxes when the Sun is in the orbital plane of the spacecraft. The second shadowing approach accounts for the ﬁnite diameters of both the Sun and the Earth. This more accurate approach has a conical shadow model with partial shadowing in a region called the penumbra. The more complex eclipse conditionsfor the conical shadow model, including illumination levels in the penumbra, can be found in Wertz [ 19]. His equations show that a spacecraft in a geostationary orbit spends 67.5 min in total shadow and 4.3 min in the penumbra during its longesteclipse. 11.4 Orbital Ephemerides of the Sun, Moon, and Planets The best source for accurate orbital ephemerides of the Sun, Moon, and planets is DE405/LE405 computed by the Jet Propulsion Laboratory (JPL) of the California Institute of Technology [ 16]. These ephemerides are obtained by precise numerical integration of the equations of motion of the bodies. This computation has four main ingredients: formulating the equations of motion, determining the initial conditions, performing the integrations, and making the results available in a useful form. It isbelieved that the difﬁculty of accurately determining the initial conditions is the limiting factor in the accuracy of the solutions. The equations of motion are described in detail in [ 16]. They include “(a) point- mass interactions among the Moon, planets, and Sun; (b) general relativity (isotropic, parameterized post-Newtonian); (c) Newtonian perturbations of selected asteroids; (d) action upon the ﬁgure of the Earth from the Moon and Sun; (e) actionupon the ﬁgure of the Moon from the Earth and Sun; (f) physical libration of the Moon, modeled as a solid body with tidal and rotational distortion, including both elastic and dissipational effects; (g) the effect upon the Moon’s motion caused bythe tides raised upon the Earth by the Moon and Sun; and (h) the perturbations of 300 asteroids upon the motions of Mars, the Earth, and the Moon.” The referenceReferences 423 frame for the ephemerides is the International Celestial Reference Frame [ 14]. The initial conditions are determined by ﬁtting data from optical observations, meridian transits, photographic and CCD astrometry, occultation timings, astrolabeobservations, radiometric emission measurements, ranging data, VLBI data, and lunar laser range data. The planetary ephemerides are saved as ﬁles of Chebyshev polynomials for the Cartesian positions and velocities of the Sun, Moon, and planets, typically at 32-day intervals. They can be obtained from JPL’s interactive “Horizons” website at http:// ssd.jpl.nasa.gov/?horizons . The positional accuracy of the inner planet ephemerides is believed to be a few thousandths of an arcsecond, and a few hundredths of an arcsecond for the outer planets. Reference [ 16] also provides Keplerian elements for applications that do not require the full accuracy of an integrated ephemeris. References Amelina, T., Batyr, G., Dicky, V ., Tumolskaya, N., Yurasov, V .S.: Comparison of atmospheric density models. In: 2ndU. S. - Russian Space Surveillance Workshop. Poznan, Poland (1996) Bowman, B.R., Tobiska, W., Marcos, F.A., Huang, C.Y ., Lin, C.S., Burke, W.J.: A new empirical thermospheric density model JB2008 using new solar and geomagnetic indices. In:AIAA/AAS Astrodynamics Specialist Conference. Honolulu (2008) Bowman, B.R., Tobiska, W., Marcos, F.A., Valladares, C.: The JB2006 empirical thermo- spheric density model. J. Atmos. Sol. Terr. Phys. 70(5), 774–793 (2008) Finlay, C.C., Maus, S., Beggan, C.D., Bondar, T.N., Chambodut, A., Chernova, T.A., Chulliat, A., Golovkov, V .P., Hamilton, B., Hamoudi, M., Holme, R., Hulot, G., Kuang, W., Langlais, B.,Lesur, V ., Lowes, F.J., Lühr, H., Macmillan, S., Mandea, M., McLean, S., Manoj, C., Menvielle,M., Michaelis, I., Olsen, N., Rauberg, J., Rother, M., Sabaka, T.J., Tangborn, A., Tøffner-Clausen, L., Thébault, E., Thomson, A.W.P., Wardinski, I., Wei, Z., Zvereva, T.I.: InternationalGeomagnetic Reference Field: the eleventh generation. Geophys. J. Int. 183, 1216–1230 (2010) Fröhlich, C., Lean, J.: Total solar irradiance (TSI) composite database (1978-present). http:// www.ngdc.noaa.gov/stp/solar/solarirrad.html#composite (Accessed Sept. 20, 2013) Harris, I., Priester, W.: Time-dependent structure of the upper atmosphere. J. Atmos. Sci. 19, 286–301 (1962) Jacchia, L.G.: New static models of the thermosphere and exosphere with empirical tempera- ture proﬁles. Tech. Rep. SAO Special Report No. 313, Smithsonian Astrophysical Observatory,Cambridge. Smithsonian Institution Astrophysical Observatory (1970) Jacchia, L.G.: Revised static models of the thermosphere and exosphere with empirical temperature proﬁles. SAO special report no. 332, Smithsonian Astrophysical Observatory,Cambridge. Smithsonian Institution Astrophysical Observatory (1971) Jacchia, L.G.: Thermospheric temperature, density, and composition: New models. SAO special report no. 375, Smithsonian Astrophysical Observatory, Cambridge. SmithsonianInstitution Astrophysical Observatory (1977) Jacchia, L.G., Slowey, J., Verniani, F.: Geomagnetic pertubations and upper-atmosphere heating”. J. Geophys. Res. 72(5), 1423–1434 (1966) Kopp, G., Lean, J.L.: A new, lower value of total solar irradiance: Evidence and climate signiﬁcance. Geophys. Res. Lett. 38(1), L01,706 (2011) Langel, R.A.: The main ﬁeld. In: Jacobs, J.A. (ed.) Geomagnetism, pp. 249–512. Academic Press, Orlando (1987)424 11 Environment Models Long, A.C., Cappellari Jr., J.O., Velez, C.E., Fuchs, A.J.: Goddard Trajectory Determination System (GTDS) mathematical theory (revision 1). FDD/522-89/001 and CSC/TR-89/6001,National Aeronautics and Space Administration/Goddard Space Flight Center, Greenbelt(1989) Ma, C., Arias, E.F., Eubanks, T.M., Frey, A.L., Gontier, A.M., Jacobs, C.S., Sovers, O.J., Archinal, B.A., Charlot, P.: The International Celestial Reference Frame as realized by verylong baseline interferometry. Astron. J. 116, 516–546 (1998) Roberts Jr., C.E.: An analytical model for upper atmosphere densities based upon Jacchia’s 1970 models. Celestial Mech. 314(4), 368–377 (1971) Standish, E.M., Williams, J.G.: Orbital ephemerides of the Sun, Moon, and planets. In: Urban, S.E., Seidelmann, P.K. (eds.) Explanatory Supplement to the Astronomical Almanac, 3rd edn.,chap. 8. University Science Books, Sausalito (2013) Vallado, D.A.: Fundamentals of Astrodynamics and Applications, 3rd edn. Microcosm Press, Hawthorne and Springer, New York (2007) Vallado, D.A., Finkleman, D.: A critical assessment of satellite drag and atmospheric density modelling. In: AIAA/AAS Astrodynamics Specialist Conference. Honolulu (2008) Wertz, J.R. (ed.): Spacecraft Attitude Determination and Control. Kluwer Academic, The Netherlands (1978) Winch, D.E., Ivers, D.J., Turner, J.P.R., Stening, R.J.: Geomagnetism and Schmidt quasi- normalization. Geophys. J. Int. 160, 487–504 (2005) Yurasov, V .S., Cefola, P.J.: Earth’s upper atmosphere density model for ballistic suport of the ﬂight of artiﬁcial Earth satellites. Tech. rep., National Standard of the Russian Federation (Gosstandart of Russia), Moscow, Russia (2004) Yurasov, V .S., Nazarenko, A.I., Cefola, P.J., Alfriend, K.T.: Density corrections for the NRLMSIS-00 atmospheric model. Adv. Astronaut. Sci. 120(2), 1079–1107 (2005)Chapter 12 Review of Control and Estimation Theory The purpose of this chapter is to provide a review of control and estimation theory. It is expected that the reader has some basic knowledge of dynamical systems andprobability theory. Several of the concepts shown in this chapter are used throughout the text. First a basic review of system modeling using differential equations is shown. This is followed by linear and nonlinear control theory. Then estimationconcepts, such as maximum likelihood and the Kalman ﬁlter, are reviewed. The reader is encouraged to read the several cited texts in this chapter for further information. 12.1 System Modeling In this section system modeling is reviewed. This subject is introduced by ﬁrstderiving the equations of motion for the classic inverted pendulum problem. Then, state and observation models for both nonlinear and linear systems are introduced. Finally, discrete-time systems are reviewed. 12.1.1 Inverted Pendulum Modeling The classic inverted pendulum mounted to a motorized cart is shown in Fig. 12.1a, wherexis the cart position, Mis the mass of the cart, mis the mass of the pendulum, `is the length to pendulum center of mass, JDm`2=3is the mass moment of inertia of the pendulum, modeling it as a uniform thin rod, /DC2is the pendulum angle from vertical, and uis the force applied to the cart. The associated free body diagram is shown in Fig. 12.1b, whereNandPare reaction forces along the horizontal F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8_ _12, © Springer Science+Business Media New York 2014425426 12 Review of Control and Estimation Theory ,m J M xu uFfmg P PNN xi1i2ab Fig. 12.1 Inverted pendulum ( a) and associated free body diagram ( b) and vertical directions, respectively, and Ffis the friction force which is given by FfDcPx, wherecis a constant. The axes i1andi2are inertially ﬁxed, which represent the horizontal and vertical directions, respectively. The locations of the centroid of the pendulum, along the i1andi2axes, denoted byxcandyc, respectively, are given by xcDxC`sin/DC2 (12.1a) ycD`cos/DC2 (12.1b) Taking two time derivatives of Eq. ( 12.1a )g i v e s RxcDRxC`R/DC2cos/DC2/NUL`P/DC22sin/DC2 (12.2) Therefore, summing the forces of the pendulum in the horizontal direction, i1,g i v e s NDmRxCm`R/DC2cos/DC2/NULm`P/DC22sin/DC2 (12.3) Summing the forces of the cart in the horizontal direction gives MRxCcPxCNDu (12.4) Substituting Eq. ( 12.3) into Eq. ( 12.4)g i v e s .MCm/RxCcPxCm`R/DC2cos/DC2/NULm`P/DC22sin/DC2Du (12.5) Taking two time derivatives of Eq. ( 12.1b )g i v e s RycD/NUL.`R/DC2sin/DC2C`P/DC22cos/DC2/ (12.6)12.1 System Modeling 427 Summing the forces of the pendulum in the vertical direction, i2,g i v e s PDmg/NULm`R/DC2sin/DC2/NULm`P/DC22cos/DC2 (12.7) For the pendulum, summing the moments around its center of gravity gives the following rotational dynamic equations: JR/DC2D.m`2=3/R/DC2DP`sin/DC2/NULN`cos/DC2 (12.8) Substituting Eqs. ( 12.3) and ( 12.7) into Eq. ( 12.8), and simplifying yields .4`=3/R/DC2Dgsin/DC2/NULRxcos/DC2 (12.9) Equations ( 12.5) and ( 12.9) provide the governing equations of motion. We now linearize the governing equations about the vertical point, where /DC2D0. The ﬁrst-order approximations are given by cos /DC2/EM1,s i n/DC2/EM/DC2, andP/DC22/EM0. Then the linearized governing equations become .4`=3/R/DC2Dg/DC2/NULRx (12.10a) .MCm/RxCcPxCm`R/DC2Du (12.10b) Solving Eq. ( 12.10a )f o rR/DC2and substituting the resultant into Eq. ( 12.10b ) leads to RxD/NULc M0Px/NUL3mg 4M0/DC2C1 M0u (12.11) where M0/DC1MCm=4 (12.12) Substituting Eq. ( 12.11 ) into Eq. ( 12.10a ) then leads to R/DC2D3.MCm/g 4M0`/DC2C3c 4M0`Px/NUL3 4M0`u (12.13) We now deﬁne the following state vector : xD/STX x/DC2PxP/DC2/ETXT(12.14)428 12 Review of Control and Estimation Theory Taking the time derivative of Eq. ( 12.14 ), and using Eqs. ( 12.11 ) and ( 12.13 )g i v e s PxD2 66666400 1 0 00 0 1 0/NUL3mg 4M0/NULc M00 03.MCm/g 4M0`3c 4M0`03 777775xC2 6666640 0 1 M0 /NUL3 4M0`3 777775u (12.15a) yD/DC41000 0100/NAK xC/DC40 0/NAK u (12.15b) where the outputs, given in the vector y, are assumed to be xand/DC2. 12.1.2 State and Observation Models Modeling is an important aspect for the analysis of system behavior and for the design of control and estimation algorithms. A model may either be static ordynamic. A static model’s output at any given time only depends on the input at that time [ 19]. A dynamic model’s present output depends on past inputs. Dynamic models frequently use differential or difference equations to describe physicalsystems. Both static and dynamic models can either be derived using a theoretical analysis or be identiﬁed using experimental data. Theoretical models help to provide a user with insight to any aspect which is modeled, but may not accurately representthe actual physical process. The major advantage of theoretical models is that the actual system need not be implemented to develop a model. Identiﬁed models usually describe actual physical processes more accurately, but may not provideall the information to describe all the desired aspects of the system. Choosing between a theoretical model or an identiﬁed model depends on a number of factors; including, the availability of obtaining experimental data, the desired accuracy ofthe model, the complexity of the physical system, etc. 12.1.2.1 State Models An important quantity for modern modeling design and analysis is the state vector, such as the one given by Eq. ( 12.14 ). The components of a state vector are known as state variables. These variables describe a system’s condition, and are directly related to the dissipation and storage of energy. The number of state variablesis known as the order of the system, which describes how many energy storing elements are present in the system. The consequence of the order leads directly to the number of ﬁrst-order differential or difference equations in the model.12.1 System Modeling 429 Annth-order system can be written using nﬁrst-order equations (known as state equations), which are mathematically described in differential form by Px.t/Df.x.t/;u.t/;t/; x.t0/Dx0 (12.16) where fis ann/STX1vector that is sufﬁciently differentiable, xis ann/STX1state vector, anduis aq/STX1vector that denotes an exogenous input representing any input to the system that does not depend on the state elements. An autonomous system is one that does not depend on time explicitly, so that Px.t/Df.t/.x.t/;u.t//. Equation ( 12.16 ) describes the general structure of a dynamic model. A subset of this general structure is a class of systems known as linear systems. A linear system follows the superposition principle [ 3], which states that a linear combination of inputs produces an output that is a linear combination of the outputs that would be produced if each input was applied separately [ 19]. Mathematically, this principle is described by yDf.z/Df.˛1z1C˛2z2/D˛1f.z1/C˛2f.z2/ (12.17) where˛1and˛2are arbitrary constants, and z1andz2are arbitrary inputs. It is easy to show that the following system is linear: Px.t/DF.t/ x.t/CB.t/ u.t/; x.t0/Dx0 (12.18) where then/STXnmatrixFand then/STXqmatrixBare known as the state matrix and input matrix, respectively. Equation ( 12.15a )s h o w st h eFandBmatrices for the inverted pendulum system. The solution to Eq. ( 12.18 ) is given by x.t/D˚.t;t0/x0CZt t0˚.t;/FS/B./FS/ u./FS/d/FS (12.19) where˚.t;t0/is known as the state transition matrix , which has the following properties: ˚.t0;t0/DI (12.20a) ˚.t0;t/D˚/NUL1.t;t0/ (12.20b) ˚.t2;t0/D˚.t2;t1/˚.t1;t0/ (12.20c) P˚.t;t0/DF.t/˚.t;t 0/ (12.20d) Note that Eq. ( 12.20a )g i v e s x.t0/Dx0, which satisﬁes the initial condition given in Eq. ( 12.18 ). Differentiating Eq. ( 12.19 ) and using the properties in Eq. ( 12.20 ) shows that it is indeed the solution for Eq. ( 12.18 ):430 12 Review of Control and Estimation Theory Px.t/DP˚.t;t0/x0C˚.t;t/B.t/ u.t/CF.t/Zt t0˚.t;/FS/B./FS/ u./FS/d/FS DF.t//DC4 ˚.t;t0/x0CZt t0˚.t;/FS/B./FS/ u./FS/d/FS/NAK CB.t/ u.t/ DF.t/ x.t/CB.t/ u.t/ (12.21) Note that since x.t/is the linear sum of a part due to the initial condition and a part due to the forcing input, it must follow the superposition principle. Consider a simple single-input-single-output (SISO) nth-order linear and autonomous ordinary differential equation (ODE), given by dny dtnCan/NUL1dn/NUL1y dtn/NUL1C/SOH/SOH/SOHCa1dy dtCa0yDu (12.22) whereyis the output variable and uis the input variable. In order to convert the ODE into ﬁrst-order form, consider the following variable change: x1Dy x2Ddy dt ::: xnDdn/NUL1y dtn/NUL1(12.23) This leads to the following equivalent system of nﬁrst-order equations: Px1Dx2 Px2Dx3 ::: PxnD/NULa0x1/NULa1x2/NUL/SOH/SOH/SOH/NULan/NUL1xnCu(12.24) which can be represented in matrix form by PxDFxCBu (12.25) where the vector xcontains the state variables xD/STX x1x2/SOH/SOH/SOHxn/ETXT(12.26)12.1 System Modeling 431 and the matrices FandBare given by FD2 666664010/SOH/SOH/SOH0 001/SOH/SOH/SOH0 ::::::::::::::: 000/SOH/SOH/SOH1 /NULa 0/NULa1/NULa2/SOH/SOH/SOH/NULan/NUL13 777775(12.27a) BD/STX 00/SOH/SOH/SOH1/ETX T(12.27b) If the linear system is autonomous, then the solution given by Eq. ( 12.19 ) simpli- ﬁes to xDeF.t/NULt0/x0CZt t0eF.t/NUL/FS/Bu./FS/d/FS (12.28) whereeF.t/NULt0/is the matrix exponential. A linear model can also be used to describe an autonomous nonlinear model. This is accomplished by performing a linearization about an equilibrium state vector and input, so that 0Df.xe;ue/ (12.29) where xeanduedenote the known equilibrium quantities. Next, a multivariable Taylor series expansion about and xeandueis performed, keeping only the ﬁrst- order terms, so that Px/EMf.xe;ue/C@f @xˇˇˇˇ xe.x/NULxe/C@f @uˇˇˇˇ ue.u/NULue/ (12.30) Now, the following linearized state and input vectors are deﬁned as /SOHxDx/NULxe (12.31a) /SOHuDu/NULue (12.31b) Therefore, a linearized model of an autonomous nonlinear system is given by /SOHPxDF/SOHxCB/SOHu (12.32) where F/DC1@f @xˇˇˇˇ xe(12.33a) B/DC1@f @uˇˇˇˇ ue(12.33b)432 12 Review of Control and Estimation Theory This model can now be used to describe and analyze the characteristics of the nonlinear system using linear tools, such as superposition, linear stability, etc. Choosing state variables usually depends on the complexity of the system. A complex system such as a spacecraft potentially has an extremely large number of state variables, such as orbital elements, kinematic elements, rotational dynamic elements, ﬂexible dynamic elements, thermal effects, disturbance model elements,etc. Often, state variables do not themselves represent physical quantities, but are needed to form a relationship to physical quantities. Implementing all state variables into a full model can be a formidable task. Ideally, one chooses theleast number of state variables to represent the characteristics of sought physical quantities. For example, for attitude estimation using rate-integrating gyros the state vector may only contain the attitude elements and gyro biases. Other effects,such as ﬂexible dynamic effects, may often be neglected in the attitude estimation, or may not be required for on-orbit implementation. It is important to note that although this simple example describes the least number of state variables forattitude estimation, other state variables in other models may have already been used before or concurrently with the attitude estimator. For example, orbital element states may be required in the attitude estimator whenever the sensor supplying thedata produces an observation which depends on spacecraft position in the orbit. An example of this scenario is a magnetometer-based attitude estimator, which requires knowledge of the orbital position state vector in order to develop thereference magnetic ﬁeld vector. Therefore, other state variables can indirectly affect the state quantities used in the primary model. 12.1.2.2 Observation Models State vectors are used to model the dynamic motion of a particular system. Observation vectors are used to show how a sensor relates to various state quantities. Observations are developed from sensor output quantities. The numberof elements in an observation vector is usually determined by both the number of available sensors and the number of individual sensor quantities (e.g. a three-axis magnetometer provides observations of three quantities). The general form of anobservation vector is given by y.t/Dh.x.t/;u.t/;t/ (12.34) where his ap/STX1observation vector. This vector shows how each sensor is related to input and state quantities. The dimension of the observation vector ( p) may be smaller or larger than the dimension of the state vector ( n). As seen from Eq. ( 12.34 ), the observation vector may also be a function of the input u(it must always be a function of the state vector). Linear observation models follow the same structure as linear state models. The standard form for the linear observation model is given by y.t/DH.t/ x.t/CD.t/ u.t/ (12.35)12.1 System Modeling 433 whereHis thep/STXnobservation matrix (also referred to as the output or sensitivity matrix) andDis thep/STXqdirect transmission matrix. Equation ( 12.15b )s h o w st h e HandDmatrices for the inverted pendulum system. The general SISO nth-order linear and autonomous ODE is given by dny dtnCan/NUL1dn/NUL1y dtn/NUL1C/SOH/SOH/SOHCa1dy dtCa0y Dbndnu dtnCbn/NUL1dn/NUL1u dtn/NUL1C/SOH/SOH/SOHCb1du dtCb0u (12.36) In order to convert the ODE into ﬁrst-order form we ﬁrst rewrite Eq. ( 12.36 )i n t oa n equivalent form involving two ODEs, given by yDbndnx dtnCbn/NUL1dn/NUL1x dtn/NUL1C/SOH/SOH/SOHCb1dx dtCb0x (12.37a) uDdnx dtnCan/NUL1dn/NUL1x dtn/NUL1C/SOH/SOH/SOHCa1dx dtCa0x (12.37b) wherexis an intermediate variable. Now, consider the following variable change: x1Dx x2Ddx dt ::: xnDdn/NUL1x dtn/NUL1(12.38) This leads to the following equivalent system of nﬁrst-order equations, given in matrix form by PxDFxCBu (12.39a) yDHxCDu (12.39b) where the matrices FandBare given by Eq. ( 12.27 ), andHandDare given by HD/STX .b0/NULbna0/.b1/NULbna1//SOH/SOH/SOH.bn/NUL1/NULbnan/NUL1//ETX (12.40a) DDbn (12.40b) Clearly, ifb0D1and the remaining coefﬁcients biD0; iD1;2;:::;n , then the intermediate variable xDy, which reduces the general case in Eq. ( 12.36 )t ot h e simple case in Eq. ( 12.22 ).434 12 Review of Control and Estimation Theory Thetransfer function for autonomous linear systems can be found by by taking the Laplace transform [ 12] of both sides of Eqs. ( 12.18 ) and ( 12.35 ) with zero initial conditions: sX.s/DFX.s/CBU.s/ (12.41a) Y.s/DHX.s/CDU.s/ (12.41b) wheresis the Laplace variable. Solving for X.s/in Eq. ( 12.41a ) and substituting the resulting expression into Eq. ( 12.41b ) yields Y.s/Dh H.sI/NULF//NUL1BCDi U.s/ (12.42) Since the inverse of .sI/NULF/is given by its adjoint divided by its determinant, then the determinant of .sI/NULF/gives the poles of the transfer function. Also, the eigenvalues of Fare equivalent to the roots of the denominator of the transfer function. All of the eigenvalues must lie left of the imaginary axis, i.e. in the left- hand plane , for a stable response. Even if one eigenvalue lies to the right of the imaginary axis then the system is unstable. Linearized observation models can also be developed, similar in fashion to the linearized state equations. This is accomplished by H/DC1@h @xˇˇˇˇ xe(12.43a) D/DC1@h @uˇˇˇˇ ue(12.43b) which are again evaluated at the equilibrium conditions. 12.1.3 Discrete-Time Systems All of the concepts shown previously extend to discrete-time systems. Discrete- time systems have now become standard in most dynamic applications with theadvent of digital computers, which are used to process sampled-data systems for estimation and control purposes. The mechanism that acts on the sensor output and supplies numbers to the digital computer is the analog-to-digital (A/D) converter.Then, the numbers are processed through numerical subroutines and sent to the dynamic system input through the digital-to-analog (D/A) converter. This allows the use of software driven systems to accommodate the estimation/control aspect ofa dynamic system, which can be modiﬁed simply by uploading new subroutines to the computer.12.1 System Modeling 435 02 135 6 4y continuoussampled TimetFig. 12.2 Continuous signal and sampled zero-order hold We shall only consider the most common sampled-type system given by a “zero- order hold” which holds the sampled point to a constant value throughout the interval. Figure 12.2 shows a sampled signal using a zero-order hold. Obviously, as the sample interval decreases the sampled signal more closely approximates the continuous signal. Consider the case where time is set to the ﬁrst sample interval, denoted by /SOHt, andFandBare constants in Eq. ( 12.18 ). Then, Eq. ( 12.28 ) reduces to x./SOHt/DeF/SOHtx.0/C/DC4Z/SOHt 0eF./SOHt /NUL/FS/d/FS/NAK Bu.0/ (12.44) The integral can be simpliﬁed by deﬁning /DLED/SOHt/NUL/FS, which leads to Z/SOHt 0eF./SOHt /NUL/FS/d/FSD/NULZ0 /SOHteF/DLEd/DLEDZ/SOHt 0eF/DLEd/DLE (12.45) Therefore, Eq. ( 12.44 ) becomes x./SOHt/D˚x.0/C/NULu.0/ (12.46) where ˚/DC1eF/SOHt(12.47a) /NUL/DC1/DC4Z/SOHt 0eFtdt/NAK B (12.47b) Expanding Eq. ( 12.46 )f o rkC1samples gives xŒ.kC1//SOHt/c141D˚x.k/SOHt/C/NULu.k/SOHt/ (12.48)436 12 Review of Control and Estimation Theory It is common convention to change the notation of Eq. ( 12.48 ) so that the entire discrete state-space representation is given by xkC1D˚xkC/NULuk (12.49a) ykDHxkCDuk (12.49b) Notice that the output system matrices HandDare unaffected by the conversion to a discrete-time system. The system can be shown to be stable if all eigenvalues of˚lie within the unit circle [ 7]. Example 12.1. In this example we will perform a conversion from the continuous- time domain to the discrete-time domain for a second-order system, given by FD/DC4/NUL10 10/NAK ;BD/DC41 0/NAK To compute˚we will enlist the help of Laplace transforms, with ˚DeF/SOHtD˚ L/NUL1ŒsI/NULF/c141/NUL1/TABˇˇ /SOHtD8 ˆˆˆ< ˆˆˆ:L/NUL12 66641 sC10 1 s.sC1/1 s3 77759 >>>= >>>;ˇˇˇˇˇˇˇˇˇ /SOHt D/DC4e/NUL/SOHt0 1/NULe/NUL/SOHt1/NAK where L/NUL1denotes the inverse Laplace transform. The matrix /NULis computed using Eq. (12.47b ): /NULDZ/SOHt 0/DC4e/NULt 1/NULe/NULt/NAK dtD/DC41/NULe/NUL/SOHt /SOHtCe/NUL/SOHt/NUL1/NAK If the sampling interval is chosen to be /SOHtD0:1s, then˚and/NULbecome ˚D/DC40:90480 0:09521/NAK ;/NULD/DC40:0952 0:0048/NAK Determining analytical expressions for ˚and/NULcan be tedious and difﬁcult for large-order systems. Fortunately, several numerical approaches exist for computing these matrices [ 18]. A computationally efﬁcient and accurate approach involves a series expansion: ˚DICF/SOHtC1 2ŠF2/SOHt2C1 3ŠF3/SOHt3C/SOH/SOH/SOH (12.50)12.2 Control Theory 437 and the matrix /NULis obtained from integration of Eq. ( 12.50 ): /NULD/DC4 I/SOHtC1 2ŠF/SOHt2C1 3ŠF2/SOHt3C/SOH/SOH/SOH/NAK B (12.51) Adequate results can be obtained in most cases using only a few of the terms in the series expansion. For the matrices in Example 12.1, using three terms in the series expansion yields ˚D/DC40:90480 0:09521/NAK ;/NULD/DC40:0952 0:0048/NAK (12.52) The series results for ˚and/NULare accurate to within four signiﬁcant digits. Results vary with sampling interval. As a general rule of thumb, if the sampling interval is below Nyquist’s upper limit, then three to four terms in the series expansion gives accurate results [ 20]. 12.2 Control Theory In this section control theory is reviewed. First, the fundamentals of basic linear control are introduced. A single axis attitude control system design is shown next to highlight the various aspects of linear control. Then, stability of nonlinear systems is discussed. Finally, a popular nonlinear controller law, called sliding-mode control,is reviewed. 12.2.1 Basic Linear Control Design A fundamental block diagram of a SISO negative feedback control system is shownin Fig. 12.3, whereR.s/ is the reference, Y.s/ is the output signal, D.s/ is the disturbance,U.s/ is the control input, G p.s/is the plant to be controlled, Gc.s/ is the controller, and H.s/ is the sensor dynamics. The disturbance is added to the control input because for spacecraft the disturbance is an external torque that “turns” it just as a control input does. This is similar to a current-controlled motor system [ 5]. Assuming the disturbance is zero, the transfer function between the output and reference is given by Y.s/ R.s/DGc.s/Gp.s/ 1CGc.s/Gp.s/H.s/(12.53) The denominator of Eq. ( 12.53 ) is known as the characteristic equation whose roots deﬁne the type of response. All roots of the associated polynomial must be to the438 12 Review of Control and Estimation Theory Fig. 12.3 Control block diagram left of the imaginary axis to insure that the closed-loop system is asymptotically stable. Clearly, the poles of the open-loop system, Gc.s/Gp.s/H.s/ , can now be manipulated by the controller, Gc.s/, to either stabilize an unstable plant or obtain some desired characteristics in the closed-loop system. The sensor dynamics can also affect the closed-loop response, although for most cases this is not a destabilizing issue. Assuming the reference is zero, the transfer function betweenthe output and disturbance is given by Y.s/ D.s/DGp.s/ 1CGc.s/Gp.s/H.s/(12.54) Note that the denominators of Eqs. ( 12.53 ) and ( 12.54 ) are equivalent, which means that the stability dynamics are the same for the reference and disturbance closed-loop responses. The numerators are different which means that the actual output responses to a reference input and a disturbance input are different. The total response is given by the sum of the two transfer functions. 12.2.1.1 Single Axis Attitude Control In this section a simple single axis attitude control system is designed. For this case Euler’s rotational equations of motion reduce down to simply JR/DC2Du (12.55) whereJis the inertia, /DC2is the angle, and uis the applied torque. The open-loop transfer function is given by /STX.s/ U.s/D1 Js2(12.56)12.2 Control Theory 439 Clearly this system is unstable since it has a double pole at the origin. Several different types of controllers can be designed to stabilize this system. Here we focus on a “proportional-integral-derivative” (PID) controller. We ﬁrst will attempt asimple proportional controller, where the error signal, E.s/ , is multiplied simply by a scalar gain, k p. Assuming that H.s/D1the closed-loop dynamics in Eq. ( 12.53 ) are given by Y.s/ U.s/Dkp Js2Ckp(12.57) Clearly, using only proportional control results in a closed-loop system that yields a sinusoidal response and thus the response is not asymptotically stable. We now will attempt a PD controller, with Gc.s/DkpCkds, wherekdis the scalar gain associated with the derivative portion of the controller. The closed-loop system now becomes Y.s/ U.s/DkpCkds Js2CkdsCkp(12.58) Now the closed-loop dynamics can be made stable. The characteristic equation can be written in the familiar form of s2C2/DLE!nsC!2 n, where/DLEis the damping ratio and!nis the natural frequency , which is the frequency of the sinusoidal response for the undamped response. From Eq. ( 12.58 )w eh a v e!nDp kp=Jand/DLED kd=.2p Jkp/. Four types of responses can be given for various values of /DLE: /DLE<0 . This results in an unstable system. /DLED0. This is the undamped response which yields a pure sinusoidal closed- loop response with frequency given by !n. The undamped response is given by y.t/DAsin.!nt/CBcos.!nt/, whereAandBare constants determined from the initial conditions. 0</DLE<1 . This results in exponentially decaying sinusoidal, known as the under-damped response, with frequency !dD!np 1/NUL/DLE2, called the damped natural frequency . The response is given by y.t/De/NUL/DLE!ntŒAsin.!dt/C Bcos.!dt//c141, whereAandBare constants determined from the initial condi- tions. Figure 12.4 gives plots for various values of /DLE. Clearly, the oscillations damp out faster as /DLEincreases. /DLED1. This gives a critically damped response that converges as fast as possible without oscillating. The roots of the characteristic equation are repeated for this case withs1;2D/NUL!n. The response is given by y.t/D.ACBt/e/NUL/DLE!nt, where AandBare constants determined from the initial conditions. Note that the term tgrows with time, but the overall system is still stable because the exponential “decays” the response faster than the t“grows” the response. /DLE>1 . This gives an over-damped response since all the roots, denoted by s1and s2, are real and negative. The response is given by y.t/DAes1tCBes2t, where AandBare constants determined from the initial conditions.440 12 Review of Control and Estimation Theory 0 1 2 3 4 5 6 7 8 9 10−0.8−0.6−0.4−0.200.20.40.60.81 ζ = 0.1 ζ = 0.7 ζ = 0.9 Time (Sec)y(t) Fig. 12.4 Response for various damping ratio values The single-axis PD control design explains a fundamental concept for basic spacecraft design. That is, spacecraft attitude control must incorporate derivative feedback in order to achieve an asymptotically stable response. This derivative information is achieved either through gyros or by taking a ﬁnite difference of the attitude. For the latter case, Eq. ( 3.174 ) can be used to determine the angular velocity. However, it is important to note that employing a ﬁnite difference ampliﬁes noise since higher frequencies are ampliﬁed. This is clearly seen by the fact that a magnitude plot of sshows a 20 decibel per decade increase. Typically, a low-pass ﬁlter is employed to ﬁlter the noise. This approach works well when loose attitude and jitter requirements are given. Some researchers imply that spacecraft can be controlled without angular velocity measurements [ 14]. However, a derivative is always given in these works, which must be derived from a ﬁnite difference approach in practice. For tight pointing and/or jitter requirements the ﬁnite difference approach will typically not meet the requirements and high qualitygyros must be employed. From Eq. ( 12.58 ) it can be seen that a unit step input will result in a unit response ast!1 . Thus zero steady-state error is achieved which results in perfect tracking. The closed-loop disturbance response is given by Y.s/ D.s/D1 Js2CkdsCkp(12.59) From the ﬁnal value theorem [5] the steady-state response for a unit disturbance input is given by 1=kp. Ideally we want the steady-state disturbance response to12.2 Control Theory 441 −1.4 −1.2 −1 −0.8 −0.6 −0.4 −0.2 0 0.2−1.5−1−0.500.511.5Imaginary Real Fig. 12.5 Pole locations for increase ki be zero. We employ a full PID controller with Gc.s/DkpCkdsCki=s, where kiis the integral gain, to make this happen. The closed-loop disturbance response is now given by Y.s/ D.s/Ds Js3Ckds2CkpsCki(12.60) From the ﬁnal value theorem the disturbance response at steady-state is now zero. However, one needs to be careful. From Eq. ( 12.59 ) a stable response is given when the PD gains are positive. However, the addition of integral control can actually destabilize the system. We show this by example. We set JDkpDkdD1 and varykifrom0to2. A plot of the root locations, also known as a root locus plot, for varying kiis shown in Fig. 12.5. WhenkiD0the roots are given by 0and/NUL1=2˙p 3=2j .A skiincreases the two complex poles move towards the imaginary axis and cross it when ki>1. While the0pole moves further down the left-hand plane’s real axis, any integral gain that is greater than 1causes the closed- loop system to become unstable. This is a typical characteristic of integral control and the reason why care must be taken when it is employed in a control design.442 12 Review of Control and Estimation Theory 12.2.2 Stability of Nonlinear Dynamic Systems We now consider the circumstance in which the original system of differential equations is nonlinear and can be brought to the standard form PxDf.x/ (12.61) Some of the nonlinear systems of differential equations encountered in applications can be solved for an exact analytical solution. Unfortunately, only a minority ofthese systems have known analytical solutions and no standardized methods exist for ﬁnding exact analytical solutions. Stability for nonlinear systems is much more difﬁcult to prove. Fortunately, Lyapunov methods can be applied to show stability for both nonlinear and linear systems. Two methods for stability were introduced by Lyapunov. The ﬁrst is given by Lyapunov’s linearization method. Before proceeding with this method we mustﬁrst deﬁne an equilibrium point, denoted by x e. An equilibrium is deﬁned as a point where the system states remain indeﬁnitely, so that Px.t/D0for allt. For linear systems there is usually only one equilibrium point given at xeD0, although there are exceptions. In Lyapunov’s linearization method each equilibrium point is considered and evaluated in a linearized model. The equilibrium point is said to be Lyapunov stable if we can select a bound on initial conditions thatresults in trajectories that remain with a chosen ﬁnite limit. Furthermore, the equilibrium point is asymptotically stable if the linearized state also approaches zero as time approaches inﬁnity. Denoting Fas the Jacobian of f.x/evaluated at the equilibrium point, Lyapunov’s linearization method gives the following stability conditions [ 25]:  The equilibrium point is asymptotically stable for the actual nonlinear system if the linearized system is strictly stable, with all eigenvalues of Fstrictly in the left-hand plane.  The equilibrium point is unstable for the actual nonlinear system if the linearized system is strictly unstable, with at least one eigenvalue strictly on the right-hand plane.  Nothing can be concluded if the linearized system is marginally stable, with at least one eigenvalue of Fon the imaginary axis and the remainder in the left- hand plane (the equilibrium point may be stable or unstable for the nonlinearsystem). Lyapunov’s linearization method provides a powerful approach to help qualify the stability of a system if a control (or estimation) scheme is designed to remain withina linear region, but does not give a thorough understanding of the nonlinear system in many cases. Lyapunov’s direct method gives a global stability condition for the general nonlinear system. This concept is closely related to the energy of a system, which is ascalar function. The scalar function must in general be continuous and have12.2 Control Theory 443 continuous derivatives with respect to all components of the state vector. Lyapunov showed that if the total energy of a system is dissipated, then the state is conﬁned to a volume bounded by a surface of constant energy, so that the system must eventuallysettle to an equilibrium point. This concept is valid for both linear and nonlinear systems. Lyapunov stability is given if a chosen scalar function V.x/satisﬁes the following conditions: V.x e/D0 V.x/>0 forx¤xe PV.x//DC40 If these conditions are met, then V.x/is a Lyapunov function . Furthermore, if PV.x/<0 forx¤xe, then the equilibrium point, xe, is asymptotically stable. For the case when the condition PV.x//DC40can only be shown, LaSalle’s theorem [28] allows us to prove asymptotic stability. We ﬁrst deﬁne an invariant set, as given in [25]: A setGis an invariant set for a dynamic system if every system trajectory which starts from a point Gremains inGfor all future time. Now assume that PV.x//DC40is true over the entire state space and that V.x/!1 askxk!1 .L e t Rbe the set of all points PV.x/D0andMbe the largest invariant set in R. LaSalle’s theorem states that all solutions globally asymptomatically converge to Mas time approaches inﬁnity. More details on Lyapunov methods for stability can be found in [25]. Example 12.2. Consider the following spring-mass-damper system with nonlinear spring and damper components: mRxCcPxjPxjCk1xCk2x3D0 wherem,c,k1, andk2have positive values. The system can be represented in ﬁrst- order form by deﬁning the following state vector xD/STX xPx/ETXT: Px1Dx2 Px2D/NUL.k1=m/x1/NUL.k2=m/x3 1/NUL.c=m/x2jx2j The system has only one equilibrium point at xD/STX 00/ETXTthat is physically correct (the others are complex). We wish to investigate the stability of this nonlinear system using Lyapunov’s direct method. Intuitively, we choose a candidate Lyapunov function that is given by the total mechanical energy of the system, which is thesum of its kinetic and potential energies: V.x/D1 2mPx2CZx 0.k1xCk2x3/dx Evaluating this integral yields V.x/D1 2mPx2C1 2k1x2C1 4k2x4444 12 Review of Control and Estimation Theory Note that zero energy corresponds to the equilibrium point ( xD0), which satisﬁes the ﬁrst condition for a valid Lyapunov function. Also, the second condition, V.x/> 0forx¤0, is clearly satisﬁed. Taking the time derivative of V.x/gives PV.x/DmRxPxC.k1xCk2x3/Px Solving the original system equation for mRx, and substituting the resulting expres- sion into the equation for PV.x/yields PV.x/D/NULcjPxj3 Clearly,PV.x//DC40for all nonzero values of Px. Therefore,V.x/is a Lyapunov function and shows that the system is stable. But PV.x/does not depend on x. To prove asymptotic stability we consider the set R, which consists of xsuch thatx2D0andx1is anything. Suppose x.t/is a trajectory starting in R. Then Px1Dx2D0, which implies that x1.t/is constant. But if this constant is not zero, thenPx2is not necessarily zero and so x2will become nonzero. Therefore, any initial point in Rmust leaveR. SinceRis not attracting, then LaSalle’s theorem implies the origin is asymptotically stable. This example shows how an “energy- like” function can be used to ﬁnd a Lyapunov function, since the energy of this system is dissipated by the damper until the mass settles down. Lyapunov’s global method can be shown to be valid for linear autonomous systems withPxDFx. Consider the function V.x/DxTPx, wherePis a positive deﬁnite symmetric matrix. Clearly, V.x/>0 for all x¤0. The time derivative of V.x/is given by PV.x/DPxTPxCxTPPxDxT.FTPCPF/ x (12.62) Next, deﬁne the following matrix Lyapunov equation: FTPCPFD/NULQ (12.63) IfQis strictly positive deﬁnite then the system is asymptotically stable. Lyapunov showed that this condition is true if and only if all eigenvalues of Fare strictly in the left-hand plane. See [ 4] for the proof. 12.2.3 Sliding-Mode Control1 In this section a popular control approach, called sliding-mode control , for nonlinear systems is brieﬂy reviewed. More details can be found in [ 25]. Sliding-mode control is also referred to as variable structure control because the structure of the 1The authors would like to thank Agamemnon L. Crassidis for many of the contributions in this section.12.2 Control Theory 445 −1.2 −1 −0.8 −0.6 −0.4 −0.2 0 0.2−0.0500.050.10.150.20.250.30.35 Sliding Phase Reaching Phase Δx˙Dx Fig. 12.6 Phase portrait control law varies, i.e. switches, based on the position of the state trajectory. Before introducing the actual sliding control approach the basic concepts of switching theory must ﬁrst be introduced. A candidate Lypaunov function is ﬁrst chosen so that the system’s state trajectories in the phase plane remain stable and point towardthe origin. The switching law forces the state trajectories onto a surface in the phase plane, which is called the sliding surface orswitching surface . The control law switches between two sets of control laws depending if the states are above or belowthe surface. Once the state trajectories reach the sliding surface, referred to as the reaching phase , the discontinuous controller forces the states to slide towards the origin, referred to as the sliding phase . A phase portrait showing these two phases for the system used in Example 12.3 is shown in Fig. 12.6. We begin our introduction to sliding-mode control by considering the following second-order system: RxDf.x;Px/Cu (12.64) wheref.x;Px/may be a linear or nonlinear function. Let x cbe the desired state and /SOHxDx/NULxc. The sliding surface, denoted by s, for a second-order system can be mathematically described by the following: sD/SOHPxC/NAK/SOHx (12.65) for some scalar /NAK. Consider the following candidate Lyapunov function: V./SOHx/D1 2s2(12.66)446 12 Review of Control and Estimation Theory The time derivative is given by PV./SOHx/DsPs (12.67) A control law can now be found based on Eq. ( 12.67 ) that ensures that the state trajectories will be asymptotically stable. In order for the state trajectories to remainon the surface, motion off the surface is prevented by setting PsD0, which is referred to as a sliding mode . This can be extended to higher-order systems by deﬁning the following tracker error vector [ 25]: /SOHxDx/NULx cD/STX /SOHx/SOHPx/SOH/SOH/SOH/SOHx.n/NUL1//ETXT(12.68) wherenis the order of the system. The sliding surface is given by sD/DC2d dtC/NAK/DC3 /SOHx (12.69) For example, when nD3we havesD/SOHRxC2/NAK/SOHPxC/NAK2/SOHPx. Sliding-mode control essentially reduces the order of the system to a ﬁrst-order system by a form of feedback linearization. Direct feedback linearization is attrac-tive for nonlinear systems since the nonlinear system dynamics are transformed into a system with linear dynamics. Typically, however, the dynamics of the system are not known exactly. This may lead to severe tracking errors when a directfeedback linearization control law is implemented on an actual system. In other words, robustness in the presence of parametric and un-modeled uncertainties cannot be ensured. Sliding-mode control solves the shortcomings and limitationsof direct feedback linearization by forcing the state trajectories to track desired state trajectories in the phase portrait. Stability is ensured by Lyapunov’s direct method and forms the basis for deriving the control law. As an example considerthe following assumed second-order system: RxDNf.x;Px/Cu (12.70) where the assumed model Nf.x;Px/will be used to develop the control law. Taking the derivative of sin Eq. ( 12.65 ) and substitutingRxDNf.x;Px/Cugives PsDRx/NULRx cC/NAK/SOHPx DNf.x;Px/Cu/NULRxcC/NAK/SOHPx (12.71) Using the condition PsD0from Eq. ( 12.67 ) leads to the following control law: ueD/NULNf.x;Px/CRxc/NUL/NAK/SOHPx (12.72)12.2 Control Theory 447 where ueis interpreted as the “best” estimate of the equivalent control [ 25]. In order to account for model uncertainties a discontinuous term is added across the sliding surface: uDue/NULksign.s/ (12.73) for some scalar k. Substituting this control law into Eq. ( 12.71 ) and then substituting the resultant into Eq. ( 12.67 ) yields PV./SOHx/D/STX f.x;Px//NULNf.x;Px//NULksign.s//ETX s D/STX f.x;Px//NULNf.x;Px//ETX s/NULkjsj (12.74) Let us assume that the model error on f.x;Px/can be bounded by some known functionF.x;Px/, so that jf.x;Px//NULNf.x;Px/j/DC4F.x;Px/ (12.75) Let the maximum value of F.x;Px/be denoted by Fmax. Then setting kDFmaxC/DC1 for some positive scalar /DC1givesPV./SOHx//DC4/NUL/DC1jsj. The resulting sliding-mode control law provides stability in the face of modeling uncertainties if kis chosen to be large enough, but it is important to note that as kincreases the control discontinuity also increases. The control switching law will cause the closed-loop system to “chatter” due to the discontinuous term, which is undesirable for most applications. The chattering can be eliminated by smoothing the control signal in a thin boundary layer. To accomplish this task the signumfunction is replaced with a saturation function with a varying boundary layer thickness. The applied sliding-mode control is now given by uDu e/NULksat.s;/SI/ (12.76) where/SIis the boundary layer thickness and sat.s;/SI//DC18 ˆˆ< ˆˆ:1 fors>/SI s=/SI forjsj/DC4/SI /NUL1fors</NUL/SI(12.77) The tracking performance is suboptimal using the saturation function, compared to using the signum function, but this provides a good tradeoff between robustness and practical implementation for a smoothed control input. The extension of sliding-mode control to multiple inputs is given in [ 25]. Other properties of this control approach can also be found in this reference.448 12 Review of Control and Estimation Theory Example 12.3. In this example the nonlinear system shown in Example 12.2 is controlled to a desired trajectory. The system with a control input is given by mRxCcPxjPxjCk1xCk2x3Du wherem,c,k1, andk2have positive values. The system can be represented in ﬁrst- order form by deﬁning the following state vector xD/STX xPx/ETXT: Px1Dx2 Px2D/NUL.k1=m/x1/NUL.k2=m/x3 1/NUL.c=m/x2jx2jCu The desired trajectories are simulated using the model parameters: mD1,cD2, k1D1, andk2D0:5with uD0for all time and an initial condition of x0DŒ1 0/c141T. A time interval of 0.01 s is used for the integration process with a ﬁnal time of 50 s. The sliding-mode control law assumes the model parameters: NmD1,NcD3, Nk1D1:5, andNk2D0:75. The control parameters are given by /NAKD3andkD1. The boundary layer thickness when the saturation function is used in the control law is given by /SID1. The assumed initial condition is given by zero for both states. Simulation results using the signum and saturation functions are shown in Fig.12.7. Comparing Fig. 12.7a and c shows that using the signum function drives the position error to zero faster than using the saturation function. But comparingFig. 12.7b and d shows that using the signum function produces the classical chattering phenomenon for the control input, while the saturation function produces a much smoother control input. 12.3 Estimation Theory In this section the basic concepts of estimation theory are reviewed. We begin with adiscussion on the differences between static-based and ﬁlter-based estimation. Then, methods of least squares are presented. Formulations are shown for both batch and recursive least squares methods involving linear processes. Then, maximumlikelihood estimation is reviewed, including a review of the Cramér-Rao lower bound. Next, nonlinear least squares is reviewed. An example is shown that involves estimating the attitude of a spacecraft from body and reference observations.This is followed by a brief discussion of the advantages and disadvantages of least squares methods. Then, a review of state estimation methods is provided, which includes the Kalman ﬁlter for linear systems, the extended Kalman ﬁlterfor nonlinear systems, and a batch smoothing algorithm. This is followed by a discussion on the concept of linear covariance analysis. Finally, the separation theorem is reviewed.12.3 Estimation Theory 449 0 5 10 15 20 25 30 35 40 45 50−0.200.20.40.60.81Position Time (Sec)0 5 10 15 20 25 30 35 40 45 50−2.5−2−1.5−1−0.500.511.5Control Input Time (Sec) 0 5 10 15 20 25 30 35 40 45 50−0.200.20.40.60.81Position Time (Sec)0 5 10 15 20 25 30 35 40 45 50−0.8−0.7−0.6−0.5−0.4−0.3−0.2−0.100.1Control Input Time (Sec)ab cd Fig. 12.7 Sliding-mode simulation results. ( a) Position error—signum function. ( b) Control input—signum function. ( c) Position error—saturation function. ( d) Control input—saturation function 12.3.1 Static-Based and Filter-Based Estimation Filtering refers to the process of estimating the current state of a system from a set of measured observations using a priori information, typically given by the previous time state estimate. The ﬁltering problem involves ﬁnding the best estimateof the true system state using an assumed model and measurements each corrupted with random noise of known statistics. The variables to be estimated are usually collected into a state vector, which typically include more variables than just theattitude. For example, star tracker measurements can be combined with a kinematic model, which is propagated using gyroscopic measurements. However, all gyros have inherent drift, which cause inaccuracies in the propagated model. A ﬁlter isused to estimate the attitude and gyro drift, oftentimes referred to as a bias because over short periods the drift occurs slowly, from the measurements. An important aspect of ﬁltering approaches is that they can be used to simultaneously estimate450 12 Review of Control and Estimation Theory quantities and ﬁlter noisy measurement observations. This is accomplished by ﬁnding the best estimate from a combination of the dynamic model propagation and the measurement observation, as discussed in the star tracker/gyro example.The attitude estimate can be shown to be more accurate than using static approaches alone. Because ﬁltering approaches can (and often do) utilize dynamic models, they can in theory estimate quantities when the number of to-be-determined quantities isgreater than the number of linearly independent observations at any single time. An example of a speciﬁc ﬁltering approach is the Kalman ﬁlter [ 11], which when used for attitude estimation can in some cases determine the attitude using one vectorsensor, e.g. a magnetometer-only solution [ 21]. Static and ﬁltering approaches can be used in a complementary fashion. For example, a static solution can be used as an initial estimate in the ﬁlter, and may alsobe used to check the integrity of the ﬁlter solution. Another example involves star- tracker determined attitudes. Modern star trackers have the capability of providing an attitude-out solution using the vector observations only in the internal processor.Two or more of these attitude solutions from multiple trackers can be combined with rate-integrating gyro measurements in a ﬁlter to provide a better attitude estimate than the estimate provided be a single tracker. Therefore, static and ﬁlteringapproaches can complement each other in the overall estimate. Both static and ﬁltering approaches have advantages and disadvantages. The main advantage of static approaches is that a solution is always provided with atmost a very rough a priori estimate of the desired quantity. Also, these approaches are usually computationally more efﬁcient than ﬁltering approaches. The main disadvantage of static approaches is that full observability is required at eachtime frame, so that algebraic singularities do not exist in the solution. Also, some variables cannot be included or determined from a static solution. Finally, optimally combining determined quantities with the proper statistical balance may be difﬁcultto do using static approaches. The main advantage of ﬁltering approaches is that estimates may still be found even when deterministic methods fail, such as in the algebraic singularity situation.Also, other variables, such as biases, can be appended into the state estimation variables, and can easily be combined with other variables with the proper statistical balance. Another advantage is that ﬁlters often provide statistical measures, such asestimate error covariances, as part of their solutions, while simultaneously ﬁltering noisy observations. The main disadvantage of ﬁltering approaches is that an a priori estimate is usually required for the solution. Also, ﬁlters may be prone to divergenceproblems. Finally, the computational load, coding size, and implementation effort are usually greater for ﬁltering approaches than with static approaches. This section provides a review of both static-based and ﬁltering-based estimation approaches. It is expected that the reader has basic knowledge of probability and statistics, especially the theory behind expectations of a random variable, Gaussian distributions and the deﬁnition of the covariance matrix. First, an introductionto the notation used for the estimation concepts throughout the text is shown.12.3 Estimation Theory 451 This is followed by a review of static-based methods, including linear and nonlinear least squares. Then, ﬁlter-based methods, such as the Kalman ﬁlter and extended Kalman ﬁlter are reviewed. The foundation of all estimation algorithms involves taking sensor measurements to estimate unknown variables. For any variable or parameter in estimation, there are three quantities of interest: the true value, the measured value, and the estimatedvalue. The true value (or “truth”) is usually unknown in practice. This represents the actual value sought of the quantity being approximated by the estimator. In this text the true value contains the word “true” as a superscript, such as x true. Measurements are never perfect, since they will always contain errors. Thus, measurements are usually modeled using a function of the true values plus some error. Other quantities used commonly in estimation are the measurement error (measurement value minustrue value) and the residual error (measurement value minus estimated value). Thus, for a measurable quantity x, the following two equations hold: measured valueDtrue valueCmeasurement error xDx trueCv and measured valueDestimated valueCresidual error xDOxC/SI The actual measurement error, v, like the true value, is never known in practice. However, the errors in the mechanism that physically generate this error are usually approximated by some known process (often by a zero-mean Gaussian noise process with known variance). These assumed known statistical properties of themeasurement errors are often employed to weight the relative importance of various measurements used in the estimation scheme. Unlike the measurement error, the residual error is known explicitly and is easily computed once an estimated valuehas been found. The residual error is often used to drive the estimator itself. It should be evident that both measurement errors and residual errors play important roles in the theoretical and computational aspects of estimation. 12.3.2 Batch Least Squares Estimation The principle of batch least squares, developed simultaneously by Karl Gaussand Adrien-Marie Legendre in the early Nineteenth Century, is used to estimate the elements of a constant vector from redundant observations. Therefore, least squares methods are known as “static” estimators. It is important to note that thesemethods may still involve dynamic models; however, the elements to be estimated are always constant. The simplest least squares problem has a linear observation model, given by yDHx trueCv (12.78)452 12 Review of Control and Estimation Theory where yis anm/STX1vector of observations, xtrueis ann/STX1vectors of to-be-estimated variables,His anm/STXnconstant observation matrix, and vis anm/STX1vector of measurement noise which is usually represented by a zero-mean Gaussian white- noise process with covariance R/DC1EfvvTg (12.79) whereEfgdenotes expectation [4]. Here it is assumed that Ris a positive deﬁnite matrix. The optimum estimate for xtrue, denoted byOx, is found by minimizing a loss function involving the weighted sum square residual errors, given by J.Ox/D1 2.y/NULHOx/TR/NUL1.y/NULHOx/ (12.80) Minimizing Eq. ( 12.80 ) can easily be shown to be equivalent to maximizing the likelihood function [ 26], which will be shown later. The best least squares estimate is obtained by taking the derivative of Eq. ( 12.80 ) with respect toOxand setting the resultant to zero, which yields OxD.HTR/NUL1H//NUL1HTR/NUL1y (12.81) A sufﬁciency test for locating the minimum is found by using the second derivative ofJ.Ox/, @2J.Ox/ @Ox2DHTR/NUL1H (12.82) which is ann/STXnHessian matrix. It is positive deﬁnite when Hhas rankn, thus providing a sufﬁcient condition for a minimum. For the simple case of estimating a scalar variable, it is easy to show that Eq. ( 12.81 ) reduces to the average of a number of observations. Variants to the least squares problem, such as the constrainedproblem, can be found in [ 4]. The structure of Eq. ( 12.81 ) can also be used to prove that the estimator is “unbiased.” An estimator Ox.y/is said to be an “unbiased estimator” of xif EfOx.y/gDx truefor every possible value of xtrue[4].2IfOxis biased, the difference EfOx.y/g/NULxtrueis called the “bias” of Ox. Substituting Eq. ( 12.78 ) into Eq. ( 12.81 ) gives OxDxtrueC.HTR/NUL1H//NUL1HTR/NUL1v (12.83) Taking the expectation of both sides gives EfOxgDxtrue, since vhas zero mean. Therefore, Eq. ( 12.81 ) is indeed an unbiased estimate. 2This implies that the estimate is a function of the measurements.12.3 Estimation Theory 453 12.3.3 Sequential Least Squares Estimation The batch least squares problem can be run as a sequential process. This is accomplished by adding an observation and deriving a sequential estimate based on the previous estimate [ 4]. The sequential estimate follows the following recursion equation: OxkC1DOxkCKkC1.ykC1/NULHkC1Oxk/ (12.84) where KkC1DPkC1HT kC1R/NUL1 kC1 (12.85) P/NUL1 kC1DP/NUL1 kCHT kC1R/NUL1 kC1HkC1 (12.86) The matrixPis known as the estimate error-covariance matrix , which will be described shortly. Equation ( 12.84 ) modiﬁes the previous best correction Oxkby an additional correction to account for the information contained in the .kC1/th measurement subset. Another form for Eq. ( 12.85 ) is given by using the matrix inversion lemma orSherman-Morrison-Woodbury formula [9]: .ACUCV//NUL1DA/NUL1/NULA/NUL1U.C/NUL1CVA/NUL1U//NUL1VA/NUL1(12.87) This leads to the covariance recursion form , given by OxkC1DOxkCKkC1.ykC1/NULHkC1Oxk/ (12.88) where KkC1DPkHT kC1/STX HkC1PkHT kC1CRkC1/ETX/NUL1(12.89) PkC1DŒI/NULKkC1HkC1/c141Pk (12.90) An alternative form for the sequential covariance expression involves using the Joseph form [ 17], which has been shown to be more numerically stable. This is given by PkC1DŒI/NULKkHkC1/c141PkŒI/NULKkHkC1/c141TCKkRkC1KT k (12.91) Equation ( 12.91 ) requires more computations, but guarantees that the covariance matrix will remain positive deﬁnite. In sequential least squares, the new estimate is the old estimate plus a linear correction term involving the residual between a new observation and the value predicted by the old estimate. Also, if the estimate covariance is “large,” thenmore weight is given to the residual. This intuitively makes sense since a large454 12 Review of Control and Estimation Theory covariance implies a large estimate error, so that more reliance should be placed on the residual than the previous estimate. As the covariance decreases more weight is placed on the previous estimate, so that the effect of residual correction is less. Thus,the addition of more observations does not signiﬁcantly affect the new estimate. 12.3.4 Maximum Likelihood Estimation Maximum likelihood estimation (MLE) was ﬁrst introduced by R. A. Fisher, a geneticist and statistician in the 1920s. Maximum likelihood yields estimates for the unknown quantities which maximize the probability of obtaining the observedset of data. The conditional probability density function (pdf) for the measurement model in Eq. ( 12.78 ) is simply given by [ 4] p.yjx true/D1 .2/EM/m=2.detR/1=2exp/DC4 /NUL1 2.y/NULHxtrue/TR/NUL1.y/NULHxtrue//NAK (12.92) We wish to maximize the conditional pdf to determine an estimate for xtrue, denoted byOx. Due to the monotonic aspect of this function, the maximization problem can be solved by maximizing the natural log of Eq. ( 12.92 ), which gives ln/STX p.yjxtrue//ETX D/NUL1 2.y/NULHxtrue/TR/NUL1.y/NULHxtrue//NULm 2ln.2/EM//NUL1 2ln.detR/ (12.93) The last two terms on the right hand side of Eq. ( 12.93 ) can be ignored because they do not depend on xtrue. Maximizing Eq. ( 12.93 ) leads to OxD.HTR/NUL1H//NUL1HTR/NUL1y (12.94) which is the familiar least squares batch estimator given by Eq. ( 12.81 ). In order to guarantee that the function is maximized the matrix /NUL.HTR/NUL1H//NUL1must be negative deﬁnite. Since Ris positive deﬁnite, then this condition is true if m/NAKn and there are at least nindependent rows in H. The likelihood function, `.yjxtrue/, is also a pdf, given by `.yjxtrue/DNY iD1p.yijxtrue/ (12.95) whereNis the total number of density functions (a product of a number of density functions is also a density function in itself). Note that the distributionsused in Eq. ( 12.95 ) are the same, but the measurements belong to a different sample drawn from the conditional density. The goal of the method of maximum likelihood is to choose as our estimate of the unknown parameters x truethat value for which the probability of obtaining the observations yis maximized.12.3 Estimation Theory 455 Many likelihood functions, such as the Gaussian pdf, contain exponential terms, which can complicate the mathematics involved in obtaining a solution. However, as seen previously, since ln Œ`.yjxtrue//c141is a monotonic function of `.yjxtrue/, then maximizing ln Œ`.yjxtrue//c141is equivalent to maximizing `.yjxtrue/.3It follows that for a maximum we have the following: necessary condition /SUB@ @xtrueln/STX `.yjxtrue//ETX/ESCˇˇˇˇ OxD0n (12.96) sufﬁcient condition @2 @xtrue@.xtrue/Tln/STX `.yjxtrue//ETX must be negative deﬁnite (12.97) Equation ( 12.96 ) is often called the likelihood equation . Maximum likelihood has many desirable properties. The ﬁrst is the invari- ance principle , which is stated as follows: Let Oxbe the maximum likelihood estimate of xtrue. Then the maximum likelihood estimate of any function g.xtrue/ of these parameters is the function g.Ox/of the maximum likelihood estimate. This is a powerful tool since we do not have to take more partial derivatives to determine the maximum likelihood estimate! Another property is that maximum likelihood is an asymptotically efﬁcient estimator. This means that if the sample size is large, the maximum likelihood estimate is approximately unbiased and has a variance that approaches the smallest that can be achieved by any estimator. Finally, the estimation errors in the maximum likelihood estimate can be shown tobeasymptotically Gaussian no matter what density function is used in the likelihood function. Proofs of these properties can be found in Sorenson [ 26]. The sufﬁcient condition in Eq. ( 12.97 ) is useful to also compute the Cramér-Rao inequality which gives a lower bound on the expected errors between the estimated quantities and the values from the known statistical properties of the measurement errors. The Cramér-Rao inequality for an unbiased estimate Ox, i.e.EfOxgDx true,i s given by P/DC1En/NULOx/NULxtrue/SOH/NULOx/NULxtrue/SOHTo /NAKF/NUL1(12.98) where the Fisher information matrix ,F, is given by FD/NULE/SUB@2 @xtrue@.xtrue/TlnŒp.yjxtrue//c141/ESC (12.99) 3Also, taking the natural logarithm changes a product to a sum which often simpliﬁes the problem to be solved.456 12 Review of Control and Estimation Theory The ﬁrst- and second-order partial derivatives are assumed to exist and to be absolutely integrable. A formal proof of the Cramér-Rao inequality can be found in [4]. The Cramér-Rao inequality gives a lower bound on the expected errors. When the equality in Eq. ( 12.98 ) is satisﬁed, then the estimator is said to be efﬁcient .T h i s can be useful for the investigation of the quality of a particular estimator. It should be stressed that the Cramér-Rao inequality gives a lower bound on the expectederrors only for the case of unbiased estimates. As an example of the Cramér-Rao inequality, consider the least squares estimator of Eq. ( 12.94 ). The Fisher information matrix using Eq. ( 12.99 ) is found to be given by FD.H TR/NUL1H/ (12.100) Substituting Eq. ( 12.78 ) into Eq. ( 12.94 )g i v e s Ox/NULxtrueD.HTR/NUL1H//NUL1HTR/NUL1v (12.101) SinceEfvgD 0then clearly the least squares estimate is unbiased. Using EfvvTgDRleads to the following estimate covariance: PD.HTR/NUL1H//NUL1(12.102) Therefore, the equality in Eq. ( 12.98 ) is satisﬁed, so the least squares estimate leads to an efﬁcient estimator. Note that estimate covariance matrix does not depend on the observations, so that the performance of the estimator can be evaluated beforeany measurements are taken. This includes ﬁnding the 3/ESCbounds on the estimate error parameters, even though the truth, x true, is never known in practice! 12.3.5 Nonlinear Least Squares Linear least squares provides a simple and efﬁcient closed-form solution for linear models. Unfortunately, many systems in spacecraft orbit and attitude estimation involve nonlinear models. The nonlinear least squares problem is more com- plicated, since in general closed-form solutions are not possible. Consider the following nonlinear observation model: yDh.xtrue/Cv (12.103) where h.xtrue/represents some nonlinear, continuously differentiable function ofxtrue. Also, it is assumed that the measurement noise is an additive function to the observation model h.xtrue/. This may not always be true, which further complicates the problem. The nonlinear least squares problem still minimizes the weighted sumsquare residual errors, given by J.Ox/D1 2Œy/NULh.Ox//c141TR/NUL1Œy/NULh.Ox//c141 (12.104)12.3 Estimation Theory 457 In principle the solution follows exactly as in the linear case, where the derivative of Eq. ( 12.104 ) is set to zero. However, in practice the estimate cannot be found in closed-form due to the nonlinear nature of the observation vector h.x/. We assume that an initial estimate of xis known, denoted by xc, so that the estimate is related by an unknown set of corrections, /SOHx,a s OxDxcC/SOHx (12.105) If the components of /SOHxare sufﬁciently small, it may be possible to solve for approximations to them and thereby update xcwith an improved estimate of xfrom Eq. (12.105 ). With this assumption, we may linearize h.Ox/about xcu s i n gaﬁ r s t - order Taylor series expansion as h.Ox//EMh.xc/CH/SOHx (12.106) where H/DC1@h @xˇˇˇˇ xc(12.107) The measurement residual “after the correction” can now be linearly approxi- mated as /SOHy/DC1y/NULh.Ox//EMy/NULh.xc//NULH/SOHxD/SOHyc/NULH/SOHx (12.108) where the residual “before the correction” is /SOHyc/DC1y/NULh.xc/ (12.109) Recall that the objective is to minimize the weighted sum squares, J,g i v e n by Eq. ( 12.104 ). The local strategy for determining the approximate corrections (“differential corrections”) in /SOHxis to select the particular corrections that lead to theminimum sum of squares of the linearly predicted residuals Jp: JD1 2/SOHyTR/NUL1/SOHy/EMJp/DC11 2./SOHyc/NULH/SOHx/TR/NUL1./SOHyc/NULH/SOHx/ (12.110) Before carrying out the minimization, we note that the minimization of Jpin Eq. (12.110 ) is equivalent to the minimization of Jin Eq. ( 12.104 ). If the process is convergent, then /SOHxdetermined by minimizing Eq. ( 12.110 ) would be expected to decrease on successive iterations until (on the ﬁnal iteration) the linearization is an extremely good approximation. Observe that the minimization of Eq. ( 12.110 ) is completely analogous to the previously minimized quadratic form. Thus, any algorithm for solving the least squares problem directly applies to solving for /SOHxin Eq. ( 12.110 ). Therefore, the corrections is given by /SOHxD.HTR/NUL1H//NUL1HTR/NUL1/SOHyc (12.111)458 12 Review of Control and Estimation Theory Model h(x) Determine ∂h ∂x Dyc = y − h(xc) Ji = DyT c R−1Dyc H = xc Dx = (HT R−1 H)−1 HT R−1Dyc dJ<ε? Stop xc = xc + DxMaximum Iterations?Stopy,R−1 YesYes NoNoxcStarting Estimate xc i = 0 i = i + 1∂h ∂x R−1 R−1 Fig. 12.8 Nonlinear least squares algorithm The complete nonlinear least squares algorithm is summarized in Fig. 12.8.A n initial guess xcis required to begin the algorithm. Equation ( 12.111 ) is then calculated using the residual measurements ./SOHyc/, Jacobian matrix .H/, and measurement covariance matrix ( R/NUL1), so that the current estimate can be updated. A stopping condition with an accuracy dependent tolerance for the minimization of Jis given by ıJ/DC1jJi/NULJi/NUL1j Ji<" kR/NUL1k(12.112) where"is a prescribed small value. If Eq. ( 12.112 ) is not satisﬁed, then the update procedure is iterated with the new estimate as the current estimate until the process converges, or unsatisfactory convergence progress is evident (e.g. a maximum allowed number of iterations is exceeded, or Jincreases on successive iterations).12.3 Estimation Theory 459 Therefore, a linear update is performed. Nonlinear least squares implies that an fairly accurate estimate of xmust be known a priori, which may not always be possible. Also, a necessary condition for Oxto be the least squares estimate is that the residual must be orthogonal to the columns of H. This is not true in general. However, in practice Oxis used to invoke an iterative procedure with xcreplaced byOx so that the process continues until the estimate is no longer improved. This iterativesearch procedure is known as the Gauss method. The estimate covariance is still given by Eq. ( 12.102 ), but is theoretically evaluated at the truth. Since this is not known, the ﬁnal estimate is used in practice. Example 12.4. In this example nonlinear least squares is used to compute the modiﬁed Rodrigues parameters (MRPs) from two vector observations. The truebody vectors are given by b true 1D2 40 013 5;b true 2D2 40 0:1p 1/NUL0:123 5 Note that the angle between these vectors is 5:74ı. The true MRP and associated attitude matrix are given by ptrueD2 6641 1Cp 2 0 03 775;A . ptrue/D2 4100 0010/NUL103 5 The reference vectors are computed using r iDATbtrue iforiD1;2. To generate body measurements the QUEST measurement model in Eq. ( 5.107b ) is used with /ESCbiD0:001ıforiD1;2. Note that the measurement covariance is fully populated. To overcome the issue of generating synthetic noise with correlations in any general semi-deﬁnite covariance matrix R, we ﬁrst will diagonalize this matrix using an eigenvalue/eigenvector decomposition: RDV/ETXVT whereVis a matrix of eigenvectors and /ETXis a matrix of eigenvalues. Since R is positive semi-deﬁnite, then Vis an orthogonal matrix and the elements of /ETX are real and positive. A random sample, denoted by z, using scalar sampling can be generated using the matrix /ETX, where the elements of /ETXare the variances of the elements of z. To determine the correlated measurement noise, we simply rotate the vector zusingVwith vDVz460 12 Review of Control and Estimation Theory where vis the correlated noise associated with R. To see that this is correct, we computeE˚ vvT/TAB DVE˚ zzT/TAB VTDV/ETXVTDR. This process is done on both Rb1andRb2to generate synthetic v1andv2vectors. The measured body vectors are then given by b1Dbtrue 1Cv1 jjbtrue 1Cv1jj;b2Dbtrue 2Cv2 jjbtrue 2Cv2jj To compute the matrix Ha ﬁrst-order expansion of the attitude matrix in the error MRPs is used. First the true attitude is related to the estimated attitude, denoted byA.Op/, by using an error attitude, denoted A.ıp/, through A.p true/DA.ıp/A.Op/ The ﬁrst-order expansion of A.ıp/is given by A.ıp/DI3/NUL4Œıp/STX/c141 The estimated ith body vector is given by ObiDA.Op/ri. Computing/SOHbi/DC1btrue i/NULObi gives /SOHbiD/NUL4Œıp/STX/c141A.Op/ri D4ŒA.Op/ri/STX/c141ıp Taking the derivative with respect to ıpgives the following Hmatrix: HD2 44ŒA.Op/r1/STX/c141 4ŒA.Op/r2/STX/c1413 5 The vector/SOHyand matrixRare given by /SOHyD" b1/NULOb1 b2/NULOb2# ;RD/ESC2I6 Equation ( 12.111 ) can now be used to perform the nonlinear least squares iterations. A multiplicative correction using Eq. ( 2.150 ) is used to update the MRP: OpD/NUL 1/NULkpck2/SOH /SOHxC/NUL 1/NULk/SOHxk2/SOH pc/NUL2/SOHx/STXpc 1Ckpck2k/SOHpck2/NUL2/SOHx/SOHpc(12.113) whereOpis the estimated MRP and pcis the initial MRP. The nonlinear least squares process is started with an initial MRP of pcD03/STX1. The stopping criterion is given when /SOHx<1/STX10/NUL9. One thousand Monte Carlo12.3 Estimation Theory 461 0 100 200 300 400 500 600 700 800 900 1000−50−2502550 0 100 200 300 400 500 600 700 800 900 1000−70−3503570 0 100 200 300 400 500 600 700 800 900 1000−1000−50005001000 Run NumberRoll ( mrad) Pitch ( mrad)Yaw ( mrad) Fig. 12.9 Attitude errors runs are executed. In each run the nonlinear least squares process converges in exactly 5 iterations. This is rather remarkable considering the large error in the initial estimate! The MRP errors are also computed using Eq. ( 2.150 ). The inverse MRP is given by its negative. Thus, ıpis given by ıpD/NUL 1/NULkOpk2/SOH ptrue/NUL/NUL 1/NULkptruek2/SOHOpC2ptrue/STXOp 1CkOpk2kptruek2C2ptrue/SOHOp The attitude errors are computed by multiplying ıpby 4. Note that covariance of the attitude errors, 16/ESC2.HTH//NUL1, evaluated at the true values, is equivalent to Eq. (5.113 ). A plot of the attitude errors along with their respective 3/ESCbounds is shown in Fig. 12.9. This indicates that the nonlinear least squares approach provides good estimates. Also, note that the yaw errors are an order of magnitude larger thanthe roll and pitch errors. This is due to the small angle between the two body vectors. Nonlinear least squares may not be suitable to locate the optimum estimate since convergence is not guaranteed unless the a priori estimate is close to the optimum value. The gradient search method [ 22,26] overcomes this difﬁculty by adjusting the estimate so that the search direction is always along the negativegradient ofJ.Ox/. However, this method has been known to converge slowly as the solution approaches the minimum J.Ox/. The Levenberg-Marquardt algorithm [16] overcomes both the difﬁculties of the standard differential correction approach when an accurate initial estimate is not given, and the slow convergence problems of the method of steepest descent when the solution is close to minimizing the462 12 Review of Control and Estimation Theory nonlinear least squares loss function in Eq. ( 12.104 ). This algorithm performs an optimum interpolation between the differential correction, which uses a Taylor series expansion, and the gradient method. In the Levenberg-Marquardt algorithm, Eq. ( 12.111 ) is modiﬁed so that the iteration equation is given by /SOHxD/STX HTR/NUL1HC/DC1R/ETX/NUL1HTR/NUL1/SOHyc (12.114) where/DC1is a scaling factor and Ris a diagonal matrix with entries given by the diagonal elements of HTR/NUL1H. By using the algorithm in Eq. ( 12.114 ) the search direction is actually intermediate between the steepest descent and the differentialcorrection direction. As /DC1!0,E q . ( 12.114 ) is equivalent to the differential correction method; however, as /DC1!1 Eq. (12.114 ) reduces to a steepest descent search along the negative gradient of J. 12.3.6 Advantages and Disadvantages Linear batch estimators are simple to design and implement provided that the system can be represented accurately using linear observation models. A major advantageof the linear batch estimator is that the error covariance can be found without using actual observations. A disadvantage of batch estimators is that the n/STXnmatrix, which must be inverted, may be ill-conditioned. This problem occurs frequentlywhen the observability of the system is low. This problem can be alleviated by using matrix square-root or factorization methods, such as a Cholesky decomposition which factors a symmetric matrix into the product of a lower triangular matrix andits transpose. Also, a large number of observations may be required to improve the accuracy of the estimate, which may substantially increase computer storage. Sequential estimators have certain advantages since the inverse of an n/STXnmatrix can be reduced to a scalar inverse, and since the estimate is found sequentially computer storage can be kept to a minimum. However, convergence of sequential methods cannot always be guaranteed (especially for bad initialization parameters),and erroneous observations cannot easily be disregarded. 12.3.7 State Estimation Techniques The least-square methods shown previously apply to “static” estimation problems. When an estimate of a varying state is required, “dynamic” methods must be used. The most common technique for state estimation using dynamic models is theKalman ﬁlter [ 11]. The term “ﬁlter” is used since it not only estimates dynamic states, but ﬁlters noisy processes. The Kalman ﬁlter is a sequential process, but12.3 Estimation Theory 463 can also estimate for constant variables as least-squares methods do. However, the essential feature of the Kalman ﬁlter is the utilization of state models for dynamic propagation. In addition, the Kalman ﬁlter compensates for dynamic modelinaccuracy by incorporating a noise term (commonly known as process noise ), that gives the ﬁlter a fading memory. So, each observation has a gradually diminishing effect on future state estimates. The Kalman ﬁlter satisﬁes an optimality criterion which minimizes the trace of the covariance of the estimate error between the state estimates and true state quantities. Statistical properties of the process noise and measurement errorare used to design an optimal ﬁlter. This section introduces the fundamental equations used in a Kalman ﬁlter. The linear Kalman ﬁlter is ﬁrst shown in order to introduce the fundamental concepts. The steady-state case is also shown forautonomous system models. The more useful formulation for attitude and orbit estimation is the nonlinear Kalman ﬁlter (also known as the extended Kalman ﬁlter ), which incorporates nonlinear dynamic and/or observation models. Divergence andpractical considerations are also discussed. 12.3.7.1 Linear Kalman Filter The linear Kalman ﬁlter development begins by assuming a truth model using the linear dynamic model in Eq. ( 12.18 ) appended with a noise term, given by Px trueDFxtrueCBuCGw (12.115) where wis a zero-mean p/STX1Gaussian white-noise process vector with spectral densityQ, andGis ann/STXpprocess noise distribution matrix. If we ignore the measurement for now, then the “propagated” estimated state, Ox, follows POxDFOxCBu (12.116) Next, a residual error is deﬁned between the true state in Eq. ( 12.115 ) and the estimated state in Eq. ( 12.116 ): /SI/DC1xtrue/NULOx (12.117) Taking the time derivative of Eq. ( 12.117 ) leads to P/SIDF/SICGw (12.118) The covariance of the residual error: P/DC1Ef/SI/SITg (12.119)464 12 Review of Control and Estimation Theory obeys the equation4 PPDEf/SIP/SITgCEfP/SI/SITgDFPCPFTCGQGT(12.120) w h i c hi ss o l v e df o r P.t/ with initial condition P.t0/DP0. Equations ( 12.116 ) and ( 12.120 ) deﬁne the propagated system for the estimated dynamic model and associated error covariance. In general the measurements are discrete, which are modeled by ykDHkxtrue kCvk (12.121) where vkis am/STX1zero-mean Gaussian white-noise process vector with covariance Rk. A discrete “update” equation is required to process the measurements. This is very similar to the sequential least-squares problem. The linear discrete-time update equation is given by OxC kDOx/NUL kCKkŒyk/NULHkOx/NUL k/c141 (12.122) where the superscripts /NULandCdenote the discrete times just before and after a discrete measurement update, respectively, i.e. Ox/NUL kcomes from the propagated estimate using Eq. ( 12.116 ). Also, the subscript kdenotes the variable at time tk. The updated covariance expression is given by computing PC k/DC1En/NUL xtrue k/NULOxC k/SOH/NUL xtrue k/NULOxC k/SOHTo (12.123) Substituting Eqs. ( 12.121 ) and ( 12.122 )i n t o( 12.123 ), and performing this expecta- tion leads to PC kDŒI/NULKkHk/c141P/NUL kŒI/NULKkHk/c141TCKkRkKT k (12.124) whereP/NUL kis given from the propagated system by Eq. ( 12.120 ). Note that Eq. (12.124 ) is valid for any gain Kk. Also note that it is equivalent to Eq. ( 12.91 ), except that the propagated P/NUL kis used. The optimal gain is determined by minimizing the trace of the updated covariance: JkDtrPC k(12.125) Performing this minimization leads to a gain that is identical to the sequential least- squares problem: KkDP/NUL kHT kŒHkP/NUL kHT kCRk/c141/NUL1(12.126) 4This follows formally from Ef/SIwTgD1 2GQ, but there are more rigorous derivations [ 4].12.3 Estimation Theory 465 Table 12.1 Continuous-discrete linear Kalman ﬁlter Model PxtrueDFxtrueCBuCGw;where w/CANN.0;Q/ ykDHxtrue kCvk;where vk/CANN.0;Rk/ Initialize Ox.t0/DOx0 P.t0/DP0 PropagationPOxDFOxCBu PPDFPCPFTCGQGT Gain KkDP/NUL kHT kŒHkP/NUL kHT kCRk/c141/NUL1 Update OxC kDOx/NUL kCKkŒyk/NULHkOx/NUL k/c141 PC kDŒI/NULKkHk/c141P/NUL k Substituting Eq. ( 12.126 ) into Eq. ( 12.124 )g i v e s PC kDŒI/NULKkHk/c141P/NUL k (12.127) This the preferred form for the covariance update, but the Joseph form in Eq. (12.124 ) can still be used with the gain in Eq. ( 12.126 ) when numerical instabilities are a concern. A summary of the continuous-discrete linear Kalman ﬁlter is shown in Table 12.1, whereN.0;Q/ denotes a Gaussian distribution with zero mean and spectral density Qfor continuous-time systems, and N.0;Rk/denotes a Gaussian distribution with zero mean and covariance Rkfor discrete-time systems. The ﬁlter is ﬁrst initialized using knowledge of the initial state, Ox0, and error covariance, P0. Then the state and error covariance are updated using the measured observation. Finally, the state dynamic model and associated error covariance are propagated using the updated values to the next discrete measurement time. The Kalman ﬁlter shown in Table 12.1 can be used with time-varying model matrices. However, if the model is autonomous a steady-state expression for the error covariance can be used. This is due to the fact that the covariance usuallyconverges rapidly for this case. Also, for a large class of problems the discrete-time version of the dynamic model in Eq. ( 12.115 ) is usually quite adequate, given by x true kC1D˚kxtrue kC/NULkukC/BELkwk (12.128) where wkis ap/STX1zero-mean Gaussian white-noise process vector with covari- anceQk. The propagation estimate is simply given by Ox/NUL kC1D˚kOxC kC/NULkuk (12.129) Combining ( 12.129 ) with ( 12.122 ) gives, for the post-update state estimates, OxkC1D˚kOxkC/NULkukCKkC1ŒykC1/NULHkC1.˚kOxkC/NULkuk//c141 (12.130)466 12 Review of Control and Estimation Theory where the superscript Con the state estimates is understood. The pre-update covariance is needed to compute the Kalman gain. The discrete-time covariance propagation is given by [ 13] P/NUL kC1D˚kPC k˚T kC/BELkQk/BELT k (12.131) Combining the discrete error covariance propagation ( 12.131 ) and update equa- tion ( 12.127 )g i v e s PkC1D˚kPk˚T k/NUL˚kPkHT kŒHkPkHT kCR/c141/NUL1HkPk˚T kC/BELkQk/BELT k(12.132) where the superscript /NULon the covariances is understood. If the system is autonomous, then the following steady-state equation can be used to ﬁnd P: PD˚P˚T/NUL˚PHTŒHPHTCR/c141/NUL1HP˚TC/BELQ/BELT(12.133) which is known as the discrete algebraic Riccati equation . The solution to Eq. (12.133 ) is given by forming a 2n/STX2nHamiltonian matrix H/DC1/DC4˚/NULT˚/NULTHTR/NUL1H /BELQ/BELT˚/NULT˚C/BELQ/BELT˚/NULTHTR/NUL1H/NAK (12.134) which can be shown to have nstable eigenvalues (inside the unit circle) and nreciprocal unstable eigenvalues [ 4]. The eigenvectors of Eq. ( 12.134 ) are then partitioned into n/STXnsubmatrices: VD/DC4V11V12 V21V22/NAK (12.135) whereV11andV21contain the eigenvectors corresponding to the unstable eigen- values, andV12andV22contain the eigenvectors corresponding to the stable eigenvalues. The steady-state solution for Pis found by using V11andV21 PDV21V/NUL1 11 (12.136) Therefore, the gain in Eq. ( 12.126 ) is now constant. Other efﬁcient methods for the solution of the Eq. ( 12.133 ) are shown in [ 1]. The steady-state discrete-time Kalman ﬁlter is summarized in Table 12.2. 12.3.7.2 Extended Kalman Filter A large class of orbit and attitude estimation problems involve nonlinear models. For several reasons, state estimation for nonlinear systems is considerably more12.3 Estimation Theory 467 Table 12.2 Discrete and autonomous linear Kalman ﬁlter Model xtrue kC1D˚xtrue kC/NULukC/BELwk;where wk/CANN.0;Q/ ykDHxtrue kCvk;where vk/CANN.0;R/ Initialize Ox.t0/DOx0 Covariance PD˚P˚T/NUL˚PHTŒHPHTCR/c141/NUL1HP˚TC/BELQ/BELT Gain KDPHTŒHPHTCR/c141/NUL1 Estimate OxkC1D˚OxkC/NULukCKŒykC1/NULH.˚ OxkC/NULuk//c141 Table 12.3 Continuous-discrete extendedKalman ﬁlterModel PxtrueDf.xtrue;u;w;t/; where w/CANN.0;Q/ ykDh.xtrue k/Cvk;where vk/CANN.0;Rk/ Initialize Ox.t0/DOx0 P.t0/DP0 PropagationPOxDf.Ox;u;t/ PPDFPCPFTCGQGT F/DC1@f @xˇˇˇˇ Ox;G /DC1@f @wˇˇˇˇ Ox Gain KkDP/NUL kHT kŒHkP/NUL kHT kCRk/c141/NUL1 Hk/DC1@h @xˇˇˇˇ Ox/NUL k Update OxC kDOx/NUL kCKkŒyk/NULh.Ox/NUL k//c141 PC kDŒI/NULKkHk/c141P/NUL k difﬁcult, and admits a wider variety of solutions than the linear problem [ 8]. Some of these problems are seen by considering the general nonlinear system model PxtrueDf.xtrue;u;w;t/ (12.137) Clearly, the probability density function of wis altered as it is transmitted through the nonlinear elements. So, if the noise term cannot be linearly separated from this equation, then the simple covariance expression in Eq. ( 12.137 ) cannot be used, since a Gaussian input causes a non-Gaussian response. Fortunately, a Kalman ﬁlter can still be derived using nonlinear models. The extended Kalman ﬁlter, though not precisely “optimum,” has been successfully applied to many nonlinear systems overthe past many years. The fundamental concept of this ﬁlter involves the notion that the true state is sufﬁciently close to the estimated state. Therefore, the error dynam- ics can be represented fairly accurately by a linearized ﬁrst-order Taylor seriesexpansion, given by Eq. ( 12.30 ). The extended Kalman ﬁlter uses the full nonlinear dynamic equation for model propagation, but uses the same linear correction as the linear Kalman ﬁlter. Also, the nominal values are replaced by the current estimatesin the ﬁlter propagation. This allows the extended Kalman ﬁlter to compute the gain matrix online, as opposed to pre-computing a gain matrix sequence. A summary of the extended Kalman ﬁlter algorithm is shown in Table 12.3.468 12 Review of Control and Estimation Theory 12.3.7.3 Smoothing A batch version of both the linear and extended Kalman ﬁlters is useful for signiﬁcantly smoothing noisy processes. Smoothing problems general fall into three cases. The ﬁxed-point smoother seeks an estimate at a single ﬁxed point in time, while the observations continue ahead of the estimation. The ﬁxed-lagsmoother seeks an estimate at a ﬁxed length of time back in the past. The ﬁxed- interval smoother uses a ﬁxed time interval of observations, and seeks estimates at some or all of the interior points. This is the most common smoother for batchestimation. An example of such a smoother is the Rauch-Tung-Striebel (RTS) optimal smoother [ 23]. This smoother essentially processes the observation ﬁrst forward in time and then backwards in time. The forward estimates are given bythe Kalman ﬁlter. The backwards process is initialized using the ﬁnal time forward estimates: Ox sNDOxC N (12.138a) PsNDPC N (12.138b) where the subscript sdenotes the smoothed quantity. The RTS smoothed estimates and covariance are computed using Kk/DC1PC k˚T k.P/NUL kC1//NUL1(12.139a) OxskDOxC kCKk.OxskC1/NULOx/NUL kC1/ (12.139b) PskDPC k/NULKk.P/NUL kC1/NULPskC1/KT k (12.139c) Note that storage of the forward estimates, state matrices, and covariance is required, but storage of the measurements is not required. The advantages of smoothing algorithms is that the resulting error covariance is always less than either the forwardor backward process alone. However, smoothing algorithms cannot be implemented for realtime application. 12.3.7.4 Stability and Performance The linear and autonomous Kalman ﬁlter is known to be extremely stable (i.e. the estimates will not diverge from the true values), and provides accurate estimates under the properly deﬁned conditions. However, the stability of the extendedKalman ﬁlter must be properly addressed before on-board implementation. Many factors affect ﬁlter stability for this case. One common problem is in the error covariance update and propagation, which may become non-positive deﬁnite chieﬂydue to numerical instabilities. A measure of the potential for difﬁculty in an ill-conditioned matrix can be found by using the condition number [27]. This problem may be overcome by using the Joseph form (shown previously) or by12.3 Estimation Theory 469 using matrix square root or factorization methods. Square root methods guarantee positive deﬁniteness, but typically require 50–150 % more computational time than that required by the standard Kalman ﬁlter [ 27]. A more efﬁcient algorithm is given by the U-D ﬁlter, which factors the covariance matrix using PDUDUTD/STX UD1=2/ETX/STX UD1=2/ETXT(12.140) whereUis an upper triangular matrix and Dis diagonal. The gain matrix, covariance propagation and update are given in terms of these matrices [ 2]. For ﬁlter performance, non-Gaussian measurement and process noise errors are a major source of concern. Typically, in most real-world applications these error sources are indeed non-Gaussian. For example, consider the problem of estimating a spacecraft’s attitude using magnetometer data. Flight data results have clearly shownthat the magnetic ﬁeld measurements contain errors which are a function of orbit rate and higher harmonics [ 24]. This can severely degrade the ﬁlter’s performance, since this is typically assumed to be modeled by a Gaussian process. A possiblesolution to these type of problems involves using a colored-noise ﬁlter [13], which pre-ﬁlters (shapes) a Gaussian noise process to more accurately model actual measurement error processes. However, even if the Gaussian noise assumption istrue, the proper values for the process and measurement covariances may not be straightforward to choose. This leads to a process known as ﬁlter tuning, which involves adjusting the ﬁlter parameters to achieve the best possible estimationperformance, most often using actual measured observations. Filter tuning can be performed off-line using numerical optimization techniques [ 22] or online using adaptive methods [ 10]. However, in practice manual optimization is more prevalent. A common procedure involves choosing small values for the measurement error covariance (which puts more weight or reliance on the measurements) and then adjusting the process noise covariance and initial covariance to achieve a reasonableperformance level. Then, the tuning process is reﬁned until the desired performance is achieved. There are many other concerns to consider in the design and implementation of a Kalman ﬁlter. For an extended Kalman ﬁlter the obvious question is: how accurate is the linearized model? This is an aspect which must be addressed in order to design an accurate ﬁlter. For example, the quaternion kinematic model loses normalizationin a straightforward linearization. Therefore, the physical nature of the model can be lost. Also, the observability may vary from one time step to the next. This must be addressed in order to check that observability can be obtained throughout theorbit. If the Kalman ﬁlter is used in conjunction with a control system, then the ﬁlter’s convergence rate (i.e. when transients decay) can signiﬁcantly affect the control system’s performance. This is usually accounted for during the initializationprocedure; however, the ﬁlter may lose “lock” during mission mode and may need proper initialization before the control system is again invoked. All or part of these factors need to be accounted early in the design (before actual operation) in order toreduce risk of failures due to inadequate ﬁlter performance.470 12 Review of Control and Estimation Theory 12.3.8 Linear Covariance Analysis Soon after the development of the Kalman ﬁlter, it was recognized that the covariance matrix can be computed without processing actual data, and that the resulting covariance is very useful for assessing the expected estimation errors resulting from candidate dynamic models and measurement strategies [ 6,10]. This is the basic idea of linear covariance analysis , which executes only the covariance initialization, covariance propagation, gain computation, and covariance update steps of Table 12.1. It has been widely employed during the development of attitude estimation systems, to determine the type of sensors required, their locations, accuracy, and required data frequency, as well as the reﬁnement required of dynamic models. The number of parameters describing a dynamical system can be quite large, and it is often impractical to solve for all of them, especially in real-time applications. Thus it can be important to consider the effect on estimation accuracy of errorsin parameters that are unknown but not solved for. Reference [ 15] considers the generalization of linear covariance analysis to include such consider parameters , including references to the earlier literature. If the models are state-dependent, as is usually the case, a nominal state trajectory is speciﬁed to evaluate the partial derivative matrices F/DC1@f=@x,G/DC1@f=@w, and H k/DC1@h=@x. In most cases, the nominal trajectory is also required to account for sensor occultation, star availability for star cameras, spacecraft attitude maneuvers, and similar effects. Note that, unlike the EKF, the nominal state trajectory is speciﬁed at the outset of the analysis and is not affected by the ﬁlter equations. 12.3.9 Separation Theorem Oftentimes a full-state controller is used in the controller. However, just as oftenall states in a system cannot be measured from sensors. Thus, an estimator is used in concert with a controller, which provides the full state information required in the controller. For example, in the inverted pendulum derived at the beginning ofthis chapter only measurements of position and angle may be provided, and these along with their derivatives are estimated by the Kalman ﬁlter to provide full state knowledge to a controller. A natural question arises: how does the dynamics ofeither the controller or the estimator affect the dynamics of the overall (combined) controller/estimator system? First, a description of the closed-loop system is provided. Here only linear and autonomous systems are considered. Also, only the regulation case is considered where the goal is to drive the true states to zero. A controller with full state feedback is given by uD/NULLx true, whereLis a constant gain. Substituting this expression into Eq. ( 12.21 ) with the deﬁnition xtrue/DC1xgives PxtrueD.F/NULBL/xtrue(12.141)12.3 Estimation Theory 471 The closed-loop controller dynamics are given by eigenvalues of .F/NULBL/.T h e control gain, L, is chosen to give some desired closed-loop response. Now consider the continuous-time version of the Kalman ﬁlter estimate equation, given by POxDFOxCK.y/NULHOx/ (12.142) Assuming no noise on y, so that yDHxtrue, then the error dynamics of the estimator, deﬁned by Eq. ( 12.117 ), are given by P/SID.F/NULKH//SI (12.143) The error dynamics of the estimator are given by eigenvalues of F/NULKH. In practice the control input uses the estimated states, with uD/NULLOx (12.144) SubstitutingOxDxtrue/NUL/SIinto ( 12.144 ), and then substituting the resultant into Eq. (12.21 ) leads to PxtrueD.F/NULBL/xtrueCBL/SI (12.145) Hence, the closed-loop dynamics of the overall controller/estimator system are given by /DC4Pxtrue P/SI/NAK D/DC4F/NULBL BL 0n/STXnF/NULKH/NAK/DC4xtrue /SI/NAK (12.146) Since the matrix in Eq. ( 12.146 ) is block-triangular, its eigenvalues are given by the eigenvalues of F/NULBLandF/NULKH. This shows that the overall controller/estimator system can be designed by separating the estimator from the controller, which is exactly the separation theorem . A block diagram of the overall controller/estimator system is shown in Fig. 12.10 . Example 12.5. In this example a linear Kalman ﬁlter is used to estimate for the states of the inverted pendulum. A full state controller is then used to bring thependulum to its zero (vertical) position. The following parameters are used for the model:MD2kg,mD0:1kg,`D0:1m, andcD2Ns/m. Note that this system is unstable. The continuous-time system is converted to discrete-time usinga sampling interval of 0:01 s. The discrete-time system matrices are given by ˚D2 6641/NUL3:8687/STX10 /NUL29:9485/STX10/NUL3/NUL1:2597/STX10/NUL4 0 1:3910 3:9241 /STX10/NUL41:1273/STX10/NUL2 0/NUL8:1945 9:8924/STX10/NUL1/NUL3:8687/STX10/NUL2 0 82:860 8:3117 /STX10/NUL21:39103 775472 12 Review of Control and Estimation Theory K LB F HˆxB FHxtrueState EstimatorSystem Dynamics Fig. 12.10 Overall controller/estimator system /NULD2 6642:5761/STX10/NUL5 /NUL1:9620/STX10/NUL4 5:3794/STX10/NUL3 /NUL4:1558/STX10/NUL23 775 The true and estimated initial states and the initial covariance are given by xtrue.t0/DOx.t0/D/STX 0.10/EM=180/00/ETXT P0D2 664.1/STX10/NUL4/2000 0 .0:15/EM=180/200 00 0 : 120 0 0 0 .0:1/EM=180/23 775 The estimated initial and true states are equal, which is generally not true in practice. It is assumed here that the ﬁlter has converged before the controller is enabled so that the estimated states will be close to their respective true states and smallvalues inP 0are appropriate. The outputs are position and angle. Measurements are generated using a zero-mean Gaussian white-noise process with standard deviations of0:001 m for position and 0:001/EM=180 rad for the angle. The state matrices for the estimate are the same as the truth so no process noise is required. The Kalman ﬁlter provides estimates for position, velocity, angle, and angular rate for use in the controller. The controller is given by ukD/NULLOxk. The control gain, L, is chosen to stabilize the system within 1 s. This is achieved by: LD/STX /NUL8:2701/NUL2:1249/STX103/NUL5:3521/NUL18:386/ETXReferences 473 00.2 0.4 0.6 0.8 11.2 1.4 1.6 1.8 2−50510Angle (Deg) Time (Sec)00.2 0.4 0.6 0.8 11.2 1.4 1.6 1.8 2−0.100.10.20.30.40.5Position (m) Time (Sec)ab Fig. 12.11 Controlled response of the inverted pendulum. ( a) Angle. ( b) Position Figure 12.11 a shows a plot of the controlled pendulum angle response. The angle starts at10ıand then swings to the other side, ﬁnally coming to a near resting point of zero. Small oscillations are present at steady state, which are due to the noisein the state estimates. A plot of the controlled cart position response is shown in Fig.12.11 b. The cart starts at its initial resting point of zero and then returns to that same point once the pendulum is stabilized. References Arnold, W.F., Laub, A.J.: Generalized eigenproblem algorithms and software for algebraic Riccati equations. Proc. IEEE 72(12), 1746–1754 (1984) Bierman, G.J.: Factorization Methods for Discrete Sequential Estimation. Academic Press, Orlando (1977) Chen, C.T.: Linear System Theory and Design. Holt, Rinehart and Winston, New York (1984)4. Crassidis, J.L., Junkins, J.L.: Optimal Estimation of Dynamic Systems, 2nd edn. CRC Press, Boca Raton (2012) Dorf, R.C., Bishop, R.H.: Modern Control Systems. Addison Wesley Longman, Menlo Park (1998) Fagin, S.L.: Recursive linear regression theory, optimal ﬁlter theory, and error analysis of optimal systems. In: 1964 IEEE International Convention Record, pp. 216–240 (1964) Franklin, G.F., Powell, J.D., Workman, M.: Digital Control of Dynamic Systems, 3rd edn. Addison Wesley Longman, Menlo Park (1998) Gelb, A. (ed.): Applied Optimal Estimation. MIT Press, Cambridge (1974)9. Golub, G.H., Van Loan, C.F.: Matrix Computations, 3rd edn. The Johns Hopkins University Press, Baltimore (1996) Jazwinski, A.H.: Stochastic Processes and Filtering Theory. Academic Press, New York (1970)11. Kalman, R.E., Bucy, R.S.: New results in linear ﬁltering and prediction theory. J. Basic Eng. 95–108 (1961) LePage, W.R.: Complex Variables and the Laplace Transform for Engineers. Dover Publica- tions, New York (1980)474 12 Review of Control and Estimation Theory Lewis, F.L.: Optimal Estimation with an Introduction to Stochastic Control Theory. Wiley, New York (1986) Lizarralde, F., Wen, J.T.Y .: Attitude control without angular velocity measurement: A passivity approach. IEEE Trans. Automat. Contr. 41(3), 468–472 (1996) Markley, F.L., Carpenter, J.R.: Generalized linear covariance analysis. J. Astronaut. Sci. 57(1 & 2), 233–260 (2009) Marquardt, D.W.: An algorithm for least-squares estimation of nonlinear parameters. J. Soc. Ind. Appl. Math. 11(2), 431–441 (1963) Maybeck, P.S.: Stochastic Models, Estimation, and Control, vol. 1. Academic Press, New York (1979) Moler, C., van Loan, C.: Nineteen dubious ways to compute the exponential of a matrix. SIAM Rev. 20(4), 801–836 (1978) Palm, W.J.: Modeling, Analysis, and Control of Dynamic Systems, 2nd edn. Wiley, New York (1999) Phillips, C.L., Nagle, H.T.: Digital Control System Analysis and Design, 2nd edn. Prentice Hall, Englewood Cliffs (1990) Psiaki, M.L., Martel, F., Pal, P.K.: Three-axis attitude determination via Kalman ﬁltering of magnetometer data. J. Guid. Contr. Dynam. 13(3), 506–514 (1990) Rao, S.S.: Engineering Optimization: Theory and Practice, 3rd edn. Wiley, New York (1996)23. Rauch, H.E., Tung, F., Striebel, C.T.: Maximum likelihood estimates of linear dynamic systems. AIAA J. 3(8), 1445–1450 (1965) Sedlack, J., Hashmall, J.: Accurate magnetometer/gyroscope attitudes using a ﬁlter with cor- related sensor noise. In: Proceedings of the Flight Mechanics/Estimation Theory Symposium, pp. 293–303. NASA-Goddard Space Flight Center, Greenbelt (1997) Slotine, J.J.E., Li, W.: Applied Nonlinear Control. Prentice Hall, Englewood Cliffs (1991)26. Sorenson, H.W.: Parameter Estimation, Principles and Problems. Marcel Dekker, New York (1980) Stengel, R.F.: Optimal Control and Estimation. Dover Publications, New York (1994)28.˙Zak, S.H.: Systems and Control. Oxford University press, New York (2003)Appendix: Computer Software All of the examples shown in the text have been programmed and simulated using MATLABR/CR. A website of these programs, listed by chapter, can be found at http://www.buffalo.edu/~johnc/space_book.htm For general information regarding MATLAB or related products, please consult MathWorks, Inc. at http://www.mathworks.com It has been our experience that to thoroughly understand the intricacies of a subject matter in this text, one must learn from basic fundamentals ﬁrst. Although computer routines can provide some insights to the subject, we feel that they mayhinder rigorous theoretical studies that are required to properly comprehend the material. Therefore, we strongly encourage students to program their own computer routines, using the codes provided from the website for veriﬁcation purposes only.We have decided not to include a disk of programs with the text so that up-to-date versions of the computer programs can be maintained on the website. The programs have been written so that anyone with even a terse background in MATLAB shouldbe able to comprehend the relationships between the examples in the text and the coded scripts. We hope that the reader will use these programs in the spirit that they are given; to supplement their reading and understanding of the material in printedtext in order to bridge the gap between theoretical studies and practical applications. Limit of Liability/Disclaimer of Warranty : The computer programs are provided as a service to readers. While the authors have used their best efforts in preparingthese programs, they make no representation or warranties with respect to the accuracy or completeness of the programs. The book publisher (Springer), the authors, the authors’ employers, or MathWorks, Inc. shall not be liable for any lossof proﬁt or any other commercial or noncommercial damages, including, but not limited to, special, incidental, consequential, or other damages. F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8, © Springer Science+Business Media New York 2014475Index A AT r a i n , 397 Active and Passive Transformations, 26,42 Advanced Composition Explorer (ACE), 401 Albedo, 109,133,391 Algebraic Method, seeTRIAD Alias and Alibi, seeActive and Passive Transformations Alonso, Roberto, 269 Angular Momentum, 67,77,140,173,323 Conservation, 111 Speciﬁc, seeSpeciﬁc Angular Momentum Angular Velocity, 68,323,356 Apogee, seeEllipse Geometry, Apoapsis Apollo, 2 Aqua, 397 Asymptotic Stability, seeControl Theory, Asymptotic Stability Atmospheric Density, 108,389,394,406 Exponential Model, 406 Scale Height, 406 GOST Model, 408 Harris-Priester Model, 407 Jacchia Model, 408 Jacchia-Bowman Model, 409 Barometric Equation, 415 Density Correction Factors, 418 Diffusion Equation, 416 High Altitude Density Correction, 419 Seasonal-Latitudinal Variation, 419 Semiannual Variation, 418 Temperature Proﬁle, 409 Jacchia-Roberts Model, 408 Atmospheric Drag, 107,389 Ballistic Coefﬁcient, 390,394 Drag Coefﬁcient, 108,389,394 Attitude Control, 1,4,6,14,287Control Moment Gyros, 8 Effects of Noise, 312 Hysteresis-Based Switching, 315 Magnetic Torque, 307,324 B-dot, 309 Detumbling, 308 Momentum Dumping, 6,8,107,307, 311 Reaction Wheels, 8,291,296,332 Regulation, 289 Safehold, 4,11,13 SAMPEX, seeSAMPEX Attitude Control Single Axis, 438 Thrusters, 8,303 Initial Acquisition, 303 Momentum Dumping, 8,303 Pulse-Width Pulse-Frequency, 303 Safehold, 303 Tracking, 294 Attitude Determination, 1,183 Fisher Information Matrix, 212 GPS, 137 Maximum Likelihood Estimation, 208 TRIAD, seeTRIAD Wahba’s Problem, seeWahba’s Problem Attitude Dynamics, 67,77,83 Attitude Error Representations, 59 Kalman Filtering, 239 Kinematics, 76 Attitude Estimation, 1,235,240 Attitude Representations, 236 Additive Quaternion, 237 Multiplicative Quaternion, 239 Three-Component, 236 Discrete-Time Propagation, 251 Effect of Orbit Errors, 216 Farrenkopf’s Steady-State Analysis, 263 F.L. Markley and J.L. Crassidis, Fundamentals of Spacecraft Attitude Determination and Control , Space Technology Library 33, DOI 10.1007/978-1-4939-0802-8, © Springer Science+Business Media New York 2014477478 Index Attitude Estimation ( cont. ) Gyro Calibration Kalman Smoother, 246 Kalman Filter Formulation, 240 Measurement Sensitivity Matrix, 241, 249,353 Measurement Update, 241 Propagation, 244 Reset, 242 Mission Mode Kalman Filter, 257 Murrell’s Version, 260 Attitude Kinematics, 67,68,83 Attitude Matrix, 40 Kinematics, 68 Aura, 398 Axisymmetric, 87 B B-dot Control, seeAttitude Control, Magnetic Torque, B-dot bac/NULcab Rule, 372 Baker, Dan, 328 Ballistic Coefﬁcient, seeAtmospheric Drag, Ballistic Coefﬁcient Bar-Itzhack, Itzhack, 3 Barba, Peter, 14 Beletsky, Vladimir, 6 Black, Harold, 2 Body Cone, 93 Boltzmann Constant, 111 Bond Number, 103 Bradley, James, 130 Brouwer, Kirk, 393 C Cauchy-Schwarz Inequality, 22 Cayley Transform, 50 Cayley-Hamilton Theorem, 60,190 Center of Mass, 77 Centripetal Acceleration, 70,400 Certainty Equivalence Principle, 312 Cloud-Aerosol Lidar and Infrared Pathﬁnder Satellite Observations (CALIPSO),397 CloudSat, 397 Cohen, Clark, 137 Computer Software, 475 Condition Number, 468 Conic Section, 373 Coning, 85 Control Moment Gyros, 100,166 Single-Gimbal, 166 Singular Conﬁgurations, 167Variable-Speed, 166 Control Theory, 437 Feedback Linearization, 446 Asymptotic Stability, 290 Closed-Loop, 288,438 Critical Damping, 439 Damped Natural Frequency, 439 Damping Ratio, 439 Equilibrium Point, 290,313,442 H1,288 Linear, 437 Lyapunov Equation, 444 Lyapunov Function, 288,290,309,313, 445 Lyapunov’s Direct Method, 290,442 Lyapunov’s Linearization Method, 442 Natural Frequency, 439 Nonlinear, 442 Stability, 442 Open-Loop, 287 Proportional-Derivative, 439 Proportional-Integral-Derivative, 332,336, 439,441 Robustness, 288,296,313 Sliding-Mode, 288,295,444 Boundary Layer, 296,447,448 Chattering, 295,447 Equivalent Control, 295,447 Reaching Phase, 445 Sliding Phase, 445 Sliding Surface, 295,445 Coriolis Acceleration, 70,401 Covariance, 184,204–209,216,270,273,274, 453,456,458,463–466 Analysis, 201,263,470 Discrete-Time, 258 Crassidis, Agamemnon, 444 Critical Damping, seeControl Theory, Critical Damping Cross Product, seeVector, Cross Product Cryogenic Infrared Spectrometers and Telescopes for theAtmosphere/Shuttle PalletSatellite (CRISTA-SPAS), 137 CubeSat, 5 D Damped Natural Frequency, seeControl Theory, Damped Natural Frequency Damping Ratio, seeControl Theory, Damping Ratio Danby, John, 398Index 479 Davenport’sKMatrix, seeWahba’s Problem, Davenport’sKMatrix Davenport, Paul, 2,52,187,199,352 Deadband, 303 DeBra-Delp Region, 117 Defense Meteorological Satellite Program (DMSP), 11,135 Dirac Delta Function, 144 Direction Cosine Matrix (DCM), seeMatrix, Direction Cosine Matrix (DCM) Discrete-Time Systems, 434 State Space, 436 Zero-Order Hold, 435 Dodge, Franklin, 102 Dot Product, seeVector, Dot Product Downing, John, 155 Duty Cycle, 304,305 E Earth Geoid, 34 Equatorial Radius, 34,388 Flattening, 34 Polar Radius, 34 World Geodetic System, 34,139 Earth Sensor, seeHorizon Sensor Earth Sensor Assembly, seeHorizon Sensor Earth-Pointing Spacecraft, 55 Dynamics, 112 Echo, 3 Eclipse Conditions, 422 Eigenvalues, seeMatrix, Eigenvalues and Eigenvectors Eigenvectors, seeMatrix, Eigenvalues and Eigenvectors Ellipse Geometry, 229,365 Apoapsis, 368 Directrix, 367 Eccentricity, 367 Focus, 366 Periapsis, 368 Polar Coordinates, 368 Semilatus Rectum, 368,369,372,374 Semimajor Axis, 365 Semiminor Axis, 365 Elliptic Orbit, 373 Environment Models, 403 Ephemeris, 420 Moon, 422 Planets, 422 Sun, 420,422 Equatorial Radius, seeEarth Geoid, Equatorial Radius Escape Velocity, 374ESOQ, 194 ESOQ2, 195 Estimation Theory, 448 Advantages and Disadvantages, 462 Batch Least Squares, 451 Colored-Noise Filter, 469 Covariance Recursion Form, 453 Efﬁcient Estimator, 207,213,456 Error-Covariance Matrix, 453 Expectation, 452 Extended Kalman Filter, 2,14,235,239, 466 Kalman Filter, 2,323,450,463 Propagation, 463,464 Update, 464 Levenberg-Marquardt, 461 Maximum Likelihood, 454 Asymptotically Efﬁcient, 455 Asymptotically Gaussian, 455 Cramér-Rao Inequality, 455 Invariance Principle, 455 Likelihood Function, 454 Measurement Error, 451 Nonlinear Least Squares, 456 Probability Density Function, 454 Residual Error, 451,452,456,463 RTS Smoother, 468 Sequential Least Squares, 453 Smoothing, 468 Square Root Filter, 469 Stability and Performance, 468 Static-Based and Filter-Based, 449 Truth, 451 Unbiased Estimate, 237,452 Euclidean Matrix Norm, seeMatrix, Frobenius Norm Euler Angles, 2,52,112,361,375 Kalman Filtering, 236 Kinematics, 73,297,361 Euler Axis/Angle, 41,197 Euler Symmetric Parameters, seeQuaternion Euler’s Equation, 79 Euler’s Rotational Equation, 84,289 Euler’s Theorem, 40 Euler, Leonhard, 40 Euler-Rodrigues Parameters, seeQuaternion Explorer, 88 Extended Kalman Filter, seeEstimation Theory, Extended Kalman Filter F Far Ultraviolet Spectroscopy Explorer (FUSE), 147480 Index Farrell, James, 2,183,196 Farrenkopf’s Model, 176,267 Farrenkopf, Robert, 263 Final Value Theorem, 440 Finite Element Methods, 99 Fisher Information Matrix, 207,455 Fisher, Ronald, 454 Flat Spin, 88 Flatley, Thomas W., 325 Flexible Body Dynamics, 99 Flight-Path Angle, 37 FOAM, 198 Free Body Diagram, 425 Frobenius Norm, seeMatrix, Frobenius Norm Froude Number, 103 G Galileo, 8 Gambhir, Brij, 269 Gauss, Karl, 451 Gaussian Distribution, 189,263,270,450–452, 455,463–465 Generalized Rodrigues Parameters, 63 Geopotential, 333,382 Sectoral Harmonics, 385 Tesseral Harmonics, 385 Zonal Harmonics, 385,386 Geostationary Experimental Ocean Satellite (GEOS), 8,115 Geostationary Operational Environmental Satellites (GOES), 8,10,11,13, 118,216 Geostationary Orbit, 3,373 Geosynchronous Orbit, 12,373 Gibbs Vector, seeRodrigues Parameters Gibbs, J. Willard, 48 Gimbal Lock, 56,57,75 Global Change Observing Mission (GCOM- W1), 397 Global Positioning System, 136,223 Almanac, 138 Broadcast Ephemeris, 139 Carrier Frequencies, 136 Clock Bias, 136 Coarse Acquisition Code, 136 Doppler Shift, 138 Error Sources, 138 Integer Ambiguity, 137,223 Multipath, 138 Phase Difference Measurements, 137,223, 279 Precise Code, 136 Pseudo-Random Code, 136Pseudolites, 138 Satellites, 138 Self Survey, 137 Goddard Trajectory Determination System, 408 Goldstein, Herbert, 89 GPS Attitude Determination, 223 Gradient, 23 Gravitational Parameter, 104,371,388 Gravity-Gradient Boom, 105 Greenwich Hour Angle, 386 Group, 27 Orthogonal, 28 Special Orthogonal, 28 Gyroscope, 140 Bias or Drift, 144,235,246,257 Coriolis Vibratory, 143 Dry Tuned-Rotor, 141 Dynamic Model Replacement, 245 Fiber Optic, 142 Floated, 140 Hemispheric Resonating, 143 Lock-In, 142 Measurement Model, 143,247,263 MEMS, 143 Misalignment, 144,235,246 Optical, 141 Rate-Integrating, 140,219,263,288 Ring Laser, 142 Scalar Factor, 144,235,246 Spinning-Mass, 140 Strapdown, 140 H Hamilton, William, 17,37 Hayabusa, 147 Herpolhode, 89 Herschel, 401 Hessian, 23 High Energy Astronomy Observatories (HEAO), 2,189 Hilbert-Schmidt Norm, seeMatrix, Frobenius Norm Hoffman, Henry, 12,107 Hoots, Felix, 393 Horizon Sensor, 10,13,135,219 Scanning, 135 Static, 135 Hubble Space Telescope (HST), 3,6,10,13, 112,141 Hughes, Peter, 89 Hyperbolic Orbit, 373 Hysteresis, 168,303,315Index 481 I Inertia Ellipsoid, 89 Inner Product, seeVector, Dot Product Innovations Covariance, 256 International Celestial Reference System (ICRF), seeReference Frame, International Celestial ReferenceSystem (ICRF) International Space Station, 111 International Sun-Earth Explorer 3 (ISEE-3), 401 International Ultraviolet Explorer (IUE), 12 Invariant Plane, 89 Inverted Pendulum, 425 J Jacobian, 22,247,458 Jacobian Elliptic Functions, 95 James Webb Space Telescope (JWST), 152, 155,162,164,401 Jitter, 148 Joint Space Operations Center (JSpOC), 409 Julian Date, 33 Junkins, John, 50 K Kalman Filter, seeEstimation Theory, Kalman Filter Kalman Gain Matrix, 256,464 Joseph Form, 453,465,468 Kane, Thomas, 99 Kaplan, Marshall, 89 Kasdin, Jeremy, 3 Kepler, 147 Kepler’s Equation, 139,376,379 Kepler’s Three Laws, 365 Kepler, Johannes, 365 Keplerian Motion, 113,370 Laplace Vector, 372 Orbital Plane, 371 Kinetic Energy, 79,83,173 Dissipation, 88 ,174 Speciﬁc, seeSpeciﬁc Kinetic Energy Kozai, Yoshihide, 393 Kreutz-Delgado, Kenneth, 14 Kronecker Delta, 24,383 L Lagrange Multiplier, 188,238 Lagrange Points, 297,398 Collinear, 400Three-Body Problem, 398 Triangular, 400 Trojan, 401 Landsat, 10 Laplace Transform, 434 Laplace Vector, seeKeplerian Motion, Laplace Vector Laplacian, 23 LaSalle’s Theorem, 290,443 Latitude, 34 Geocentric, 34,383 Geodetic, 34 Legendre, Adrien-Marie, 451 Lewis, 11,13 Libration, 105,115 Libration Dampers, 105 Libration Points, seeLagrange Points Lightsey, E. Glenn, 137 Liu, Frank, 162 Longitude, 34,383 Low-Earth Orbit, 4,8,277,373 Lunar Atmosphere and Dust Environment Explorer (LADEE), 5 Lyapunov Analysis, 14 Lyapunov Equation, seeControl Theory, Lyapunov Equation Lyapunov Function, seeControl Theory, Lyapunov Function, 443 LaSalle’s Theorem, seeLaSalle’s Theorem Lyapunov’s Direct Method, seeControl Theory, Lyapunov’s Direct Method M Mach’s Principle, 32 Magnetic Dipole, 106,168 Magnetic Field, 106,135,270,307,328,403 Deﬁnitive Geomagnetic Reference Field, 404 Dipole, 404 International Geomagnetic Reference Field, 107,220,275,333,404 Magnetic Field Satellite (Magsat), 2 Magnetic Torque Control, seeAttitude Control, Magnetic Torque Control Magnetic Torquers, 6,168,319 Dipole Moment, 168,311 Magnetometer, 135 Three-Axis, 107,219,269,319,322 Magnetometer Calibration, 235,269 Centered Solution, 272 Batch, 273 Kalman Filtering, 276 Measurement Model, 270482 Index Magnetometer Calibration ( cont. ) Scalar Checking, 269 Sequential, 273 TWOSTEP, 269,274 MAGSAT, 189 Marandi, S. R., 50 Mason, Glenn, 328 MATLAB, 172,322,475 Matrix, 17 Adjoint, 20,29,346 Block Diagonal, 248,254,277 Characteristic Equation, 41,213 Cholesky Decomposition, 176,462 Cross Product, 29,345 Identities, 345 Determinant, 20,29,346 Diagonal, 19,197,248 Direction Cosine Matrix (DCM), 26,27 Eigenvalues and Eigenvectors, 2,40,82, 175,188,213,349,434,436,442, 444,459,471 Exponential, seeMatrix Exponential Frobenius Norm, 186,224 Hessian, 452 Identity, 19 Orthonormal Basis, 25,208 Inverse, 20 Inversion Lemma, seeMatrix Inversion Lemma Nonsingular, 20,255 Null Space, 153 Orthogonal, 27,197,258 Product, 18 Projection, 255 Proper Orthogonal, 28,197 Pseudoinverse, 156 Reﬂection, 61 Singular Value Decomposition, 196,271 Skew Symmetric, 19,29,345 State Transition, seeState Transition Matrix Symmetric, 19 Trace, 19,186,188,197,346 Transpose, 18 Triangular, 19 Zero, 18 Matrix Exponential, 45,251,431 Matrix Inversion Lemma, 453 Maximum Likelihood Estimation, see Estimation Theory, MaximumLikelihood Mean Motion, 113,373,378 Minimax, 157 Mission Mode, 4Mission Planning Graphics Tool, 397 Modi, Vinod, 50 Modiﬁed Rodrigues Parameters, 50,229, 282, 459 Kalman Filtering, 236 Kinematics, 72 Moment of Inertia, 80 Principal Moments, 82,85,94,100,105, 117 Products, 82 Triangle Inequality, 82,117 Moore-Penrose Generalized Inverse, see Matrix, Pseudoinverse Mortari, Daniele, 191 Multimission Modular Spacecraft (MMS), 12, 154,239 Murrell, James, 260 N Natural Frequency, seeControl Theory, Natural Frequency Navigation Base, 31 Nebelecky, Christopher, 382 Newton’s Universal Gravitational Constant, 104,370,383 Newton-Raphson Iteration, 191,379 Nonlinear Least Squares, seeEstimation Theory, Nonlinear Least Squares,274 North American Air Defense Command (NORAD), 393 Nutation, 85,87,174 Body Rate, 91 Inertial Rate, 92 Nutation Dampers, 88,170 Viscous Ring, 171 Nyquist’s Limit, 260,437 O Obliquity of the Ecliptic, 421 Observation Models, 432 Linearization, 434 Measurement Sensitivity Matrix, 241,433 Optical Bench, 31 Orbit Propagation, 379 Orbital Dynamics, 365 Orbital Elements, 138,374 Argument of Periapsis, 374 Eccentric Anomaly, 376 Eccentricity, 113,374 Inclination, 374 Initial Mean Anomaly, 374Index 483 Right Ascension of the Ascending Node, 374 Semimajor Axis, 374 True Anomaly, 113,369,377 Orbital Plane, seeKeplerian Motion, Orbital Plane Orbiting Solar Observatory (OSO 1), 6,8 Ørsted, 8 Outgassing, 111 P Parabolic Orbit, 373 Parallel Axis Theorem, 81 Perigee, seeEllipse Geometry, Periapsis Perturbation Methods, 392 Osculating Orbit, 392 SecularJ2,395 Variation of Parameters, 392 Osculating Elements, 392,393 Pioneer, 6,392 Planck, 401 Poinsot’s Construction, 89 Pointing Error, 4 Modes, 3 Poisson Distribution, 129 Polar Radius, seeEarth Geoid, Polar Radius Polhode, 89 Potter, James, 183 Precession, 113 Principal Axes, 82,174 Major, 85 Minor, 85 Principal Moments of Inertia, seeMoment of Inertia, Principal Moments Probability Density Function, seeEstimation Theory, Probability DensityFunction Procrustes Problem, seeWahba’s Problem Products of Inertia, seeMoment of Inertia, Products Pulse-Width Pulse-Frequency, seeAttitude Control, Thrusters, Pulse-WidthPulse-Frequency Q qMethod, 2,352 qMethod, 187 Quaternion, 3,14,17,37,45,361 Attitude, 45,350 Conjugate, 39,347 Error, 289,354Identities, 345 Identity, 39,347 Inverse, 39 Kinematics, 71,244,289,355 Measurement, 242 Normalization, 237,238 Product, 37,347 Unit, 46 QUEST, 2,189 Sequential Rotations, 192 QUEST Measurement Model, 205,209,225, 249,254 R Radar Calibration (RADCAL), 137 RADARSAT, 398 Random Walk Process, 263 Reaction Wheel Characteristics, 148 Reaction Wheels, 6,100,147,319 Characteristics, 148 Disturbances, 148 Campbell Diagram, 151 Cogging, 152 Dynamic Imbalance, 149 Static Imbalance, 149 Torque Ripple, 152 Waterfall Chart, 152 Whirl Modes, 150 Friction, 148 Redundant Conﬁgurations, 152 Distribution Matrix, 153 Dodecahedron, 155 Minimax (L1)L a w , 157,163 NASA Standard, 154,157,293 Pseudoinverse ( L2)L a w , 155,163 Pyramid, 154–156,160,293 Six-Wheel, 155,157,159 Redundancy, 123 Analytic Redundancy, 124 Block-Redundant, 123 Cold Backup, 123 Cross-Strapped, 123 Hot Backup, 123 Warm Backup, 123 Reference Frame, 10,24,31 Body, 31,80 Celestial, 32,423 Co-Rotating, 398 Earth-Centered/Earth-Fixed (ECEF), 32, 139,270,383,385 Flatley Coordinate System, 325 Geocentric Inertial (GCI), 32,107,109, 375,389,391,405,421484 Index Reference Frame ( cont. ) Hill, 62,118 Inertial, 31 International Celestial Reference System (ICRF), 32,130 Local-Vertical/Local-Horizontal (LVLH), 36,105,112,216,219,339 Perifocal, 374 Transformations, 25 Succesive, 27 Retrograde Orbit, 397 Reynolds Number, 103,172 Riccati Equation, 466 Right Hand Rule, 30 Rigid Body, 80 Dynamics, 84 Torque-Free Dynamics Axial Symmetry, 90 Triaxial Symmetry, 94 Roberson, Robert, 6 Rodrigues Parameters, 48,243 Kalman Filtering, 236 Kinematics, 72 Rodrigues, Olinde, 46,383 Roll/Yaw Coupling, 13,114 Rossi X-Ray Timing Explorer (RXTE), 10 Rotation, 40 Rotation Vector, 44 Kalman Filtering, 236 Kinematics, 72 S Safehold Mode, seeAttitude Control, Safehold Sagnac Effect, 141 SAMPEX Attitude Control, 318 Attitude Determination, 321 Magnetic Torque, 324 Modes, 319,324 Orbit Rate Rotation, 327 Special Pointing, 328 Vertical Pointing, 326 RAM Angle, 325 RAM Vector, 325 Reaction Wheel, 332 Simulations, 333 Velocity Avoidance, 325 Saturation Function, 296,447 Scalar Product, seeVector, Dot Product Schaub, Hanspeter, 50 Schmidt Trigger, 303 Schur Norm, seeMatrix, Frobenius Norm Semi-Synchronous Orbit, 136Semilatus Rectum, seeEllipse Geometry, Semilatus Rectum Separation Theorem, 1,312,470 Separatrix, 87 Sherman-Morrison-Woodbury Formula, see Matrix Inversion Lemma Shuster, Malcolm, 1,2,17,201,254,256,269 Sidereal Day, 3,33 Single-Point Failure, 123 Sliding-Mode Control, seeControl Theory, Sliding-Mode Slosh, 99,102 Smithsonian Air and Space Museum, 397 Solar and Heliospheric Observatory (SOHO), 3,401 Solar Day, 34 Solar Maximum Mission (SMM), 12 Solar Radiation and Climate Experiment (SORCE), 13 Solar Radiation Pressure, 382,390,421 Absorption, 109,391 Diffuse Reﬂection, 109,391 Specular Reﬂection, 109,391 Solar, Anomalous and Magnetospheric Particle Explorer (SAMPEX), 4,289,318 Space Cone, 93 Space Precision Attitude Reference System (SPARS), 2,239 Space Shuttle, 12 Space Technology-5 (ST5), 171 Speciﬁc Angular Momentum, 37,371 Speciﬁc Energy, 371 Speciﬁc Kinetic Energy, 371 Speciﬁc Potential Energy, 371 Spectral Density, 247,258,263,463,465 Spectrum Analysis, 278 Speed of Light, 130 Spherical Harmonics, 383,403 Sputnik, 1,3 Stabilization, 3 Dual-Spin, 6,7 Gravity-Gradient, 8,107,117 Momentum Bias, 8,116,320,324 Spin, 6,84,107,287 Three-Axis, 6,8,14 Star Tracker, 125,242 Accuracy, 128,226 Active Pixel Sensors (APS), 125 CCD, 125 Centroiding, 126 CMOS, 125 Dark Current, 128 Defocusing, 126 Field of View, 127Index 485 Focal Plane Coordinates, 126 Hot Pixels, 128 Initial Attitude Acquisition, 126 Instrument Magnitude, 129 Lost-in-Space Mode, 127 Measurement Model, 254 Point Spread Function, 126 Resolution, 127 Shot Noise, 127 Star Catalogs, 129 Tracking Mode, 126 Stars Differential Aberration, 132 Parallax, 130 Proper Motion, 130 Star Catalog, 129 Stellar Aberration, 130 Visual Magnitude, 129 State Space, seeSystem Modeling, State Space State Transition Matrix, 251,258,429 Stefan-Boltzmann Law, 109,391 Stuelpnagel, John, 196 Sun Sensor, 11,133,219 Coarse, 133,319 Fine or Digital, 133,134,319,321 Sun-Synchronous Orbit, 277,397 Dawn/Dusk, 398 Swift, 155,162 System Modeling, 428 Linearization, 431 Single-Input-Single-Output, 430,433,437 State Space, 430 T Tait-Bryan Angles, 55,361 Kalman Filtering, 236 Kinematics, 361 TANS Vector, 137 TASTE Test, 189 Television Infrared Observation Satellite (TIROS), 135 Tesla, Nikola, 106 Thermal Radiation, 109,392 Third-Body Forces, 388 Three-Body Problem, seeLagrange Points, Three-Body Problem Thrusters, 6,169 Cold Gas, 169 Electric, 170Monopropellant, 169 Speciﬁc Impulse, 169 Time GPS, 139 Greenwich Mean Sidereal Time (GMST), 32 Universal Time (UT), 139 Torque Aerodynamic Torque, 107 Couple, 170 External, 103 Gravity-Gradient, 103,114 Internal, 99 Magnetic, 106 Mass-Expulsion, 110,169 Momentum Exchange, 99 Solar Radiation Pressure, 9,108,297 Torque Rods, seeMagnetic Torquers Total Ozone Mapping Spectrometer-Earth Probe (TOMS-EP), 11 Transfer Function, 434 Characteristic Equation, 437 Poles, 434,438 Transformations, seeReference Frame, Transformations Transit Research and Attitude Control (TRAAC), 8 Transition Region And Coronal Explorer (TRACE), 277 Translational Momentum, 67 TRIAD, 2,183,184,199,208,319 Triangle Inequality, 22 Moment of Inertia, 82 Triaxial, 87 Tropical Rainfall Measuring Mission (TRMM), 5,10,13,124,135,218,275,393 Attitude Determination, 218 Tsiotras, Panagiotis, 52 Two Line Elements, 393 Two-Point Boundary Value Problem, 287,294 TWOSTEP, seeMagnetometer Calibration, TWOSTEP U Unbiased Estimate, seeEstimation Theory, Unbiased Estimate Unscented Kalman Filter, 263 Unwinding, 313 Upper Atmosphere Research Satellite (UARS), 11486 Index V Vallado, David, 389,406 Vander Velde, Wallace, 183 Variable-Structure Control, seeSliding-Mode Control Vector, 21 Abstract, 25 Basis, 24,188 Column, 18 Cross Product, 28 Dot Product, 21,28 Euclidean Norm, 21,156 Kinematics, 70 Nadir, 36,135 Normalization, 21 Orthogonal Projection, 21 Orthonormal, 24,185 Outer Product, 20 Representations, 25 Row, 19 Unit Vector, 21 Zenith, 105,326 Zero, 18 Vector Product, seeVector, Cross Product Vernal Equinox, 32,374vis viva Equation, 374 von Braun, Wernher, 88 W Wahba’s Problem, 2,183,186,224 Attitude Proﬁle Matrix, 186,196,198,202, 352 Covariance Analysis, 204 Two Observations, 207 Davenport’sKMatrix, 187,193,352 Error Analysis, 201 SVD Method, 196 Two Observations, 199 Observability, 213 Wahba, Grace, 2,186 Weber Number, 103 Wen, John, 14 Wie, Bong, 14 Wiener, T. F., 50 Wilkinson Microwave Anisotropy Probe (WMAP), 4,5,26,111,125,134, 288,297,318,336,401 WIND, 401